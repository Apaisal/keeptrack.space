(function(){"use strict";function e(e,t){var a="   "+e;return a.substr(a.length-t)}function t(e,t,a,r,s,o){if(e)return 367*e-Math.floor(7*(e+Math.floor((t+9)/12))*.25)+Math.floor(275*t/9)+a+1721013.5+((o/60+s)/60+r)/24;{var i;i=Date.now();let e=new Date(i.getFullYear(),0,0),t=i-e;return Math.floor(t/n)}}const a=2*Math.PI,r=a/360,s=360/a,o=1440,n=1.15741e-8;satellite.lookanglesInterval=5,satellite.lookanglesLength=2,satellite.isRiseSetLookangles=!1,satellite.currentEpoch=(e=>{function t(e,a){return e.length<a?t("0"+e,a):e}e=new Date(e);let a=e.getUTCFullYear();a=parseInt(a.toString().substr(2,2));let r=t(timeManager.getDayOfYear(e),3),s=(60*e.getUTCHours()+e.getUTCMinutes())/1440;return r=(r+s).toFixed(8),r=t(r,12),[a,r]}),satellite.distance=((e,t)=>{if(null==e||null==t)return"";if(e=satSet.getSat(e.id),t=satSet.getSat(t.id),null==t||null==e)return"";if("Star"===t.type||"Star"===e.type)return"";let a=Math.pow(e.position.x-t.position.x,2),r=Math.pow(e.position.y-t.position.y,2),s=Math.pow(e.position.z-t.position.z,2),o=Math.sqrt(a+r+s).toFixed(0);return"<br />Range: "+o+" km"}),satellite.setobs=(e=>{if(void 0===e)return sensorManager.currentSensor=sensorManager.defaultSensor,void $(".sensor-reset-menu").hide();$("#menu-sensor-info").removeClass("bmenu-item-disabled"),$("#menu-fov-bubble").removeClass("bmenu-item-disabled"),$("#menu-surveillance").removeClass("bmenu-item-disabled"),$("#menu-planetarium").removeClass("bmenu-item-disabled"),$("#menu-astronomy").removeClass("bmenu-item-disabled"),$(".sensor-reset-menu").show(),sensorManager.currentSensor=e,sensorManager.currentSensor.observerGd={latitude:e.lat*r,longitude:e.long*r,height:parseFloat(e.obshei)}}),satellite.altitudeCheck=((e,t,a)=>{let r=satellite.twoline2satrec(e,t),s=timeManager.propTimeCheck(a,timeManager.propRealTime),i=timeManager.jday(s.getUTCFullYear(),s.getUTCMonth()+1,s.getUTCDate(),s.getUTCHours(),s.getUTCMinutes(),s.getUTCSeconds());i+=s.getUTCMilliseconds()*n;let l,g=satellite.gstime(i),u=(i-r.jdsatepoch)*o,c=satellite.sgp4(r,u);try{l=satellite.eciToGeodetic(c.position,g)}catch(e){return 0}return l.height}),satellite.getTEARR=((e,t,a)=>{if(!objectManager.isSensorManagerLoaded)throw new Error("satellite.getTEARR requires sensorManager");let i={};if(void 0===t){if(void 0===sensorManager.currentSensor)throw new Error("getTEARR requires a sensor or for a sensor to be currently selected.");t=sensorManager.currentSensor}if(void 0===t.observerGd){try{t.observerGd={height:t.obshei,latitude:t.lat,longitude:t.long}}catch(e){throw"observerGd is not set and could not be guessed."}if(void 0===t.observerGd.longitude)try{t.observerGd={height:t.alt,latitude:t.lat*r,longitude:t.lon*r}}catch(e){throw"observerGd is not set and could not be guessed."}}let l,g=satellite.twoline2satrec(e.TLE1,e.TLE2);l=void 0!==a?a:timeManager.propTime();let u=timeManager.jday(l.getUTCFullYear(),l.getUTCMonth()+1,l.getUTCDate(),l.getUTCHours(),l.getUTCMinutes(),l.getUTCSeconds());u+=l.getUTCMilliseconds()*n;let c=satellite.gstime(u),d=(u-g.jdsatepoch)*o,m=satellite.sgp4(g,d);try{let e=satellite.eciToGeodetic(m.position,c);i.alt=e.height,i.lon=e.longitude,i.lat=e.latitude;let a=satellite.eciToEcf(m.position,c),r=satellite.ecfToLookAngles(t.observerGd,a);i.azimuth=r.azimuth*s,i.elevation=r.elevation*s,i.range=r.rangeSat}catch(e){i.alt=0,i.lon=0,i.lat=0,i.azimuth=0,i.elevation=0,i.range=0}return i.inview=satellite.checkIsInFOV(t,{az:i.azimuth,el:i.elevation,range:i.range}),uiManager.currentTEARR=i,i}),satellite.nextpassList=(e=>{let t=[];for(let a=0;a<e.length;a++){let r=satellite.nextNpasses(e[a],void 0,864e5,satellite.lookanglesInterval,settingsManager.nextNPassesCount);for(let s=0;s<r.length;s++)t.push({SCC_NUM:e[a].SCC_NUM,time:r[s]})}return t}),satellite.nextpass=((e,t,a,r)=>{if(void 0===t){if(void 0===sensorManager.currentSensor)throw"getTEARR requires a sensor or for a sensor to be currently selected.";t=sensorManager.currentSensor}if(void 0===t.observerGd)try{t.observerGd={height:t.obshei,latitude:t.lat,longitude:t.long}}catch(e){throw"observerGd is not set and could not be guessed."}void 0===a&&(a=satellite.lookanglesLength),void 0===r&&(r=satellite.lookanglesInterval);let s=timeManager.getPropOffset(),o=0,n=satellite.twoline2satrec(e.TLE1,e.TLE2);for(let e=0;e<24*a*60*60;e+=r){o=1e3*e+s;let a=timeManager.propTimeCheck(o,timeManager.propRealTime),r=satellite.getRae(a,n,t),i=satellite.checkIsInFOV(t,r);if(i)return timeManager.dateFormat(a,"isoDateTime",!0)}return"No Passes in "+satellite.lookanglesLength+" Days"}),satellite.nextNpasses=((e,t,r,s,n)=>{if(void 0===t){if(void 0===sensorManager.currentSensor)throw"getTEARR requires a sensor or for a sensor to be currently selected.";t=sensorManager.currentSensor}if(void 0===t.observerGd)try{t.observerGd={height:t.obshei,latitude:t.lat,longitude:t.long}}catch(e){throw"observerGd is not set and could not be guessed."}void 0===r&&(r=satellite.lookanglesLength),void 0===s&&(s=satellite.lookanglesInterval);let i=[],l=timeManager.getPropOffset(),g=satellite.twoline2satrec(e.TLE1,e.TLE2);const u=o/(g.no*o/a);for(let e=0;e<24*r*60*60;e+=s){if(i.length>=n)return i;let a=e+l,r=timeManager.propTimeCheck(1e3*a,timeManager.propRealTime),s=satellite.getRae(r,g,t),o=satellite.checkIsInFOV(t,s);o&&(i.push(r),e+=60*u*.75)}return i}),satellite.lastlooksArray=[],satellite.getlookangles=(e=>{function t(e,t){let a=sensorManager.currentSensor;var r=Date.now(),o=timeManager.propTimeCheck(e,r);let n=satellite.getRae(o,t,a),i=satellite.checkIsInFOV(a,n);if(i){if(satellite.isRiseSetLookangles){let e=new Date;e.setTime(Number(o)-1e3*s);let r=satellite.getRae(e,t,a),i=satellite.checkIsInFOV(a,r);if(!i)return{time:timeManager.dateFormat(o,"isoDateTime",!0),rng:n.range,az:n.az,el:n.el};{e.setTime(Number(o)+1e3*s),r=satellite.getRae(e,t,a);let i=satellite.checkIsInFOV(a,r);if(!i)return{time:timeManager.dateFormat(o,"isoDateTime",!0),rng:n.range,az:n.az,el:n.el}}return}return{time:timeManager.dateFormat(o,"isoDateTime",!0),rng:n.range,az:n.az,el:n.el}}}if(!sensorManager.checkSensorSelected())return void console.warn("satellite.getlookangles requires a sensor to be set!");let a=timeManager.getPropOffset(),r=satellite.twoline2satrec(e.TLE1,e.TLE2),s=satellite.isRiseSetLookangles?1:satellite.lookanglesInterval,o=[];for(let e=0;e<24*satellite.lookanglesLength*60*60;e+=s){let s=1e3*e+a,n=t(s,r);if(void 0!==n&&o.push(n),o.length>=1500)break}o.sort(function(e,t){return new Date(e.time)-new Date(t.time)}),satellite.lastlooksArray=o,function(){var e=document.getElementById("looks");e.innerHTML="";var t=e.insertRow(),a=t.insertCell();a.appendChild(document.createTextNode("Time")),a.setAttribute("style","text-decoration: underline");var r=t.insertCell();r.appendChild(document.createTextNode("El")),r.setAttribute("style","text-decoration: underline");var s=t.insertCell();s.appendChild(document.createTextNode("Az")),s.setAttribute("style","text-decoration: underline");var n=t.insertCell();n.appendChild(document.createTextNode("Rng")),n.setAttribute("style","text-decoration: underline");for(let t=0;t<o.length;t++){let a;if(e.rows.length>0)for(let r=0;r<e.rows.length;r++){var i=e.rows[r].cells[0].textContent,l=parseInt(i.substr(0,4)),g=parseInt(i.substr(5,2))-1,u=parseInt(i.substr(8,2)),c=parseInt(i.substr(11,2)),d=parseInt(i.substr(14,2)),m=parseInt(i.substr(17,2)),p=new Date(l,g,u,c,d,m);if(p.setUTCDate(u),p.setUTCHours(c),o[t].time<p){a=e.insertRow(t);break}}null==a&&(a=e.insertRow());let r=a.insertCell();r.appendChild(document.createTextNode(timeManager.dateFormat(o[t].time,"isoDateTime",!1)));let s=a.insertCell();s.appendChild(document.createTextNode(o[t].el.toFixed(1)));let n=a.insertCell();n.appendChild(document.createTextNode(o[t].az.toFixed(0)));let T=a.insertCell();T.appendChild(document.createTextNode(o[t].rng.toFixed(0)))}}()}),satellite.lastMultiSiteArray=[],satellite.getlookanglesMultiSite=(e=>{function t(e,t,a){var r=Date.now(),s=timeManager.propTimeCheck(e,r);let o=satellite.getRae(s,t,a),n=satellite.checkIsInFOV(a,o);if(n)return{time:s.toISOString(),el:o.el,az:o.az,rng:o.range,name:a.shortName}}let r=!1;sensorManager.checkSensorSelected()||(r=!0),sensorManager.tempSensor=sensorManager.currentSensor;let s=timeManager.getPropOffset(),n=satellite.twoline2satrec(e.TLE1,e.TLE2);const i=o/(n.no*o/a);let l=[];for(let e=0;e<sensorManager.sensorListUS.length;e++){satellite.setobs(sensorManager.sensorListUS[e]);for(let a=0;a<24*satellite.lookanglesLength*60*60;a+=satellite.lookanglesInterval){let r=1e3*a+s,o=t(r,n,sensorManager.sensorListUS[e]);void 0!==o&&(l.push(o),a+=60*i*.75)}}l.sort(function(e,t){return new Date(e.time)-new Date(t.time)}),satellite.lastMultiSiteArray=l,function(){var e=document.getElementById("looksmultisite");e.innerHTML="";var t=e.insertRow(),a=t.insertCell();a.appendChild(document.createTextNode("Time")),a.setAttribute("style","text-decoration: underline");var r=t.insertCell();r.appendChild(document.createTextNode("El")),r.setAttribute("style","text-decoration: underline");var s=t.insertCell();s.appendChild(document.createTextNode("Az")),s.setAttribute("style","text-decoration: underline");var o=t.insertCell();o.appendChild(document.createTextNode("Rng")),o.setAttribute("style","text-decoration: underline");var n=t.insertCell();n.appendChild(document.createTextNode("Sensor")),n.setAttribute("style","text-decoration: underline");for(let t=0;t<l.length;t++){let a;if(e.rows.length>0)for(let r=0;r<e.rows.length;r++){var i=e.rows[r].cells[0].textContent,g=parseInt(i.substr(0,4)),u=parseInt(i.substr(5,2))-1,c=parseInt(i.substr(8,2)),d=parseInt(i.substr(11,2)),m=parseInt(i.substr(14,2)),p=parseInt(i.substr(17,2)),T=new Date(g,u,c,d,m,p);if(T.setUTCDate(c),T.setUTCHours(d),l[t].time<T){a=e.insertRow(t);break}}null==a&&(a=e.insertRow());let r=a.insertCell();r.appendChild(document.createTextNode(timeManager.dateFormat(l[t].time,"isoDateTime",!0)));let s=a.insertCell();s.appendChild(document.createTextNode(l[t].el.toFixed(1)));let o=a.insertCell();o.appendChild(document.createTextNode(l[t].az.toFixed(0)));let n=a.insertCell();n.appendChild(document.createTextNode(l[t].rng.toFixed(0)));let h=a.insertCell();h.appendChild(document.createTextNode(l[t].name))}}(),sensorManager.currentSensor=r?sensorManager.defaultSensor:sensorManager.tempSensor}),satellite.satSensorFOV=((e,a)=>{function r(e,a){let r=t(e.getUTCFullYear(),e.getUTCMonth()+1,e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds());r+=e.getUTCMilliseconds()*n;let s=satellite.gstime(r),i=(r-a.jdsatepoch)*o,l=satellite.sgp4(a,i);return satellite.eciToEcf(l.position,s)}let s=timeManager.getPropOffset(),i=Date.now(),l=timeManager.propTimeCheck(s,i),g=satellite.twoline2satrec(e.TLE1,e.TLE2),u=r(l,g),c=satellite.twoline2satrec(a.TLE1,a.TLE2),d=r(l,c);console.log(u),console.log(d)}),satellite.findCloseObjects=(()=>{function e(e,a){let r=new Date;r.setTime(Number(Date.now())+e);let s=t(r.getUTCFullYear(),r.getUTCMonth()+1,r.getUTCDate(),r.getUTCHours(),r.getUTCMinutes(),r.getUTCSeconds());s+=r.getUTCMilliseconds()*n;let i=(s-a.jdsatepoch)*o;return satellite.sgp4(a,i)}let a=[],r=[];for(let t=0;t<satSet.numSats;t++){let a=satSet.getSat(t);if(void 0===a.TLE1)continue;if(a.apogee>5556)continue;a.satrec=satellite.twoline2satrec(a.TLE1,a.TLE2);let s=e(0,a.satrec);a.position=s.position,void 0!==a.position&&r.push(a)}for(let e=0;e<r.length;e++){let t=r[e],s=t.position,o=s.x-20,n=s.x+20,i=s.y-20,l=s.y+20,g=s.z-20,u=s.z+20;for(let e=0;e<r.length;e++){let s=r[e];if(t==s)continue;let c=s.position;c.x<n&&c.x>o&&c.y<l&&c.y>i&&c.z<u&&c.z>g&&a.push({sat1:t,sat2:s})}}let s=Array.from(new Set(a));a=[],r=[];for(let t=0;t<s.length;t++){let a=s[t].sat1,r=e(18e5,a.satrec);s[t].sat1.position=r.position,a=s[t].sat2,r=e(18e5,a.satrec),a.position=r.position,s[t].sat2.position=r.position}r=Array.from(new Set(r));for(let e=0;e<s.length;e++){let t=s[e].sat1,r=t.position;if(void 0===r)continue;let o=r.x-20,n=r.x+20,i=r.y-20,l=r.y+20,g=r.z-20,u=r.z+20,c=s[e].sat2,d=c.position;void 0!==d&&(d.x<n&&d.x>o&&d.y<l&&d.y>i&&d.z<u&&d.z>g&&(a.push(t.SCC_NUM),a.push(c.SCC_NUM)))}s=Array.from(new Set(a));let i="";for(let e=0;e<s.length;e++)e==s.length-1?i+=s[e]:i+=s[e]+",";searchBox.doSearch(i)}),satellite.getOrbitByLatLon=((e,t,a,r,i,l,g)=>{function u(e,t){return e.length<t?u("0"+e,t):e}function c(t){var a,r,o=satellite.twoline2satrec(e.TLE1,e.TLE2);a=void 0===M?(o.mo*s).toPrecision(10):M,a=a.split("."),a[0]=a[0].substr(-3,3),a[1]=a[1].substr(0,4),a=(a[0]+"."+a[1]).toString(),a=u(a,8),r=void 0===b?(e.raan*s).toPrecision(7):b,r=r.split("."),r[0]=r[0].substr(-3,3),r[1]=r[1].substr(0,4),r=(r[0]+"."+r[1]).toString(),r=u(r,8),b=r;var n=e.SCC_NUM,l=e.TLE1.substr(9,8),g=(e.inclination*s).toPrecision(7);g=g.split("."),g[0]=g[0].substr(-3,3),g[1]=g[1].substr(0,4),g=(g[0]+"."+g[1]).toString(),g=u(g,8);var c=e.TLE1.substr(18,2),d=e.TLE1.substr(20,12),m=e.TLE2.substr(52,11),f=e.eccentricity.toPrecision(7).substr(2,7);t/=10,t=parseFloat(t).toPrecision(7),t=u(t,8);var C=e.TLE1.substr(32,39);T="1 "+n+"U "+l+" "+c+d+C,h="2 "+n+" "+g+" "+r+" "+f+" "+t+" "+a+" "+m+"    10",o=satellite.twoline2satrec(T,h);var S=p(i,o,3);return e.TLE1=T,e.TLE2=h,v=t,S}function d(t){var a=satellite.twoline2satrec(e.TLE1,e.TLE2);t/=10,t=parseFloat(t).toPrecision(7),t=u(t,8);var r=(e.raan*s).toPrecision(7);b=r,r=r.toString().split("."),r[0]=r[0].substr(-3,3),r[1]=r[1].substr(0,4),r=(r[0]+"."+r[1]).toString(),r=u(r,8);var o=e.SCC_NUM,n=e.TLE1.substr(9,8),l=(e.inclination*s).toPrecision(7);l=l.split("."),l[0]=l[0].substr(-3,3),l[1]=l[1].substr(0,4),l=(l[0]+"."+l[1]).toString(),l=u(l,8);var g,c=e.TLE1.substr(18,2),d=e.TLE1.substr(20,12),m=e.TLE2.substr(52,11),f=e.eccentricity.toPrecision(7).substr(2,7);g=void 0===v?(e.argPe*s).toPrecision(7):v,g=g.split("."),g[0]=g[0].substr(-3,3),g[1]=g[1].substr(0,4),g=(g[0]+"."+g[1]).toString(),g=u(g,8);var C=e.TLE1.substr(32,39),S="1 "+o+"U "+n+" "+c+d+C,x="2 "+o+" "+l+" "+r+" "+f+" "+g+" "+t+" "+m+"    10";a=satellite.twoline2satrec(S,x);var w=p(i,a,1);return 1===w&&(T=S,h=x,e.TLE1=S,e.TLE2=x,M=t),w}function m(t,a){var r=satellite.twoline2satrec(e.TLE1,e.TLE2),o=M;let n=t;t/=100,t>360&&(t-=360),t=t.toPrecision(7),t=t.split("."),t[0]=t[0].substr(-3,3),t[1]=t[1].substr(0,4),t=(t[0]+"."+t[1]).toString(),t=u(t,8),b=t;var l=e.SCC_NUM,g=e.TLE1.substr(9,8),c=(e.inclination*s).toPrecision(7);c=c.split("."),c[0]=c[0].substr(-3,3),c[1]=c[1].substr(0,4),c=(c[0]+"."+c[1]).toString(),c=u(c,8);var d,m=e.TLE1.substr(18,2),f=e.TLE1.substr(20,12),C=e.TLE2.substr(52,11),S=e.eccentricity.toPrecision(7).substr(2,7);d=void 0===v?(e.argPe*s).toPrecision(7):v,d=d.split("."),d[0]=d[0].substr(-3,3),d[1]=d[1].substr(0,4),d=(d[0]+"."+d[1]).toString(),d=u(d,8);var x=e.TLE1.substr(32,39);T="1 "+l+"U "+g+" "+m+f+x,h="2 "+l+" "+c+" "+t+" "+S+" "+d+" "+o+" "+C+"    10",r=satellite.twoline2satrec(T,h);var w=p(i,r,2);return 1===w&&(e.TLE1=T,t=n/100+a,t>360&&(t-=360),t<0&&(t+=360),t=t.toPrecision(7),t=t.split("."),t[0]=t[0].substr(-3,3),t[1]=t[1].substr(0,4),t=(t[0]+"."+t[1]).toString(),t=u(t,8),b=t,h="2 "+l+" "+c+" "+t+" "+S+" "+d+" "+o+" "+C+"    10",e.TLE2=h),w}function p(e,r,s){timeManager.propRealTime=Date.now();var i=timeManager.propTimeCheck(e,timeManager.propRealTime),g=timeManager.jday(i.getUTCFullYear(),i.getUTCMonth()+1,i.getUTCDate(),i.getUTCHours(),i.getUTCMinutes(),i.getUTCSeconds());g+=i.getUTCMilliseconds()*n;var u,c,d,m,p=satellite.gstime(g),T=(g-r.jdsatepoch)*o,h=satellite.sgp4(r,T);void 0===h&&console.log(r);try{u=satellite.eciToGeodetic(h.position,p)}catch(e){return console.warn(e),2}if(c=1*satellite.degreesLat(u.latitude),d=1*satellite.degreesLong(u.longitude),m=u.height,null==S&&(S=c),1===s){if(c===S)return 0;c>S&&(x="N"),c<S&&(x="S"),S=c}return c>t-.15&&c<t+.15&&1===s?1:d>a-.15&&d<a+.15&&2===s?1:m>l-30&&m<l+30&&3===s?1:(c>t-11&&c<t+11||1!==s)&&(d>a-11&&d<a+11||2!==s)?(m<l-100||m>l+100)&&3===s?5:0:5}var T,h,M,b,v,f,C,S,x,w;for(void 0===g&&(g=0),w=0;w<5200;w+=1){if(C=d(w),1===C){if(x===r)break;w+=20}5===C&&(w+=100)}if(2===C)return console.warn("meanACalcResults failed after trying all combinations!"),["Error",""];if(void 0!==l&&0!==l)for(C=0,w=0;w<3600&&(f=c(w),1!==f||1!==C||x!==r);w+=1){if(5===f&&(w+=50),2===f)return["Error",""];for(var L=0;L<5200;L+=1){if(C=d(L),1===C){if(x===r)break;L+=20}if(5===C&&(L+=100),2===C)return["Error",""]}}for(w=0;w<52e4;w+=1){var U=m(w,g);if(1===U)break;5===U&&(w+=1e3)}return[T,h]}),satellite.calculateLookAngles=((e,t,a)=>{function s(e,a){let r=new Date;r.setTime(Number(Date.now())+e);let s=satellite.getRae(r,a,t),o=satellite.checkIsInFOV(t,s);if(o){if(satellite.isRiseSetLookangles){var n=new Date;n.setTime(Number(Date.now())+e-1e3*satellite.lookanglesInterval);let o=satellite.getRae(n,a,t),i=satellite.checkIsInFOV(t,o);return i?(n.setTime(Number(Date.now())+e-1e3*satellite.lookanglesInterval),o=satellite.getRae(n,a,t),i=satellite.checkIsInFOV(t,o),i?void 0:{time:timeManager.dateFormat(r,"isoDateTime",!0),rng:s.range,az:s.az,el:s.el}):{time:timeManager.dateFormat(r,"isoDateTime",!0),rng:s.range,az:s.az,el:s.el}}return{time:timeManager.dateFormat(r,"isoDateTime",!0),rng:s.range,az:s.az,el:s.el}}return!1}(function(){if(void 0===t){if(!sensorManager.checkSensorSelected())return void console.error("getlookangles2 requires a sensor!");t=sensorManager.currentSensor}else{if(void 0===t.obsminaz)return void console.error("sensor format incorrect");t.observerGd={latitude:t.lat*r,longitude:t.long*r,height:parseFloat(t.obshei)}}void 0===e?console.error("sat parameter required!"):void 0!==e.TLE1&&void 0!==e.TLE2||console.error("sat parameter invalid format!"),void 0===a&&(a=0),void 0===satellite.isRiseSetLookangles&&(satellite.isRiseSetLookangles=!1)})(),void 0===a&&(a=0);var o,n=0,i=satellite.twoline2satrec(e.TLE1,e.TLE2),l=[];satellite.isRiseSetLookangles&&(o=satellite.lookanglesInterval,satellite.lookanglesInterval=1);for(var g=0;g<24*satellite.lookanglesLength*60*60;g+=satellite.lookanglesInterval)if(n=1e3*g+a,l.length<=5e3){let e=s(n,i);0==e&&l.push(e)}return satellite.isRiseSetLookangles&&(satellite.lookanglesInterval=o),l}),satellite.findBestPasses=((e,t)=>{for(var a=e.split(","),r=[],s=0;s<a.length;s++)try{for(var o=satSet.getSat(satSet.getIdFromObjNum(a[s])),n=satellite.findBestPass(o,t,0),i=0;i<n.length;i++)r.push(n[i])}catch(e){console.warn(e)}let l=r.sort((e,t)=>t.sortTime-e.sortTime);l.reverse(),l.forEach(function(e){delete e.sortTime});for(let e=0;e<l.length;e++)l[e].startDate=l[e].startDate.toISOString().split("T")[0],l[e].startTime=l[e].startTime.toISOString().split("T")[1].split(".")[0],l[e].stopDate=l[e].stopDate.toISOString().split("T")[0],l[e].stopTime=l[e].stopTime.toISOString().split("T")[1].split(".")[0];uiManager.saveCsv(l,"bestSatTimes")}),satellite.findBestPass=((e,t,s)=>{function n(e,a){let r=new Date;r.setTime(Number(Date.now())+e);let s=satellite.getRae(r,a,t),o=satellite.checkIsInFOV(t,s);if(o){let o=new Date;o.setTime(Number(Date.now())+e-1e3*u);let n=satellite.getRae(o,a,t),i=satellite.checkIsInFOV(t,n);if(i){if(o.setTime(Number(Date.now())+e+1e3*u),n=satellite.getRae(o,a,t),i=satellite.checkIsInFOV(t,n),!i){f=s.el<=3.5,d=Math.min((r-h)/1e3/60*10/8,10);let e=Math.min(b/40*10,10);e-=Math.max((b-50)/5,0),e*=v&&f?2:1,d+=e,d+=Math.min(9e3/M,10),d-=Math.max((900-M)/10,0);let t=0;try{t=(r-h)/1e3}catch(e){t=0}return{sortTime:h,scc:a.satnum,score:d,startDate:h,startTime:h,startAz:m,startEl:p,startRange:T,stopDate:r,stopTime:r,stopAz:s.az.toFixed(0),stopEl:s.el.toFixed(1),stopRange:s.range.toFixed(0),tic:t,minRange:M.toFixed(0),passMaxEl:b.toFixed(1)}}}else s.el<=3.5&&(v=!0),h=r,m=s.az.toFixed(0),p=s.el.toFixed(1),T=s.range.toFixed(0);b<s.el&&(b=s.el),M>s.range&&(M=s.range)}}(function(){if(void 0===t){if(!sensorManager.checkSensorSelected())return void console.error("getlookangles2 requires a sensor!");t=sensorManager.currentSensor}else{if(void 0===t.obsminaz)return void console.error("sensor format incorrect");t.observerGd={latitude:t.lat*r,longitude:t.long*r,height:parseFloat(t.obshei)}}void 0===e?console.error("sat parameter required!"):void 0!==e.TLE1&&void 0!==e.TLE2||console.error("sat parameter invalid format!")})(),void 0===s&&(s=0);var i=0,l=satellite.twoline2satrec(e.TLE1,e.TLE2),g=[];let u=5,c=7;for(var d=0,m=null,p=null,T=null,h=null,M=t.obsmaxrange,b=0,v=!1,f=!1,C=o/(l.no*o/a),S=0;S<24*c*60*60;S+=u)if(i=1e3*S+s,g.length<=5e3){let e=n(i,l);void 0!==e&&(g.push(e),d=0,m=null,p=null,T=null,h=null,M=t.obsmaxrange,b=0,v=!1,f=!1,S+=60*C*.75)}return g}),satellite.getRae=((e,a,r)=>{let i=t(e.getUTCFullYear(),e.getUTCMonth()+1,e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds());i+=e.getUTCMilliseconds()*n;let l=satellite.gstime(i),g=(i-a.jdsatepoch)*o,u=satellite.sgp4(a,g);if(void 0===u||null==u)return console.debug("positionEci failed in satellite.getRae()"),{az:0,el:0,range:0};let c=satellite.eciToEcf(u.position,l),d=satellite.ecfToLookAngles(r.observerGd,c),m=d.azimuth*s,p=d.elevation*s,T=d.rangeSat;return{az:m,el:p,range:T}}),satellite.genMlData={},satellite.genMlData.eci2inc=((e,a)=>{let r=timeManager.propTime(),i=[],l=[],g=[],u=[],c=[],d=satSet.getSatData(),m=0,p=!1;for(let T=e;T<a&&!d[T].static;T++){c=[];for(let e=0;e<3;e++){c[e]=[];let a=new Date(1*r+12e4*T*e),s=t(a.getUTCFullYear(),a.getUTCMonth()+1,a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds());s+=a.getUTCMilliseconds()*n;let i=satellite.twoline2satrec(d[T].TLE1,d[T].TLE2),l=(s-i.jdsatepoch)*o,g=satellite.sgp4(i,l);try{c[e].push(1*a,g.position.x,g.position.y,g.position.z,g.velocity.x,g.velocity.y,g.velocity.z)}catch(e){p=!0;break}}p?p=!1:(5==m?(m=0,g.push(c),u.push([d[T].inclination*s,d[T].raan*s,d[T].eccentricity,d[T].argPe*s,d[T].meanMotion])):(i.push(c),l.push([d[T].inclination*s,d[T].raan*s,d[T].eccentricity,d[T].argPe*s,d[T].meanMotion])),m++)}console.log(i.length),console.log(l.length),console.log(g.length),console.log(u.length),uiManager.saveVariable(i,"train-data.json"),uiManager.saveVariable(l,"train-target.json"),uiManager.saveVariable(g,"test-data.json"),uiManager.saveVariable(u,"test-target.json")}),satellite.genMlData.tlePredict=((e,a)=>{let r=timeManager.propTime(),s=[],i=[],l=satSet.getSatData(),g=!1;for(let u=e;u<a&&!l[u].static;u++){i=[];for(let e=0;e<3;e++){i[e]=[];let a=new Date(1*r+1e4*e),s=t(a.getUTCFullYear(),a.getUTCMonth()+1,a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds());s+=a.getUTCMilliseconds()*n;let c=satellite.twoline2satrec(l[u].TLE1,l[u].TLE2),d=(s-c.jdsatepoch)*o,m=satellite.sgp4(c,d);try{i[e].push(1*a,m.position.x,m.position.y,m.position.z,m.velocity.x,m.velocity.y,m.velocity.z)}catch(e){g=!0;break}}g?g=!1:s.push(i)}console.log(s.length),uiManager.saveVariable(s,"metObs.json")}),satellite.eci2Rae=((e,a,r)=>{e=new Date(e);let o=t(e.getUTCFullYear(),e.getUTCMonth()+1,e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds());o+=e.getUTCMilliseconds()*n;let i=satellite.gstime(o),l=satellite.eciToEcf(a.position,i),g=satellite.ecfToLookAngles(r.observerGd,l),u=g.azimuth*s,c=g.elevation*s,d=g.rangeSat;return{az:u,el:c,range:d}}),satellite.getEci=((e,a)=>{let r=t(a.getUTCFullYear(),a.getUTCMonth()+1,a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds());r+=a.getUTCMilliseconds()*n;let s=satellite.twoline2satrec(e.TLE1,e.TLE2),i=(r-s.jdsatepoch)*o;return satellite.sgp4(s,i)}),satellite.findNearbyObjectsByOrbit=(e=>{if(void 0===e||null==e)return;let t=satSet.getSatData(),a=[],r=1.05*e.period,s=.95*e.period,o=1.025*e.inclination,n=.975*e.inclination,i=1.025*e.raan,l=.975*e.raan;for(let e=0;e<t.length;e++){let g=t[e];if(g.static)break;g.period>r||g.period<s||(g.inclination>o||g.inclination<n||g.raan>i||g.raan<l||a.push(g.id))}return a}),satellite.findClosestApproachTime=((e,t,a,r)=>{let s={};void 0===r&&(r=86400);let o=1e6;for(let n=0;n<r;n++){let r=a+1e3*n,i=timeManager.propTimeCheck(r,timeManager.propRealTime),l=satellite.getEci(e,i),g=satellite.getEci(t,i),u=Math.sqrt((l.position.x-g.position.x)**2+(l.position.y-g.position.y)**2+(l.position.z-g.position.z)**2);u<o&&(o=u,s={time:i,propOffset:a+1e3*n,dist:u,velX:l.velocity.x-g.velocity.x,velY:l.velocity.y-g.velocity.y,velZ:l.velocity.z-g.velocity.z})}return s}),satellite.createManeuverAnalyst=((t,a,r,s)=>{var o,n,i,l=satSet.getSat(t),g=l,u=l.getTEARR();o=satellite.degreesLat(u.lat),n=satellite.degreesLong(u.lon),i=u.alt;var c,d=l.getDirection(),m=satellite.currentEpoch(timeManager.propTime());l.TLE1=l.TLE1.substr(0,18)+m[0]+m[1]+l.TLE1.substr(32),cameraManager.camSnapMode=!1,c=l.apogee-l.perigee<300?satellite.getOrbitByLatLon(l,o,n,d,timeManager.propOffset):satellite.getOrbitByLatLon(l,o,n,d,timeManager.propOffset,i);var p=c[0],T=c[1];t=satSet.getIdFromObjNum(8e4);var h=satSet.getSat(t);h=g;var M,b="1 "+8e4+p.substr(7);M=h.apogee-h.perigee<300?satellite.getOrbitByLatLon(h,o,n,d,timeManager.propOffset,0,s):satellite.getOrbitByLatLon(h,o,n,d,timeManager.propOffset,i,s),b=M[0],C=M[1];var v=T.substr(8,8);v=(parseFloat(v)+a).toPrecision(7),v=v.split("."),v[0]=v[0].substr(-3,3),v[1]?v[1]=v[1].substr(0,4):v[1]="0000",v=(v[0]+"."+v[1]).toString(),v=e(v,8);var f=C.substr(52,10);f=parseFloat(f*r).toPrecision(10),f=f.split("."),f[0]=f[0].substr(-2,2),f[1]?f[1]=f[1].substr(0,8):f[1]="00000000",f=(f[0]+"."+f[1]).toString();var C="2 80000 "+v+" "+C.substr(17,35)+f+C.substr(63);return h=satSet.getSat(t),h.TLE1=b,h.TLE2=C,h.active=!0,satellite.altitudeCheck(b,C,timeManager.propOffset)>1?(satCruncher.postMessage({typ:"satEdit",id:t,TLE1:b,TLE2:C}),orbitManager.updateOrbitBuffer(t,!0,b,C),!0):(console.warn("Breakup Generator Failed"),!1)}),satellite.findChangeOrbitToDock=((e,t,a,r)=>{let s=0,o=0,n=1,i={dist:1e6};for(let s=-1;s<=1;s++)for(let o=-1;o<=1;o++)for(let n=.95;n<=1.05;n+=.05)if(satellite.createManeuverAnalyst(e.id,s,n,o)){let e=satellite.findClosestApproachTime(satSet.getSatFromObjNum(8e4),t,a,r);e.dist<i.dist&&(i=e,console.log(`Distance: ${i.dist}`),console.log(`Time: ${i.time}`),console.log(satSet.getSatFromObjNum(8e4)))}console.log(`${e.inclination+s}`),console.log(`${e.raan+o}`),console.log(`${e.meanMotion*n}`),satellite.createManeuverAnalyst(e.id,s,n,o)}),satellite.checkIsInFOV=((e,t)=>{let a=t.az,r=t.el,s=t.range;return e.obsminaz>e.obsmaxaz?(a>=e.obsminaz||a<=e.obsmaxaz)&&r>=e.obsminel&&r<=e.obsmaxel&&s<=e.obsmaxrange&&s>=e.obsminrange||(a>=e.obsminaz2||a<=e.obsmaxaz2)&&r>=e.obsminel2&&r<=e.obsmaxel2&&s<=e.obsmaxrange2&&s>=e.obsminrange2:a>=e.obsminaz&&a<=e.obsmaxaz&&r>=e.obsminel&&r<=e.obsmaxel&&s<=e.obsmaxrange&&s>=e.obsminrange||a>=e.obsminaz2&&a<=e.obsmaxaz2&&r>=e.obsminel2&&r<=e.obsmaxel2&&s<=e.obsmaxrange2&&s>=e.obsminrange2}),satellite.getDOPsTable=((e,t,a)=>{let r,s=document.getElementById("dops");s.innerHTML="";let o=timeManager.getPropOffset(),n=0,i=s.insertRow(),l=i.insertCell();l.appendChild(document.createTextNode("Time"));let g=i.insertCell();g.appendChild(document.createTextNode("HDOP"));let u=i.insertCell();u.appendChild(document.createTextNode("PDOP"));let c=i.insertCell();c.appendChild(document.createTextNode("GDOP"));for(let d=0;d<1440;d++){n=1e3*d*60+o,r=timeManager.propTimeCheck(n,timeManager.propRealTime);let m=satellite.getDOPs(e,t,a,!1,r);i=s.insertRow(),l=i.insertCell(),l.appendChild(document.createTextNode(timeManager.dateFormat(r,"isoDateTime",!0))),g=i.insertCell(),g.appendChild(document.createTextNode(m.HDOP)),u=i.insertCell(),u.appendChild(document.createTextNode(m.PDOP)),c=i.insertCell(),c.appendChild(document.createTextNode(m.GDOP))}}),satellite.getDOPs=((e,t,a,o,n)=>{if(void 0!==e){if(void 0!==t){var i,l;a=void 0!==a?a:0,o=void 0!==o&&o,e*=r,t*=r;var g=[];void 0===groups.GPSGroup&&(groups.GPSGroup=new groups.SatGroup("nameRegex",/NAVSTAR/iu)),void 0===n&&(n=timeManager.propTime());var u=timeManager.jday(n.getUTCFullYear(),n.getUTCMonth()+1,n.getUTCDate(),n.getUTCHours(),n.getUTCMinutes(),n.getUTCSeconds());u+=1.15741e-8*n.getUTCMilliseconds();var c=satellite.gstime(u),d={},m=Math.cos(e),p=Math.sin(e),T=Math.cos(t+c),h=Math.sin(t+c);d.x=6371.25*m*T,d.y=6371.25*m*h,d.z=6371.25*p;for(var M=0;M<groups.GPSGroup.sats.length;M++)i=satSet.getSat(groups.GPSGroup.sats[M].satId),l=satellite.ecfToLookAngles({longitude:t,latitude:e,height:a},satellite.eciToEcf(i.position,c)),i.az=l.azimuth*s,i.el=l.elevation*s,i.el>settingsManager.gpsElevationMask&&g.push(i);return satellite.calculateDOPs(g,d,o)}console.error("Longitude Required")}else console.error("Latitude Required")}),satellite.calculateDOPs=((e,t,a)=>{var r={};let s=e.length;if(s<4)return r.PDOP=50,r.HDOP=50,r.GDOP=50,r.VDOP=50,r.TDOP=50,r;var o=window.numeric.rep([s,4],0),n=[],i=[];let l=[];for(var g=1;g<=s;g++){var u=e[g-1];a&&(l[g-1]={},l[g-1].line=new Line,l[g-1].sat=u,l[g-1].ref=[t.x,t.y,t.z]);var c=u.az,d=u.el;n.push(c),i.push(d);var m=[Math.cos(d*Math.PI/180)*Math.sin(c*Math.PI/180),Math.cos(d*Math.PI/180)*Math.cos(c*Math.PI/180),Math.sin(d*Math.PI/180),1];window.numeric.setBlock(o,[g-1,0],[g-1,3],[m])}var p=window.numeric.dot(window.numeric.transpose(o),o),T=window.numeric.inv(p),h=Math.sqrt(T[0][0]+T[1][1]+T[2][2]),M=Math.sqrt(T[0][0]+T[1][1]),b=Math.sqrt(T[0][0]+T[1][1]+T[2][2]+T[3][3]),v=Math.sqrt(T[2][2]),f=Math.sqrt(T[3][3]);return r.PDOP=parseFloat(Math.round(100*h)/100).toFixed(2),r.HDOP=parseFloat(Math.round(100*M)/100).toFixed(2),r.GDOP=parseFloat(Math.round(100*b)/100).toFixed(2),r.VDOP=parseFloat(Math.round(100*v)/100).toFixed(2),r.TDOP=parseFloat(Math.round(100*f)/100).toFixed(2),r}),satellite.radarMaxRange=((e,t,a,r,s)=>{let o=Math.pow(10,(r-30)/10),n=s*=Math.pow(10,6),i=e*Math.pow(t,2)*a*Math.pow(3*Math.pow(10,8),2),l=o*Math.pow(4*Math.PI,3)*Math.pow(n,2),g=Math.sqrt(Math.sqrt(i/l));return g}),satellite.radarMinSignal=((e,t,a,r,s)=>{let o=s*=Math.pow(10,6),n=e*Math.pow(t,2)*a*Math.pow(3*Math.pow(10,8),2),i=r**4*Math.pow(4*Math.PI,3)*Math.pow(o,2),l=n/i,g=Math.log10(l);return g}),satellite.getSunTimes=((e,t,a,r)=>{if(void 0===t){if(void 0===sensorManager.currentSensor)throw"getTEARR requires a sensor or for a sensor to be currently selected.";t=sensorManager.currentSensor}if(void 0===t.observerGd)try{t.observerGd={height:t.obshei,latitude:t.lat,longitude:t.long}}catch(e){throw"observerGd is not set and could not be guessed."}void 0===a&&(a=satellite.lookanglesLength),void 0===r&&(r=satellite.lookanglesInterval);for(var i=timeManager.getPropOffset(),l=0,g=satellite.twoline2satrec(e.TLE1,e.TLE2),u=1e11,c=0;c<24*a*60*60;c+=r){l=1e3*c+i;var d=timeManager.propTimeCheck(l,timeManager.propRealTime),m=timeManager.jday(d.getUTCFullYear(),d.getUTCMonth()+1,d.getUTCDate(),d.getUTCHours(),d.getUTCMinutes(),d.getUTCSeconds());m+=d.getUTCMilliseconds()*n;var p,T,h,M,b,v=satellite.gstime(m),f=sun.getDirection2(m),C=1e6*f[0],S=1e6*f[1],x=1e6*f[2],w=(m-g.jdsatepoch)*o,L=satellite.sgp4(g,w),U=Math.pow(C-L.position.x,2),E=Math.pow(S-L.position.y,2),y=Math.pow(x-L.position.z,2),D=Math.sqrt(U+E+y);p=satellite.eciToEcf(L.position,v),T=satellite.ecfToLookAngles(t.observerGd,p),h=T.azimuth*s,M=T.elevation*s,b=T.rangeSat,t.obsminaz>t.obsmaxaz?((h>=t.obsminaz||h<=t.obsmaxaz)&&M>=t.obsminel&&M<=t.obsmaxel&&b<=t.obsmaxrange&&b>=t.obsminrange||(h>=t.obsminaz2||h<=t.obsmaxaz2)&&M>=t.obsminel2&&M<=t.obsmaxel2&&b<=t.obsmaxrange2&&b>=t.obsminrange2)&&D<u&&(u=D):(h>=t.obsminaz&&h<=t.obsmaxaz&&M>=t.obsminel&&M<=t.obsmaxel&&b<=t.obsmaxrange&&b>=t.obsminrange||h>=t.obsminaz2&&h<=t.obsmaxaz2&&M>=t.obsminel2&&M<=t.obsmaxel2&&b<=t.obsmaxrange2&&b>=t.obsminrange2)&&D<u&&(u=D)}}),satellite.lookAnglesToEcf=((e,t,a,s,o,n)=>{var i={};i.latitude=s,i.longitude=o,i.height=n;var l,g,u,c=satellite.geodeticToEcf(i);l=c.x,g=c.y,u=c.z;var d=Math.sin(s),m=Math.sin(o),p=Math.cos(s),T=Math.cos(o),h=r*e,M=r*t,b=-a*Math.cos(M)*Math.cos(h),v=a*Math.cos(M)*Math.sin(h),f=a*Math.sin(M),C=d*T*b+-m*v+p*T*f+l,S=d*m*b+T*v+p*m*f+g,x=-p*b+d*f+u;return{x:C,y:S,z:x}}),satellite.eci2ll=((e,t,a)=>{var r=timeManager.propTime(),o=timeManager.jday(r.getUTCFullYear(),r.getUTCMonth()+1,r.getUTCDate(),r.getUTCHours(),r.getUTCMinutes(),r.getUTCSeconds());o+=1.15741e-8*r.getUTCMilliseconds();var n=satellite.gstime(o),i=satellite.eciToGeodetic({x:e,y:t,
z:a},n);return i.latitude=i.latitude*s,i.longitude=i.longitude*s,i.longitude=i.longitude>180?i.longitude-360:i.longitude,i.longitude=i.longitude<-180?i.longitude+360:i.longitude,i}),satellite.map=((e,t)=>{function a(e,t){var a=timeManager.propTimeCheck(e,timeManager.propRealTime),r=timeManager.jday(a.getUTCFullYear(),a.getUTCMonth()+1,a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds());r+=a.getUTCMilliseconds()*n;var i,l,g,u=satellite.gstime(r),c=(r-t.jdsatepoch)*o,d=satellite.sgp4(t,c);i=satellite.eciToGeodetic(d.position,u),l=satellite.degreesLat(i.latitude),g=satellite.degreesLong(i.longitude);var m,p,T,h,M,b=timeManager.dateFormat(a,"isoDateTime",!0);m=satellite.eciToEcf(d.position,u),p=satellite.ecfToLookAngles(sensorManager.currentSensor.observerGd,m),T=p.azimuth*s,h=p.elevation*s,M=p.rangeSat;var v=0;return sensorManager.currentSensor.obsminaz<sensorManager.currentSensor.obsmaxaz?(T>=sensorManager.currentSensor.obsminaz&&T<=sensorManager.currentSensor.obsmaxaz&&h>=sensorManager.currentSensor.obsminel&&h<=sensorManager.currentSensor.obsmaxel&&M<=sensorManager.currentSensor.obsmaxrange&&M>=sensorManager.currentSensor.obsminrange||T>=sensorManager.currentSensor.obsminaz2&&T<=sensorManager.currentSensor.obsmaxaz2&&h>=sensorManager.currentSensor.obsminel2&&h<=sensorManager.currentSensor.obsmaxel2&&M<=sensorManager.currentSensor.obsmaxrange2&&M>=sensorManager.currentSensor.obsminrange2)&&(v=1):((T>=sensorManager.currentSensor.obsminaz||T<=sensorManager.currentSensor.obsmaxaz)&&h>=sensorManager.currentSensor.obsminel&&h<=sensorManager.currentSensor.obsmaxel&&M<=sensorManager.currentSensor.obsmaxrange&&M>=sensorManager.currentSensor.obsminrange||(T>=sensorManager.currentSensor.obsminaz2||T<=sensorManager.currentSensor.obsmaxaz2)&&h>=sensorManager.currentSensor.obsminel2&&h<=sensorManager.currentSensor.obsmaxel2&&M<=sensorManager.currentSensor.obsmaxrange2&&M>=sensorManager.currentSensor.obsminrange2)&&(v=1),{lat:l,lon:g,time:b,inview:v}}var r=timeManager.getPropOffset(),i=satellite.twoline2satrec(e.TLE1,e.TLE2),l=t*e.period/50*60*1e3+r;return a(l,i)})})();