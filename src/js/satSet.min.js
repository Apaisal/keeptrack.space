var satSensorMarkerArray=[],emptyMat4=mat4.create();(function(){function e(a,t){return a.length<t?e("0"+a,t):a}var a,t,r,n,i,o,l,g,d,u,c,S,M,p,h,m,f=2*Math.PI,v=360/f,b={},L=settingsManager.limitSats,D={};try{settingsManager.loadStr("elsets"),b=new Worker(settingsManager.installDirectory+"js/satCruncher.js")}catch(e){console.log(e),browserUnsupported()}var C,T,y=0,x=!1;b.onmessage=(e=>{if(!x){for(M=JSON.parse(e.data.extraData),m=0;m<D.numSats;m++)S[m].inclination=M[m].inclination,S[m].eccentricity=M[m].eccentricity,S[m].raan=M[m].raan,S[m].argPe=M[m].argPe,S[m].meanMotion=M[m].meanMotion,S[m].semiMajorAxis=M[m].semiMajorAxis,S[m].semiMinorAxis=M[m].semiMinorAxis,S[m].apogee=M[m].apogee,S[m].perigee=M[m].perigee,S[m].period=M[m].period;return x=!0,void(M=null)}if(e.data.extraUpdate)return M=JSON.parse(e.data.extraData),m=e.data.satId,S[m].inclination=M[0].inclination,S[m].eccentricity=M[0].eccentricity,S[m].raan=M[0].raan,S[m].argPe=M[0].argPe,S[m].meanMotion=M[0].meanMotion,S[m].semiMajorAxis=M[0].semiMajorAxis,S[m].semiMinorAxis=M[0].semiMinorAxis,S[m].apogee=M[0].apogee,S[m].perigee=M[0].perigee,S[m].period=M[0].period,S[m].TLE1=M[0].TLE1,S[m].TLE2=M[0].TLE2,void(M=null);if(void 0===g?g=new Float32Array(e.data.satPos):g.set(e.data.satPos,0),void 0===d?d=new Float32Array(e.data.satVel):d.set(e.data.satVel,0),void 0!==e.data.satInView&&(void 0===u?u=new Int8Array(e.data.satInView):u.set(e.data.satInView,0)),void 0!==e.data.satInSun&&(void 0===c?c=new Int8Array(e.data.satInSun):c.set(e.data.satInSun,0)),void 0!==e.data.sensorMarkerArray&&(satSensorMarkerArray=e.data.sensorMarkerArray),(settingsManager.isMapMenuOpen||settingsManager.isMapUpdateOverride)&&(y=Date.now(),y>settingsManager.lastMapUpdateTime+3e4?(uiManager.updateMap(),settingsManager.lastMapUpdateTime=y,settingsManager.isMapUpdateOverride=!1):settingsManager.isMapUpdateOverride&&(uiManager.updateMap(),settingsManager.lastMapUpdateTime=y,settingsManager.isMapUpdateOverride=!1)),settingsManager.socratesOnSatCruncher&&(selectSat(settingsManager.socratesOnSatCruncher),settingsManager.socratesOnSatCruncher=null),(objectManager.isSensorManagerLoaded&&null!=sensorManager.currentSensor.lat||settingsManager.isForceColorScheme)&&(isDragging||D.setColorScheme(settingsManager.currentColorScheme,!0)),!settingsManager.cruncherReady){""!==L&&$("#menu-satellite-collision").hide(),D.onCruncherReady(),settingsManager.disableUI||(function(){let e;try{e=JSON.parse(localStorage.getItem("currentSensor"))}catch(a){e=null}if(null!==e)try{void 0===e[0]||null==e[0]?(sensorManager.setSensor(null,e[1]),uiManager.legendMenuChange("default")):void 0===e[0].shortName?(sensorManager.setSensor(e[0],e[1]),uiManager.legendMenuChange("default")):(sensorManager.setSensor(sensorManager.sensorList[e[0].shortName],e[1]),uiManager.legendMenuChange("default"))}catch(e){localStorage.setItem("currentSensor",null),console.warn("Saved Sensor Information Invalid")}}(),function(){let e;try{e=localStorage.getItem("watchlistList")}catch(a){e=null}if(null!==e){let a=JSON.parse(e),t=[];for(let e=0;e<a.length;e++){let r=D.getSatExtraOnly(D.getIdFromObjNum(a[e]));if(null===r)return void console.error("Watchlist File Format Incorret");a[e]=r.id,t.push(!1)}uiManager.updateWatchlist(a,t)}}());try{nextLaunchManager.init()}catch(e){}(function(){let e=D.queryStr.split("&");for(let a=0;a<e.length;a++){let t=e[a].split("=")[0],r=e[a].split("=")[1];"search"==t&&(settingsManager.disableUI||(searchBox.doSearch(r),0==settingsManager.lastSearchResults.length&&(uiManager.toast(`Search for "${r}" found nothing!`,"caution",!0),searchBox.hideResults())))}for(let t=0;t<e.length;t++){let r,n=e[t].split("=")[0],s=e[t].split("=")[1];switch(n){case"intldes":r=D.getIdFromIntlDes(s.toUpperCase()),null!==r?selectSat(r):uiManager.toast(`International Designator "${s.toUpperCase()}" was not found!`,"caution",!0);break;case"sat":r=D.getIdFromObjNum(s.toUpperCase()),null!==r?selectSat(r):uiManager.toast(`Satellite "${s.toUpperCase()}" was not found!`,"caution",!0);break;case"misl":var a=s.split(",");$("#ms-type").val(a[0].toString()),$("#ms-attacker").val(a[1].toString()),$("#ms-target").val(a[2].toString()),$("#missile").trigger("submit");break;case"date":if(isNaN(parseInt(s))){uiManager.toast(`Date value of "${s}" is not a proper unix timestamp!`,"caution",!0);break}timeManager.propOffset=Number(s)-Date.now(),$("#datetime-input-tb").datepicker("setDate",new Date(timeManager.propRealTime+timeManager.propOffset)),b.postMessage({typ:"offset",dat:timeManager.propOffset.toString()+" "+timeManager.propRate.toString()});break;case"rate":if(isNaN(parseFloat(s))){uiManager.toast(`Propagation rate of "${s}" is not a valid float!`,"caution",!0);break}s=Math.min(s,1e3),s=Math.max(s,0),timeManager.propRate=Number(s),b.postMessage({typ:"offset",dat:timeManager.propOffset.toString()+" "+timeManager.propRate.toString()})}}})(),settingsManager.startWithOrbitsDisplayed&&setTimeout(function(){groups.debris=new groups.SatGroup("all",""),groups.selectGroup(groups.debris),D.setColorScheme(settingsManager.currentColorScheme,!0),groups.debris.updateOrbits(),settingsManager.isOrbitOverlayVisible=!0},0),setTimeout(function(){$("img").each(function(){$(this).attr("src",$(this).attr("delayedsrc"))})},0),settingsManager.cruncherReady=!0}}),D.changeShaders=(e=>{switch(gl.detachShader(a,C),gl.detachShader(a,T),e){case"var":gl.shaderSource(C,shaderLoader.getShaderCode("dot-vertex-var.glsl"));break;case 12:gl.shaderSource(C,shaderLoader.getShaderCode("dot-vertex-12.glsl"));break;case 6:gl.shaderSource(C,shaderLoader.getShaderCode("dot-vertex-6.glsl"));break;case 2:gl.shaderSource(C,shaderLoader.getShaderCode("dot-vertex-2.glsl"))}gl.compileShader(C),gl.shaderSource(T,shaderLoader.getShaderCode("dot-fragment.glsl")),gl.compileShader(T),gl.attachShader(a,C),gl.attachShader(a,T),gl.linkProgram(a),a.aPos=gl.getAttribLocation(a,"aPos"),a.aColor=gl.getAttribLocation(a,"aColor"),a.aStar=gl.getAttribLocation(a,"aStar"),a.minSize=gl.getUniformLocation(a,"minSize"),a.maxSize=gl.getUniformLocation(a,"maxSize"),a.uMvMatrix=gl.getUniformLocation(a,"uMvMatrix"),a.uCamMatrix=gl.getUniformLocation(a,"uCamMatrix"),a.uPMatrix=gl.getUniformLocation(a,"uPMatrix")}),D.init=(e=>{D.satsReadyCallback=e,db.log("satSet.init"),function(){for(var e=window.location.search.substring(1),a=e.split("&"),t=0;t<a.length;t++){var r=a[t].split("=")[0];"vertShadersSize"===r&&(settingsManager.vertShadersSize=6,document.getElementById("settings-shaders").checked=!0)}}(),a=gl.createProgram(),C=gl.createShader(gl.VERTEX_SHADER),gl.shaderSource(C,shaderLoader.getShaderCode("dot-vertex-var.glsl")),gl.compileShader(C),T=gl.createShader(gl.FRAGMENT_SHADER),gl.shaderSource(T,shaderLoader.getShaderCode("dot-fragment.glsl")),gl.compileShader(T),gl.attachShader(a,C),gl.attachShader(a,T),gl.linkProgram(a),a.aPos=gl.getAttribLocation(a,"aPos"),a.aColor=gl.getAttribLocation(a,"aColor"),a.aStar=gl.getAttribLocation(a,"aStar"),a.minSize=gl.getUniformLocation(a,"minSize"),a.maxSize=gl.getUniformLocation(a,"maxSize"),a.uMvMatrix=gl.getUniformLocation(a,"uMvMatrix"),a.uCamMatrix=gl.getUniformLocation(a,"uCamMatrix"),a.uPMatrix=gl.getUniformLocation(a,"uPMatrix"),D.startCatalogLoad=(()=>{if(settingsManager.isCatalogPreloaded=!0,void 0===settingsManager.tleSource&&(settingsManager.tleSource=`${settingsManager.installDirectory}tle/TLE.json`),settingsManager.offline)D.loadTLEs(jsTLEfile),jsTLEfile=null;else try{var e=settingsManager.tleSource;$.get({url:""+e,cache:!1}).done(function(e){D.loadTLEs(e)}).fail(function(){$.get({url:""+e,cache:!0}).done(function(e){D.loadTLEs(e)}).fail(function(){$.getScript(`${settingsManager.installDirectory}offline/tle.js`,function(){D.loadTLEs(jsTLEfile)},!0)})})}catch(e){console.log(e),D.loadTLEs(jsTLEfile),jsTLEfile=null}}),D.startCatalogLoad()}),D.loadTLEs=(a=>{function r(t){var r,n,i,o=[];D.sccIndex={},D.cosparIndex={},null==t[0]&&(L="");for(let s=0;s<a.length;s++)if(a[s].SCC_NUM=e(a[s].TLE1.substr(2,5).trim(),5),""!==L)for(var l=0;l<t.length;l++)a[s].SCC_NUM===t[l]&&(r=a[s].TLE1.substr(9,8).trim().substring(0,2),""===r?a[s].intlDes="none":(n=r>50?"19":"20",r=n+r,i=a[s].TLE1.substr(9,8).trim().substring(2),a[s].intlDes=r+"-"+i),a[s].id=s,D.sccIndex[`${a[s].SCC_NUM}`]=a[s].id,D.cosparIndex[`${a[s].intlDes}`]=a[s].id,a[s].active=!0,o.push(a[s]));else r=a[s].TLE1.substr(9,8).trim().substring(0,2),""===r?a[s].intlDes="none":(n=r>50?"19":"20",r=n+r,i=a[s].TLE1.substr(9,8).trim().substring(2),a[s].intlDes=r+"-"+i),a[s].id=s,D.sccIndex[`${a[s].SCC_NUM}`]=a[s].id,D.cosparIndex[`${a[s].intlDes}`]=a[s].id,a[s].active=!0,o.push(a[s]);let g,d=!1;if("undefined"!=typeof satelliteList&&settingsManager.offline){for(let e=0;e<satelliteList.length;e++)if(d=!1,null!=satelliteList[e].SCC&&null!=satelliteList[e].TLE1&&null!=satelliteList[e].TLE2){if(void 0!==D.sccIndex[`${satelliteList[e].SCC}`]){C=D.sccIndex[`${satelliteList[e].SCC}`],o[C].ON=satelliteList[e].ON,o[C].OT=void 0!==satelliteList[e].OT?satelliteList[e].OT:null,o[C].TLE1=satelliteList[e].TLE1,o[C].TLE2=satelliteList[e].TLE2,d=!0;break}if(!d){if(null==satelliteList[e].TLE1)continue;if(null==satelliteList[e].TLE2)continue;settingsManager.isExtraSatellitesAdded=!0,void 0===satelliteList[e].ON&&(satelliteList[e].ON="Unknown"),void 0===satelliteList[e].OT&&(satelliteList[e].OT=null),r=satelliteList[e].TLE1.substr(9,8).trim().substring(0,2),n=r>50?"19":"20",r=n+r,i=satelliteList[e].TLE1.substr(9,8).trim().substring(2),g={static:!1,missile:!1,active:!0,ON:satelliteList[e].ON,OT:satelliteList[e].OT,C:"Unknown",LV:"Unknown",LS:"Unknown",SCC_NUM:satelliteList[e].SCC.toString(),TLE1:satelliteList[e].TLE1,TLE2:satelliteList[e].TLE2,intlDes:r+"-"+i,type:"sat",id:o.length,vmag:satelliteList[e].vmag},D.sccIndex[`${satelliteList[e].SCC.toString()}`]=o.length,D.cosparIndex[`${r}-${i}`]=o.length,o.push(g)}}satelliteList=null}if("undefined"!=typeof satInfoList&&settingsManager.offline){for(s=0;s<satInfoList.length;s++)for(settingsManager.isExtraSatellitesAdded=!0,d=!1,C=s;C<o.length;C++)if(satInfoList[s].SCC===o[C].SCC_NUM){o[C].ON=satInfoList[s].ON,o[C].C=satInfoList[s].C,o[C].LV=satInfoList[s].LV,o[C].LS=satInfoList[s].LS,o[C].URL=satInfoList[s].URL,d=!0;break}satInfoList=null}if("undefined"!=typeof trusatList&&settingsManager.trusatMode){for(s=0;s<trusatList.length;s++)null!=trusatList[s].TLE1&&null!=trusatList[s].TLE2&&(void 0===trusatList[s].ON&&(trusatList[s].ON="Unknown"),void 0===trusatList[s].OT&&(trusatList[s].OT=null),r=trusatList[s].TLE1.substr(9,8).trim().substring(0,2),n=r>50?"19":"20",r=n+r,i=trusatList[s].TLE1.substr(9,8).trim().substring(2),scc=e(parseInt(trusatList[s].TLE1.substr(2,5).trim()).toString(),5),g={static:!1,missile:!1,active:!0,trusat:!0,ON:trusatList[s].ON,OT:4,C:"Unknown",LV:"Unknown",LS:"Unknown",SCC_NUM:`T${scc.toString()}`,TLE1:trusatList[s].TLE1,TLE2:trusatList[s].TLE2,intlDes:r+"-"+i,type:"sat",id:o.length},o.push(g));trusatList=null}for(settingsManager.isExtraSatellitesAdded&&($(".legend-pink-box").show(),$(".legend-trusat-box")[1].parentElement.style.display="",$(".legend-trusat-box")[2].parentElement.style.display="",$(".legend-trusat-box")[3].parentElement.style.display="",$(".legend-trusat-box")[1].parentElement.innerHTML=`<div class="Square-Box legend-trusat-box"></div>${settingsManager.nameOfSpecialSats}`,$(".legend-trusat-box")[2].parentElement.innerHTML=`<div class="Square-Box legend-trusat-box"></div>${settingsManager.nameOfSpecialSats}`,$(".legend-trusat-box")[3].parentElement.innerHTML=`<div class="Square-Box legend-trusat-box"></div>${settingsManager.nameOfSpecialSats}`),D.orbitalSats=o.length,objectManager.starIndex1+=D.orbitalSats,objectManager.starIndex2+=D.orbitalSats,settingsManager.isEnableGsCatalog&&D.initGsData(),C=0;C<objectManager.staticSet.length;C++)o.push(objectManager.staticSet[C]);for(C=0;C<objectManager.analSatSet.length;C++)objectManager.analSatSet[C].id=o.length,o.push(objectManager.analSatSet[C]);radarDataManager.satDataStartIndex=o.length+1;for(let e=0;e<objectManager.radarDataSet.length;e++)o.push(objectManager.radarDataSet[e]);for(C=0;C<objectManager.missileSet.length;C++)o.push(objectManager.missileSet[C]);for(D.missileSats=o.length,C=0;C<objectManager.fieldOfViewSet.length;C++)objectManager.fieldOfViewSet[C].id=o.length,o.push(objectManager.fieldOfViewSet[C]);return o}var i,l,d,u,c,M,p,h,m,f=[];if("undefined"!=typeof trusatList||!settingsManager.trusatMode||settingsManager.trusatOnly){(function(){for(var e=window.location.search.substring(1),a=e.split("&"),t=0;t<a.length;t++){var r=a[t].split("=")[0],n=a[t].split("=")[1];switch(r){case"limitSats":L=n,$("#limitSats").val(n),$("#limitSats-Label").addClass("active"),f=n.split(",");break;case"lat":n>=-90&&n<=90&&(i=n);break;case"long":n>=-180&&n<=360&&(l=n);break;case"hei":n>=-20&&n<=20&&(d=n);break;case"minaz":n>=0&&n<=360&&(u=n);break;case"maxaz":n>=0&&n<=360&&(c=n);break;case"minel":n>=-10&&n<=180&&(M=n);break;case"maxel":n>=-10&&n<=180&&(p=n);break;case"minrange":n>=0&&(h=n);break;case"maxrange":n<=1e7&&(m=n)}}})(),S=r(f),a=null,D.satDataString=JSON.stringify(S),timeManager.propRealTime=Date.now(),void 0!==i&&void 0!==l&&void 0!==d&&void 0!==u&&void 0!==c&&void 0!==M&&void 0!==p&&void 0!==h&&void 0!==m&&(satellite.setobs({lat:i,long:l,obshei:d,obsminaz:u,obsmaxaz:c,obsminel:M,obsmaxel:p,obsminrange:h,obsmaxrange:m}),b.postMessage({typ:"offset",dat:timeManager.propOffset.toString()+" "+timeManager.propRate.toString(),setlatlong:!0,lat:i,long:l,obshei:d,obsminaz:u,obsmaxaz:c,obsminel:M,obsmaxel:p,obsminrange:h,obsmaxrange:m})),b.postMessage({typ:"satdata",dat:D.satDataString,fieldOfViewSetLength:objectManager.fieldOfViewSet.length,isLowPerf:settingsManager.lowPerf}),delete objectManager.fieldOfViewSet,t=gl.createBuffer(),g=new Float32Array(3*S.length);var v=[];o=gl.createBuffer();for(var C=0;C<S.length;C++){var T=C+1&255,y=(C+1&65280)>>8,x=(C+1&16711680)>>16;v.push(T/255),v.push(y/255),v.push(x/255)}if(gl.bindBuffer(gl.ARRAY_BUFFER,o),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(v),gl.STATIC_DRAW),n=gl.createBuffer(),D.setupStarBuffer(),D.numSats=S.length,D.setColorScheme(ColorScheme.default,!0),settingsManager.shadersReady=!0,D.satsReadyCallback&&(D.satsReadyCallback(S),!settingsManager.trusatOnly))try{void 0===D.getSat(D.getIdFromObjNum(44235)).vmag&&satVmagManager.init()}catch(e){console.debug("satVmagManager Not Loaded")}}else $.getScript("/tle/trusat.js",function(e){D.loadTLEs(e)})}),D.getSatData=(()=>(db.log("satSet.getSatData"),S)),D.getSatInView=(()=>(db.log("satSet.getSatInView"),void 0!==u&&u)),D.getSatInSun=(()=>(db.log("satSet.getSatInSun"),void 0!==c&&c)),D.getSatVel=(()=>(db.log("satSet.getSatVel"),void 0!==d&&d)),D.resetSatInView=(()=>{u=new Int8Array(u.length),u.fill(0)}),D.resetSatInSun=(()=>{c=new Int8Array(c.length),c.fill(0)}),D.setColorScheme=((e,a)=>{db.log("satSet.setColorScheme"),settingsManager.currentColorScheme=e;try{i=e.calculateColorBuffers(a),r=i.colorBuf,l=i.pickableBuf}catch(e){console.log("satSet.setColorScheme not ready yet!")}}),D.convertIdArrayToSatnumArray=(e=>{let a=[];for(let t=0;t<e.length;t++)a.push(parseInt(D.getSat(e[t]).SCC_NUM));return a}),D.convertSatnumArrayToIdArray=(e=>{let a=[];for(let t=0;t<e.length;t++)try{a.push(D.getSatFromObjNum(e[t]).id)}catch(e){}return a}),D.initGsData=(()=>{$.getScript("satData/gs.json",function(e){settingsManager.loadStr("satIntel"),$("#loading-screen").fadeIn(1e3,function(){D.gsInfo=JSON.parse(e);for(let e=0;e<D.gsInfo.length;e++){let a=D.gsInfo[e],t=0,r=0;for(let e=0;e<a[1].length;e++){let n=a[1][e];t=Math.max(t-200,0),void 0!==D.cosparIndex[`${n.cospar}`]&&(r=D.cosparIndex[`${n.cospar}`],void 0!==n.name&&(void 0!==S[r].ON&&"TBA"!=S[r].ON&&"Unknown"!=S[r].ON&&"PAYLOAD"!=S[r].ON.slice(0,7)&&"OBJECT"!=S[r].ON.slice(0,6)||(S[r].ON=n.name)),void 0!==n.lv&&(void 0!==S[r].LV&&"U"!=S[r].LV||(S[r].LV=n.lv)),void 0!==n.ls&&(void 0!==S[r].LS&&"U"!=S[r].LS||(S[r].LS=n.ls)),void 0!==a[0].gsurl&&(S[r].URL=a[0].gsurl),void 0!==a[0].sdpow&&(S[r].Pw=a[0].sdpow),void 0!==a[0].sdtyp&&(S[r].P=a[0].sdtyp),void 0!==a[0].sdcon&&(S[r].Con=a[0].sdcon),void 0!==a[0].sdmas&&(S[r].DM=a[0].sdmas),void 0!==a[0].sdope&&(S[r].U=a[0].sdope),void 0!==a[0].sdlif&&(S[r].Li=a[0].sdlif))}}uiManager.hideLoadingScreen()})})}),D.searchCelestrak=((e,a)=>{if(void 0===a){for(var t=15e3;t<S.length;t++)if(S[t].SCC_NUM>=8e4&&!S[t].active){a=t;break}}else a=D.getIdFromObjNum(a);let r=new XMLHttpRequest;r.open("GET",`php/get_data.php?type=c&sat=${e}`,!0),r.onload=function(){if(this.status>=200&&this.status<400){let e=JSON.parse(this.response).split("\n"),t=e[1],r=e[2];D.insertNewAnalystSatellite(t,r,a)}else console.warn("Celestrack request returned an error!")},r.onerror=function(){console.warn("Celestrack request failed!")},r.send()}),D.searchN2yo=((e,a)=>{if(void 0===a){for(var t=15e3;t<S.length;t++)if(S[t].SCC_NUM>=8e4&&!S[t].active){a=t;break}}else a=D.getIdFromObjNum(a);let r=new XMLHttpRequest;r.open("GET",`php/get_data.php?type=n&sat=${e}`,!0),r.onload=function(){if(this.status>=200&&this.status<400){let e=this.response.split('<div id="tle">')[1].split("<pre>")[1].split("\n"),t=e[0],r=e[1];D.insertNewAnalystSatellite(t,r,a)}else console.warn("N2YO request returned an error!")},r.onerror=function(){console.warn("N2YO request failed!")},r.send()}),D.insertNewAnalystSatellite=((e,a,t)=>{if(satellite.altitudeCheck(e,a,timeManager.propOffset)>1){b.postMessage({typ:"satEdit",id:t,active:!0,TLE1:e,TLE2:a}),orbitManager.updateOrbitBuffer(t,!0,e,a);let r=D.getSat(t);r.active=!0,r.OT=1,searchBox.doSearch(r.SCC_NUM.toString())}else console.debug(e),console.debug(a),uiManager.toast("New Analyst Satellite is Invalid!","critical")}),D.setupStarBuffer=(()=>{let e=D.setupStarData(S);gl.bindBuffer(gl.ARRAY_BUFFER,n),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(e),gl.STATIC_DRAW)}),D.setupStarData=(e=>{let a=[];for(var t=0;t<e.length;t++)t>=objectManager.starIndex1&&t<=objectManager.starIndex2?a.push(1):a.push(0);for(let e=0;e<settingsManager.lastSearchResults.length;e++)a[settingsManager.lastSearchResults[e]]=1;return a}),D.updateRadarData=(()=>{for(let e=0;e<radarDataManager.radarData.length;e++)try{S[radarDataManager.satDataStartIndex+e].isRadarData=!0,S[radarDataManager.satDataStartIndex+e].mId=parseInt(radarDataManager.radarData[e].m),S[radarDataManager.satDataStartIndex+e].t=radarDataManager.radarData[e].t,S[radarDataManager.satDataStartIndex+e].rcs=parseInt(radarDataManager.radarData[e].rc),S[radarDataManager.satDataStartIndex+e].trackId=parseInt(radarDataManager.radarData[e].ti),S[radarDataManager.satDataStartIndex+e].objectId=parseInt(radarDataManager.radarData[e].oi),S[radarDataManager.satDataStartIndex+e].satId=parseInt(radarDataManager.radarData[e].si),S[radarDataManager.satDataStartIndex+e].missileComplex=parseInt(radarDataManager.radarData[e].mc),S[radarDataManager.satDataStartIndex+e].missileObject=parseInt(radarDataManager.radarData[e].mo),S[radarDataManager.satDataStartIndex+e].azError=radarDataManager.radarData[e].ae,S[radarDataManager.satDataStartIndex+e].elError=radarDataManager.radarData[e].ee,S[radarDataManager.satDataStartIndex+e].dataType=radarDataManager.radarData[e].dataType}catch(e){}D.setColorScheme(settingsManager.currentColorScheme,!0)});let A,E,R,I;var w;D.draw=((e,s)=>{if(settingsManager.shadersReady&&settingsManager.cruncherReady){if(I=radarDataManager.radarData.length,I>0){if(0===timeManager.propRate?timeManager.propTimeVar.setTime(Number(timeManager.propRealTime)+timeManager.propOffset):timeManager.propTimeVar.setTime(Number(timeManager.propRealTime)+timeManager.propOffset+(Number(timeManager.now)-Number(timeManager.propRealTime))*timeManager.propRate),A=1*timeManager.propTimeVar,0==radarDataManager.drawT1)for(R=0;R<I;R++)if(radarDataManager.radarData[R].t>timeManager.now-3e3){radarDataManager.drawT1=R;break}for(E=!1,h=radarDataManager.drawT1;h<I;h++){if(radarDataManager.radarData[h].t>=A-3e3&&radarDataManager.radarData[h].t<=A+3e3){if(E||(radarDataManager.drawT1=h,E=!0),0!==g[3*(radarDataManager.satDataStartIndex+h)])continue;g[3*(radarDataManager.satDataStartIndex+h)]=radarDataManager.radarData[h].x,g[3*(radarDataManager.satDataStartIndex+h)+1]=radarDataManager.radarData[h].y,g[3*(radarDataManager.satDataStartIndex+h)+2]=radarDataManager.radarData[h].z}else g[3*(radarDataManager.satDataStartIndex+h)]=0,g[3*(radarDataManager.satDataStartIndex+h)+1]=0,g[3*(radarDataManager.satDataStartIndex+h)+2]=0;if(radarDataManager.radarData[h].t>A+3e3)break}}if(p=Math.max(timeManager.propRate,.001),dlManager.drawDt=Math.min(dlManager.dt/1e3,1/p),dlManager.drawDt*=timeManager.propRate,D.satDataLenInDraw=S.length,!settingsManager.lowPerf&&dlManager.drawDt>settingsManager.minimumDrawDt)for(D.satDataLenInDraw-=settingsManager.maxFieldOfViewMarkers+settingsManager.maxRadarData,D.satDataLenInDraw3=3*D.satDataLenInDraw,D.orbitalSats3=3*D.orbitalSats,h=0;h<D.satDataLenInDraw3;h++)D.orbitalSats3,g[h]+=d[h]*dlManager.drawDt;gl.useProgram(a),gl.bindFramebuffer(gl.FRAMEBUFFER,null),gl.uniformMatrix4fv(a.uMvMatrix,!1,emptyMat4),gl.uniformMatrix4fv(a.uCamMatrix,!1,s),gl.uniformMatrix4fv(a.uPMatrix,!1,e),cameraType.current==cameraType.planetarium?(gl.uniform1f(a.minSize,settingsManager.satShader.minSizePlanetarium),gl.uniform1f(a.maxSize,settingsManager.satShader.maxSizePlanetarium)):(gl.uniform1f(a.minSize,settingsManager.satShader.minSize),gl.uniform1f(a.maxSize,settingsManager.satShader.maxSize)),gl.bindBuffer(gl.ARRAY_BUFFER,n),gl.enableVertexAttribArray(a.aStar),gl.vertexAttribPointer(a.aStar,1,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,t),gl.bufferData(gl.ARRAY_BUFFER,g,gl.STREAM_DRAW),gl.vertexAttribPointer(a.aPos,3,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,r),gl.enableVertexAttribArray(a.aColor),gl.vertexAttribPointer(a.aColor,4,gl.FLOAT,!1,0,0),gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA),gl.enable(gl.BLEND),gl.depthMask(!1),gl.drawArrays(gl.POINTS,0,S.length),gl.depthMask(!0),gl.disable(gl.BLEND);try{gl.useProgram(gl.pickShaderProgram),gl.bindFramebuffer(gl.FRAMEBUFFER,gl.pickFb),gl.uniformMatrix4fv(gl.pickShaderProgram.uMvMatrix,!1,emptyMat4),gl.uniformMatrix4fv(gl.pickShaderProgram.uCamMatrix,!1,s),gl.uniformMatrix4fv(gl.pickShaderProgram.uPMatrix,!1,e),gl.enableVertexAttribArray(gl.pickShaderProgram.aColor),gl.bindBuffer(gl.ARRAY_BUFFER,o),gl.vertexAttribPointer(gl.pickShaderProgram.aColor,3,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,l),gl.enableVertexAttribArray(gl.pickShaderProgram.aPickable),gl.vertexAttribPointer(gl.pickShaderProgram.aPickable,1,gl.FLOAT,!1,0,0),gl.drawArrays(gl.POINTS,0,S.length)}catch(e){db.log(`satData.length: ${S.length}`),db.log(e)}}}),D.setSat=((e,a)=>{if(!S)return null;S[e]=a,S[e].velocity=0==S[e].velocity?{}:S[e].velocity}),D.mergeSat=(e=>{if(!S)return null;var a=D.getIdFromObjNum(e.SCC);S[a].ON=e.ON,S[a].C=e.C,S[a].LV=e.LV,S[a].LS=e.LS,S[a].R=e.R,S[a].URL=e.URL,S[a].NOTES=e.NOTES,S[a].TTP=e.TTP,S[a].FMISSED=e.FMISSED,S[a].ORPO=e.ORPO,S[a].constellation=e.constellation,S[a].associates=e.associates,S[a].maneuver=e.maneuver}),D.vmagUpdate=(e=>{if(!S)return null;var a=D.getIdFromObjNum(e.satid);try{S[a].vmag=e.vmag}catch(e){}}),D.getSat=(e=>(db.log("satSet.getSat",!0),S&&S[e]?(x&&(S[e].inViewChange=!1,void 0!==u&&void 0!==u[e]?(S[e].inview!==u[e]&&(S[e].inViewChange=!0),S[e].inview=u[e]):(S[e].inview=!1,S[e].inViewChange=!1),void 0!==c&&void 0!==c[e]&&(S[e].inSun!==c[e]&&(S[e].inSunChange=!0),S[e].inSun=c[e]),S[e].velocity,S[e].velocity=void 0===S[e].velocity?{}:S[e].velocity,S[e].velocity.total=Math.sqrt(d[3*e]*d[3*e]+d[3*e+1]*d[3*e+1]+d[3*e+2]*d[3*e+2]),S[e].velocity.x=d[3*e],S[e].velocity.y=d[3*e+1],S[e].velocity.z=d[3*e+2],S[e].position={x:g[3*e],y:g[3*e+1],z:g[3*e+2]}),void 0===S[e].isInSun&&(S[e].isInSun=(()=>{let a=sun.realXyz,t=Math.asin(RADIUS_OF_EARTH/Math.sqrt(Math.pow(-S[e].position.x,2)+Math.pow(-S[e].position.y,2)+Math.pow(-S[e].position.z,2)))*v,r=Math.asin(RADIUS_OF_SUN/Math.sqrt(Math.pow(-S[e].position.x+a.x,2)+Math.pow(-S[e].position.y+a.y,2)+Math.pow(-S[e].position.z+a.z,2)))*v,n=Math.acos(window.numeric.dot([-S[e].position.x,-S[e].position.y,-S[e].position.z],[-S[e].position.x+a.x,-S[e].position.y+a.y,-S[e].position.z+a.z])/(Math.sqrt(Math.pow(-S[e].position.x,2)+Math.pow(-S[e].position.y,2)+Math.pow(-S[e].position.z,2))*Math.sqrt(Math.pow(-S[e].position.x+a.x,2)+Math.pow(-S[e].position.y+a.y,2)+Math.pow(-S[e].position.z+a.z,2))))*v;return t>r&&n<t-r?0:Math.abs(t-r)<n&&n<t+r?1:r>t?1:n<r-t?1:2})),void 0===S[e].setRAE&&(S[e].setRAE=(a=>{S[e].rae=a})),void 0===S[e].getAltitude&&(S[e].getAltitude=(()=>S[e].missile?satellite.eci2ll(S[e].position.x,S[e].position.y,S[e].position.z).height:satellite.altitudeCheck(S[e].TLE1,S[e].TLE2,timeManager.propOffset))),objectManager.isSensorManagerLoaded&&void 0===S[e].getTEARR&&(S[e].getTEARR=((a,t)=>{if(S[e].missile)return{inview:S[e].inView};let r={};if(void 0===t&&(t=sensorManager.currentSensor),void 0===t.observerGd){try{t.observerGd={height:t.obshei,latitude:t.lat,longitude:t.long}}catch(e){throw"observerGd is not set and could not be guessed."}if(void 0===t.observerGd.longitude)try{t.observerGd={height:t.alt,latitude:t.lat*DEG2RAD,longitude:t.lon*DEG2RAD}}catch(e){throw"observerGd is not set and could not be guessed."}}let n,s=satellite.twoline2satrec(S[e].TLE1,S[e].TLE2);n=void 0!==a?a:timeManager.propTime();let i=timeManager.jday(n.getUTCFullYear(),n.getUTCMonth()+1,n.getUTCDate(),n.getUTCHours(),n.getUTCMinutes(),n.getUTCSeconds());i+=n.getUTCMilliseconds()*MILLISECONDS_PER_DAY;let o=satellite.gstime(i),l=(i-s.jdsatepoch)*MINUTES_PER_DAY,g=satellite.sgp4(s,l);try{let e=satellite.eciToGeodetic(g.position,o);r.alt=e.height,r.lon=e.longitude,r.lat=e.latitude;let a=satellite.eciToEcf(g.position,o),n=satellite.ecfToLookAngles(t.observerGd,a);r.azimuth=n.azimuth*v,r.elevation=n.elevation*v,r.range=n.rangeSat}catch(e){r.alt=0,r.lon=0,r.lat=0,r.azimuth=0,r.elevation=0,r.range=0}return r.inview=satellite.checkIsInFOV(t,{az:r.azimuth,el:r.elevation,range:r.range}),uiManager.currentTEARR=r,r})),void 0===S[e].getDirection&&(S[e].getDirection=(()=>{let a=S[e].getTEARR().lat*v,t=timeManager.propTimeCheck(5e3,timeManager.propTime()),r=S[e].getTEARR(t).lat*v;if(a<r)return"N";if(a>r)return"S";if(a===r){if(t=timeManager.propTimeCheck(2e4,timeManager.propTime()),futureTEARR=S[e].getTEARR(t),a<r)return"N";if(a>r)return"S"}return console.warn("Sat Direction Calculation Error - By Pole?"),"Error"})),S[e]):null)),D.getSatInViewOnly=(e=>S&&S[e]?(S[e].inview=u[e],S[e]):null),D.getSatPosOnly=(e=>{if(!S)return null;if(!S[e])return null;x&&(S[e].position={x:g[3*e],y:g[3*e+1],z:g[3*e+2]});let a=S[e];return a}),D.getSatExtraOnly=(e=>S&&S[e]?S[e]:null),D.getSatFromObjNum=(e=>{let a=D.getIdFromObjNum(e);return D.getSat(a)}),D.getIdFromObjNum=(e=>{if(void 0!==D.sccIndex[`${e}`])return D.sccIndex[`${e}`];for(let a=0;a<S.length;a++)if(parseInt(S[a].SCC_NUM)==e)return a;return null}),D.getIdFromIntlDes=(e=>void 0!==D.cosparIndex[`${e}`]?D.cosparIndex[`${e}`]:null),D.getIdFromStarName=(e=>{for(var a=0;a<S.length;a++)if("Star"===S[a].type&&S[a].name===e)return a;return null}),D.getIdFromSensorName=(e=>{if(void 0!==e)for(var a=0;a<S.length;a++)if(!0===S[a].static&&!0!==S[a].missile&&"Star"!==S[a].type&&S[a].name===e)return a;try{var t=timeManager.propTime(),r=timeManager.jday(t.getUTCFullYear(),t.getUTCMonth()+1,t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds());r+=1.15741e-8*t.getUTCMilliseconds();var n=satellite.gstime(r);let e=Math.cos(sensorManager.currentSensor.lat*DEG2RAD),a=Math.sin(sensorManager.currentSensor.lat*DEG2RAD),s=Math.cos(sensorManager.currentSensor.long*DEG2RAD+n),i=Math.sin(sensorManager.currentSensor.long*DEG2RAD+n),o={position:{},name:"Custom Sensor"};return o.position.x=(6371.25+sensorManager.currentSensor.obshei)*e*s,o.position.y=(6371.25+sensorManager.currentSensor.obshei)*e*i,o.position.z=(6371.25+sensorManager.currentSensor.obshei)*a,o}catch(e){return console.log(e),null}}),D.getScreenCoords=((e,a,t,r)=>{satScreenPositionArray.error=!1,r||(r=D.getSatPosOnly(e).position),w=vec4.fromValues(r.x,r.y,r.z,1),vec4.transformMat4(w,w,t),vec4.transformMat4(w,w,a),satScreenPositionArray.x=w[0]/w[3],satScreenPositionArray.y=w[1]/w[3],satScreenPositionArray.z=w[2]/w[3],satScreenPositionArray.x=.5*(satScreenPositionArray.x+1)*window.innerWidth,satScreenPositionArray.y=.5*(1-satScreenPositionArray.y)*window.innerHeight,satScreenPositionArray.x>=0&&satScreenPositionArray.y>=0&&satScreenPositionArray.z>=0&&satScreenPositionArray.z<=1||(satScreenPositionArray.error=!0)}),D.searchYear=(e=>{for(var a=[],t=0;t<S.length;t++)void 0!==S[t].TLE1&&S[t].TLE1.substring(9,11)==e&&a.push(t);return a}),D.searchYearOrLess=(e=>{for(var a=[],t=0;t<S.length;t++)void 0!==S[t].TLE1&&(e>=59&&e<100?S[t].TLE1.substring(9,11)<=e&&S[t].TLE1.substring(9,11)>=59&&a.push(t):(S[t].TLE1.substring(9,11)<=e||S[t].TLE1.substring(9,11)>=59)&&a.push(t));return a}),D.searchNameRegex=(e=>{for(var a=[],t=0;t<S.length;t++)e.test(S[t].ON)&&a.push(t);return a}),D.searchCountryRegex=(e=>{for(var a=[],t=0;t<S.length;t++)e.test(S[t].C)&&a.push(t);return a}),D.searchAzElRange=((e,a,t,r,n,s,i,o,l,g,d,u,c)=>{function M(e){for(var a=[],t=0;t<e.length;t++)e[t].inview&&a.push(e[t]);return a}function p(e){for(var a=[],t=0;t<e.length;t++)e[t].OT===c&&a.push(e[t]);return a}function h(e,a,t){for(var r=[],n=0;n<e.length;n++)e[n].azimuth<t&&e[n].azimuth>a&&r.push(e[n]);return r}function m(e,a,t){for(var r=[],n=0;n<e.length;n++)e[n].elevation<t&&e[n].elevation>a&&r.push(e[n]);return r}function f(e,a,t){for(var r=[],n=0;n<e.length;n++)e[n].range<t&&e[n].range>a&&r.push(e[n]);return r}function b(e,a,t){for(var r=[],n=0;n<e.length;n++)(e[n].inclination*v).toFixed(2)<t&&(e[n].inclination*v).toFixed(2)>a&&r.push(e[n]);return r}function L(e,a,t){for(var r=[],n=0;n<e.length;n++)e[n].period<t&&e[n].period>a&&r.length<=200&&r.push(e[n]);return r.length>=200&&$("#findByLooks-results").text("Limited to 200 Results!"),r}function D(e,a,t){console.log(a),console.log(t);for(var r=[],n=0;n<e.length;n++)parseFloat(e[n].R)<t&&parseFloat(e[n].R)>a&&r.length<=200&&(console.log(e[n]),r.push(e[n]));return r.length>=200&&$("#findByLooks-results").text("Limited to 200 Results!"),r}var C=!isNaN(parseFloat(e))&&isFinite(e),T=!isNaN(parseFloat(a))&&isFinite(a),y=!isNaN(parseFloat(t))&&isFinite(t),x=!isNaN(parseFloat(r))&&isFinite(r),A=!isNaN(parseFloat(l))&&isFinite(l),E=!isNaN(parseFloat(d))&&isFinite(d),R=!isNaN(parseFloat(n))&&isFinite(n),I=!isNaN(parseFloat(s))&&isFinite(s),w=!isNaN(parseFloat(i))&&isFinite(i),N=!isNaN(parseFloat(o))&&isFinite(o),O=!isNaN(parseFloat(g))&&isFinite(g),F=!isNaN(parseFloat(u))&&isFinite(u);if(c*=1,T||y||C||x||A||E){R||(n=5),I||(s=5),w||(i=200),N||(o=1),O||(g=.5),F||(u=d/10);for(var U=[],k=0,P=0;P<S.length;P++)S[P].static||S[P].missile||!S[P].active||(U.push(S[P]),satellite.getTEARR(U[k]),U[k].azimuth=uiManager.currentTEARR.azimuth,U[k].elevation=uiManager.currentTEARR.elevation,U[k].range=uiManager.currentTEARR.range,U[k].inview=uiManager.currentTEARR.inview,k++);if(x||A||(U=M(U)),0!==c&&(U=p(U)),C){e*=1,n*=1;var j=e-n,z=e+n;U=h(U,j,z)}if(T){a*=1,s*=1;var _=a-s,B=a+s;U=m(U,_,B)}if(y){t*=1,i*=1;var V=t-i,Y=t+i;U=f(U,V,Y)}if(x){r*=1,o*=1;var G=r-o,q=r+o;U=b(U,G,q)}if(A){l*=1,g*=1;var H=l-g,J=l+g;U=L(U,H,J)}if(E){d*=1,u*=1;var W=d-u,X=d+u;U=D(U,W,X)}var K=[];for(P=0;P<U.length;P++)P<U.length-1?$("#search").val($("#search").val()+U[P].SCC_NUM+","):$("#search").val($("#search").val()+U[P].SCC_NUM),K.push(U[P].SCC_NUM);return searchBox.doSearch($("#search").val()),U}}),D.exportTle2Csv=(()=>{let e=[],a=D.getSatData();a.sort((e,a)=>parseInt(e.SCC_NUM)-parseInt(a.SCC_NUM));for(let t=0;t<a.length;t++){let r=a[t];void 0!==r.TLE1&&void 0!==r.TLE2&&("ANALSAT"!=r.C&&e.push({satId:r.SCC_NUM,TLE1:r.TLE1,TLE2:r.TLE2,inclination:r.inclination*v,eccentricity:r.eccentricity,period:r.period,raan:r.raan*v,apogee:r.apogee,perigee:r.perigee,site:r.LS,country:r.C,name:r.ON,mission:r.M,purpose:r.P,user:r.U,rocket:r.LV,contractor:r.Con,dryMass:r.DM,
liftMass:r.LM,lifeExpected:r.Li,power:r.Pw,visualMagnitude:r.vmag,source1:r.S1,source2:r.S2,source3:r.S3,source4:r.S4,source5:r.S5,source6:r.S6,source7:r.S7,source8:r.URL}))}uiManager.saveCsv(e,"catalogInfo")}),D.exportTle2Txt=(()=>{let e=[],a=D.getSatData();a.sort((e,a)=>parseInt(e.SCC_NUM)-parseInt(a.SCC_NUM));for(let t=0;t<a.length;t++){let r=a[t];void 0!==r.TLE1&&void 0!==r.TLE2&&("ANALSAT"!=r.C&&(e.push(r.TLE1),e.push(r.TLE2)))}e=e.join("\n");var t=new Blob([e],{type:"text/plain;charset=utf-8"});saveAs(t,"TLE.txt")}),D.setHover=(e=>{if(e!==objectManager.hoveringSat){if(gl.bindBuffer(gl.ARRAY_BUFFER,r),-1!==objectManager.hoveringSat&&objectManager.hoveringSat!==objectManager.selectedSat)try{gl.bufferSubData(gl.ARRAY_BUFFER,4*objectManager.hoveringSat*4,new Float32Array(settingsManager.currentColorScheme.colorizer(D.getSat(objectManager.hoveringSat)).color))}catch(e){console.log(objectManager.hoveringSat),console.log(D.getSat(objectManager.hoveringSat)),console.log(settingsManager.currentColorScheme.colorizer(D.getSat(objectManager.hoveringSat)))}-1!==e&&e!==objectManager.selectedSat&&gl.bufferSubData(gl.ARRAY_BUFFER,4*e*4,new Float32Array(settingsManager.hoverColor)),objectManager.hoveringSat=e,D.setColorScheme(settingsManager.currentColorScheme,!0)}}),D.selectSat=(e=>{e!==objectManager.selectedSat&&(isAnalysisMenuOpen&&-1!=e&&$("#anal-sat").val(D.getSat(e).SCC_NUM),adviceList.satelliteSelected(),b.postMessage({satelliteSelected:[e]}),settingsManager.isMobileModeEnabled&&mobile.searchToggle(!1),"undefined"!=typeof meshManager&&(gl.bindBuffer(gl.ARRAY_BUFFER,r),-1!==objectManager.selectedSat&&gl.bufferSubData(gl.ARRAY_BUFFER,4*objectManager.selectedSat*4,new Float32Array(settingsManager.currentColorScheme.colorizer(D.getSat(objectManager.selectedSat)).color)),-1!==e&&(isSatView=!0,gl.bufferSubData(gl.ARRAY_BUFFER,4*e*4,new Float32Array(settingsManager.selectedColor)))),objectManager.selectedSat=e,D.setColorScheme(settingsManager.currentColorScheme,!0),objectManager.isSensorManagerLoaded&&null!=sensorManager.currentSensor.lat&&$("#menu-lookangles").removeClass("bmenu-item-disabled"),$("#menu-lookanglesmultisite").removeClass("bmenu-item-disabled"),$("#menu-satview").removeClass("bmenu-item-disabled"),$("#menu-map").removeClass("bmenu-item-disabled"),$("#menu-editSat").removeClass("bmenu-item-disabled"),$("#menu-sat-fov").removeClass("bmenu-item-disabled"),$("#menu-newLaunch").removeClass("bmenu-item-disabled"),$("#menu-breakup").removeClass("bmenu-item-disabled"))}),D.onCruncherReady=(()=>{db.log("satSet.onCruncherReady",!0),D.queryStr=window.location.search.substring(1),D.satDataString=null}),window.satSet=D,window.satCruncher=b,window.satPos=g})();