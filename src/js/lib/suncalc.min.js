function toJulian(n){return n.valueOf()/dayMs-.5+J1970}function fromJulian(n){return new Date((n+.5-J1970)*dayMs)}function toDays(n){return toJulian(n)-J2000}function rightAscension(n,a){return atan(sin(n)*cos(e)-tan(a)*sin(e),cos(n))}function declination(n,a){return asin(sin(a)*cos(e)+cos(a)*sin(e)*sin(n))}function azimuth(n,a,t){return atan(sin(n),cos(n)*sin(a)-tan(t)*cos(a))}function altitude(n,a,t){return asin(sin(a)*sin(t)+cos(a)*cos(t)*cos(n))}function siderealTime(n,a){return rad*(280.16+360.9856235*n)-a}function astroRefraction(n){return n<0&&(n=0),2967e-7/Math.tan(n+.00312536/(n+.08901179))}function solarMeanAnomaly(n){return rad*(357.5291+.98560028*n)}function eclipticLongitude(n){var a=rad*(1.9148*sin(n)+.02*sin(2*n)+3e-4*sin(3*n)),t=102.9372*rad;return n+a+t+PI}function sunCoords(n){var a=solarMeanAnomaly(n),t=eclipticLongitude(a);return{dec:declination(t,0),ra:rightAscension(t,0)}}function julianCycle(n,a){return Math.round(n-J0-a/(2*PI))}function approxTransit(n,a,t){return J0+(n+a)/(2*PI)+t}function solarTransitJ(n,a,t){return J2000+n+.0053*sin(a)-.0069*sin(2*t)}function hourAngle(n,a,t){return acos((sin(n)-sin(a)*sin(t))/(cos(a)*cos(t)))}function getSetJ(n,a,t,r,o,i,s){var e=hourAngle(n,t,r),u=approxTransit(e,a,o);return solarTransitJ(u,i,s)}function moonCoords(n){var a=rad*(218.316+13.176396*n),t=rad*(134.963+13.064993*n),r=rad*(93.272+13.22935*n),o=a+6.289*rad*sin(t),i=5.128*rad*sin(r),s=385001-20905*cos(t);return{ra:rightAscension(o,i),dec:declination(o,i),dist:s}}function hoursLater(n,a){return new Date(n.valueOf()+a*dayMs/24)}var SunCalc={},PI=Math.PI,sin=Math.sin,cos=Math.cos,tan=Math.tan,asin=Math.asin,atan=Math.atan2,acos=Math.acos,rad=PI/180,dayMs=864e5,J1970=2440588,J2000=2451545,e=23.4397*rad;SunCalc.getPosition=function(n,a,t){var r=rad*-t,o=rad*a,i=toDays(n),s=sunCoords(i),e=siderealTime(i,r)-s.ra;return{azimuth:azimuth(e,o,s.dec),altitude:altitude(e,o,s.dec)}};var times=SunCalc.times=[[-.833,"sunrise","sunset"],[-.3,"sunriseEnd","sunsetStart"],[-6,"dawn","dusk"],[-12,"nauticalDawn","nauticalDusk"],[-18,"nightEnd","night"],[6,"goldenHourEnd","goldenHour"]];SunCalc.addTime=function(n,a,t){times.push([n,a,t])};var J0=9e-4;SunCalc.getTimes=function(n,a,t){var r,o,i,s,e,u=rad*-t,c=rad*a,d=toDays(n),l=julianCycle(d,u),f=approxTransit(0,u,l),h=solarMeanAnomaly(f),m=eclipticLongitude(h),M=declination(m,0),g=solarTransitJ(f,h,m),C={solarNoon:fromJulian(g),nadir:fromJulian(g-.5)};for(r=0,o=times.length;r<o;r+=1)i=times[r],s=getSetJ(i[0]*rad,u,c,M,l,h,m),e=g-(s-g),C[i[1]]=fromJulian(e),C[i[2]]=fromJulian(s);return C},SunCalc.getMoonPosition=function(n,a,t){var r=rad*-t,o=rad*a,i=toDays(n),s=moonCoords(i),e=siderealTime(i,r)-s.ra,u=altitude(e,o,s.dec),c=atan(sin(e),tan(o)*cos(s.dec)-sin(s.dec)*cos(e));return u+=astroRefraction(u),{azimuth:azimuth(e,o,s.dec),altitude:u,distance:s.dist,parallacticAngle:c}},SunCalc.getMoonIllumination=function(n){var a=toDays(n||new Date),t=sunCoords(a),r=moonCoords(a),o=149598e3,i=acos(sin(t.dec)*sin(r.dec)+cos(t.dec)*cos(r.dec)*cos(t.ra-r.ra)),s=atan(o*sin(i),r.dist-o*cos(i)),e=atan(cos(t.dec)*sin(t.ra-r.ra),sin(t.dec)*cos(r.dec)-cos(t.dec)*sin(r.dec)*cos(t.ra-r.ra));return{fraction:(1+cos(s))/2,phase:.5+.5*s*(e<0?-1:1)/Math.PI,angle:e}},SunCalc.getMoonTimes=function(n,a,t,r){var o=new Date(n);r?o.setUTCHours(0,0,0,0):o.setHours(0,0,0,0);for(var i,s,e,u,c,d,l,f,h,m,M,g,C,J=.133*rad,v=SunCalc.getMoonPosition(o,a,t).altitude-J,y=1;y<=24&&(i=SunCalc.getMoonPosition(hoursLater(o,y),a,t).altitude-J,s=SunCalc.getMoonPosition(hoursLater(o,y+1),a,t).altitude-J,c=(v+s)/2-i,d=(s-v)/2,l=-d/(2*c),f=(c*l+d)*l+i,h=d*d-4*c*i,m=0,h>=0&&(C=Math.sqrt(h)/(2*Math.abs(c)),M=l-C,g=l+C,Math.abs(M)<=1&&m++,Math.abs(g)<=1&&m++,M<-1&&(M=g)),1===m?v<0?e=y+M:u=y+M:2===m&&(e=y+(f<0?g:M),u=y+(f<0?M:g)),!e||!u);y+=2)v=s;var S={};return e&&(S.rise=hoursLater(o,e)),u&&(S.set=hoursLater(o,u)),e||u||(S[f>0?"alwaysUp":"alwaysDown"]=!0),S};export{SunCalc};