<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <script>
    var ManUpdateSource = 'TLE Updater';
    function manrequest_task(action)
    {
      if (action == "view") {
        ManUpdateSource = new EventSource('TLEManUpdate.php?scc=' + document.getElementById("SCC_NUM").value + '&action=view');
        document.getElementById("OBJECT_NAME").value = "Not Found";
        document.getElementById("OBJECT_URL").value = "Not Found";
        document.getElementById("COUNTRY").value = "Not Found";
        document.getElementById("LAUNCH_VEHICLE").value = "Not Found";
        document.getElementById("LAUNCH_SITE").value = "Not Found";
        document.getElementById("LAUNCH_SITEC").value = "Not Found";
        document.getElementById("OBJECT_TYPE").value = "Not Found";
      }
      if (action == "update") {
        var oname = document.getElementById("OBJECT_NAME").value;
        var ourl = document.getElementById("OBJECT_URL").value;
        var ocountry = document.getElementById("COUNTRY").value;
        var oslv = document.getElementById("LAUNCH_VEHICLE").value;
        var olsite = document.getElementById("LAUNCH_SITE").value;
        var olcountry = document.getElementById("LAUNCH_SITEC").value;
        var ot = document.getElementById("OBJECT_TYPE").value;
        ManUpdateSource = new EventSource('TLEManUpdate.php?scc=' + document.getElementById("SCC_NUM").value + '&action=update' +
                                 '&OBJECT_NAME=' + oname + '&OBJECT_URL=' + ourl + '&COUNTRY=' + ocountry + '&LAUNCH_VEHICLE=' + oslv +
                                 '&LAUNCH_SITE=' + olsite + '&LAUNCH_SITEC=' + olcountry + '&OBJECT_TYPE=' + ot);
      }

      //A message is received from Parser
      ManUpdateSource.addEventListener('message' , function(e)
      {
        var result = JSON.parse( e.data );
        if (result.message)
          add_log(result.message);
        else if (action == "view") {
          document.getElementById("OBJECT_NAME").value = result.OBJECT_NAME;
          document.getElementById("OBJECT_URL").value = result.OBJECT_URL;
          document.getElementById("COUNTRY").value = result.COUNTRY;
          document.getElementById("LAUNCH_VEHICLE").value = result.LAUNCH_VEHICLE;
          document.getElementById("LAUNCH_SITE").value = result.LAUNCH_SITE;
          document.getElementById("LAUNCH_SITEC").value = result.LAUNCH_SITEC;
          document.getElementById("OBJECT_TYPE").value = result.OBJECT_TYPE;
          document.getElementById("EPOCH_DAY").innerHTML = result.EPOCH_DAY;
          document.getElementById("EPOCH_YEAR").innerHTML = result.EPOCH_YEAR;
        }

          //Close the listener when Catalogue Update Complete
        if(e.data.search('Catalogue Closed') != -1)
          {ManUpdateSource.close();}
      });

        //Close the listener if there is an error
      ManUpdateSource.addEventListener('error' , function(e)
      {
        add_log('Error occured');
        ManUpdateSource.close();
      });
    }

    var ParseSource = 'TLE Parser';
    function start_task()
    {
      ParseSource = new EventSource('TLEParse.php');

      //A message is received from Parser
      ParseSource.addEventListener('message' , function(e)
      {
        var result = JSON.parse( e.data );
        add_log(result.message);
          //Update Progress Bar
        document.getElementById('progressor').style.width = result.progress + "%";

          //Close the listener when Catalogue Update Complete
        if(e.data.search('Catalogue Update Complete') != -1)
        {
          ParseSource.close();
        }
      });

        //Close the listener if there is an error
      ParseSource.addEventListener('error' , function(e)
      {
        add_log('Error occured');
        ParseSource.close();
      });
    }

    var RequestSource = 'TLE Update';
    function TLEUpdate_task()
    {
      RequestSource = new EventSource('TLEUpdate.php?type=' + document.getElementById("DOWNLOAD_TYPE").value);

      //A message is received from Parser
      RequestSource.addEventListener('message' , function(e)
      {
        var result = JSON.parse( e.data );
        add_log(result.message);
          //Update Progress Bar
        document.getElementById('progressor').style.width = result.progress + "%";

          //Close the listener when Catalogue Update Complete
        if(e.data.search('Catalogue Download Complete') != -1)
        {
          RequestSource.close();
        }
      });

        //Close the listener if there is an error
      RequestSource.addEventListener('error' , function(e)
      {
        add_log('Error occured');
        RequestSource.close();
      });
    }

    function stop_task()
    {
      add_log('All External Scripts Stopped');
      if (RequestSource != 'TLE Update')
        RequestSource.close();
      if (ParseSource != 'TLE Parser')
        ParseSource.close();
    }

    function add_log(message)
    {
      var r = document.getElementById('results');
      r.innerHTML += message + '<br>';
      r.scrollTop = r.scrollHeight;
    }
    function clear_log()
    {
      var r = document.getElementById('results');
      r.innerHTML = '';
      r.scrollTop = r.scrollHeight;
    }
    </script>
  </head>
  <body>
    <!-- J-Day in Top Right Corner -->
      <div style="padding-top:2px; position: absolute; right: 0px; width:150px;">
        <span>Current JDay:</span>
        <span id="Current-Jday"></span>
      </div>

    <!-- Top Menu, Console, and Progress Bar Container -->
      <div id="container" style="margin-left:25%; width:50%; text-align:center; padding: 10px;">
        <!-- Top Menu To Request ELSETs -->
          <div id="request" style="position: absolute; left: 30%; top: 10px; width:25%;">
              Type:
              <select id="DOWNLOAD_TYPE" name="updateType">
                <option value="recent">Most Recent</option>
                <option value="leo">LEO</option>
                <option value="full">Everything</option>
                <option value="decay">Decays</option>
              </select>
              <input type="button" onclick="TLEUpdate_task();" value="Request" />
          </div>
        <!-- Top Menu To Parse Files-->
          <div id="buttons" style="position: absolute; left: 50%; top: 10px; width:25%;">
            <input type="button" onclick="start_task();"  value="Start Update" />
            <input type="button" onclick="clear_log();"  value="Clear" />
            <input type="button" onclick="stop_task();"  value="Stop" />
          </div>
        <!-- Center Console/Log -->
          <div id="results" style="text-align:left; border:1px solid #ccc; position: relative; top: 20px; width: 100%; height:200px; overflow:auto; background:#eee; margin: 0 auto;"></div>
        <!-- Center Progress Bar -->
          <div style="border:1px solid #ccc;position: relative; top: 30px; width: 100%; height:20px; overflow:auto; background:#eee; margin: 0 auto;">
            <div id="progressor" style="background:#07c; width:0%; height:100%;"></div>
          </div>
    </div>

    <!-- Side Menu -->
      <div style="position: absolute; left: 10px; top: 10px;">
        <form action="LaunchUpdate.php" method="POST">
          <input type="submit" value="Check Launch Calendar" />
        </form>
          <input type="button" onclick="toggleEditELSETMenu();" value="ELSET View/Update" />
          <script>
            function toggleEditELSETMenu() {
              if (document.getElementById('ELSET-Update-Menu').style.display == 'block')
                document.getElementById('ELSET-Update-Menu').style.display = 'none';
              else if (document.getElementById('ELSET-Update-Menu').style.display == 'none')
                document.getElementById('ELSET-Update-Menu').style.display = 'block';
            }
          </script>
      </div>
    <!-- ELSET View/Update -->
      <div id="ELSET-Update-Menu" style="display: none; position: absolute; left: 30%; top: 330px; width:40%;">
        <form>
          <div>
            <span>SCC #:</span>
            <input id="SCC_NUM" type="text" style="position: absolute; right: 0px; width:100px;" maxlength="5" name="scc" value="5">
          </div>
          <br />
          <div style="position: absolute; right: 0px;">
            <input type="button" onclick="manrequest_task('view');" value="Request" />
          </div>
          <br />
          <br />
          <div>
            <span>Name:</span>
            <input id="OBJECT_NAME" type="text" style="position: absolute; right: 0px; width:100px;" name="OBJECT_NAME" value="5">
          </div>
          <div style="padding-top:4px;">
            <span>Epoch Day:</span>
            <span id="EPOCH_DAY" style="position: absolute; right: 0px; width:100px;">15</span>
          </div>
          <div style="padding-top:4px;">
            <span>Epoch Year:</span>
            <span id="EPOCH_YEAR" style="position: absolute; right: 0px; width:100px;">366.02</span>
          </div>
          <div>
            <span>Object URL:</span>
            <input id="OBJECT_URL" type="text" style="position: absolute; right: 0px; width:100px;" name="OBJECT_URL" value="5">
          </div>
          <div>
            <span>Country:</span>
            <input id="COUNTRY" type="text" style="position: absolute; right: 0px; width:100px;" name="COUNTRY" value="5">
          </div>
          <div>
            <span>Launch Vehicle:</span>
            <input id="LAUNCH_VEHICLE" type="text" style="position: absolute; right: 0px; width:100px;" name="LAUNCH_VEHICLE" value="5">
          </div>
          <div>
            <span>Launch Site:</span>
            <input id="LAUNCH_SITE" type="text" style="position: absolute; right: 0px; width:100px;" name="LAUNCH_SITE" value="5">
          </div>
          <div>
            <span>Launch Country:</span>
            <input id="LAUNCH_SITEC" type="text" style="position: absolute; right: 0px; width:100px;" name="LAUNCH_SITEC" value="5">
          </div>
          <div>
            <span>Object Type:</span>
            <input id="OBJECT_TYPE" type="text" style="position: absolute; right: 0px; width:100px;" name="OBJECT_TYPE" value="5">
          </div>
          <br />
          <div style="position: absolute; right: 0px;">
            <input type="button" onclick="manrequest_task('update');" value="Update"/>
          </div>
        </form>
      </div>

  <!-- Update JDay in Top Right Corner -->
  <script>

    Date.prototype.isLeapYear = function() {
    var year = this.getFullYear();
    if((year & 3) != 0) return false;
    return ((year % 100) != 0 || (year % 400) == 0);
    };

    // Get Day of Year
    Date.prototype.getDOY = function() {
        var dayCount = [0, 31, 59, 90, 120, 151, 181, 212, 243, 273, 304, 334];
        var mn = this.getMonth();
        var dn = this.getDate();
        var dayOfYear = dayCount[mn] + dn;
        if(mn > 1 && this.isLeapYear()) dayOfYear++;
        return dayOfYear;
    };

    jday = new Date();
    document.getElementById("Current-Jday").innerHTML = jday.getDOY();
  </script>
  </body>
</html>
