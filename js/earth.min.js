ATMOSPHERE_MAX=108,ATMOSPHERE_MOD=RADIUS_OF_EARTH+300,ATMOSPHERE_DIST=4e3,ATMOSPHERE_DIST_MOD=5e3,ATMOSPHERE_DIST_MIN=200,function(){var e,t,r,a,g,l,i,o,n,E,T,R={},m=!1,u=!1,s=mat4.create(),A=mat3.create();R.earthJ=0,R.earthEra=0,R.timeTextStr="",R.timeTextStrEmpty="",R.lightDirection=[],R.propRateDOM=$("#propRate-status-box"),R.pos=[0,0,0];var h=!1,f=!1,c=!1;function _(){h&&f&&(c=!0,R.loaded=!0,$("#loader-text").text("Drawing Dots in Space..."))}R.loaded=!1,R.init=function(){var l=gl.createShader(gl.FRAGMENT_SHADER),i=shaderLoader.getShaderCode("earth-fragment.glsl");gl.shaderSource(l,i),gl.compileShader(l);var o=gl.createShader(gl.VERTEX_SHADER),R=shaderLoader.getShaderCode("earth-vertex.glsl");gl.shaderSource(o,R),gl.compileShader(o),n=gl.createProgram(),gl.attachShader(n,o),gl.attachShader(n,l),gl.linkProgram(n),n.aVertexPosition=gl.getAttribLocation(n,"aVertexPosition"),n.aTexCoord=gl.getAttribLocation(n,"aTexCoord"),n.aVertexNormal=gl.getAttribLocation(n,"aVertexNormal"),n.uPMatrix=gl.getUniformLocation(n,"uPMatrix"),n.uCamMatrix=gl.getUniformLocation(n,"uCamMatrix"),n.uMvMatrix=gl.getUniformLocation(n,"uMvMatrix"),n.uNormalMatrix=gl.getUniformLocation(n,"uNormalMatrix"),n.uLightDirection=gl.getUniformLocation(n,"uLightDirection"),n.uAmbientLightColor=gl.getUniformLocation(n,"uAmbientLightColor"),n.uDirectionalLightColor=gl.getUniformLocation(n,"uDirectionalLightColor"),n.uSampler=gl.getUniformLocation(n,"uSampler"),n.uNightSampler=gl.getUniformLocation(n,"uNightSampler"),E=gl.createTexture();var m=new Image,u=new Image;m.onload=function(){$("#loader-text").text("Painting the Earth..."),gl.bindTexture(gl.TEXTURE_2D,E),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,m),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.REPEAT),h=!0,_()},settingsManager.nasaImages&&(m.src="images/dayearth-4096.jpg"),settingsManager.trusatImages&&(m.src="images/trusatvector-4096.jpg"),settingsManager.blueImages&&(m.src="images/world_blue-2048.png"),settingsManager.lowresImages&&(m.src="images/no_clouds_4096.jpg"),settingsManager.vectorImages&&(m.src="images/dayearthvector-4096.jpg"),settingsManager.hiresImages||settingsManager.hiresNoCloudsImages?(settingsManager.hiresImages&&(u.src="images/2_earth_16k.jpg"),settingsManager.hiresNoCloudsImages&&(u.src="images/no_clouds_8k.jpg"),u.onload=function(){gl.bindTexture(gl.TEXTURE_2D,E),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,u),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.REPEAT)}):u=null,T=gl.createTexture();var s=new Image,A=new Image;s.onload=function(){gl.bindTexture(gl.TEXTURE_2D,T),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,s),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.REPEAT),f=!0,_()},settingsManager.nasaImages&&(s.src="images/nightearth-4096.png"),settingsManager.trusatImages&&(s.src="images/nightearth-4096.png"),settingsManager.lowresImages&&(s.src="images/nightearth-4096.png"),settingsManager.blueImages&&(s.src="images/nightearth-4096.png"),settingsManager.vectorImages&&(s.src="images/dayearthvector-4096.jpg"),settingsManager.hiresImages||settingsManager.hiresNoCloudsImages?(A.src="images/6_night_16k.jpg",A.onload=function(){gl.bindTexture(gl.TEXTURE_2D,T),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,A),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.REPEAT)}):u=null;var c=[],M=[],x=[];for(let e=0;e<=64;e++){var d=Math.PI/64*e-Math.PI/2,S=Math.cos(Math.abs(d)),U=Math.sin(d);for(let t=0;t<=64;t++){var D=2*Math.PI/64*t,p=Math.cos(D)*S,F=Math.sin(D)*S,L=1-e/64,P=.5+t/64;c.push(p*RADIUS_OF_EARTH),c.push(F*RADIUS_OF_EARTH),c.push(U*RADIUS_OF_EARTH),x.push(P),x.push(L),M.push(p),M.push(F),M.push(U)}}var I=[];for(let e=0;e<64;e++)for(let t=0;t<64;t++){var b=65*e+t,N=b+1,B=65*(e+1)+t,v=B+1;I.push(b),I.push(N),I.push(B),I.push(B),I.push(v),I.push(N)}g=I.length,e=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,e),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(c),gl.STATIC_DRAW),t=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,t),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(M),gl.STATIC_DRAW),r=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,r),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(x),gl.STATIC_DRAW),a=gl.createBuffer(),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,a),gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(I),gl.STATIC_DRAW)},R.draw=function(h,f){if(c){if(R.lastTime=l,l=timeManager.propTime(),R.lastTime-l<300){for(R.tDS=l.toJSON(),R.timeTextStr=R.timeTextStrEmpty,R.iText=0;R.iText<20;R.iText++)R.iText<10&&(R.timeTextStr+=R.tDS[R.iText]),10===R.iText&&(R.timeTextStr+=" "),R.iText>11&&(R.timeTextStr+=R.tDS[R.iText-1]);settingsManager.isPropRateChange&&!settingsManager.isAlwaysHidePropRate&&(timeManager.propRate>1.01||timeManager.propRate<.99?(timeManager.propRate<10&&R.propRateDOM.html("Propagation Speed: "+timeManager.propRate.toFixed(1)+"x"),timeManager.propRate>=10&&R.propRateDOM.html("Propagation Speed: "+timeManager.propRate.toFixed(2)+"x"),R.propRateDOM.show(),u=!0):u&&(R.propRateDOM.hide(),u=!1),settingsManager.isPropRateChange=!1),m?document.getElementById("datetime-text").childNodes[0].nodeValue=`${R.timeTextStr} UTC`:(document.getElementById("datetime-text").innerText=`${R.timeTextStr} UTC`,m=!0)}return!settingsManager.isEditTime&&settingsManager.cruncherReady||$("#datetime-input-tb").val(R.timeTextStr),R.earthJ=timeManager.jday(l.getUTCFullYear(),l.getUTCMonth()+1,l.getUTCDate(),l.getUTCHours(),l.getUTCMinutes(),l.getUTCSeconds()),R.earthJ+=l.getUTCMilliseconds()*MILLISECONDS_PER_DAY,R.earthEra=satellite.gstime(R.earthJ),isDayNightToggle||(sun.currentDirection(),vec3.normalize(R.lightDirection,R.lightDirection)),i=s,mat4.identity(i),mat4.rotateZ(i,i,R.earthEra),mat4.translate(i,i,R.pos),o=A,mat3.normalFromMat4(o,i),gl.useProgram(n),gl.bindFramebuffer(gl.FRAMEBUFFER,null),gl.uniformMatrix3fv(n.uNormalMatrix,!1,o),gl.uniformMatrix4fv(n.uMvMatrix,!1,i),gl.uniformMatrix4fv(n.uPMatrix,!1,h),gl.uniformMatrix4fv(n.uCamMatrix,!1,f),isDayNightToggle||gl.uniform3fv(n.uLightDirection,R.lightDirection),gl.uniform3fv(n.uAmbientLightColor,[.03,.03,.03]),gl.uniform3fv(n.uDirectionalLightColor,[1,1,1]),gl.uniform1i(n.uSampler,0),gl.activeTexture(gl.TEXTURE0),gl.bindTexture(gl.TEXTURE_2D,E),isDayNightToggle?(gl.uniform1i(n.uNightSampler,1),gl.activeTexture(gl.TEXTURE1),gl.bindTexture(gl.TEXTURE_2D,E)):(gl.uniform1i(n.uNightSampler,1),gl.activeTexture(gl.TEXTURE1),gl.bindTexture(gl.TEXTURE_2D,T)),gl.bindBuffer(gl.ARRAY_BUFFER,r),gl.enableVertexAttribArray(n.aTexCoord),gl.vertexAttribPointer(n.aTexCoord,2,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,e),gl.enableVertexAttribArray(n.aVertexPosition),gl.vertexAttribPointer(n.aVertexPosition,3,gl.FLOAT,!1,0,0),gl.vertexAttribPointer(gl.pickShaderProgram.aPos,3,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,t),gl.enableVertexAttribArray(n.aVertexNormal),gl.vertexAttribPointer(n.aVertexNormal,3,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,a),gl.drawElements(gl.TRIANGLES,g,gl.UNSIGNED_SHORT,0),gl.useProgram(gl.pickShaderProgram),gl.bindFramebuffer(gl.FRAMEBUFFER,gl.pickFb),gl.uniformMatrix4fv(gl.pickShaderProgram.uMvMatrix,!1,i),gl.disableVertexAttribArray(gl.pickShaderProgram.aColor),gl.enableVertexAttribArray(gl.pickShaderProgram.aPos),gl.drawElements(gl.TRIANGLES,g,gl.UNSIGNED_SHORT,0),!0}},window.earth=R}(),function(){var e,t,r,a,g,l,i,o,n,E,T={},R=mat4.create(),m=mat3.create();T.lightDirection=[],T.pos=[100,0,0];var u=!1,s=!1;function A(){u&&s&&(!0,$("#loader-text").text("Drawing Dots in Space..."))}T.init=function(){var l=gl.createShader(gl.FRAGMENT_SHADER),i=shaderLoader.getShaderCode("atmosphere-fragment.glsl");gl.shaderSource(l,i),gl.compileShader(l);var T=gl.createShader(gl.VERTEX_SHADER),R=shaderLoader.getShaderCode("atmosphere-vertex.glsl");gl.shaderSource(T,R),gl.compileShader(T),o=gl.createProgram(),gl.attachShader(o,T),gl.attachShader(o,l),gl.linkProgram(o),o.aVertexPosition=gl.getAttribLocation(o,"aVertexPosition"),o.aTexCoord=gl.getAttribLocation(o,"aTexCoord"),o.aVertexNormal=gl.getAttribLocation(o,"aVertexNormal"),o.uPMatrix=gl.getUniformLocation(o,"uPMatrix"),o.uCamMatrix=gl.getUniformLocation(o,"uCamMatrix"),o.uMvMatrix=gl.getUniformLocation(o,"uMvMatrix"),o.uNormalMatrix=gl.getUniformLocation(o,"uNormalMatrix"),o.uLightDirection=gl.getUniformLocation(o,"uLightDirection"),o.uAmbientLightColor=gl.getUniformLocation(o,"uAmbientLightColor"),o.uDirectionalLightColor=gl.getUniformLocation(o,"uDirectionalLightColor"),o.uSampler=gl.getUniformLocation(o,"uSampler"),o.uNightSampler=gl.getUniformLocation(o,"uNightSampler"),n=gl.createTexture();var m=new Image;m.onload=function(){gl.bindTexture(gl.TEXTURE_2D,n),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,m),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.REPEAT),u=!0,A()},m.src="images/atmosphere-day.png",E=gl.createTexture();var h=new Image;new Image;h.onload=function(){gl.bindTexture(gl.TEXTURE_2D,E),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,h),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.REPEAT),s=!0,A()},h.src="images/atmosphere-night.png";var f=[],c=[],_=[];for(let e=0;e<=64;e++){var M=Math.PI/64*e-Math.PI/2,x=Math.cos(Math.abs(M)),d=Math.sin(M);for(let t=0;t<=64;t++){var S=2*Math.PI/64*t,U=Math.cos(S)*x,D=Math.sin(S)*x,p=1-e/64,F=.5+t/64;f.push(1*U),f.push(D*ATMOSPHERE_MOD),f.push(d*ATMOSPHERE_MOD),_.push(F),_.push(p),c.push(U),c.push(D),c.push(d)}}var L=[];for(let e=0;e<64;e++)for(let t=0;t<64;t++){var P=65*e+t,I=P+1,b=65*(e+1)+t,N=b+1;L.push(P),L.push(I),L.push(b),L.push(b),L.push(N),L.push(I)}g=L.length,e=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,e),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(f),gl.STATIC_DRAW),t=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,t),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(c),gl.STATIC_DRAW),r=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,r),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(_),gl.STATIC_DRAW),a=gl.createBuffer(),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,a),gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(L),gl.STATIC_DRAW)},T.resize=function(){T.pos[0]=Math.min(zoomTarget**3*ATMOSPHERE_DIST+ATMOSPHERE_DIST_MOD,ATMOSPHERE_DIST_MIN),ATMOSPHERE_MOD=RADIUS_OF_EARTH+ATMOSPHERE_MAX/zoomLevel**2;var l=gl.createShader(gl.FRAGMENT_SHADER),i=shaderLoader.getShaderCode("atmosphere-fragment.glsl");gl.shaderSource(l,i),gl.compileShader(l);var n=gl.createShader(gl.VERTEX_SHADER),E=shaderLoader.getShaderCode("atmosphere-vertex.glsl");gl.shaderSource(n,E),gl.compileShader(n),o=gl.createProgram(),gl.attachShader(o,n),gl.attachShader(o,l),gl.linkProgram(o),o.aVertexPosition=gl.getAttribLocation(o,"aVertexPosition"),o.aTexCoord=gl.getAttribLocation(o,"aTexCoord"),o.aVertexNormal=gl.getAttribLocation(o,"aVertexNormal"),o.uPMatrix=gl.getUniformLocation(o,"uPMatrix"),o.uCamMatrix=gl.getUniformLocation(o,"uCamMatrix"),o.uMvMatrix=gl.getUniformLocation(o,"uMvMatrix"),o.uNormalMatrix=gl.getUniformLocation(o,"uNormalMatrix"),o.uLightDirection=gl.getUniformLocation(o,"uLightDirection"),o.uAmbientLightColor=gl.getUniformLocation(o,"uAmbientLightColor"),o.uDirectionalLightColor=gl.getUniformLocation(o,"uDirectionalLightColor"),o.uSampler=gl.getUniformLocation(o,"uSampler"),o.uNightSampler=gl.getUniformLocation(o,"uNightSampler");var R=[],m=[],u=[];for(let e=0;e<=64;e++){var s=Math.PI/64*e-Math.PI/2,A=Math.cos(Math.abs(s)),h=Math.sin(s);for(let t=0;t<=64;t++){var f=2*Math.PI/64*t,c=Math.cos(f)*A,_=Math.sin(f)*A,M=1-e/64,x=.5+t/64;R.push(1*c),R.push(_*ATMOSPHERE_MOD),R.push(h*ATMOSPHERE_MOD),u.push(x),u.push(M),m.push(c),m.push(_),m.push(h)}}var d=[];for(let e=0;e<64;e++)for(let t=0;t<64;t++){var S=65*e+t,U=S+1,D=65*(e+1)+t,p=D+1;d.push(S),d.push(U),d.push(D),d.push(D),d.push(p),d.push(U)}g=d.length,e=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,e),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(R),gl.STATIC_DRAW),t=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,t),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(m),gl.STATIC_DRAW),r=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,r),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(u),gl.STATIC_DRAW),a=gl.createBuffer(),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,a),gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(d),gl.STATIC_DRAW)},T.draw=function(s,A){if(u&&earth.loaded)return gl.enable(gl.BLEND),gl.disable(gl.DEPTH_TEST),gl.blendFunc(gl.ONE,gl.ONE_MINUS_SRC_ALPHA),vec3.normalize(earth.lightDirection,T.lightDirection),vec3.inverse(T.lightDirection,T.lightDirection),l=R,mat4.identity(l),mat4.rotateZ(l,l,camYaw+90*DEG2RAD),mat4.rotateY(l,l,camPitch),mat4.translate(l,l,T.pos),i=m,mat3.normalFromMat4(i,l),gl.useProgram(o),gl.bindFramebuffer(gl.FRAMEBUFFER,null),gl.uniformMatrix3fv(o.uNormalMatrix,!1,i),gl.uniformMatrix4fv(o.uMvMatrix,!1,l),gl.uniformMatrix4fv(o.uPMatrix,!1,s),gl.uniformMatrix4fv(o.uCamMatrix,!1,A),gl.uniform3fv(o.uAmbientLightColor,[.5,.5,.5]),gl.uniform1i(o.uSampler,0),gl.activeTexture(gl.TEXTURE0),gl.bindTexture(gl.TEXTURE_2D,n),gl.uniform1i(o.uNightSampler,1),gl.activeTexture(gl.TEXTURE1),gl.bindTexture(gl.TEXTURE_2D,E),gl.bindBuffer(gl.ARRAY_BUFFER,r),gl.enableVertexAttribArray(o.aTexCoord),gl.vertexAttribPointer(o.aTexCoord,2,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,e),gl.enableVertexAttribArray(o.aVertexPosition),gl.vertexAttribPointer(o.aVertexPosition,3,gl.FLOAT,!1,0,0),gl.vertexAttribPointer(gl.pickShaderProgram.aPos,3,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,t),gl.enableVertexAttribArray(o.aVertexNormal),gl.vertexAttribPointer(o.aVertexNormal,3,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,a),gl.drawElements(gl.TRIANGLES,g,gl.UNSIGNED_SHORT,0),gl.useProgram(gl.pickShaderProgram),gl.bindFramebuffer(gl.FRAMEBUFFER,gl.pickFb),gl.uniformMatrix4fv(gl.pickShaderProgram.uMvMatrix,!1,l),gl.disableVertexAttribArray(gl.pickShaderProgram.aColor),gl.enableVertexAttribArray(gl.pickShaderProgram.aPos),gl.drawElements(gl.TRIANGLES,g,gl.UNSIGNED_SHORT,0),gl.disable(gl.BLEND),gl.enable(gl.DEPTH_TEST),!0},window.atmosphere=T}();