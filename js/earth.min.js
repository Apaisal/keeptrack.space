!function(){var e,t,r,a,g,l,i,o,n,T,E,R={},m=!1,u=!1,s=mat4.create(),A=mat3.create();R.earthJ=0,R.earthEra=0,R.timeTextStr="",R.timeTextStrEmpty="",R.lightDirection=[],R.propRateDOM=$("#propRate-status-box"),R.pos=[0,0,0];var x=!1,h=!1,_=!1;function c(){x&&h&&(_=!0,$("#loader-text").text("Drawing Dots in Space..."))}R.init=function(){var l=gl.createShader(gl.FRAGMENT_SHADER),i=shaderLoader.getShaderCode("earth-fragment.glsl");gl.shaderSource(l,i),gl.compileShader(l);var o=gl.createShader(gl.VERTEX_SHADER),R=shaderLoader.getShaderCode("earth-vertex.glsl");gl.shaderSource(o,R),gl.compileShader(o),n=gl.createProgram(),gl.attachShader(n,o),gl.attachShader(n,l),gl.linkProgram(n),n.aVertexPosition=gl.getAttribLocation(n,"aVertexPosition"),n.aTexCoord=gl.getAttribLocation(n,"aTexCoord"),n.aVertexNormal=gl.getAttribLocation(n,"aVertexNormal"),n.uPMatrix=gl.getUniformLocation(n,"uPMatrix"),n.uCamMatrix=gl.getUniformLocation(n,"uCamMatrix"),n.uMvMatrix=gl.getUniformLocation(n,"uMvMatrix"),n.uNormalMatrix=gl.getUniformLocation(n,"uNormalMatrix"),n.uLightDirection=gl.getUniformLocation(n,"uLightDirection"),n.uAmbientLightColor=gl.getUniformLocation(n,"uAmbientLightColor"),n.uDirectionalLightColor=gl.getUniformLocation(n,"uDirectionalLightColor"),n.uSampler=gl.getUniformLocation(n,"uSampler"),n.uNightSampler=gl.getUniformLocation(n,"uNightSampler"),T=gl.createTexture();var m=new Image,u=new Image;m.onload=function(){$("#loader-text").text("Painting the Earth..."),gl.bindTexture(gl.TEXTURE_2D,T),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,m),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.REPEAT),x=!0,c()},settingsManager.vectorImages||(m.src="images/dayearth-4096.jpg"),settingsManager.vectorImages&&(m.src="images/dayearthvector-4096.jpg"),settingsManager.hiresImages?(setTimeout(function(){u.src="images/2_earth_16k.jpg"},2e4),u.onload=function(){gl.bindTexture(gl.TEXTURE_2D,T),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,u),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.REPEAT)}):u=null,E=gl.createTexture();var s=new Image,A=new Image;s.onload=function(){gl.bindTexture(gl.TEXTURE_2D,E),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,s),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.REPEAT),h=!0,c()},settingsManager.vectorImages||(s.src="images/nightearth-4096.png"),settingsManager.vectorImages&&(s.src="images/dayearthvector-4096.jpg"),settingsManager.hiresImages?(setTimeout(function(){A.src="images/6_night_16k.jpg"},2e4),A.onload=function(){gl.bindTexture(gl.TEXTURE_2D,E),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,A),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.REPEAT)}):u=null;for(var _=[],f=[],d=[],U=0;U<=64;U++)for(var p=Math.PI/64*U-Math.PI/2,D=Math.cos(Math.abs(p)),M=Math.sin(p),S=0;S<=64;S++){var F=2*Math.PI/64*S,I=Math.cos(F)*D,P=Math.sin(F)*D,L=1-U/64,b=.5+S/64;_.push(I*RADIUS_OF_EARTH),_.push(P*RADIUS_OF_EARTH),_.push(M*RADIUS_OF_EARTH),d.push(b),d.push(L),f.push(I),f.push(P),f.push(M)}var N=[];for(U=0;U<64;U++)for(S=0;S<64;S++){var B=65*U+S,v=B+1,X=65*(U+1)+S,C=X+1;N.push(B),N.push(v),N.push(X),N.push(X),N.push(C),N.push(v)}g=N.length,e=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,e),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(_),gl.STATIC_DRAW),t=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,t),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(f),gl.STATIC_DRAW),r=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,r),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(d),gl.STATIC_DRAW),a=gl.createBuffer(),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,a),gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(N),gl.STATIC_DRAW)},R.draw=function(x,h){if(_){for(l=timeManager.propTime(),R.tDS=l.toJSON(),R.timeTextStr=R.timeTextStrEmpty,R.iText=0;R.iText<20;R.iText++)R.iText<10&&(R.timeTextStr+=R.tDS[R.iText]),10===R.iText&&(R.timeTextStr+=" "),R.iText>11&&(R.timeTextStr+=R.tDS[R.iText-1]);return settingsManager.isPropRateChange&&!settingsManager.isAlwaysHidePropRate&&(timeManager.propRate>1.01||timeManager.propRate<.99?(timeManager.propRate<10&&R.propRateDOM.html("Propagation Speed: "+timeManager.propRate.toFixed(1)+"x"),timeManager.propRate>=10&&R.propRateDOM.html("Propagation Speed: "+timeManager.propRate.toFixed(2)+"x"),R.propRateDOM.show(),u=!0):u&&(R.propRateDOM.hide(),u=!1),settingsManager.isPropRateChange=!1),m?document.getElementById("datetime-text").childNodes[0].nodeValue=R.timeTextStr:(document.getElementById("datetime-text").innerText=R.timeTextStr,m=!0),!settingsManager.isEditTime&&settingsManager.cruncherReady||$("#datetime-input-tb").val(R.timeTextStr),R.earthJ=timeManager.jday(l.getUTCFullYear(),l.getUTCMonth()+1,l.getUTCDate(),l.getUTCHours(),l.getUTCMinutes(),l.getUTCSeconds()),R.earthJ+=l.getUTCMilliseconds()*MILLISECONDS_PER_DAY,R.earthEra=satellite.gstime(R.earthJ),isDayNightToggle||(sun.currentDirection(),vec3.normalize(R.lightDirection,R.lightDirection)),i=s,mat4.identity(i),mat4.rotateZ(i,i,R.earthEra),mat4.translate(i,i,R.pos),o=A,mat3.normalFromMat4(o,i),gl.useProgram(n),gl.bindFramebuffer(gl.FRAMEBUFFER,null),gl.uniformMatrix3fv(n.uNormalMatrix,!1,o),gl.uniformMatrix4fv(n.uMvMatrix,!1,i),gl.uniformMatrix4fv(n.uPMatrix,!1,x),gl.uniformMatrix4fv(n.uCamMatrix,!1,h),isDayNightToggle||gl.uniform3fv(n.uLightDirection,R.lightDirection),gl.uniform3fv(n.uAmbientLightColor,[.03,.03,.03]),gl.uniform3fv(n.uDirectionalLightColor,[1,1,.9]),gl.uniform1i(n.uSampler,0),gl.activeTexture(gl.TEXTURE0),gl.bindTexture(gl.TEXTURE_2D,T),isDayNightToggle?(gl.uniform1i(n.uNightSampler,1),gl.activeTexture(gl.TEXTURE1),gl.bindTexture(gl.TEXTURE_2D,T)):(gl.uniform1i(n.uNightSampler,1),gl.activeTexture(gl.TEXTURE1),gl.bindTexture(gl.TEXTURE_2D,E)),gl.bindBuffer(gl.ARRAY_BUFFER,r),gl.enableVertexAttribArray(n.aTexCoord),gl.vertexAttribPointer(n.aTexCoord,2,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,e),gl.enableVertexAttribArray(n.aVertexPosition),gl.vertexAttribPointer(n.aVertexPosition,3,gl.FLOAT,!1,0,0),gl.vertexAttribPointer(gl.pickShaderProgram.aPos,3,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,t),gl.enableVertexAttribArray(n.aVertexNormal),gl.vertexAttribPointer(n.aVertexNormal,3,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,a),gl.drawElements(gl.TRIANGLES,g,gl.UNSIGNED_SHORT,0),gl.useProgram(gl.pickShaderProgram),gl.bindFramebuffer(gl.FRAMEBUFFER,gl.pickFb),gl.uniformMatrix4fv(gl.pickShaderProgram.uMvMatrix,!1,i),gl.disableVertexAttribArray(gl.pickShaderProgram.aColor),gl.enableVertexAttribArray(gl.pickShaderProgram.aPos),gl.drawElements(gl.TRIANGLES,g,gl.UNSIGNED_SHORT,0),!0}},window.earth=R}();