!function(){var e,t,r,a,g,i,l,n,o,T,s,E={},m=!1,R=!1,u=mat4.create(),A=mat3.create();E.earthJ=0,E.earthEra=0,E.timeTextStr="",E.timeTextStrEmpty="",E.lightDirection=[],E.propRateDOM=$("#propRate-status-box"),E.pos=[0,0,0];var h=!1,x=!1,_=!1;function c(){h&&x&&(_=!0,$("#loader-text").text("Drawing Dots in Space..."))}E.init=function(){var i=gl.createShader(gl.FRAGMENT_SHADER),l=shaderLoader.getShaderCode("earth-fragment.glsl");gl.shaderSource(i,l),gl.compileShader(i);var n=gl.createShader(gl.VERTEX_SHADER),E=shaderLoader.getShaderCode("earth-vertex.glsl");gl.shaderSource(n,E),gl.compileShader(n),o=gl.createProgram(),gl.attachShader(o,n),gl.attachShader(o,i),gl.linkProgram(o),o.aVertexPosition=gl.getAttribLocation(o,"aVertexPosition"),o.aTexCoord=gl.getAttribLocation(o,"aTexCoord"),o.aVertexNormal=gl.getAttribLocation(o,"aVertexNormal"),o.uPMatrix=gl.getUniformLocation(o,"uPMatrix"),o.uCamMatrix=gl.getUniformLocation(o,"uCamMatrix"),o.uMvMatrix=gl.getUniformLocation(o,"uMvMatrix"),o.uNormalMatrix=gl.getUniformLocation(o,"uNormalMatrix"),o.uLightDirection=gl.getUniformLocation(o,"uLightDirection"),o.uAmbientLightColor=gl.getUniformLocation(o,"uAmbientLightColor"),o.uDirectionalLightColor=gl.getUniformLocation(o,"uDirectionalLightColor"),o.uSampler=gl.getUniformLocation(o,"uSampler"),o.uNightSampler=gl.getUniformLocation(o,"uNightSampler"),T=gl.createTexture();var m=new Image,R=new Image;m.onload=function(){$("#loader-text").text("Painting the Earth..."),gl.bindTexture(gl.TEXTURE_2D,T),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,m),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.REPEAT),h=!0,c()},settingsManager.nasaImages&&(m.src="images/dayearth-4096.jpg"),settingsManager.trusatImages&&(m.src="images/trusatvector-4096.jpg"),settingsManager.blueImages&&(m.src="images/world_blue-2048.png"),settingsManager.lowresImages&&(m.src="images/no_clouds_4096.jpg"),settingsManager.vectorImages&&(m.src="images/dayearthvector-4096.jpg"),settingsManager.hiresImages||settingsManager.hiresNoCloudsImages?(settingsManager.hiresImages&&(R.src="images/2_earth_16k.jpg"),settingsManager.hiresNoCloudsImages&&(R.src="images/no_clouds_8k.jpg"),R.onload=function(){gl.bindTexture(gl.TEXTURE_2D,T),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,R),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.REPEAT)}):R=null,s=gl.createTexture();var u=new Image,A=new Image;u.onload=function(){gl.bindTexture(gl.TEXTURE_2D,s),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,u),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.REPEAT),x=!0,c()},settingsManager.nasaImages&&(u.src="images/nightearth-4096.png"),settingsManager.trusatImages&&(u.src="images/nightearth-4096.png"),settingsManager.lowresImages&&(u.src="images/nightearth-4096.png"),settingsManager.blueImages&&(u.src="images/nightearth-4096.png"),settingsManager.vectorImages&&(u.src="images/dayearthvector-4096.jpg"),settingsManager.hiresImages||settingsManager.hiresNoCloudsImages?(A.src="images/6_night_16k.jpg",A.onload=function(){gl.bindTexture(gl.TEXTURE_2D,s),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,A),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.REPEAT)}):R=null;for(var _=[],d=[],M=[],p=0;p<=64;p++)for(var f=Math.PI/64*p-Math.PI/2,U=Math.cos(Math.abs(f)),D=Math.sin(f),I=0;I<=64;I++){var S=2*Math.PI/64*I,F=Math.cos(S)*U,P=Math.sin(S)*U,b=1-p/64,L=.5+I/64;_.push(F*RADIUS_OF_EARTH),_.push(P*RADIUS_OF_EARTH),_.push(D*RADIUS_OF_EARTH),M.push(L),M.push(b),d.push(F),d.push(P),d.push(D)}var N=[];for(p=0;p<64;p++)for(I=0;I<64;I++){var B=65*p+I,X=B+1,v=65*(p+1)+I,C=v+1;N.push(B),N.push(X),N.push(v),N.push(v),N.push(C),N.push(X)}g=N.length,e=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,e),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(_),gl.STATIC_DRAW),t=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,t),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(d),gl.STATIC_DRAW),r=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,r),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(M),gl.STATIC_DRAW),a=gl.createBuffer(),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,a),gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(N),gl.STATIC_DRAW)},E.draw=function(h,x){if(_){if(E.lastTime=i,i=timeManager.propTime(),E.lastTime-i<300){for(E.tDS=i.toJSON(),E.timeTextStr=E.timeTextStrEmpty,E.iText=0;E.iText<20;E.iText++)E.iText<10&&(E.timeTextStr+=E.tDS[E.iText]),10===E.iText&&(E.timeTextStr+=" "),E.iText>11&&(E.timeTextStr+=E.tDS[E.iText-1]);settingsManager.isPropRateChange&&!settingsManager.isAlwaysHidePropRate&&(timeManager.propRate>1.01||timeManager.propRate<.99?(timeManager.propRate<10&&E.propRateDOM.html("Propagation Speed: "+timeManager.propRate.toFixed(1)+"x"),timeManager.propRate>=10&&E.propRateDOM.html("Propagation Speed: "+timeManager.propRate.toFixed(2)+"x"),E.propRateDOM.show(),R=!0):R&&(E.propRateDOM.hide(),R=!1),settingsManager.isPropRateChange=!1),m?document.getElementById("datetime-text").childNodes[0].nodeValue=`${E.timeTextStr} UTC`:(document.getElementById("datetime-text").innerText=`${E.timeTextStr} UTC`,m=!0)}return!settingsManager.isEditTime&&settingsManager.cruncherReady||$("#datetime-input-tb").val(E.timeTextStr),E.earthJ=timeManager.jday(i.getUTCFullYear(),i.getUTCMonth()+1,i.getUTCDate(),i.getUTCHours(),i.getUTCMinutes(),i.getUTCSeconds()),E.earthJ+=i.getUTCMilliseconds()*MILLISECONDS_PER_DAY,E.earthEra=satellite.gstime(E.earthJ),isDayNightToggle||(sun.currentDirection(),vec3.normalize(E.lightDirection,E.lightDirection)),l=u,mat4.identity(l),mat4.rotateZ(l,l,E.earthEra),mat4.translate(l,l,E.pos),n=A,mat3.normalFromMat4(n,l),gl.useProgram(o),gl.bindFramebuffer(gl.FRAMEBUFFER,null),gl.uniformMatrix3fv(o.uNormalMatrix,!1,n),gl.uniformMatrix4fv(o.uMvMatrix,!1,l),gl.uniformMatrix4fv(o.uPMatrix,!1,h),gl.uniformMatrix4fv(o.uCamMatrix,!1,x),isDayNightToggle||gl.uniform3fv(o.uLightDirection,E.lightDirection),gl.uniform3fv(o.uAmbientLightColor,[.03,.03,.03]),gl.uniform3fv(o.uDirectionalLightColor,[1,1,1]),gl.uniform1i(o.uSampler,0),gl.activeTexture(gl.TEXTURE0),gl.bindTexture(gl.TEXTURE_2D,T),isDayNightToggle?(gl.uniform1i(o.uNightSampler,1),gl.activeTexture(gl.TEXTURE1),gl.bindTexture(gl.TEXTURE_2D,T)):(gl.uniform1i(o.uNightSampler,1),gl.activeTexture(gl.TEXTURE1),gl.bindTexture(gl.TEXTURE_2D,s)),gl.bindBuffer(gl.ARRAY_BUFFER,r),gl.enableVertexAttribArray(o.aTexCoord),gl.vertexAttribPointer(o.aTexCoord,2,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,e),gl.enableVertexAttribArray(o.aVertexPosition),gl.vertexAttribPointer(o.aVertexPosition,3,gl.FLOAT,!1,0,0),gl.vertexAttribPointer(gl.pickShaderProgram.aPos,3,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,t),gl.enableVertexAttribArray(o.aVertexNormal),gl.vertexAttribPointer(o.aVertexNormal,3,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,a),gl.drawElements(gl.TRIANGLES,g,gl.UNSIGNED_SHORT,0),gl.useProgram(gl.pickShaderProgram),gl.bindFramebuffer(gl.FRAMEBUFFER,gl.pickFb),gl.uniformMatrix4fv(gl.pickShaderProgram.uMvMatrix,!1,l),gl.disableVertexAttribArray(gl.pickShaderProgram.aColor),gl.enableVertexAttribArray(gl.pickShaderProgram.aPos),gl.drawElements(gl.TRIANGLES,g,gl.UNSIGNED_SHORT,0),!0}},window.earth=E}();