"use strict";var gl,debugTimeArray=[],canvasDOM=$("#keeptrack-canvas"),satHoverBoxNode1=document.getElementById("sat-hoverbox1"),satHoverBoxNode2=document.getElementById("sat-hoverbox2"),satHoverBoxNode3=document.getElementById("sat-hoverbox3"),satHoverBoxDOM=$("#sat-hoverbox"),timeManager=window.timeManager,satCruncher=window.satCruncher,camYaw=0,camPitch=0,yawErr=0,camYawTarget=0,camPitchTarget=0,camSnapMode=!1,camZoomSnappedOnSat=!1,camAngleSnappedOnSat=!1,zoomLevel=.6925,zoomTarget=.6925,isZoomIn=!1,camRotateSpeed=0,clickedSat=0;let cameraManager={chaseSpeed:.0035};var pitchRotate,yawRotate,pickFb,pickTex,pickColorBuf,touchStartTime,fpsEl,fpsAz,drawLoopCallback,isEditSatMenuOpen=!1,isDOPMenuOpen=!1,isLookanglesMenuOpen=!1,isLookanglesMultiSiteMenuOpen=!1,isNewLaunchMenuOpen=!1,isBreakupMenuOpen=!1,isMissileMenuOpen=!1,isPlanetariumView=!1,isAstronomyView=!1,isSatView=!1,isVideoRecording=!1,isCustomSensorMenuOpen=!1,pMatrix=mat4.create(),camMatrix=mat4.create(),camMatrixEmpty=mat4.create(),lastselectedSat=-1,drawLineList=[],updateHoverDelay=0,updateHoverDelayLimit=1,cameraType={current:0,default:0,fixedToSat:1,offset:2,fps:3,planetarium:4,satellite:5,astronomy:6},mouseX=0,mouseY=0,mouseTimeout=null,mouseSat=-1,isMouseMoving=!1,dragPoint=[0,0,0],screenDragPoint=[0,0],dragStartPitch=0,dragStartYaw=0,isDragging=!1,dragHasMoved=!1,isPinching=!1,deltaPinchDistance=0,startPinchDistance=0,fpsPitch=0,fpsPitchRate=0,fpsRotate=0,fpsRotateRate=0,fpsYaw=0,fpsYawRate=0,fpsXPos=0,fpsYPos=0,fpsZPos=0,fpsForwardSpeed=0,fpsSideSpeed=0,fpsVertSpeed=0,isFPSForwardSpeedLock=!1,isFPSSideSpeedLock=!1,isFPSVertSpeedLock=!1,fpsRun=1,fpsLastTime=1,satScreenPositionArray={},isShowNextPass=!1,rotateTheEarth=!0;let updateHoverSatId,updateHoverSatPos,glScreenX,glScreenY,screenVec,comboPMat,invMat,worldVec,gCPr,gCPz,gCPrYaw,gCPx,gCPy,fpsTimeNow,fpsElapsed,satData,dragTarget,xDif,yDif,yawTarget,pitchTarget,dragPointR,dragTargetR,dragPointLon,dragTargetLon,dragPointLat,dragTargetLat,pitchDif,yawDif;cameraManager.isPanning=!1,cameraManager.isWorldPan=!1,cameraManager.isScreenPan=!1,cameraManager.panReset=!1,cameraManager.panSpeed={x:0,y:0,z:0},cameraManager.panMovementSpeed=.5,cameraManager.panTarget={x:0,y:0,z:0},cameraManager.panCurrent={x:0,y:0,z:0},cameraManager.panDif={x:0,y:0,z:0},cameraManager.panStartPosition={x:0,y:0,z:0},cameraManager.camPitchSpeed=0,cameraManager.camYawSpeed=0,cameraManager.isLocalRotate=!1,cameraManager.localRotateReset=!1,cameraManager.localRotateSpeed={pitch:0,roll:0,yaw:0},cameraManager.localRotateMovementSpeed=5e-5,cameraManager.localRotateTarget={pitch:0,roll:0,yaw:0},cameraManager.localRotateCurrent={pitch:0,roll:0,yaw:0},cameraManager.localRotateDif={pitch:0,roll:0,yaw:0},cameraManager.localRotateStartPosition={pitch:0,roll:0,yaw:0},cameraManager.ecPitch=0,cameraManager.ecYaw=0,cameraManager.ftsPitch=0,cameraManager.ftsYaw=0,cameraManager.ecLastZoom=.45;let rayOrigin,ptThru,rayDir,toCenterVec,dParallel,longDir,dPerp,dSubSurf,dSurf,ptSurf,isHoverBoxVisible=!1,isShowDistance=!0;function initializeKeepTrack(){mobile.checkMobileMode(),webGlInit(),sun.init(),earth.init(),settingsManager.enableLimitedUI||settingsManager.isDrawLess||(atmosphere.init(),moon.init()),ColorScheme.init(),$("#loader-text").text("Drawing Dots in Space..."),satSet.init(function(e){orbitManager.init(),groups.init(),setTimeout(function(){earth.loadHiRes(),earth.loadHiResNight(),!settingsManager.offline&&"serviceWorker"in navigator&&navigator.serviceWorker.register("./serviceWorker.js").then(function(){console.debug("[Service Worker] Installed!")})},0),settingsManager.disableUI||searchBox.init(e),function e(){earth.loaded||($("#loader-text").text("Coloring Inside the Lines..."),setTimeout(function(){e()},250))}();!function e(){earth.loaded?($("#version-info").html(settingsManager.versionNumber),$("#version-info").tooltip({delay:50,html:settingsManager.versionDate,position:"top"}),$("#canvas-holder").attr("style","display:block"),mobile.checkMobileMode(),settingsManager.isMobileModeEnabled?($("#mobile-start-button").show(),$("#spinner").hide(),$("#loader-text").html("")):settingsManager.trusatMode?setTimeout(function(){$("#loading-screen").removeClass("full-loader"),$("#loading-screen").addClass("mini-loader-container"),$("#logo-inner-container").addClass("mini-loader"),$("#logo-text").html(""),$("#logo-trusat").hide(),$("#loading-screen").hide(),$("#loader-text").html("Attempting to Math...")},3e3):setTimeout(function(){$("#loading-screen").removeClass("full-loader"),$("#loading-screen").addClass("mini-loader-container"),$("#logo-inner-container").addClass("mini-loader"),$("#logo-text").html(""),$("#logo-trusat").hide(),$("#loading-screen").hide(),$("#loader-text").html("Attempting to Math...")},1500),satSet.setColorScheme(settingsManager.currentColorScheme),$(window).width()>$(window).height()?(settingsManager.mapHeight=$(window).width(),$("#map-image").width(settingsManager.mapHeight),settingsManager.mapHeight=3*settingsManager.mapHeight/4,$("#map-image").height(settingsManager.mapHeight),$("#map-menu").width($(window).width())):(settingsManager.mapHeight=$(window).height()-100,$("#map-image").height(settingsManager.mapHeight),settingsManager.mapHeight=4*settingsManager.mapHeight/3,$("#map-image").width(settingsManager.mapHeight),$("#map-menu").width($(window).width())),satLinkManager.idToSatnum()):setTimeout(function(){e()},250)}()}),settingsManager.isEnableRadarData&&radarDataManager.init(),dlManager.drawLoop(),settingsManager.disableUI||settingsManager.isDrawLess||"undefined"!=typeof meshManager&&(setTimeout(function(){meshManager.init()},0),settingsManager.selectedColor=[0,0,0,0])}var drawLoopCount=0,dlManager={};function initializeGpuManager(){let e={};e.kern={},e.transforms={},e.settings={},e.settings.steps=16,e.settings.batchSize=5,e.gpu=new GPU({mode:settingsManager.gpujsMode}),e.transforms.satrec=(e=>{let a=[],t=0;for(var r in e)if(e.hasOwnProperty(r)){if("method"==r){let n="d"==e[r]?1:0;a.push(n),t++;continue}if("init"==r){let n="y"==e[r]?1:0;a.push(n),t++;continue}if("operationmode"==r){let n="i"==e[r]?1:0;a.push(n),t++;continue}if("satnum"==r){a.push(parseInt(e[r])),t++;continue}a.push(e[r]),t++}else;for(;t<100;)a.push(0),t++;return a}),e.getSat=((e,a)=>{let t=satSet.sccIndex[a],r=e[4*t+1][0][0],n=e[4*t+2][0][0],s=e[4*t+3][0][0];console.log(`${r}, ${n}, ${s}`)}),e.satrecSetup=((a,t,r)=>{r=r||new Date,t=t||0;var n=function(e,a,t,r,n,s){return 367*e-Math.floor(7*(e+Math.floor((a+9)/12))*.25)+Math.floor(275*a/9)+t+1721013.5+((s/60+n)/60+r)/24}(r.getUTCFullYear(),r.getUTCMonth()+1,r.getUTCDate(),r.getUTCHours(),r.getUTCMinutes(),r.getUTCSeconds());n+=1.15741e-8*r.getUTCMilliseconds();let s,i=satSet.getSatData(),o=[],c=[];for(var l=t;l<t+a;l++)s=satellite.twoline2satrec(i[l].TLE1,i[l].TLE2),o.push(e.transforms.satrec(s)),c.push(1440*(n-s.jdsatepoch));return[o,c]}),e.funcs={},e.funcs.sgp4=((a,t)=>{console.time("gM.funcs.sgp4");let r,n=[],s=new Date;for(var i=0;i<a;i=i){let o=i,c=e.settings.batchSize;o+e.settings.batchSize>a&&(c=a-o),i+=c,[satrecList,tsinceList]=e.satrecSetup(c,o,s),e.kern.sgp4.setOutput([4,e.settings.steps,satrecList.length]);try{r=e.kern.sgp4(satrecList,tsinceList,t)}catch(e){console.log(i),console.debug(e)}n=n.concat(r)}return console.timeEnd("gM.funcs.sgp4"),n}),e.funcs.sgp42=((a,t)=>{let r=Math.floor(a/50),n=a%50,s=[],i=[],o=[],c=[];for(var l=0;l<=r;l++){let a=[],g=[],d=[],m=[];if(l==r){if(0==n)break;[satrecList,tsinceList]=e.satrecSetup(n,50*l)}else[satrecList,tsinceList]=e.satrecSetup(50,50*l);e.kern.sgp4.setOutput([satrecList.length,t,4]),[a,g,d,m]=e.kern.sgp4(satrecList,tsinceList),s=s.concat(a),i=i.concat(g),o=o.concat(d),c=c.concat(m)}return i}),e.kern.sgp4=e.gpu.createKernel(function(e,a,t){let r=a[this.thread.z]+t*this.thread.y/60;if(0==this.thread.x)return r;let n=3.141592653589793,s=.00108262998905,i=2*n,o=60/Math.sqrt(650944.0944816993),c=-253215306e-14/s;var l,g,d,m,M,h,p,u,S,f=0,w=0,v=0,b=0,x=0,D=0,C=0,L=0,y=0,T=0,O=0,P=0,R=0,$=0,E=0,z=0,B=0,I=0,k=0,N=0,U=0,F=0,A=0,H=0,Y=0,_=0,V=0,j=0,X=0,Z=0,G=0,W=0,K=0,q=0,J=0,Q=0,ee=0,ae=0,te=0,re=0,ne=0,se=0,ie=0,oe=0,ce=0,le=0,ge=0,de=0,me=0,Me=0,he=0;let pe=0;var ue=0,Se=0,fe=0,we=0,ve=0,be=0,xe=0,De=e[this.thread.z][18],Ce=e[this.thread.z][40];e[this.thread.z][19],e[this.thread.z][36],e[this.thread.z][37];S=e[this.thread.z][10]+e[this.thread.z][38]*r;let Le=e[this.thread.z][9]+e[this.thread.z][28]*r;if(N=Le,re=S,p=r*r,se=e[this.thread.z][7]+e[this.thread.z][39]*r+e[this.thread.z][42]*p,K=1-e[this.thread.z][20]*r,q=e[this.thread.z][5]*e[this.thread.z][21]*r,J=e[this.thread.z][32]*p,1!==e[this.thread.z][16]){B=e[this.thread.z][29]*r;var ye=1+e[this.thread.z][27]*Math.cos(S);re=S+(ue=B+e[this.thread.z][41]*(ye*ye*ye-e[this.thread.z][26])),N=Le-ue,j=(V=p*r)*r,K=K-e[this.thread.z][23]*p-e[this.thread.z][24]*V-e[this.thread.z][25]*j,q+=e[this.thread.z][5]*e[this.thread.z][22]*(Math.sin(re)-e[this.thread.z][30]),J=J+e[this.thread.z][33]*V+j*(e[this.thread.z][34]+r*e[this.thread.z][35])}ne=e[this.thread.z][11];var Te=e[this.thread.z][8];if(te=e[this.thread.z][6],1===e[this.thread.z][17]){X=r;var Oe=e[this.thread.z][46],Pe=e[this.thread.z][47],Re=e[this.thread.z][48],$e=e[this.thread.z][49],Ee=e[this.thread.z][50],ze=e[this.thread.z][51],Be=e[this.thread.z][52],Ie=e[this.thread.z][53],ke=e[this.thread.z][54],Ne=e[this.thread.z][55],Ue=e[this.thread.z][56],Fe=e[this.thread.z][57],Ae=e[this.thread.z][58],He=e[this.thread.z][59],Ye=e[this.thread.z][60],_e=e[this.thread.z][61],Ve=e[this.thread.z][62],je=e[this.thread.z][63],Xe=e[this.thread.z][64],Ze=e[this.thread.z][9],Ge=e[this.thread.z][28],We=e[this.thread.z][45],Ke=e[this.thread.z][84],qe=e[this.thread.z][95],Je=e[this.thread.z][11],Qe=e[this.thread.z][98],ea=(Te=Te,e[this.thread.z][99]),aa=e[this.thread.z][100],ta=5.7686396,ra=.95240898,na=1.8014998,sa=1.050833,ia=4.4108898;I=0;var oa=(We+.0043752690880113*X)%i;Te+=Fe*r,te+=_e*r,N+=Xe*r,se+=je*r,re+=Ve*r;var ca=0;if(0!==Oe){(0===Qe||r*Qe<=0||Math.abs(r)<Math.abs(Qe))&&(Qe=0,aa=Je,ea=qe);var la=0;la=r>0?720:-720;for(var ga=381,da=0,ma=0,Ma=0;381===ga;){if(2!==Oe)da=Ae*Math.sin(ea-.13130908)+He*Math.sin(2*(ea-2.8843198))+Ye*Math.sin(3*(ea-.37448087)),ma=aa+Ke,Ma=Ae*Math.cos(ea-.13130908)+2*He*Math.cos(2*(ea-2.8843198))+3*Ye*Math.cos(3*(ea-.37448087)),Ma*=ma;else{var ha=Ze+Ge*Qe,pa=ha+ha,ua=ea+ea;da=Pe*Math.sin(pa+ea-ta)+Re*Math.sin(ea-ta)+$e*Math.sin(ha+ea-ra)+Ee*Math.sin(-ha+ea-ra)+ze*Math.sin(pa+ua-na)+Be*Math.sin(ua-na)+Ie*Math.sin(ha+ea-sa)+ke*Math.sin(-ha+ea-sa)+Ne*Math.sin(ha+ua-ia)+Ue*Math.sin(-ha+ua-ia),ma=aa+Ke,Ma=Pe*Math.cos(pa+ea-ta)+Re*Math.cos(ea-ta)+$e*Math.cos(ha+ea-ra)+Ee*Math.cos(-ha+ea-ra)+Ie*Math.cos(ha+ea-sa)+ke*Math.cos(-ha+ea-sa)+2*(ze*Math.cos(pa+ua-na)+Be*Math.cos(ua-na)+Ne*Math.cos(ha+ua-ia)+Ue*Math.cos(-ha+ua-ia)),Ma*=ma}Math.abs(r-Qe)>=720?(0,ga=381):(ca=r-Qe,ga=0),381===ga&&(ea=ea+ma*la+259200*da,aa=aa+da*la+259200*Ma,Qe+=la)}ne=aa+da*ca+Ma*ca*ca*.5,ce=ea+ma*ca+da*ca*ca*.5,1!==Oe?(re=ce-2*se+2*oa,I=ne-Je):(re=ce-se-N+oa,I=ne-Je),ne=Je+I}}if(ne<=0)return ne;if(l=Math.pow(o/ne,2/3)*K*K,ne=o/Math.pow(l,1.5),(Te-=q)>=1||Te<-.001)return-401;Te<1e-6&&(Te=1e-6),le=(re+=e[this.thread.z][11]*J)+N+se,ue=1-Te*Te;var Sa=Te;if(oe=te,U=N%=i,he=se%=i,ge=re=((le%=i)-N-se)%i,O=Math.sin(te),T=Math.cos(te),1===e[this.thread.z][17]){var fa,wa,va,ba=e[this.thread.z][43],xa=0,Da=0,Ca=0,La=0,ya=0,Ta=0,Oa=0,Pa=0,Ra=0,$a=0,Ea=0,za=0,Ba=0,Ia=0,ka=0,Na=e[this.thread.z][65],Ua=e[this.thread.z][66],Fa=e[this.thread.z][67],Aa=e[this.thread.z][68],Ha=e[this.thread.z][69],Ya=e[this.thread.z][70],_a=e[this.thread.z][71],Va=e[this.thread.z][72],ja=e[this.thread.z][73],Xa=e[this.thread.z][74],Za=e[this.thread.z][75],Ga=e[this.thread.z][76],Wa=e[this.thread.z][77],Ka=e[this.thread.z][78],qa=e[this.thread.z][79],Ja=e[this.thread.z][80],Qa=e[this.thread.z][81],et=e[this.thread.z][82],at=e[this.thread.z][83];r=e[this.thread.z][31];var tt=e[this.thread.z][85],rt=e[this.thread.z][86],nt=e[this.thread.z][87],st=e[this.thread.z][88],it=e[this.thread.z][89],ot=e[this.thread.z][90],ct=e[this.thread.z][91],lt=e[this.thread.z][92],gt=e[this.thread.z][93],dt=e[this.thread.z][94],mt=e[this.thread.z][96],Mt=e[this.thread.z][97];Ia=(ka=Mt+119459e-10*r)+.0335*Math.sin(ka),fa=Va*(ya=.5*(Ea=Math.sin(Ia))*Ea-.25)+ja*(Ta=-.5*Ea*Math.cos(Ia)),wa=qa*ya+Ja*Ta,va=Qa*ya+et*Ta+at*Ea;var ht=Xa*ya+Za*Ta+Ga*Ea,pt=Wa*ya+Ka*Ta;if(Ia=(ka=mt+.00015835218*r)+.1098*Math.sin(ka),Oa=fa+(Ua*(ya=.5*(Ea=Math.sin(Ia))*Ea-.25)+Na*(Ta=-.5*Ea*Math.cos(Ia))),$a=wa+(ot*ya+ct*Ta),F=va+(lt*ya+gt*Ta+dt*Ea),Pa=ht+(tt*ya+rt*Ta+nt*Ea),Ra=pt+(st*ya+it*Ta),F-=_a,Pa-=Aa,Ra-=Ha,oe+=$a-=Ya,Sa+=Oa-=Fa,O=Math.sin(oe),T=Math.cos(oe),oe>=.2?(U+=Pa-=T*(Ra/=O),he+=Ra,ge+=F):(xa=O*(La=Math.sin(he)),Da=O*(Ca=Math.cos(he)),xa+=Ra*Ca+$a*T*La,Da+=-Ra*La+$a*T*Ca,(he%=i)<0&&0===ba&&(he+=i),za=ge+U+T*he,za+=F+Pa-$a*he*O,Ba=he,(he=Math.atan2(xa,Da))<0&&0===ba&&(he+=i),Math.abs(Ba-he)>n&&(he<Ba?he+=i:he-=i),U=za-(ge+=F)-T*he),oe<0&&(oe=-oe,he+=n,U-=n),Sa<0||Sa>1)return-402}1===e[this.thread.z][17]&&(O=Math.sin(oe),T=Math.cos(oe),De=-.5*c*O,Ce=Math.abs(T+1)>1.5e-12?-.25*c*O*(3+5*T)/(1+T):-.25*c*O*(3+5*T)/1.5e-12),g=Sa*Math.cos(U),ue=1/(l*(1-Sa*Sa)),d=Sa*Math.sin(U)+ue*De,k=u=((ce=ge+U+he+ue*Ce*g)-he)%i,Z=9999.9;for(var ut=1;Math.abs(Z)>=1e-12&&ut<=10;)C=Math.sin(k),(Z=(u-d*(D=Math.cos(k))+g*C-k)/(Z=1-D*g-C*d))>.95?Z=.95:Z<-.95&&(Z=-.95),k+=Z,ut+=1;if(m=g*D+d*C,h=g*C-d*D,(F=l*(1-(M=g*g+d*d)))<0)return-403;A=l*(1-m);var St=Math.sqrt(l)*h/A;Y=Math.sqrt(F)/A,z=l/A*(C-d-g*(ue=h/(1+(f=Math.sqrt(1-M))))),E=l/A*(D-g+d*ue),_=Math.atan2(z,E),x=(E+E)*z,b=1-2*z*z,W=(G=.5*s*(ue=1/F))*ue,1===e[this.thread.z][17]&&(3*(P=T*T)-1,1-P),pe=A*(1-1.5*W*f*e[this.thread.z][19])+.5*G*e[this.thread.z][36]*b,_-=.25*W*e[this.thread.z][37]*x,Me=he+1.5*W*T*x,ie=oe+1.5*W*T*O*b;var ft=St-ne*G*e[this.thread.z][36]*x/o;return H=Y+ne*G*(e[this.thread.z][36]*b+1.5*e[this.thread.z][19])/o,$=Math.sin(_),R=Math.cos(_),v=Math.sin(Me),w=Math.cos(Me),y=Math.sin(ie),Se=pe*(Q=(de=-v*(L=Math.cos(ie)))*$+w*R)*6378.137,fe=pe*(ee=(me=w*L)*$+v*R)*6378.137,we=pe*(ae=y*$)*6378.137,ve=6378.137*o/60*(ft*Q+H*(de*R-w*$)),be=6378.137*o/60*(ft*ee+H*(me*R-v*$)),xe=6378.137*o/60*(ft*ae+H*(y*R)),pe<1?-404:1==this.thread.x?Se:2==this.thread.x?fe:3==this.thread.x?we:4==this.thread.x?ve:5==this.thread.x?be:6==this.thread.x?xe:void 0},{dynamicOutput:!0,output:[1e4,7,1]}),window.gpuManager=e}function _watermarkedDataURL(e,a){var t,r,n=document.createElement("canvas"),s=n.getContext("2d");t=n.width=e.width,r=n.height=e.height,s.drawImage(e,0,0),s.font="24px nasalization";var i=s.measureText(a).width;s.globalAlpha=1,s.fillStyle="white",s.fillText(a,t-i-30,r-30),document.body.appendChild(n);let o=n.toDataURL();return n.parentNode.removeChild(n),o}dlManager.i=0,dlManager.drawLoopCount=0,dlManager.drawNow,dlManager.lastDrawTime=0,dlManager.sat,dlManager.demoModeSatellite=0,dlManager.demoModeLastTime=0,dlManager.time=null,dlManager.dt=null,dlManager.drawLoop=(()=>{if(requestAnimationFrame(dlManager.drawLoop),dlManager.drawNow=Date.now(),dlManager.dt=dlManager.drawNow-(dlManager.time||dlManager.drawNow),void 0!==dlManager.drawLoopCount&&(dlManager.drawLoopCount++,dlManager.drawLoopCount>100&&delete dlManager.drawLoopCount,dlManager.drawLoopCount>50&&dlManager.dt>500&&settingsManager.isSlowCPUModeEnabled),dlManager.dt>20?updateHoverDelayLimit=settingsManager.updateHoverDelayLimitSmall:dlManager.dt>50?updateHoverDelayLimit=settingsManager.updateHoverDelayLimitBig:updateHoverDelayLimit>1&&--updateHoverDelayLimit,dlManager.time=dlManager.drawNow,timeManager.now=dlManager.drawNow,(cameraManager.isPanning||cameraManager.panReset)&&(cameraManager.isPanning&&(cameraManager.camPitchSpeed=0,cameraManager.camYawSpeed=0,cameraManager.panDif.x=screenDragPoint[0]-mouseX,cameraManager.panDif.y=screenDragPoint[1]-mouseY,cameraManager.panDif.z=screenDragPoint[1]-mouseY,-1!==objectManager.selectedSat&&(cameraManager.panDif.x/=30,cameraManager.panDif.y/=30,cameraManager.panDif.z/=30),cameraManager.panTarget.x=cameraManager.panStartPosition.x+cameraManager.panDif.x*cameraManager.panMovementSpeed*zoomLevel,cameraManager.isWorldPan&&(cameraManager.panTarget.y=cameraManager.panStartPosition.y+cameraManager.panDif.y*cameraManager.panMovementSpeed*zoomLevel),cameraManager.isScreenPan&&(cameraManager.panTarget.z=cameraManager.panStartPosition.z+cameraManager.panDif.z*cameraManager.panMovementSpeed)),cameraManager.panReset&&(cameraManager.panTarget.x=0,cameraManager.panTarget.y=0,cameraManager.panTarget.z=0,cameraManager.panDif.x=-cameraManager.panCurrent.x,cameraManager.panDif.y=cameraManager.panCurrent.y,cameraManager.panDif.z=cameraManager.panCurrent.z),cameraManager.panResetModifier=cameraManager.panReset?.5:1,cameraManager.panSpeed.x=(cameraManager.panCurrent.x-cameraManager.panTarget.x)*cameraManager.panMovementSpeed*zoomLevel,cameraManager.panSpeed.x-=cameraManager.panSpeed.x*dlManager.dt*cameraManager.panMovementSpeed*zoomLevel,cameraManager.panCurrent.x+=cameraManager.panResetModifier*cameraManager.panMovementSpeed*cameraManager.panDif.x,cameraManager.isWorldPan&&(fpsYPos-=Math.cos(cameraManager.localRotateCurrent.yaw)*cameraManager.panResetModifier*cameraManager.panMovementSpeed*cameraManager.panDif.y,fpsZPos+=Math.sin(cameraManager.localRotateCurrent.pitch)*cameraManager.panResetModifier*cameraManager.panMovementSpeed*cameraManager.panDif.y,fpsYPos-=Math.sin(-cameraManager.localRotateCurrent.yaw)*cameraManager.panResetModifier*cameraManager.panMovementSpeed*cameraManager.panDif.x),(cameraManager.isScreenPan||cameraManager.panReset)&&(cameraManager.panSpeed.z=(cameraManager.panCurrent.z-cameraManager.panTarget.z)*cameraManager.panMovementSpeed*zoomLevel,cameraManager.panSpeed.z-=cameraManager.panSpeed.z*dlManager.dt*cameraManager.panMovementSpeed*zoomLevel,cameraManager.panCurrent.z-=cameraManager.panResetModifier*cameraManager.panMovementSpeed*cameraManager.panDif.z),cameraManager.panReset&&(fpsXPos-=fpsXPos/25,fpsYPos-=fpsYPos/25,fpsZPos-=fpsZPos/25,cameraManager.panCurrent.x>-.5&&cameraManager.panCurrent.x<.5&&(cameraManager.panCurrent.x=0),cameraManager.panCurrent.y>-.5&&cameraManager.panCurrent.y<.5&&(cameraManager.panCurrent.y=0),cameraManager.panCurrent.z>-.5&&cameraManager.panCurrent.z<.5&&(cameraManager.panCurrent.z=0),fpsXPos>-.5&&fpsXPos<.5&&(fpsXPos=0),fpsYPos>-.5&&fpsYPos<.5&&(fpsYPos=0),fpsZPos>-.5&&fpsZPos<.5&&(fpsZPos=0),0==cameraManager.panCurrent.x&&0==cameraManager.panCurrent.y&&0==cameraManager.panCurrent.z&&0==fpsXPos&&0==fpsYPos&&0==fpsZPos&&(cameraManager.panReset=!1))),(cameraManager.isLocalRotate||cameraManager.localRotateReset)&&(cameraManager.isLocalRotate&&(cameraManager.localRotateDif.pitch=screenDragPoint[1]-mouseY,cameraManager.localRotateTarget.pitch=cameraManager.localRotateStartPosition.pitch+cameraManager.localRotateDif.pitch*-settingsManager.cameraMovementSpeed,cameraManager.localRotateSpeed.pitch=dlManager.normalizeAngle(cameraManager.localRotateCurrent.pitch-cameraManager.localRotateTarget.pitch)*-settingsManager.cameraMovementSpeed,cameraManager.isLocalRotateRoll&&(cameraManager.localRotateDif.roll=screenDragPoint[0]-mouseX,cameraManager.localRotateTarget.roll=cameraManager.localRotateStartPosition.roll+cameraManager.localRotateDif.roll*settingsManager.cameraMovementSpeed,cameraManager.localRotateSpeed.roll=dlManager.normalizeAngle(cameraManager.localRotateCurrent.roll-cameraManager.localRotateTarget.roll)*-settingsManager.cameraMovementSpeed),cameraManager.isLocalRotateYaw&&(cameraManager.localRotateDif.yaw=screenDragPoint[0]-mouseX,cameraManager.localRotateTarget.yaw=cameraManager.localRotateStartPosition.yaw+cameraManager.localRotateDif.yaw*settingsManager.cameraMovementSpeed,cameraManager.localRotateSpeed.yaw=dlManager.normalizeAngle(cameraManager.localRotateCurrent.yaw-cameraManager.localRotateTarget.yaw)*-settingsManager.cameraMovementSpeed)),cameraManager.localRotateReset&&(cameraManager.localRotateTarget.pitch=0,cameraManager.localRotateTarget.roll=0,cameraManager.localRotateTarget.yaw=0,cameraManager.localRotateDif.pitch=-cameraManager.localRotateCurrent.pitch,cameraManager.localRotateDif.roll=-cameraManager.localRotateCurrent.roll,cameraManager.localRotateDif.yaw=-cameraManager.localRotateCurrent.yaw),cameraManager.resetModifier=cameraManager.localRotateReset?500:1,cameraManager.localRotateSpeed.pitch-=cameraManager.localRotateSpeed.pitch*dlManager.dt*cameraManager.localRotateMovementSpeed,cameraManager.localRotateCurrent.pitch+=cameraManager.resetModifier*cameraManager.localRotateMovementSpeed*cameraManager.localRotateDif.pitch,(cameraManager.isLocalRotateRoll||cameraManager.localRotateReset)&&(cameraManager.localRotateSpeed.roll-=cameraManager.localRotateSpeed.roll*dlManager.dt*cameraManager.localRotateMovementSpeed,cameraManager.localRotateCurrent.roll+=cameraManager.resetModifier*cameraManager.localRotateMovementSpeed*cameraManager.localRotateDif.roll),(cameraManager.isLocalRotateYaw||cameraManager.localRotateReset)&&(cameraManager.localRotateSpeed.yaw-=cameraManager.localRotateSpeed.yaw*dlManager.dt*cameraManager.localRotateMovementSpeed,cameraManager.localRotateCurrent.yaw+=cameraManager.resetModifier*cameraManager.localRotateMovementSpeed*cameraManager.localRotateDif.yaw),cameraManager.localRotateReset&&(cameraManager.localRotateCurrent.pitch>-.001&&cameraManager.localRotateCurrent.pitch<.001&&(cameraManager.localRotateCurrent.pitch=0),cameraManager.localRotateCurrent.roll>-.001&&cameraManager.localRotateCurrent.roll<.001&&(cameraManager.localRotateCurrent.roll=0),cameraManager.localRotateCurrent.yaw>-.001&&cameraManager.localRotateCurrent.yaw<.001&&(cameraManager.localRotateCurrent.yaw=0),0==cameraManager.localRotateCurrent.pitch&&0==cameraManager.localRotateCurrent.roll&&0==cameraManager.localRotateCurrent.yaw&&(cameraManager.localRotateReset=!1))),isDragging&&!settingsManager.isMobileModeEnabled||isDragging&&settingsManager.isMobileModeEnabled&&(0!==mouseX||0!==mouseY)?(xDif=screenDragPoint[0]-mouseX,yDif=screenDragPoint[1]-mouseY,yawTarget=dragStartYaw+xDif*settingsManager.cameraMovementSpeed,pitchTarget=dragStartPitch+yDif*-settingsManager.cameraMovementSpeed,cameraManager.camPitchSpeed=dlManager.normalizeAngle(camPitch-pitchTarget)*-settingsManager.cameraMovementSpeed,cameraManager.camYawSpeed=dlManager.normalizeAngle(camYaw-yawTarget)*-settingsManager.cameraMovementSpeed,camSnapMode=!1):settingsManager.isMobileModeEnabled?settingsManager.isMobileModeEnabled&&(cameraManager.camPitchSpeed-=cameraManager.camPitchSpeed*dlManager.dt*settingsManager.cameraMovementSpeed*settingsManager.cameraDecayFactor,cameraManager.camYawSpeed-=cameraManager.camYawSpeed*dlManager.dt*settingsManager.cameraMovementSpeed*settingsManager.cameraDecayFactor):(cameraManager.camPitchSpeed-=cameraManager.camPitchSpeed*dlManager.dt*settingsManager.cameraMovementSpeed*settingsManager.cameraDecayFactor,cameraManager.camYawSpeed-=cameraManager.camYawSpeed*dlManager.dt*settingsManager.cameraMovementSpeed*settingsManager.cameraDecayFactor),camRotateSpeed-=camRotateSpeed*dlManager.dt*settingsManager.cameraMovementSpeed,cameraType.current===cameraType.fps||cameraType.current===cameraType.satellite||cameraType.current===cameraType.astronomy?(fpsPitch-=20*cameraManager.camPitchSpeed*dlManager.dt,fpsYaw-=20*cameraManager.camYawSpeed*dlManager.dt,fpsRotate-=20*camRotateSpeed*dlManager.dt,fpsPitch>90&&(fpsPitch=90),fpsPitch<-90&&(fpsPitch=-90),fpsRotate>360&&(fpsRotate-=360),fpsRotate<0&&(fpsRotate+=360),fpsYaw>360&&(fpsYaw-=360),fpsYaw<0&&(fpsYaw+=360)):(camPitch+=cameraManager.camPitchSpeed*dlManager.dt,camYaw+=cameraManager.camYawSpeed*dlManager.dt,fpsRotate+=camRotateSpeed*dlManager.dt),rotateTheEarth&&(camYaw-=settingsManager.autoRotateSpeed*dlManager.dt),zoomLevel!==zoomTarget&&(zoomLevel>settingsManager.satShader.largeObjectMaxZoom?settingsManager.satShader.maxSize=1.5*settingsManager.satShader.maxAllowedSize:zoomLevel<settingsManager.satShader.largeObjectMinZoom?settingsManager.satShader.maxSize=settingsManager.satShader.maxAllowedSize/3:settingsManager.satShader.maxSize=settingsManager.satShader.maxAllowedSize),camSnapMode?(camPitch+=(camPitchTarget-camPitch)*cameraManager.chaseSpeed*dlManager.dt,yawErr=dlManager.normalizeAngle(camYawTarget-camYaw),camYaw+=yawErr*cameraManager.chaseSpeed*dlManager.dt,zoomLevel+=(zoomTarget-zoomLevel)*dlManager.dt*.0025):(isZoomIn?zoomLevel-=zoomLevel*dlManager.dt/100*Math.abs(zoomTarget-zoomLevel):zoomLevel+=zoomLevel*dlManager.dt/100*Math.abs(zoomTarget-zoomLevel),(zoomLevel>=zoomTarget&&!isZoomIn||zoomLevel<=zoomTarget&&isZoomIn)&&(zoomLevel=zoomTarget)),cameraType.current==cameraType.fixedToSat?camPitch=dlManager.normalizeAngle(camPitch):(camPitch>TAU/4&&(camPitch=TAU/4),camPitch<-TAU/4&&(camPitch=-TAU/4)),camYaw=dlManager.normalizeAngle(camYaw),cameraType.current==cameraType.default||cameraType.current==cameraType.offset?(cameraManager.ecPitch=camPitch,cameraManager.ecYaw=camYaw):cameraType.current==cameraType.fixedToSat&&(cameraManager.ftsPitch=camPitch,cameraManager.ftsYaw=camYaw),-1!==objectManager.selectedSat&&(dlManager.sat=satSet.getSat(objectManager.selectedSat),dlManager.sat.static||(_camSnapToSat(dlManager.sat),dlManager.sat.missile||"undefined"==typeof meshManager?settingsManager.selectedColor=[1,0,0,1]:settingsManager.selectedColor=[0,0,0,0],"undefined"==typeof meshManager||dlManager.sat.missile||(meshManager.selectedSatPosition.x>dlManager.sat.position.x-1&&meshManager.selectedSatPosition.x<dlManager.sat.position.x+1&&meshManager.selectedSatPosition.y>dlManager.sat.position.y-1&&meshManager.selectedSatPosition.y<dlManager.sat.position.y+1&&meshManager.selectedSatPosition.z>dlManager.sat.position.z-1&&meshManager.selectedSatPosition.z<dlManager.sat.position.z+1?(meshManager.selectedSatPosition.x=dlManager.sat.position.x+(meshManager.selectedSatPosition.x-dlManager.sat.position.x)*dlManager.drawDt,meshManager.selectedSatPosition.y=dlManager.sat.position.y+(meshManager.selectedSatPosition.y-dlManager.sat.position.y)*dlManager.drawDt,meshManager.selectedSatPosition.z=dlManager.sat.position.z+(meshManager.selectedSatPosition.z-dlManager.sat.position.z)*dlManager.drawDt):meshManager.selectedSatPosition=dlManager.sat.position)),dlManager.sat.static&&(cameraType.current,cameraType.planetarium)),"undefined"!=typeof missileManager&&missileManager.missileArray.length>0)for(dlManager.i=0;dlManager.i<missileManager.missileArray.length;dlManager.i++)orbitManager.updateOrbitBuffer(missileManager.missileArray[dlManager.i].id);if(cameraType.current!==cameraType.fps&&cameraType.current!==cameraType.satellite&&cameraType.current!==cameraType.astronomy||_fpsMovement(),dlManager.drawScene(),dlManager.drawLines(),dlManager.updateHover(),dlManager.onDrawLoopComplete(drawLoopCallback),settingsManager.isDemoModeOn&&_demoMode(),settingsManager.isSatLabelModeOn&&cameraType.current===cameraType.planetarium||(isSatMiniBoxInUse&&$("#sat-minibox").html(""),isSatMiniBoxInUse=!1),settingsManager.screenshotMode){if(webGlInit(),settingsManager.queuedScreenshot)return;setTimeout(function(){let e=document.createElement("a");e.download="keeptrack.png";let a,t=(new Date).getFullYear();a=settingsManager.copyrightOveride?"":`©${t} KEEPTRACK.SPACE`,e.href=_watermarkedDataURL(canvasDOM[0],a),settingsManager.screenshotMode=!1,settingsManager.queuedScreenshot=!1,setTimeout(function(){e.click()},10),webGlInit()},200),settingsManager.queuedScreenshot=!0}});let cSTS={};function _camSnapToSat(e){camAngleSnappedOnSat&&(cSTS.pos=e.position,cSTS.r=Math.sqrt(cSTS.pos.x**2+cSTS.pos.y**2),cSTS.yaw=Math.atan2(cSTS.pos.y,cSTS.pos.x)+TAU/4,cSTS.pitch=Math.atan2(cSTS.pos.z,cSTS.r),cSTS.pitch||(console.warn("Pitch Calculation Error"),cSTS.pitch=0,camZoomSnappedOnSat=!1,camAngleSnappedOnSat=!1),cSTS.yaw||(console.warn("Yaw Calculation Error"),cSTS.yaw=0,camZoomSnappedOnSat=!1,camAngleSnappedOnSat=!1),cameraType.current===cameraType.planetarium||camSnap(cSTS.pitch,cSTS.yaw)),camZoomSnappedOnSat&&(cSTS.altitude,cSTS.camDistTarget,e.missile||e.static||!e.active||(cSTS.altitude=e.getAltitude()),e.missile&&(cSTS.altitude=e.maxAlt+1e3,orbitManager.setSelectOrbit(e.satId)),cSTS.altitude?cSTS.camDistTarget=cSTS.altitude+RADIUS_OF_EARTH+settingsManager.camDistBuffer:(cSTS.camDistTarget=RADIUS_OF_EARTH+settingsManager.camDistBuffer,console.warn(`Zoom Calculation Error: ${cSTS.altitude} -- ${cSTS.camDistTarget}`),camZoomSnappedOnSat=!1,camAngleSnappedOnSat=!1),cSTS.camDistTarget=cSTS.camDistTarget<settingsManager.minZoomDistance?settingsManager.minZoomDistance+10:cSTS.camDistTarget,zoomTarget=Math.pow((cSTS.camDistTarget-settingsManager.minZoomDistance)/(settingsManager.maxZoomDistance-settingsManager.minZoomDistance),1/ZOOM_EXP),cameraManager.ecLastZoom=zoomTarget+.1,settingsManager.isMobileModeEnabled&&(camZoomSnappedOnSat=!1)),cameraType.current===cameraType.planetarium&&(zoomTarget=.01)}function _calculateSensorPos(e){var a,t,r,n,s,i,o=timeManager.propTime(),c=(a=o.getUTCFullYear(),t=o.getUTCMonth()+1,r=o.getUTCDate(),n=o.getUTCHours(),s=o.getUTCMinutes(),i=o.getUTCSeconds(),367*a-Math.floor(7*(a+Math.floor((t+9)/12))*.25)+Math.floor(275*t/9)+r+1721013.5+((i/60+s)/60+n)/24);c+=1.15741e-8*o.getUTCMilliseconds();var l=satellite.gstime(c),g=Math.cos(sensorManager.currentSensor.lat*DEG2RAD),d=Math.sin(sensorManager.currentSensor.lat*DEG2RAD),m=Math.cos(sensorManager.currentSensor.long*DEG2RAD+l),M=Math.sin(sensorManager.currentSensor.long*DEG2RAD+l);return e.x=(RADIUS_OF_EARTH+PLANETARIUM_DIST)*g*m,e.y=(RADIUS_OF_EARTH+PLANETARIUM_DIST)*g*M,e.z=(RADIUS_OF_EARTH+PLANETARIUM_DIST)*d,e.gmst=l,e}function _fpsMovement(){fpsTimeNow=Date.now(),0!==fpsLastTime&&(fpsElapsed=fpsTimeNow-fpsLastTime,isFPSForwardSpeedLock&&fpsForwardSpeed<0?fpsForwardSpeed=Math.max(fpsForwardSpeed+Math.min(-1.02*fpsForwardSpeed*fpsElapsed,-.2),-settingsManager.fpsForwardSpeed):isFPSForwardSpeedLock&&fpsForwardSpeed>0&&(fpsForwardSpeed=Math.min(fpsForwardSpeed+Math.max(1.02*fpsForwardSpeed*fpsElapsed,.2),settingsManager.fpsForwardSpeed)),isFPSSideSpeedLock&&fpsSideSpeed<0?fpsSideSpeed=Math.max(fpsSideSpeed+Math.min(-1.02*fpsSideSpeed*fpsElapsed,-.2),-settingsManager.fpsSideSpeed):isFPSSideSpeedLock&&fpsSideSpeed<0&&(fpsSideSpeed=Math.min(fpsSideSpeed+Math.max(1.02*fpsSideSpeed*fpsElapsed,.2),settingsManager.fpsSideSpeed)),isFPSVertSpeedLock&&fpsVertSpeed<0?fpsVertSpeed=Math.max(fpsVertSpeed+Math.min(-1.02*fpsVertSpeed*fpsElapsed,-.2),-settingsManager.fpsVertSpeed):isFPSVertSpeedLock&&fpsVertSpeed<0&&(fpsVertSpeed=Math.min(fpsVertSpeed+Math.max(1.02*fpsVertSpeed*fpsElapsed,.2),settingsManager.fpsVertSpeed)),cameraType.fps&&(0!==fpsForwardSpeed&&(fpsXPos-=Math.sin(fpsYaw*DEG2RAD)*fpsForwardSpeed*fpsRun*fpsElapsed,fpsYPos-=Math.cos(fpsYaw*DEG2RAD)*fpsForwardSpeed*fpsRun*fpsElapsed,fpsZPos+=Math.sin(fpsPitch*DEG2RAD)*fpsForwardSpeed*fpsRun*fpsElapsed),0!==fpsVertSpeed&&(fpsZPos-=fpsVertSpeed*fpsRun*fpsElapsed),0!==fpsSideSpeed&&(fpsXPos-=Math.cos(-fpsYaw*DEG2RAD)*fpsSideSpeed*fpsRun*fpsElapsed,fpsYPos-=Math.sin(-fpsYaw*DEG2RAD)*fpsSideSpeed*fpsRun*fpsElapsed)),isFPSForwardSpeedLock||(fpsForwardSpeed*=Math.min(.98*fpsElapsed,.98)),isFPSSideSpeedLock||(fpsSideSpeed*=Math.min(.98*fpsElapsed,.98)),isFPSVertSpeedLock||(fpsVertSpeed*=Math.min(.98*fpsElapsed,.98)),fpsForwardSpeed<.01&&fpsForwardSpeed>-.01&&(fpsForwardSpeed=0),fpsSideSpeed<.01&&fpsSideSpeed>-.01&&(fpsSideSpeed=0),fpsVertSpeed<.01&&fpsVertSpeed>-.01&&(fpsVertSpeed=0),fpsPitch+=fpsPitchRate*fpsElapsed,fpsRotate+=fpsRotateRate*fpsElapsed,fpsYaw+=fpsYawRate*fpsElapsed),fpsLastTime=fpsTimeNow}var currentSearchSats;dlManager.drawScene=(()=>{if(gl.bindFramebuffer(gl.FRAMEBUFFER,gl.pickFb),gl.clearColor(0,0,0,1),gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT),gl.bindFramebuffer(gl.FRAMEBUFFER,null),camMatrix=camMatrixEmpty,mat4.identity(camMatrix),isNaN(camPitch)||isNaN(camYaw)||isNaN(camPitchTarget)||isNaN(camYawTarget)||isNaN(zoomLevel)||isNaN(zoomTarget)){try{console.group("Camera Math Error"),console.log(`camPitch: ${camPitch}`),console.log(`camYaw: ${camYaw}`),console.log(`camPitchTarget: ${camPitchTarget}`),console.log(`camYawTarget: ${camYawTarget}`),console.log(`zoomLevel: ${zoomLevel}`),console.log(`zoomTarget: ${zoomTarget}`),console.log(`settingsManager.cameraMovementSpeed: ${settingsManager.cameraMovementSpeed}`),console.groupEnd()}catch(e){console.warn("Camera Math Error")}camPitch=.5,camYaw=.5,zoomLevel=.5,camPitchTarget=0,camYawTarget=0,zoomTarget=.5}switch(cameraType.current){case cameraType.default:mat4.translate(camMatrix,camMatrix,[cameraManager.panCurrent.x,cameraManager.panCurrent.y,cameraManager.panCurrent.z]),mat4.rotateX(camMatrix,camMatrix,-cameraManager.localRotateCurrent.pitch),mat4.rotateY(camMatrix,camMatrix,-cameraManager.localRotateCurrent.roll),mat4.rotateZ(camMatrix,camMatrix,-cameraManager.localRotateCurrent.yaw),mat4.translate(camMatrix,camMatrix,[fpsXPos,fpsYPos,-fpsZPos]),mat4.translate(camMatrix,camMatrix,[0,_getCamDist(),0]),mat4.rotateX(camMatrix,camMatrix,cameraManager.ecPitch),mat4.rotateZ(camMatrix,camMatrix,-cameraManager.ecYaw);break;case cameraType.offset:mat4.rotateX(camMatrix,camMatrix,-cameraManager.localRotateCurrent.pitch),mat4.rotateY(camMatrix,camMatrix,-cameraManager.localRotateCurrent.roll),mat4.rotateZ(camMatrix,camMatrix,-cameraManager.localRotateCurrent.yaw),mat4.translate(camMatrix,camMatrix,[settingsManager.offsetCameraModeX,_getCamDist(),settingsManager.offsetCameraModeZ]),mat4.rotateX(camMatrix,camMatrix,cameraManager.ecPitch),mat4.rotateZ(camMatrix,camMatrix,-cameraManager.ecYaw);break;case cameraType.fixedToSat:mat4.rotateX(camMatrix,camMatrix,-cameraManager.localRotateCurrent.pitch),mat4.rotateY(camMatrix,camMatrix,-cameraManager.localRotateCurrent.roll),mat4.rotateZ(camMatrix,camMatrix,-cameraManager.localRotateCurrent.yaw),sat=satSet.getSat(objectManager.selectedSat),mat4.translate(camMatrix,camMatrix,[0,_getCamDist()-RADIUS_OF_EARTH-sat.getAltitude(),0]),mat4.rotateX(camMatrix,camMatrix,cameraManager.ftsPitch),mat4.rotateZ(camMatrix,camMatrix,-cameraManager.ftsYaw),satPos=[-sat.position.x,-sat.position.y,-sat.position.z],mat4.translate(camMatrix,camMatrix,satPos);break;case cameraType.fps:mat4.rotate(camMatrix,camMatrix,-fpsPitch*DEG2RAD,[1,0,0]),mat4.rotate(camMatrix,camMatrix,fpsYaw*DEG2RAD,[0,0,1]),mat4.translate(camMatrix,camMatrix,[fpsXPos,fpsYPos,-fpsZPos]);break;case cameraType.planetarium:satPos=_calculateSensorPos({}),pitchRotate=-1*sensorManager.currentSensor.lat*DEG2RAD,yawRotate=(90-sensorManager.currentSensor.long)*DEG2RAD-satPos.gmst,mat4.rotate(camMatrix,camMatrix,pitchRotate,[1,0,0]),mat4.rotate(camMatrix,camMatrix,yawRotate,[0,0,1]),mat4.translate(camMatrix,camMatrix,[-satPos.x,-satPos.y,-satPos.z]),_showOrbitsAbove();break;case cameraType.satellite:-1!==objectManager.selectedSat&&(lastselectedSat=objectManager.selectedSat),sat=satSet.getSat(lastselectedSat),satPos=[-sat.position.x,-sat.position.y,-sat.position.z],mat4.translate(camMatrix,camMatrix,satPos),vec3.normalize(normUp,satPos),vec3.normalize(normForward,[sat.velocity.x,sat.velocity.y,sat.velocity.z]),vec3.transformQuat(normLeft,normUp,quat.fromValues(normForward[0],normForward[1],normForward[2],90*DEG2RAD)),satNextPos=[sat.position.x+sat.velocity.x,sat.position.y+sat.velocity.y,sat.position.z+sat.velocity.z],mat4.lookAt(camMatrix,satNextPos,satPos,normUp),mat4.translate(camMatrix,camMatrix,[sat.position.x,sat.position.y,sat.position.z]),mat4.rotate(camMatrix,camMatrix,fpsPitch*DEG2RAD,normLeft),mat4.rotate(camMatrix,camMatrix,-fpsYaw*DEG2RAD,normUp),mat4.translate(camMatrix,camMatrix,satPos),orbitManager.updateOrbitBuffer(lastselectedSat);break;case cameraType.astronomy:{satPos=_calculateSensorPos({}),pitchRotate=-1*sensorManager.currentSensor.lat*DEG2RAD;let e=null;if(void 0===sensorManager.currentSensor.name){if(null==(e=satSet.getIdFromSensorName(sensorManager.currentSensor.name)))return}else e=satSet.getSat(satSet.getIdFromSensorName(sensorManager.currentSensor.name));let a=[1.01*-e.position.x,1.01*-e.position.y,1.01*-e.position.z];fpsXPos=e.position.x,fpsYPos=e.position.y,fpsZPos=e.position.z,mat4.rotate(camMatrix,camMatrix,pitchRotate+-fpsPitch*DEG2RAD,[1,0,0]),mat4.rotate(camMatrix,camMatrix,-fpsRotate*DEG2RAD,[0,1,0]),vec3.normalize(normUp,a),mat4.rotate(camMatrix,camMatrix,-fpsYaw*DEG2RAD,normUp),mat4.translate(camMatrix,camMatrix,[1.01*-e.position.x,1.01*-e.position.y,1.01*-e.position.z]),_showOrbitsAbove();break}}if(gl.useProgram(gl.pickShaderProgram),gl.uniformMatrix4fv(gl.pickShaderProgram.uPMatrix,!1,pMatrix),gl.uniformMatrix4fv(gl.pickShaderProgram.camMatrix,!1,camMatrix),gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT),earth.update(),settingsManager.enableLimitedUI||settingsManager.isDrawLess||(sun.draw(pMatrix,camMatrix),moon.draw(pMatrix,camMatrix)),settingsManager.enableLimitedUI||settingsManager.isDrawLess||cameraType.current===cameraType.planetarium||cameraType.current===cameraType.astronomy||(atmosphere.update(),atmosphere.draw(pMatrix,camMatrix)),earth.draw(pMatrix,camMatrix),satSet.draw(pMatrix,camMatrix),orbitManager.draw(pMatrix,camMatrix),-1!==objectManager.selectedSat&&settingsManager.enableConstantSelectedSatRedraw&&(orbitManager.clearSelectOrbit(),orbitManager.setSelectOrbit(objectManager.selectedSat)),-1!==objectManager.selectedSat&&"undefined"!=typeof meshManager&&meshManager.isReady){let e=satSet.getSat(objectManager.selectedSat);if("undefined"!=typeof meshManager&&(settingsManager.modelsOnSatelliteViewOverride||cameraType.current!==cameraType.satellite)&&!e.static){if(25544==e.SCC_NUM)return meshManager.models.iss.position=meshManager.selectedSatPosition,void meshManager.drawObject(meshManager.models.iss,pMatrix,camMatrix,e,!0);if(1==e.OT)return"FLOCK"==e.ON.slice(0,5)||"LEMUR"==e.ON.slice(0,5)?(meshManager.models.s3u.position=meshManager.selectedSatPosition,void meshManager.drawObject(meshManager.models.s3u,pMatrix,camMatrix,e,!0)):"STARLINK"==e.ON.slice(0,8)?(meshManager.models.starlink.position=meshManager.selectedSatPosition,void meshManager.drawObject(meshManager.models.starlink,pMatrix,camMatrix,e,!0)):"GLOBALSTAR"==e.ON.slice(0,10)?(meshManager.models.globalstar.position=meshManager.selectedSatPosition,void meshManager.drawObject(meshManager.models.globalstar,pMatrix,camMatrix,e,!0)):"IRIDIUM"==e.ON.slice(0,7)?(meshManager.models.iridium.position=meshManager.selectedSatPosition,void meshManager.drawObject(meshManager.models.iridium,pMatrix,camMatrix,e,!0)):"ORBCOMM"==e.ON.slice(0,7)?(meshManager.models.orbcomm.position=meshManager.selectedSatPosition,void meshManager.drawObject(meshManager.models.orbcomm,pMatrix,camMatrix,e,!0)):"O3B"==e.ON.slice(0,3)?(meshManager.models.o3b.position=meshManager.selectedSatPosition,void meshManager.drawObject(meshManager.models.o3b,pMatrix,camMatrix,e,!0)):"NAVSTAR"==e.ON.slice(0,7)||"NAVSTAR"==e.ON.slice(10,17)?(meshManager.models.gps.position=meshManager.selectedSatPosition,void meshManager.drawObject(meshManager.models.gps,pMatrix,camMatrix,e,!0)):"GALILEO"==e.ON.slice(0,7)?(meshManager.models.galileo.position=meshManager.selectedSatPosition,void meshManager.drawObject(meshManager.models.galileo,pMatrix,camMatrix,e,!0)):"04630"==e.SCC_NUM||"05204"==e.SCC_NUM||"05851"==e.SCC_NUM||"06691"==e.SCC_NUM||"08482"==e.SCC_NUM||"08916"==e.SCC_NUM||"09803"==e.SCC_NUM||"11397"==e.SCC_NUM||"12339"==e.SCC_NUM||"13086"==e.SCC_NUM||"14930"==e.SCC_NUM||"15453"==e.SCC_NUM||"18583"==e.SCC_NUM||"20066"==e.SCC_NUM||"20929"==e.SCC_NUM||"21805"==e.SCC_NUM||"23435"==e.SCC_NUM||"24737"==e.SCC_NUM||"26356"==e.SCC_NUM||"26880"==e.SCC_NUM||"28158"==e.SCC_NUM?(meshManager.models.dsp.position=meshManager.selectedSatPosition,void meshManager.drawObject(meshManager.models.dsp,pMatrix,camMatrix,e,!0)):"36868"==e.SCC_NUM||"38254"==e.SCC_NUM||"39256"==e.SCC_NUM||"43651"==e.SCC_NUM||"44481"==e.SCC_NUM||"45465"==e.SCC_NUM?(meshManager.models.aehf.position=meshManager.selectedSatPosition,void meshManager.drawObject(meshManager.models.aehf,pMatrix,camMatrix,e,!0)):parseFloat(e.R)<.1&&parseFloat(e.R)>.04?(meshManager.models.s1u.position=meshManager.selectedSatPosition,void meshManager.drawObject(meshManager.models.s1u,pMatrix,camMatrix,e,!0)):parseFloat(e.R)<.22&&parseFloat(e.R)>=.1?(meshManager.models.s2u.position=meshManager.selectedSatPosition,void meshManager.drawObject(meshManager.models.s2u,pMatrix,camMatrix,e,!0)):parseFloat(e.R)<.33&&parseFloat(e.R)>=.22?(meshManager.models.s3u.position=meshManager.selectedSatPosition,void meshManager.drawObject(meshManager.models.s3u,pMatrix,camMatrix,e,!0)):(meshManager.models.sat2.position=meshManager.selectedSatPosition,void meshManager.drawObject(meshManager.models.sat2,pMatrix,camMatrix,e,!0));if(2==e.OT)return meshManager.models.rocketbody.position=meshManager.selectedSatPosition,void meshManager.drawObject(meshManager.models.rocketbody,pMatrix,camMatrix,e,!1);if(3==e.OT){if(e.SCC_NUM<=2e4)return meshManager.models.debris0.position=meshManager.selectedSatPosition,void meshManager.drawObject(meshManager.models.debris0,pMatrix,camMatrix,e,!1);if(e.SCC_NUM<=35e3)return meshManager.models.debris1.position=meshManager.selectedSatPosition,void meshManager.drawObject(meshManager.models.debris1,pMatrix,camMatrix,e,!1);if(e.SCC_NUM>35e3)return meshManager.models.debris2.position=meshManager.selectedSatPosition,void meshManager.drawObject(meshManager.models.debris2,pMatrix,camMatrix,e,!1)}}}}),dlManager.updateHover=(()=>{if(settingsManager.disableUI||(currentSearchSats=searchBox.getLastResultGroup()),!settingsManager.disableUI&&searchBox.isHovering()){updateHoverSatId=searchBox.getHoverSat(),satSet.getScreenCoords(updateHoverSatId,pMatrix,camMatrix);try{_hoverBoxOnSat(updateHoverSatId,satScreenPositionArray.x,satScreenPositionArray.y)}catch(e){}}else{if(!isMouseMoving||isDragging||settingsManager.isMobileModeEnabled)return;++updateHoverDelay>=updateHoverDelayLimit&&(updateHoverDelay=0,mouseSat=getSatIdFromCoord(mouseX,mouseY)),settingsManager.enableHoverOrbits&&(-1!==mouseSat?orbitManager.setHoverOrbit(mouseSat):orbitManager.clearHoverOrbit(),satSet.setHover(mouseSat)),settingsManager.enableHoverOverlay&&_hoverBoxOnSat(mouseSat,mouseX,mouseY)}});var labelCount,satHoverMiniDOM,satLabelModeLastTime=0,isSatMiniBoxInUse=!1,hoverBoxOnSatMiniElements=[];function _showOrbitsAbove(){if(!settingsManager.isSatLabelModeOn||cameraType.current!==cameraType.planetarium)return isSatMiniBoxInUse&&$("#sat-minibox").html(""),void(isSatMiniBoxInUse=!1);if(null!=sensorManager.currentSensor.lat&&!(dlManager.drawNow-satLabelModeLastTime<settingsManager.satLabelInterval)){var e;orbitManager.clearInViewOrbit(),labelCount=0,isHoverBoxVisible=!0,(hoverBoxOnSatMiniElements=document.getElementById("sat-minibox")).innerHTML="";for(var a=0;a<satSet.orbitalSats&&labelCount<settingsManager.maxLabels;a++)(e=satSet.getSatPosOnly(a)).static||e.missile||1===e.OT&&!1===ColorScheme.objectTypeFlags.payload||2===e.OT&&!1===ColorScheme.objectTypeFlags.rocketBody||3===e.OT&&!1===ColorScheme.objectTypeFlags.debris||e.inview&&!1===ColorScheme.objectTypeFlags.inFOV||(satSet.getScreenCoords(a,pMatrix,camMatrix,e.position),satScreenPositionArray.error||void 0!==satScreenPositionArray.x&&void 0!==satScreenPositionArray.y&&(satScreenPositionArray.x>window.innerWidth||satScreenPositionArray.y>window.innerHeight||(settingsManager.isShowSatNameNotOrbit||orbitManager.addInViewOrbit(a),(satHoverMiniDOM=document.createElement("div")).id="sat-minibox-"+a,satHoverMiniDOM.textContent=e.SCC_NUM,satHoverMiniDOM.setAttribute("style","display: block; position: absolute; left: "+satScreenPositionArray.x+"10px; top: "+satScreenPositionArray.y+"px"),hoverBoxOnSatMiniElements.appendChild(satHoverMiniDOM),labelCount++)));isSatMiniBoxInUse=!0,satLabelModeLastTime=dlManager.drawNow}}let sat2;function _hoverBoxOnSat(e,a,t){if(cameraType.current===cameraType.planetarium&&!settingsManager.isDemoModeOn)return satHoverBoxDOM.css({display:"none"}),void(-1===e?canvasDOM.css({cursor:"default"}):canvasDOM.css({cursor:"pointer"}));if(-1===e){if(!isHoverBoxVisible||!settingsManager.enableHoverOverlay)return;objectManager.isStarManagerLoaded&&(!0!==starManager.isConstellationVisible||starManager.isAllConstellationVisible||starManager.clearConstellations()),satHoverBoxDOM.css({display:"none"}),canvasDOM.css({cursor:"default"}),isHoverBoxVisible=!1}else if(!isDragging&&settingsManager.enableHoverOverlay){var r=satSet.getSatExtraOnly(e);satSet.getSatExtraOnly(objectManager.selectedSat);if(isHoverBoxVisible=!0,r.static||r.isRadarData)if("Launch Facility"===r.type){var n=objectManager.extractLaunchSite(r.name);satHoverBoxNode1.textContent=n.site+", "+n.sitec,satHoverBoxNode2.innerHTML=r.type+satellite.distance(r,objectManager.selectedSatData)+"",satHoverBoxNode3.textContent=""}else if(r.isRadarData){if(satHoverBoxNode1.innerHTML="Measurement: "+r.mId+"</br>Track: "+r.trackId+"</br>Object: "+r.objectId,-1!==r.missileComplex&&(satHoverBoxNode1.innerHTML+="</br>Missile Complex: "+r.missileComplex,satHoverBoxNode1.innerHTML+="</br>Missile Object: "+r.missileObject),-1!==r.satId&&(satHoverBoxNode1.innerHTML+="</br>Satellite: "+r.satId),void 0===r.rae&&sensorManager.currentSensor!==sensorManager.defaultSensor&&(r.rae=satellite.eci2Rae(r.t,r,sensorManager.currentSensor),r.setRAE(r.rae)),sensorManager.currentSensor!==sensorManager.defaultSensor){let e=new Date(r.t);satHoverBoxNode2.innerHTML=`JDAY: ${timeManager.getDayOfYear(e)} - ${e.toLocaleString("en-GB",{timeZone:"UTC"}).slice(-8)}`+"</br>R: "+r.rae.range.toFixed(2)+" A: "+r.rae.az.toFixed(2)+" E: "+r.rae.el.toFixed(2)}else{let e=new Date(r.t);satHoverBoxNode2.innerHTML=`JDAY: ${timeManager.getDayOfYear(e)} - ${e.toLocaleString("en-GB",{timeZone:"UTC"}).slice(-8)}`}satHoverBoxNode3.innerHTML="RCS: "+r.rcs.toFixed(2)+" m^2 ("+(10**(r.rcs/10)).toFixed(2)+" dBsm)</br>Az Error: "+r.azError.toFixed(2)+"° El Error: "+r.elError.toFixed(2)+"°"}else"Control Facility"===r.type?(satHoverBoxNode1.textContent=r.name,satHoverBoxNode2.innerHTML=r.typeExt+satellite.distance(r,objectManager.selectedSatData)+"",satHoverBoxNode3.textContent=""):"Star"===r.type?(null!==starManager.findStarsConstellation(r.name)?satHoverBoxNode1.innerHTML=r.name+"</br>"+starManager.findStarsConstellation(r.name):satHoverBoxNode1.textContent=r.name,satHoverBoxNode2.innerHTML=r.type,satHoverBoxNode3.innerHTML="RA: "+r.ra.toFixed(3)+" deg </br> DEC: "+r.dec.toFixed(3)+" deg",starManager.drawConstellations(starManager.findStarsConstellation(r.name))):(satHoverBoxNode1.textContent=r.name,satHoverBoxNode2.innerHTML=r.type+satellite.distance(r,objectManager.selectedSatData)+"",satHoverBoxNode3.textContent="");else if(r.missile)satHoverBoxNode1.innerHTML=r.ON+"<br >"+r.desc,satHoverBoxNode2.textContent="",satHoverBoxNode3.textContent="";else{if(!settingsManager.enableHoverOverlay)return;settingsManager.disableUI?(satHoverBoxNode1.textContent=r.ON,satHoverBoxNode2.textContent=r.SCC_NUM,satHoverBoxNode3.textContent=objectManager.extractCountry(r.C)):objectManager.isSensorManagerLoaded&&null!=sensorManager.currentSensor.lat&&isShowNextPass&&isShowDistance?(satHoverBoxNode1.textContent=r.ON,satHoverBoxNode2.textContent=r.SCC_NUM,satHoverBoxNode3.innerHTML=satellite.nextpass(r)+satellite.distance(r,satSet.getSat(objectManager.selectedSat))+""):isShowDistance?(satHoverBoxNode1.textContent=r.ON,sat2=satSet.getSat(objectManager.selectedSat),satHoverBoxNode2.innerHTML=r.SCC_NUM+satellite.distance(r,sat2)+"",satHoverBoxNode3.innerHTML=null!==sat2&&r!==sat2?"X: "+r.position.x.toFixed(2)+" Y: "+r.position.y.toFixed(2)+" Z: "+r.position.z.toFixed(2)+"</br>ΔX: "+(r.velocity.x-sat2.velocity.x).toFixed(2)+"km/s ΔY: "+(r.velocity.y-sat2.velocity.y).toFixed(2)+"km/s ΔZ: "+(r.velocity.z-sat2.velocity.z).toFixed(2)+"km/s":"X: "+r.position.x.toFixed(2)+" Y: "+r.position.y.toFixed(2)+" Z: "+r.position.z.toFixed(2)+"</br>X: "+r.velocity.x.toFixed(2)+" Y: "+r.velocity.y.toFixed(2)+" Z: "+r.velocity.z.toFixed(2)):objectManager.isSensorManagerLoaded&&null!=sensorManager.currentSensor.lat&&isShowNextPass?(satHoverBoxNode1.textContent=r.ON,satHoverBoxNode2.textContent=r.SCC_NUM,satHoverBoxNode3.textContent=satellite.nextpass(r)):(satHoverBoxNode1.textContent=r.ON,satHoverBoxNode2.textContent=r.SCC_NUM,satHoverBoxNode3.innerHTML="X: "+r.position.x.toFixed(2)+" Y: "+r.position.y.toFixed(2)+" Z: "+r.position.z.toFixed(2)+"</br>X: "+r.velocity.x.toFixed(2)+" Y: "+r.velocity.y.toFixed(2)+" Z: "+r.velocity.z.toFixed(2))}satHoverBoxDOM.css({display:"block","text-align":"center",position:"fixed",left:a+20,top:t-10}),canvasDOM.css({cursor:"pointer"})}}function _demoMode(){if(objectManager.isSensorManagerLoaded&&null==sensorManager.currentSensor.lat)return;if(dlManager.drawNow-demoModeLastTime<settingsManager.demoModeInterval)return;dlManager.demoModeLast=dlManager.drawNow,dlManager.demoModeSatellite===satSet.getSatData().length&&(dlManager.demoModeSatellite=0);let e=satSet.getSatData();for(dlManager.i=dlManager.demoModeSatellite;dlManager.i<e.length;dlManager.i++)if(dlManager.sat=e[dlManager.i],!sat.static&&!(sat.missile||1===sat.OT&&!1===ColorScheme.objectTypeFlags.payload||2===sat.OT&&!1===ColorScheme.objectTypeFlags.rocketBody||3===sat.OT&&!1===ColorScheme.objectTypeFlags.debris||sat.inview&&!1===ColorScheme.objectTypeFlags.inFOV||(satSet.getScreenCoords(i,pMatrix,camMatrix),satScreenPositionArray.error||void 0===satScreenPositionArray.x||void 0===satScreenPositionArray.y||satScreenPositionArray.x>window.innerWidth||satScreenPositionArray.y>window.innerHeight)))return _hoverBoxOnSat(i,satScreenPositionArray.x,satScreenPositionArray.y),orbitManager.setSelectOrbit(i),void(dlManager.demoModeSatellite=dlManager.i+1)}function _fixDpi(e,a){let t={height:()=>+getComputedStyle(e).getPropertyValue("height").slice(0,-2),width:()=>+getComputedStyle(e).getPropertyValue("width").slice(0,-2)};e.setAttribute("width",t.width()*a),e.setAttribute("height",t.height()*a)}function webGlInit(){db.log("webGlInit");let e,a=canvasDOM[0];void 0!==settingsManager.dpi?e=settingsManager.dpi:(e=window.devicePixelRatio,settingsManager.dpi=e);let t=document.documentElement.clientWidth||0,r=window.innerWidth||0;var n=Math.min.apply(null,[t,r].filter(Boolean)),s=Math.min(document.documentElement.clientHeight||0,window.innerHeight||0);settingsManager.screenshotMode?(a.width=settingsManager.hiResWidth,a.height=settingsManager.hiResHeight):settingsManager.isAutoResizeCanvas&&(settingsManager.isMobileModeEnabled?((n-a.width)/a.width*100<1&&(s-a.height)/a.height*100<1||mobile.isRotationEvent||mobile.forceResize)&&(a.width=n,a.height=s,mobile.forceResize=!1,mobile.isRotationEvent=!1):(a.width=n,a.height=s)),settingsManager.satShader.isUseDynamicSizing&&(settingsManager.satShader.dynamicSize=1920/a.width*settingsManager.satShader.dynamicSizeScalar*settingsManager.dpi,settingsManager.satShader.minSize=Math.max(settingsManager.satShader.minSize,settingsManager.satShader.dynamicSize)),(gl=settingsManager.disableUI?a.getContext("webgl",{alpha:!1,desynchronized:!0})||a.getContext("experimental-webgl",{alpha:!1,desynchronized:!0}):a.getContext("webgl",{alpha:!1,premultipliedAlpha:!1,desynchronized:!0,antialias:!0,powerPreference:"high-performance",preserveDrawingBuffer:!0,stencil:!1})||a.getContext("experimental-webgl",{alpha:!1,premultipliedAlpha:!1,desynchronized:!0,antialias:!0,powerPreference:"high-performance",preserveDrawingBuffer:!0,stencil:!1}))||browserUnsupported(),gl.getExtension("EXT_frag_depth"),gl.viewport(0,0,a.width,a.height),gl.enable(gl.DEPTH_TEST),initGPUPicking(),window.gl=gl}function initGPUPicking(){var e=gl.createShader(gl.FRAGMENT_SHADER),a=shaderLoader.getShaderCode("pick-fragment.glsl");gl.shaderSource(e,a),gl.compileShader(e);var t=gl.createShader(gl.VERTEX_SHADER),r=shaderLoader.getShaderCode("pick-vertex.glsl");gl.shaderSource(t,r),gl.compileShader(t);var n=gl.createProgram();gl.attachShader(n,t),gl.attachShader(n,e),gl.linkProgram(n),n.aPos=gl.getAttribLocation(n,"aPos"),n.aColor=gl.getAttribLocation(n,"aColor"),n.aPickable=gl.getAttribLocation(n,"aPickable"),n.uCamMatrix=gl.getUniformLocation(n,"uCamMatrix"),n.uMvMatrix=gl.getUniformLocation(n,"uMvMatrix"),n.uPMatrix=gl.getUniformLocation(n,"uPMatrix"),gl.pickShaderProgram=n,pickFb=gl.createFramebuffer(),gl.bindFramebuffer(gl.FRAMEBUFFER,pickFb),pickTex=gl.createTexture(),gl.bindTexture(gl.TEXTURE_2D,pickTex),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.drawingBufferWidth,gl.drawingBufferHeight,0,gl.RGBA,gl.UNSIGNED_BYTE,null);var s=gl.createRenderbuffer();gl.bindRenderbuffer(gl.RENDERBUFFER,s),gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_COMPONENT16,gl.drawingBufferWidth,gl.drawingBufferHeight),gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,pickTex,0),gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_ATTACHMENT,gl.RENDERBUFFER,s),gl.pickFb=pickFb,pickColorBuf=new Uint8Array(4),pMatrix=mat4.create(),mat4.perspective(pMatrix,settingsManager.fieldOfView,gl.drawingBufferWidth/gl.drawingBufferHeight,settingsManager.zNear,settingsManager.zFar);mat4.mul(pMatrix,pMatrix,[1,0,0,0,0,0,-1,0,0,1,0,0,0,0,0,1])}function _getCamDist(){return db.log("_getCamDist",!0),Math.pow(zoomLevel,ZOOM_EXP)*(settingsManager.maxZoomDistance-settingsManager.minZoomDistance)+settingsManager.minZoomDistance}function _unProject(e,a){return glScreenX=e/gl.drawingBufferWidth*2-1,glScreenY=1-a/gl.drawingBufferHeight*2,screenVec=[glScreenX,glScreenY,-.01,1],comboPMat=mat4.create(),mat4.mul(comboPMat,pMatrix,camMatrix),invMat=mat4.create(),mat4.invert(invMat,comboPMat),worldVec=vec4.create(),vec4.transformMat4(worldVec,screenVec,invMat),[worldVec[0]/worldVec[3],worldVec[1]/worldVec[3],worldVec[2]/worldVec[3]]}function getSatIdFromCoord(e,a){return gl.bindFramebuffer(gl.FRAMEBUFFER,gl.pickFb),gl.readPixels(e,gl.drawingBufferHeight-a,1,1,gl.RGBA,gl.UNSIGNED_BYTE,pickColorBuf),(pickColorBuf[2]<<16|pickColorBuf[1]<<8|pickColorBuf[0])-1}function getEarthScreenPoint(e,a){return rayOrigin=getCamPos(),ptThru=_unProject(e,a),rayDir=vec3.create(),vec3.subtract(rayDir,ptThru,rayOrigin),vec3.normalize(rayDir,rayDir),toCenterVec=vec3.create(),vec3.scale(toCenterVec,rayOrigin,-1),dParallel=vec3.dot(rayDir,toCenterVec),longDir=vec3.create(),vec3.scale(longDir,rayDir,dParallel),vec3.add(ptThru,rayOrigin,longDir),dPerp=vec3.len(ptThru),dSubSurf=Math.sqrt(RADIUS_OF_EARTH*RADIUS_OF_EARTH-dPerp*dPerp),dSurf=dParallel-dSubSurf,ptSurf=vec3.create(),vec3.scale(ptSurf,rayDir,dSurf),vec3.add(ptSurf,ptSurf,rayOrigin),ptSurf}function getCamPos(){return gCPr=_getCamDist(),gCPz=gCPr*Math.sin(camPitch),gCPrYaw=gCPr*Math.cos(camPitch),gCPx=gCPrYaw*Math.sin(camYaw),gCPy=gCPrYaw*-Math.cos(camYaw),[gCPx,gCPy,gCPz]}function longToYaw(e){var a=timeManager.selectedDate,t=new Date,r=0;t.setUTCHours(a.getUTCHours()+2*a.getUTCMonth()-11),t.setUTCMinutes(a.getUTCMinutes()),t.setUTCSeconds(a.getUTCSeconds()),a.setUTCHours(0),a.setUTCMinutes(0),a.setUTCSeconds(0);var n=(t-a)/60/60/1e3;return n>24&&(n-=24),r=(e+(n*=15))*DEG2RAD,r=dlManager.normalizeAngle(r)}function latToPitch(e){var a=e*DEG2RAD;return a>TAU/4&&(a=TAU/4),a<-TAU/4&&(a=-TAU/4),a}function camSnap(e,a){camPitchTarget=e,camYawTarget=dlManager.normalizeAngle(a),cameraManager.ecPitch=e,cameraManager.ecYaw=a,camSnapMode=!0}function changeZoom(e){zoomTarget="geo"!==e?"leo"!==e?e:.45:.82}dlManager.onDrawLoopComplete=(e=>{void 0!==e&&e()}),$(window).bind("orientationchange",function(e){console.log("rotate"),mobile.isRotationEvent=!0}),dlManager.normalizeAngle=(e=>((e%=TAU)>Math.PI&&(e-=TAU),e<-Math.PI&&(e+=TAU),e));var isselectedSatNegativeOne=!1;function selectSat(e){var a;if(db.log("selectSat"),db.log(`satId: ${e}`,!0),-1!==e){if(rotateTheEarth=!1,cameraManager.isChasing=!1,"Star"==(a=satSet.getSat(e)).type)return;if((0==a.active||void 0===a.active)&&void 0===a.staticNum)return}if(satSet.selectSat(e),camSnapMode=!1,-1===e&&(settingsManager.currentColorScheme===ColorScheme.group||$("#search").val().length>=3?$("#menu-sat-fov").removeClass("bmenu-item-disabled"):($("#menu-sat-fov").removeClass("bmenu-item-selected"),$("#menu-sat-fov").addClass("bmenu-item-disabled"),settingsManager.isSatOverflyModeOn=!1,satCruncher.postMessage({isShowSatOverfly:"reset"}))),-1!==e||-1==e&&!isselectedSatNegativeOne)for(var t=0;t<drawLineList.length;t++)drawLineList[t].isDrawWhenSelected&&drawLineList.splice(t,1);if(-1!==e||isselectedSatNegativeOne){if(-1!==e){if(cameraType.current==cameraType.default&&(cameraManager.ecLastZoom=zoomLevel,cameraType.current=cameraType.fixedToSat),cameraManager.isChasing=!0,isselectedSatNegativeOne=!1,objectManager.selectedSat=e,!(a=satSet.getSatExtraOnly(e)))return;if("Star"==a.type)return;if(a.static){if(void 0===a.staticNum)return;return adviceList.sensor(),a=satSet.getSat(e),objectManager.isSensorManagerLoaded&&sensorManager.setSensor(null,a.staticNum),objectManager.isSensorManagerLoaded&&(sensorManager.curSensorPositon=[a.position.x,a.position.y,a.position.z]),objectManager.selectedSat=-1,$("#menu-sensor-info").removeClass("bmenu-item-disabled"),$("#menu-fov-bubble").removeClass("bmenu-item-disabled"),$("#menu-surveillance").removeClass("bmenu-item-disabled"),$("#menu-planetarium").removeClass("bmenu-item-disabled"),$("#menu-astronomy").removeClass("bmenu-item-disabled"),void(-1!==objectManager.selectedSat&&$("#menu-lookangles").removeClass("bmenu-item-disabled"))}var r,n;camZoomSnappedOnSat=!0,camAngleSnappedOnSat=!0,orbitManager.setSelectOrbit(e),objectManager.isSensorManagerLoaded&&null!=sensorManager.currentSensor.lat&&$("#menu-lookangles").removeClass("bmenu-item-disabled"),$("#menu-lookanglesmultisite").removeClass("bmenu-item-disabled"),$("#menu-satview").removeClass("bmenu-item-disabled"),$("#menu-editSat").removeClass("bmenu-item-disabled"),$("#menu-sat-fov").removeClass("bmenu-item-disabled"),$("#menu-map").removeClass("bmenu-item-disabled"),$("#menu-newLaunch").removeClass("bmenu-item-disabled"),"block"===$("#search-results").css("display")?window.innerWidth<=1e3||($("#search").val().length>0&&$("#search-results").attr("style","display:block; max-height:27%"),cameraType.current,cameraType.planetarium):window.innerWidth<=1e3||($("#search").val().length>0&&$("#search-results").attr("style","display:block; max-height:auto"),cameraType.current,cameraType.planetarium),a.missile?$(".sat-only-info").hide():$(".sat-only-info").show(),$("#sat-infobox").fadeIn(),$("#sat-info-title").html(a.ON),a.URL&&""!==a.URL&&$("#sat-info-title").html("<a class='iframe' href='"+a.URL+"'>"+a.ON+"</a>"),$("#edit-satinfo-link").html("<a class='iframe' href='editor.htm?scc="+a.SCC_NUM+"&popup=true'>Edit Satellite Info</a>"),$("#sat-intl-des").html(a.intlDes),"unknown"===a.OT?$("#sat-objnum").html(1+a.TLE2.substr(2,7).toString()):($("#sat-objnum").html(a.SCC_NUM),settingsManager.isOfficialWebsite&&ga("send","event","Satellite","SCC: "+a.SCC_NUM,"SCC Number")),0===a.OT&&(r="TBA"),1===a.OT&&(r="Payload"),2===a.OT&&(r="Rocket Body"),3===a.OT&&(r="Debris"),4===a.OT&&(r=settingsManager.offline?"Special":"Amateur Sat"),5===a.OT&&(r="Measurement"),6===a.OT&&(r="Radar Track"),7===a.OT&&(r="Radar Object"),a.missile&&(r="Ballistic Missile"),$("#sat-type").html(r),n=objectManager.extractCountry(a.C),$("#sat-country").html(n);var s,i,o,c=[];if(a.missile?(i=(c=a.desc.split("("))[0].substr(0,c[0].length-1),s=a.desc.split("(")[1].split(")")[0],c.site=i,c.sitec=a.C):c=objectManager.extractLaunchSite(a.LS),$("#sat-site").html(c.site),$("#sat-sitec").html(c.sitec),settingsManager.isOfficialWebsite&&ga("send","event","Satellite","Country: "+n,"Country"),settingsManager.isOfficialWebsite&&ga("send","event","Satellite","Site: "+c,"Site"),a.missile?(a.LV=s,$("#sat-vehicle").html(a.LV)):($("#sat-vehicle").html(a.LV),"U"===a.LV&&$("#sat-vehicle").html("Unknown"),objectManager.extractLiftVehicle(a.LV)),null===a.R||void 0===a.R)$("#sat-rcs").html("Unknown");else a.R<.1&&(o="Small"),a.R>=.1&&(o="Medium"),a.R>1&&(o="Large"),$("#sat-rcs").html(o),$("#sat-rcs").tooltip({delay:50,html:a.R,position:"left"});if(!a.missile){$("a.iframe").colorbox({iframe:!0,width:"80%",height:"80%",fastIframe:!1,closeButton:!1}),$("#sat-apogee").html(a.apogee.toFixed(0)+" km"),$("#sat-perigee").html(a.perigee.toFixed(0)+" km"),$("#sat-inclination").html((a.inclination*RAD2DEG).toFixed(2)+"°"),$("#sat-eccentricity").html(a.eccentricity.toFixed(3)),$("#sat-period").html(a.period.toFixed(2)+" min"),$("#sat-period").tooltip({delay:50,html:"Mean Motion: "+MINUTES_PER_DAY/a.period.toFixed(2),position:"left"}),void 0!==a.U&&""!=a.U?$("#sat-user").html(a.U):$("#sat-user").html("Unknown"),void 0!==a.P&&""!=a.P?$("#sat-purpose").html(a.P):$("#sat-purpose").html("Unknown"),void 0!==a.Con&&""!=a.Con?$("#sat-contractor").html(a.Con):$("#sat-contractor").html("Unknown"),void 0!==a.LM&&""!=a.LM?$("#sat-lmass").html(a.LM+" kg"):$("#sat-lmass").html("Unknown"),void 0!==a.DM&&""!=a.DM?$("#sat-dmass").html(a.DM+" kg"):$("#sat-dmass").html("Unknown"),void 0!==a.Li&&""!=a.Li?$("#sat-life").html(a.Li+" yrs"):$("#sat-life").html("Unknown"),void 0!==a.Pw&&""!=a.Pw?$("#sat-power").html(a.Pw+" w"):$("#sat-power").html("Unknown"),void 0!==a.vmag&&""!=a.vmag?$("#sat-vmag").html(a.vmag):$("#sat-vmag").html("Unknown"),void 0!==a.S1&&""!=a.S1?($("#sat-source1").html(`<a class="iframe" href="${a.S1}">${a.S1.split("//").splice(1)}</a>`),$("#sat-source1w").show()):($("#sat-source1").html("Unknown"),$("#sat-source1w").hide()),void 0!==a.S2&&""!=a.S2?($("#sat-source2").html(`<a class="iframe" href="${a.S2}">${a.S2.split("//").splice(1)}</a>`),$("#sat-source2w").show()):($("#sat-source2").html("Unknown"),$("#sat-source2w").hide()),void 0!==a.S3&&""!=a.S3?($("#sat-source3").html(`<a class="iframe" href="${a.S3}">${a.S3.split("//").splice(1)}</a>`),$("#sat-source3w").show()):($("#sat-source3").html("Unknown"),$("#sat-source3w").hide()),void 0!==a.S4&&""!=a.S4?($("#sat-source4").html(`<a class="iframe" href="${a.S4}">${a.S4.split("//").splice(1)}</a>`),$("#sat-source4w").show()):($("#sat-source4").html("Unknown"),$("#sat-source4w").hide()),void 0!==a.S5&&""!=a.S5?($("#sat-source5").html(`<a class="iframe" href="${a.S5}">${a.S5.split("//").splice(1)}</a>`),$("#sat-source5w").show()):($("#sat-source5").html("Unknown"),$("#sat-source5w").hide()),void 0!==a.S6&&""!=a.S6?($("#sat-source6").html(`<a class="iframe" href="${a.S6}">${a.S6.split("//").splice(1)}</a>`),$("#sat-source6w").show()):($("#sat-source6").html("Unknown"),$("#sat-source6w").hide()),void 0!==a.S7&&""!=a.S7?($("#sat-source7").html(`<a class="iframe" href="${a.S7}">${a.S7.split("//").splice(1)}</a>`),$("#sat-source7w").show()):($("#sat-source7").html("Unknown"),$("#sat-source7w").hide()),void 0!==a.URL&&""!=a.URL?($("#sat-source8").html(`<a class="iframe" href="${a.URL}">${a.URL.split("//").splice(1)}</a>`),$("#sat-source8w").show()):($("#sat-source8").html("Unknown"),$("#sat-source8w").hide()),$("a.iframe").colorbox({iframe:!0,width:"80%",height:"80%",fastIframe:!1,closeButton:!1});var l,g=new Date,d=timeManager.getDayOfYear(g);if(g=(g=g.getFullYear()).toString().substr(2,2),l=satSet.getSat(e).TLE1.substr(18,2)===g?d-satSet.getSat(e).TLE1.substr(20,3):d-satSet.getSat(e).TLE1.substr(20,3)+365*satSet.getSat(e).TLE1.substr(17,2),$("#sat-elset-age").html(l+" Days"),$("#sat-elset-age").tooltip({delay:50,html:"Epoch Year: "+a.TLE1.substr(18,2).toString()+" Day: "+a.TLE1.substr(20,8).toString(),position:"left"}),objectManager.isSensorManagerLoaded){g=new Date(timeManager.propRealTime+timeManager.propOffset);var m=SunCalc.getTimes(g,sensorManager.currentSensor.lat,sensorManager.currentSensor.long),M=a.isInSun;null==sensorManager.currentSensor.lat?(0==M&&$("#sat-sun").html("No Sunlight"),1==M&&$("#sat-sun").html("Limited Sunlight"),2==M&&$("#sat-sun").html("Direct Sunlight")):"Optical"!==sensorManager.currentSensor.type&&"Observer"!==sensorManager.currentSensor.type?$("#sat-sun").html("No Effect"):m.dawn.getTime()-g>0||m.dusk.getTime()-g<0?(0==M&&$("#sat-sun").html("No Sunlight"),1==M&&$("#sat-sun").html("Limited Sunlight"),2==M&&$("#sat-sun").html("Direct Sunlight")):"Invalid Date"==m.night||"Invalid Date"!=m.dawn&&"Invalid Date"!=m.dusk?$("#sat-sun").html("Sun Exclusion"):(0==M&&$("#sat-sun").html("No Sunlight"),1==M&&$("#sat-sun").html("Limited Sunlight"),2==M&&$("#sat-sun").html("Direct Sunlight"))}else $("#sat-sun").parent().hide()}if(objectManager.isSensorManagerLoaded&&null!=sensorManager.currentSensor.lat){isLookanglesMenuOpen&&satellite.getlookangles(a);let r=!1;for(t=0;t<drawLineList.length;t++)void 0!==drawLineList[t].sat&&drawLineList[t].sat.id==e&&(r=!0);r||debugDrawLine("sat4",[e,satSet.getIdFromSensorName(sensorManager.currentSensor.name)],"g")}}}else cameraType.current=cameraType.current==cameraType.fixedToSat?cameraType.default:cameraType.current,cameraType.current!=cameraType.default&&cameraType.current!=cameraType.offset||(camPitch=cameraManager.ecPitch,camYaw=cameraManager.ecYaw,zoomTarget=cameraManager.ecLastZoom),isselectedSatNegativeOne=!0,$("#sat-infobox").fadeOut(),orbitManager.clearSelectOrbit(),$("#menu-lookanglesmultisite").removeClass("bmenu-item-selected"),$("#menu-lookangles").removeClass("bmenu-item-selected"),$("#menu-editSat").removeClass("bmenu-item-selected"),$("#menu-map").removeClass("bmenu-item-selected"),$("#menu-newLaunch").removeClass("bmenu-item-selected"),$("#menu-breakup").removeClass("bmenu-item-selected"),$("#menu-customSensor").removeClass("bmenu-item-selected"),$("#menu-lookanglesmultisite").addClass("bmenu-item-disabled"),$("#menu-lookangles").addClass("bmenu-item-disabled"),$("#menu-satview").addClass("bmenu-item-disabled"),$("#menu-editSat").addClass("bmenu-item-disabled"),$("#menu-map").addClass("bmenu-item-disabled"),$("#menu-newLaunch").addClass("bmenu-item-disabled"),$("#menu-breakup").addClass("bmenu-item-disabled"),$("#editSat-menu").effect("slide",{direction:"left",mode:"hide"},1e3),$("#map-menu").effect("slide",{direction:"left",mode:"hide"},1e3),$("#newLaunch-menu").effect("slide",{direction:"left",mode:"hide"},1e3),$("#breakup-menu").effect("slide",{direction:"left",mode:"hide"},1e3),$("#customSensor-menu").effect("slide",{direction:"left",mode:"hide"},1e3),$("#search").val().length>0&&$("#search-results").attr("style","display: block; max-height:auto"),isEditSatMenuOpen=!1,isLookanglesMenuOpen=!1,settingsManager.isMapMenuOpen=!1,isLookanglesMultiSiteMenuOpen=!1,isNewLaunchMenuOpen=!1,isBreakupMenuOpen=!1,isMissileMenuOpen=!1,isCustomSensorMenuOpen=!1;objectManager.selectedSat=e,-1!==e&&(void 0!==a.TTP?($("#sat-ttp-wrapper").show(),$("#sat-ttp").html(a.TTP)):$("#sat-ttp-wrapper").hide(),void 0!==a.NOTES?($("#sat-notes-wrapper").show(),$("#sat-notes").html(a.NOTES)):$("#sat-notes-wrapper").hide(),void 0!==a.FMISSED?($("#sat-fmissed-wrapper").show(),$("#sat-fmissed").html(a.FMISSED)):$("#sat-fmissed-wrapper").hide(),void 0!==a.ORPO?($("#sat-oRPO-wrapper").show(),$("#sat-oRPO").html(a.ORPO)):$("#sat-oRPO-wrapper").hide(),void 0!==a.constellation?($("#sat-constellation-wrapper").show(),$("#sat-constellation").html(a.constellation)):$("#sat-constellation-wrapper").hide(),void 0!==a.maneuver?($("#sat-maneuver-wrapper").show(),$("#sat-maneuver").html(a.maneuver)):$("#sat-maneuver-wrapper").hide(),void 0!==a.associates?($("#sat-associates-wrapper").show(),$("#sat-associates").html(a.associates)):$("#sat-associates-wrapper").hide(),uiManager.updateMap())}function enableSlowCPUMode(){db.log("enableSlowCPUMode"),settingsManager.cruncherReady&&(settingsManager.isSlowCPUModeEnabled=!0,settingsManager.minimumSearchCharacters=3,settingsManager.satLabelInterval=500,satCruncher.postMessage({isSlowCPUModeEnabled:!0}))}function debugDrawLine(e,a,t){switch(void 0===t&&(t=[1,0,1,1]),t){case"r":t=[1,0,0,1];break;case"o":t=[1,.5,0,1];break;case"y":t=[1,1,0,1];break;case"g":t=[0,1,0,1];break;case"b":t=[0,0,1,1];break;case"c":t=[0,1,1,1];break;case"p":t=[1,0,1,1]}if("sat"==e){let e=satSet.getSat(a);drawLineList.push({line:new Line,sat:e,ref:[0,0,0],ref2:[e.position.x,e.position.y,e.position.z],color:t})}if("sat2"==e){let e=satSet.getSat(a[0]);drawLineList.push({line:new Line,sat:e,ref:[a[1],a[2],a[3]],ref2:[e.position.x,e.position.y,e.position.z],color:t})}if("sat3"==e){let e=satSet.getSat(a[0]);var r=satSet.getSat(a[1]);drawLineList.push({line:new Line,sat:e,sat2:r,ref:[e.position.x,e.position.y,e.position.z],ref2:[r.position.x,r.position.y,r.position.z],color:t,isOnlyInFOV:!0,isDrawWhenSelected:!1})}if("sat4"==e){let e=satSet.getSat(a[0]);r=satSet.getSat(a[1]);drawLineList.push({line:new Line,sat:e,sat2:r,ref:[e.position.x,e.position.y,e.position.z],ref2:[r.position.x,r.position.y,r.position.z],color:t,isOnlyInFOV:!0,isDrawWhenSelected:!0})}if("sat5"==e){let e=satSet.getSat(a[0]);r=satSet.getSat(a[1]);drawLineList.push({line:new Line,sat:e,sat2:r,ref:[e.position.x,e.position.y,e.position.z],ref2:[r.position.x,r.position.y,r.position.z],color:t,isOnlyInFOV:!1,isDrawWhenSelected:!1})}"ref"==e&&drawLineList.push({line:new Line,ref:[0,0,0],ref2:[a[0],a[1],a[2]],color:t}),"ref2"==e&&drawLineList.push({line:new Line,ref:[a[0],a[1],a[2]],ref2:[a[3],a[4],a[5]],color:t})}var tempStar1,tempStar2,sat,satPos,satNextPos,drawLinesI=0,normUp=[0,0,0],crossNormUp=[0,0,0],normLeft=[0,0,0],normForward=[0,0,0];dlManager.drawLines=(()=>{if(0!=drawLineList.length)for(drawLinesI=0;drawLinesI<drawLineList.length;drawLinesI++){if(void 0!==drawLineList[drawLinesI].sat)if(drawLineList[drawLinesI].sat=satSet.getSatPosOnly(drawLineList[drawLinesI].sat.id),void 0!==drawLineList[drawLinesI].sat2)if(void 0!==drawLineList[drawLinesI].sat2.name){if(void 0===drawLineList[drawLinesI].sat2.id&&(drawLineList[drawLinesI].sat2.id=satSet.getIdFromSensorName(drawLineList[drawLinesI].sat2.name)),drawLineList[drawLinesI].sat2=satSet.getSat(drawLineList[drawLinesI].sat2.id),drawLineList[drawLinesI].isOnlyInFOV&&!drawLineList[drawLinesI].sat.getTEARR().inview){drawLineList.splice(drawLinesI,1);continue}drawLineList[drawLinesI].line.set([drawLineList[drawLinesI].sat.position.x,drawLineList[drawLinesI].sat.position.y,drawLineList[drawLinesI].sat.position.z],[drawLineList[drawLinesI].sat2.position.x,drawLineList[drawLinesI].sat2.position.y,drawLineList[drawLinesI].sat2.position.z])}else drawLineList[drawLinesI].sat2=satSet.getSatPosOnly(drawLineList[drawLinesI].sat2.id),drawLineList[drawLinesI].line.set([drawLineList[drawLinesI].sat.position.x,drawLineList[drawLinesI].sat.position.y,drawLineList[drawLinesI].sat.position.z],[drawLineList[drawLinesI].sat2.position.x,drawLineList[drawLinesI].sat2.position.y,drawLineList[drawLinesI].sat2.position.z]);else drawLineList[drawLinesI].line.set(drawLineList[drawLinesI].ref,[drawLineList[drawLinesI].sat.position.x,drawLineList[drawLinesI].sat.position.y,drawLineList[drawLinesI].sat.position.z]);else void 0!==drawLineList[drawLinesI].star1&&void 0!==drawLineList[drawLinesI].star2?(void 0===drawLineList[drawLinesI].star1ID&&(drawLineList[drawLinesI].star1ID=satSet.getIdFromStarName(drawLineList[drawLinesI].star1)),void 0===drawLineList[drawLinesI].star2ID&&(drawLineList[drawLinesI].star2ID=satSet.getIdFromStarName(drawLineList[drawLinesI].star2)),tempStar1=satSet.getSatPosOnly(drawLineList[drawLinesI].star1ID),tempStar2=satSet.getSatPosOnly(drawLineList[drawLinesI].star2ID),drawLineList[drawLinesI].line.set([tempStar1.position.x,tempStar1.position.y,tempStar1.position.z],[tempStar2.position.x,tempStar2.position.y,tempStar2.position.z])):drawLineList[drawLinesI].line.set(drawLineList[drawLinesI].ref,drawLineList[drawLinesI].ref2);drawLineList[drawLinesI].line.draw(drawLineList[drawLinesI].color)}}),$(document).ready(function(){if(initializeKeepTrack(),$(window).on({keydown:function(e){!0!==e.ctrlKey&&!0!==e.metaKey||(cameraManager.isCtrlPressed=!0)}}),$(window).on({keyup:function(e){!1===e.ctrlKey&&!1===e.metaKey&&(cameraManager.isCtrlPressed=!1)}}),settingsManager.disableWindowScroll||settingsManager.disableNormalEvents){window.addEventListener("scroll",function(e){return window.scrollTo(0,0),!1},{passive:!1});try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:function(){!0}}))}catch(e){}document.createElement("div")}if(settingsManager.disableZoomControls||settingsManager.disableNormalEvents){function e(e){1==e.ctrlKey&&e.preventDefault()}window.addEventListener("keydown",function(e){1!=e.ctrlKey||"61"!=e.which&&"107"!=e.which&&"173"!=e.which&&"109"!=e.which&&"187"!=e.which&&"189"!=e.which||e.preventDefault()},{passive:!1}),window.addEventListener("mousewheel",e,{passive:!1}),window.addEventListener("DOMMouseScroll",e,{passive:!1})}settingsManager.disableWindowTouchMove&&window.addEventListener("touchmove",function(e){e.preventDefault()},{passive:!1}),$(window).on("resize",function(){settingsManager.disableUI||uiManager.resize2DMap(),mobile.checkMobileMode(),settingsManager.disableUI||(settingsManager.screenshotMode?(bodyDOM.css("overflow","visible"),$("#canvas-holder").css("overflow","visible"),$("#canvas-holder").width=3840,$("#canvas-holder").height=2160,bodyDOM.width=3840,bodyDOM.height=2160):(bodyDOM.css("overflow","hidden"),$("#canvas-holder").css("overflow","hidden"))),settingsManager.isResizing||window.setTimeout(function(){settingsManager.isResizing=!1,webGlInit()},500),settingsManager.isResizing=!0}),$(window).mousedown(function(e){settingsManager.disableCameraControls||(1===e.button&&(cameraManager.isLocalRotate=!0,cameraManager.localRotateStartPosition=cameraManager.localRotateCurrent,cameraManager.isShiftPressed?(cameraManager.isLocalRotateRoll=!0,cameraManager.isLocalRotateYaw=!1):(cameraManager.isLocalRotateRoll=!1,cameraManager.isLocalRotateYaw=!0)),2===e.button&&(cameraManager.isShiftPressed||cameraManager.isCtrlPressed)&&(cameraManager.isPanning=!0,cameraManager.panStartPosition=cameraManager.panCurrent,cameraManager.isShiftPressed?(cameraManager.isScreenPan=!1,cameraManager.isWorldPan=!0):(cameraManager.isScreenPan=!0,cameraManager.isWorldPan=!1)))}),$(window).mouseup(function(e){settingsManager.disableCameraControls||(1===e.button&&(cameraManager.isLocalRotate=!1,cameraManager.isLocalRotateRoll=!1,cameraManager.isLocalRotateYaw=!1),2===e.button&&(cameraManager.isPanning=!1,cameraManager.isScreenPan=!1,cameraManager.isWorldPan=!1))}),function(){var e;function a(){let a=0;$("#clear-lines-rmb").hide(),$("#view-info-rmb").hide(),$("#view-sensor-info-rmb").hide(),$("#view-sat-info-rmb").hide(),$("#view-related-sats-rmb").hide(),$("#view-curdops-rmb").hide(),$("#view-24dops-rmb").hide(),$("#edit-sat-rmb").hide(),$("#create-observer-rmb ").hide(),$("#create-sensor-rmb").hide(),$("#line-eci-axis-rmb").hide(),$("#line-sensor-sat-rmb").hide(),$("#line-earth-sat-rmb").hide(),$("#line-sat-sun-rmb").hide(),$("#earth-low-rmb").hide(),$("#earth-high-rmb").hide(),$("#earth-vec-rmb").hide();var t=!1,r=!1;if(rightBtnSaveDOM.show(),rightBtnViewDOM.hide(),rightBtnEditDOM.hide(),rightBtnCreateDOM.hide(),rightBtnDrawDOM.hide(),rightBtnEarthDOM.hide(),drawLineList.length>0&&$("#clear-lines-rmb").show(),-1!==mouseSat){if(void 0===clickedSat)return;let e=satSet.getSat(clickedSat);if(void 0===e||null==e)return;void 0!==satSet.getSat(clickedSat).type&&"Star"===satSet.getSat(clickedSat).type||(rightBtnViewDOM.show(),t=!0,a++),satSet.getSat(clickedSat).static?"Optical"!==satSet.getSat(clickedSat).type&&"Mechanical"!==satSet.getSat(clickedSat).type&&"Ground Sensor Station"!==satSet.getSat(clickedSat).type&&"Phased Array Radar"!==satSet.getSat(clickedSat).type||$("#view-sensor-info-rmb").show():($("#edit-sat-rmb").show(),rightBtnEditDOM.show(),!0,a++,$("#view-sat-info-rmb").show(),$("#view-related-sats-rmb").show(),objectManager.isSensorManagerLoaded&&null!=sensorManager.currentSensor.lat&&"CUSTOM"!==sensorManager.whichRadar&&$("#line-sensor-sat-rmb").show(),$("#line-earth-sat-rmb").show(),$("#line-sat-sun-rmb").show(),rightBtnDrawDOM.show(),r=!0,a++)}void 0===e||isNaN(e.latitude)||isNaN(e.longitude)||(t||(rightBtnViewDOM.show(),++a),$("#view-info-rmb").show(),$("#view-curdops-rmb").show(),$("#view-24dops-rmb").show(),rightBtnCreateDOM.show(),++a,$("#create-observer-rmb ").show(),$("#create-sensor-rmb").show(),r||(rightBtnDrawDOM.show(),++a),$("#line-eci-axis-rmb").show(),rightBtnEarthDOM.show(),++a,$("#earth-nasa-rmb").show(),$("#earth-blue-rmb").show(),$("#earth-low-rmb").show(),$("#earth-high-no-clouds-rmb").show(),$("#earth-vec-rmb").show(),1==settingsManager.nasaImages&&$("#earth-nasa-rmb").hide(),1==settingsManager.trusatImages&&$("#earth-trusat-rmb").hide(),1==settingsManager.blueImages&&$("#earth-blue-rmb").hide(),1==settingsManager.lowresImages&&$("#earth-low-rmb").hide(),1==settingsManager.hiresNoCloudsImages&&$("#earth-high-no-clouds-rmb").hide(),1==settingsManager.vectorImages&&$("#earth-vec-rmb").hide()),rightBtnMenuDOM.show(),satHoverBoxDOM.hide();var n=mouseX<canvasDOM.innerWidth()/2?0:-100,s=mouseY<canvasDOM.innerHeight()/2?0:-50*a;rightBtnMenuDOM.css({display:"block","text-align":"center",position:"absolute",left:mouseX+n,top:mouseY+s})}function t(){1!=settingsManager.isPreventColorboxClose&&(rightBtnMenuDOM.hide(),uiManager.clearRMBSubMenu(),"block"===$("#colorbox").css("display")&&$.colorbox.close())}function r(){uiManager.clearRMBSubMenu();var e=rightBtnSaveDOM.offset().left<canvasDOM.innerWidth()/2?165:-165;rightBtnSaveMenuDOM.css({display:"block","text-align":"center",position:"absolute",left:rightBtnSaveDOM.offset().left+e,top:rightBtnSaveDOM.offset().top}),0!==rightBtnSaveDOM.offset().top?rightBtnSaveMenuDOM.show():rightBtnSaveMenuDOM.hide()}function n(){uiManager.clearRMBSubMenu();var e=rightBtnViewDOM.offset().left<canvasDOM.innerWidth()/2?165:-165;rightBtnViewMenuDOM.css({display:"block","text-align":"center",position:"absolute",left:rightBtnViewDOM.offset().left+e,top:rightBtnViewDOM.offset().top}),0!==rightBtnViewDOM.offset().top?rightBtnViewMenuDOM.show():rightBtnViewMenuDOM.hide()}function s(){uiManager.clearRMBSubMenu();var e=rightBtnEditDOM.offset().left<canvasDOM.innerWidth()/2?165:-165;rightBtnEditMenuDOM.css({display:"block","text-align":"center",position:"absolute",left:rightBtnEditDOM.offset().left+e,top:rightBtnEditDOM.offset().top}),0!==rightBtnEditMenuDOM.offset().top?rightBtnEditMenuDOM.show():rightBtnEditMenuDOM.hide()}function i(){uiManager.clearRMBSubMenu();var e=rightBtnCreateDOM.offset().left<canvasDOM.innerWidth()/2?165:-165;rightBtnCreateMenuDOM.css({display:"block","text-align":"center",position:"absolute",left:rightBtnCreateDOM.offset().left+e,top:rightBtnCreateDOM.offset().top}),0!==rightBtnCreateMenuDOM.offset().top?rightBtnCreateMenuDOM.show():rightBtnCreateMenuDOM.hide()}function o(){uiManager.clearRMBSubMenu();var e=rightBtnDrawDOM.offset().left<canvasDOM.innerWidth()/2?165:-165;rightBtnDrawMenuDOM.css({display:"block","text-align":"center",position:"absolute",left:rightBtnDrawDOM.offset().left+e,top:rightBtnDrawDOM.offset().top}),0!==rightBtnDrawDOM.offset().top?rightBtnDrawMenuDOM.show():rightBtnDrawMenuDOM.hide()}function c(){uiManager.clearRMBSubMenu();var e=rightBtnColorsDOM.offset().left<canvasDOM.innerWidth()/2?165:-165;rightBtnColorsMenuDOM.css({display:"block","text-align":"center",position:"absolute",left:rightBtnColorsDOM.offset().left+e,top:rightBtnColorsDOM.offset().top}),0!==rightBtnColorsDOM.offset().top?rightBtnColorsMenuDOM.show():rightBtnColorsMenuDOM.hide()}function l(){uiManager.clearRMBSubMenu();var e=rightBtnEarthDOM.offset().left<canvasDOM.innerWidth()/2?165:-165;rightBtnEarthMenuDOM.css({display:"block","text-align":"center",position:"absolute",left:rightBtnEarthDOM.offset().left+e,top:rightBtnEarthDOM.offset().top}),0!==rightBtnEarthDOM.offset().top?rightBtnEarthMenuDOM.show():rightBtnEarthMenuDOM.hide()}function g(a){if(!settingsManager.disableUI){var t=a.target.id;switch("A"==a.target.tagName&&(t=a.target.parentNode.id),"UL"==a.target.tagName&&(t=a.target.firstChild.id),t){case"save-hd-rmb":uiManager.saveHiResPhoto("hd");break;case"save-4k-rmb":uiManager.saveHiResPhoto("4k");break;case"save-8k-rmb":uiManager.saveHiResPhoto("8k");break;case"view-info-rmb":M.toast({html:"Lat: "+e.latitude.toFixed(3)+"<br/>Lon: "+e.longitude.toFixed(3)});break;case"view-sat-info-rmb":selectSat(clickedSat);break;case"view-sensor-info-rmb":selectSat(clickedSat),$("#menu-sensor-info").on("click",()=>{});break;case"view-related-sats-rmb":var r=satSet.getSatExtraOnly(clickedSat).intlDes.slice(0,8);searchBox.doSearch(r);break;case"view-curdops-rmb":var n=satellite.getDOPs(e.latitude,e.longitude,0);M.toast({html:"HDOP: "+n.HDOP+"<br/>VDOP: "+n.VDOP+"<br/>PDOP: "+n.PDOP+"<br/>GDOP: "+n.GDOP+"<br/>TDOP: "+n.TDOP});break;case"view-24dops-rmb":isDOPMenuOpen?(uiManager.hideSideMenus(),isDOPMenuOpen=!0,$("#loading-screen").fadeIn(1e3,function(){$("#dops-lat").val(e.latitude.toFixed(3)),$("#dops-lon").val(e.longitude.toFixed(3)),$("#dops-alt").val(0),$("#dops-el").val(settingsManager.gpsElevationMask);var a=1*$("#dops-lat").val(),t=1*$("#dops-lon").val(),r=1*$("#dops-alt").val();$("#dops-el").val();satellite.getDOPsTable(a,t,r),$("#menu-dops").addClass("bmenu-item-selected"),$("#loading-screen").fadeOut("slow"),$("#dops-menu").effect("slide",{direction:"left",mode:"show"},1e3)})):($("#dops-lat").val(e.latitude.toFixed(3)),$("#dops-lon").val(e.longitude.toFixed(3)),$("#dops-alt").val(0),$("#dops-el").val(settingsManager.gpsElevationMask),uiManager.bottomIconPress({currentTarget:{id:"menu-dops"}}));break;case"edit-sat-rmb":selectSat(clickedSat),isEditSatMenuOpen||uiManager.bottomIconPress({currentTarget:{id:"menu-editSat"}});break;case"create-sensor-rmb":$("#customSensor-menu").effect("slide",{direction:"left",mode:"show"},1e3),$("#menu-customSensor").addClass("bmenu-item-selected"),isCustomSensorMenuOpen=!0,$("#cs-telescope").on("click",()=>{}),$("#cs-lat").val(e.latitude),$("#cs-lon").val(e.longitude),$("#cs-hei").val(0),$("#cs-type").val("Optical"),$("#cs-minaz").val(0),$("#cs-maxaz").val(360),$("#cs-minel").val(10),$("#cs-maxel").val(90),$("#cs-minrange").val(0),$("#cs-maxrange").val(1e6),$("#customSensor").on("submit",()=>{});break;case"reset-camera-rmb":cameraManager.panReset=!0,cameraManager.localRotateReset=!0;break;case"clear-lines-rmb":drawLineList=[],objectManager.isStarManagerLoaded&&(starManager.isAllConstellationVisible=!1);break;case"line-eci-axis-rmb":debugDrawLine("ref",[1e4,0,0],"r"),debugDrawLine("ref",[0,1e4,0],"g"),debugDrawLine("ref",[0,0,1e4],"b");break;case"line-earth-sat-rmb":debugDrawLine("sat",clickedSat,"p");break;case"line-sensor-sat-rmb":debugDrawLine("sat5",[clickedSat,satSet.getIdFromSensorName(sensorManager.currentSensor.name)],"p");break;case"line-sat-sun-rmb":var s=sun.realXyz;debugDrawLine("sat2",[clickedSat,s.x,s.y,s.z],"p");break;case"create-observer-rmb":$("#customSensor-menu").effect("slide",{direction:"left",mode:"show"},1e3),$("#menu-customSensor").addClass("bmenu-item-selected"),isCustomSensorMenuOpen=!0,$("#cs-lat").val(e.latitude),$("#cs-lon").val(e.longitude),$("#cs-hei").val(0),$("#cs-type").val("Observer"),$("#customSensor").on("submit",()=>{}),uiManager.legendMenuChange("sunlight"),satSet.setColorScheme(ColorScheme.sunlight,!0),uiManager.colorSchemeChangeAlert(settingsManager.currentColorScheme),settingsManager.isForceColorScheme=!0,satCruncher.postMessage({isSunlightView:!0});break;case"colors-default-rmb":objectManager.isSensorManagerLoaded&&sensorManager.currentSensor.lat,uiManager.legendMenuChange("default"),satSet.setColorScheme(ColorScheme.default,!0),uiManager.colorSchemeChangeAlert(settingsManager.currentColorScheme),settingsManager.isOfficialWebsite&&ga("send","event","ColorScheme Menu","Default Color","Selected");break;case"colors-sunlight-rmb":uiManager.legendMenuChange("sunlight"),satSet.setColorScheme(ColorScheme.sunlight,!0),uiManager.colorSchemeChangeAlert(settingsManager.currentColorScheme),settingsManager.isForceColorScheme=!0,satCruncher.postMessage({isSunlightView:!0}),settingsManager.isOfficialWebsite&&ga("send","event","ColorScheme Menu","Sunlight","Selected");break;case"colors-country-rmb":uiManager.legendMenuChange("countries"),satSet.setColorScheme(ColorScheme.countries),uiManager.colorSchemeChangeAlert(settingsManager.currentColorScheme),settingsManager.isOfficialWebsite&&ga("send","event","ColorScheme Menu","Countries","Selected");break;case"colors-velocity-rmb":uiManager.legendMenuChange("velocity"),satSet.setColorScheme(ColorScheme.velocity),uiManager.colorSchemeChangeAlert(settingsManager.currentColorScheme),settingsManager.isOfficialWebsite&&ga("send","event","ColorScheme Menu","Velocity","Selected");break;case"colors-ageOfElset-rmb":uiManager.legendMenuChange("ageOfElset"),satSet.setColorScheme(ColorScheme.ageOfElset),uiManager.colorSchemeChangeAlert(settingsManager.currentColorScheme),settingsManager.isOfficialWebsite&&ga("send","event","ColorScheme Menu","Age of Elset","Selected");break;case"earth-blue-rmb":settingsManager.blueImages=!0,settingsManager.nasaImages=!1,settingsManager.trusatImages=!1,settingsManager.lowresImages=!1,settingsManager.hiresImages=!1,settingsManager.hiresNoCloudsImages=!1,settingsManager.vectorImages=!1,localStorage.setItem("lastMap","blue"),earth.init(),earth.loadHiRes(),earth.loadHiResNight();break;case"earth-nasa-rmb":settingsManager.blueImages=!1,settingsManager.nasaImages=!0,settingsManager.trusatImages=!1,settingsManager.lowresImages=!1,settingsManager.hiresImages=!1,settingsManager.hiresNoCloudsImages=!1,settingsManager.vectorImages=!1,localStorage.setItem("lastMap","nasa"),earth.init(),earth.loadHiRes(),earth.loadHiResNight();break;case"earth-trusat-rmb":settingsManager.blueImages=!1,settingsManager.nasaImages=!1,settingsManager.trusatImages=!0,settingsManager.lowresImages=!1,settingsManager.hiresImages=!1,settingsManager.hiresNoCloudsImages=!1,settingsManager.vectorImages=!1,localStorage.setItem("lastMap","trusat"),earth.init(),earth.loadHiRes(),earth.loadHiResNight();break;case"earth-low-rmb":settingsManager.blueImages=!1,settingsManager.nasaImages=!1,settingsManager.trusatImages=!1,settingsManager.lowresImages=!0,settingsManager.hiresImages=!1,settingsManager.hiresNoCloudsImages=!1,settingsManager.vectorImages=!1,localStorage.setItem("lastMap","low"),earth.init(),earth.loadHiRes(),earth.loadHiResNight();break;case"earth-high-rmb":$("#loading-screen").fadeIn(1e3,function(){settingsManager.blueImages=!1,settingsManager.nasaImages=!1,settingsManager.trusatImages=!1,settingsManager.lowresImages=!1,settingsManager.hiresImages=!0,settingsManager.hiresNoCloudsImages=!1,settingsManager.vectorImages=!1,localStorage.setItem("lastMap","high"),earth.init(),earth.loadHiRes(),earth.loadHiResNight(),$("#loading-screen").fadeOut("slow")});break;case"earth-high-no-clouds-rmb":$("#loading-screen").fadeIn(1e3,function(){settingsManager.blueImages=!1,settingsManager.nasaImages=!1,settingsManager.trusatImages=!1,settingsManager.lowresImages=!1,settingsManager.hiresImages=!1,settingsManager.hiresNoCloudsImages=!0,settingsManager.vectorImages=!1,localStorage.setItem("lastMap","high-nc"),earth.init(),earth.loadHiRes(),earth.loadHiResNight(),$("#loading-screen").fadeOut("slow")});break;case"earth-vec-rmb":settingsManager.blueImages=!1,settingsManager.nasaImages=!1,settingsManager.trusatImages=!1,settingsManager.lowresImages=!1,settingsManager.hiresImages=!1,settingsManager.hiresNoCloudsImages=!1,settingsManager.vectorImages=!0,localStorage.setItem("lastMap","vec"),earth.init(),earth.loadHiRes(),earth.loadHiResNight();break;case"clear-screen-rmb":drawLineList=[],objectManager.isStarManagerLoaded&&(starManager.isAllConstellationVisible=!1),searchBox.doSearch(""),mobile.searchToggle(!1),uiManager.hideSideMenus(),isMilSatSelected=!1,$("#menu-space-stations").removeClass("bmenu-item-selected"),objectManager.isSensorManagerLoaded&&null==sensorManager.currentSensor.lat||cameraType.current===cameraType.planetarium||cameraType.current===cameraType.astronomy||uiManager.legendMenuChange("default"),selectSat(-1)}rightBtnMenuDOM.hide(),uiManager.clearRMBSubMenu()}}db.log("_canvasController"),canvasDOM.on("touchmove",function(e){if(settingsManager.disableNormalEvents&&e.preventDefault(),isPinching&&void 0!==e.originalEvent.touches[0]&&void 0!==e.originalEvent.touches[1]){var a=Math.hypot(e.originalEvent.touches[0].pageX-e.originalEvent.touches[1].pageX,e.originalEvent.touches[0].pageY-e.originalEvent.touches[1].pageY);if(isNaN(a))return;deltaPinchDistance=(startPinchDistance-a)/maxPinchSize,zoomTarget+=deltaPinchDistance*(settingsManager.cameraMovementSpeed/10),zoomTarget=Math.min(Math.max(zoomTarget,1e-4),1)}else mouseX=e.originalEvent.touches[0].clientX,mouseY=e.originalEvent.touches[0].clientY,isDragging&&screenDragPoint[0]!==mouseX&&screenDragPoint[1]!==mouseY&&(dragHasMoved=!0,camAngleSnappedOnSat=!1,camZoomSnappedOnSat=!1),isMouseMoving=!0,clearTimeout(mouseTimeout),mouseTimeout=setTimeout(function(){isMouseMoving=!1},250)}),canvasDOM.on("mousemove",function(e){mouseX=e.clientX-(canvasDOM.position().left-window.scrollX),mouseY=e.clientY-(canvasDOM.position().top-window.scrollY),isDragging&&screenDragPoint[0]!==mouseX&&screenDragPoint[1]!==mouseY&&(dragHasMoved=!0,camAngleSnappedOnSat=!1,camZoomSnappedOnSat=!1),isMouseMoving=!0,clearTimeout(mouseTimeout),mouseTimeout=setTimeout(function(){isMouseMoving=!1},150)}),settingsManager.disableUI&&canvasDOM.on("wheel",function(e){satHoverBoxDOM.css({display:"none"})}),settingsManager.disableUI||(canvasDOM.on("wheel",function(e){settingsManager.disableNormalEvents&&e.preventDefault();var a=e.originalEvent.deltaY;1===e.originalEvent.deltaMode&&(a*=33.3333333),isZoomIn=a<0,rotateTheEarth=!1,settingsManager.isZoomStopsSnappedOnSat||-1==objectManager.selectedSat?(zoomTarget+=a/100/50/speedModifier,zoomTarget=Math.min(Math.max(zoomTarget,.001),1),cameraManager.ecLastZoom=zoomTarget,camZoomSnappedOnSat=!1):((settingsManager.camDistBuffer<300||-1==settingsManager.nearZoomLevel)&&(settingsManager.camDistBuffer+=a/7.5,settingsManager.camDistBuffer=Math.min(Math.max(settingsManager.camDistBuffer,30),300),settingsManager.nearZoomLevel=zoomLevel),settingsManager.camDistBuffer>=300&&(zoomTarget+=a/100/50/speedModifier,zoomTarget=Math.min(Math.max(zoomTarget,.001),1),cameraManager.ecLastZoom=zoomTarget,camZoomSnappedOnSat=!1,zoomTarget<settingsManager.nearZoomLevel&&(camZoomSnappedOnSat=!0,settingsManager.camDistBuffer=200))),cameraType.current!==cameraType.planetarium&&cameraType.current!==cameraType.fps&&cameraType.current!==cameraType.satellite&&cameraType.current!==cameraType.astronomy||(settingsManager.fieldOfView+=2e-4*a,$("#fov-text").html("FOV: "+(100*settingsManager.fieldOfView).toFixed(2)+" deg"),settingsManager.fieldOfView>settingsManager.fieldOfViewMax&&(settingsManager.fieldOfView=settingsManager.fieldOfViewMax),settingsManager.fieldOfView<settingsManager.fieldOfViewMin&&(settingsManager.fieldOfView=settingsManager.fieldOfViewMin),webGlInit())}),canvasDOM.on("click",function(e){settingsManager.disableNormalEvents&&e.preventDefault(),rightBtnMenuDOM.hide(),uiManager.clearRMBSubMenu(),"block"===$("#colorbox").css("display")&&$.colorbox.close()}),canvasDOM.on("mousedown",function(a){settingsManager.disableNormalEvents&&a.preventDefault(),1===speedModifier&&(settingsManager.cameraMovementSpeed=.003,settingsManager.cameraMovementSpeedMin=.005),2===a.button&&(dragPoint=getEarthScreenPoint(mouseX,mouseY),e=satellite.eci2ll(dragPoint[0],dragPoint[1],dragPoint[2])),screenDragPoint=[mouseX,mouseY],dragStartPitch=camPitch,dragStartYaw=camYaw,0===a.button&&(isDragging=!0),camSnapMode=!1,settingsManager.disableUI||(rotateTheEarth=!1),rightBtnMenuDOM.hide(),uiManager.clearRMBSubMenu(),uiManager.updateURL()}),canvasDOM.on("touchstart",function(e){settingsManager.cameraMovementSpeed=1e-4,settingsManager.cameraMovementSpeedMin=1e-4,e.originalEvent.touches.length>1?(isPinching=!0,startPinchDistance=Math.hypot(e.originalEvent.touches[0].pageX-e.originalEvent.touches[1].pageX,e.originalEvent.touches[0].pageY-e.originalEvent.touches[1].pageY)):(mobile.startMouseX=e.originalEvent.touches[0].clientX,mobile.startMouseY=e.originalEvent.touches[0].clientY,mouseX=e.originalEvent.touches[0].clientX,mouseY=e.originalEvent.touches[0].clientY,mouseSat=getSatIdFromCoord(mouseX,mouseY),settingsManager.cameraMovementSpeed=Math.max(.005*zoomLevel,settingsManager.cameraMovementSpeedMin),dragPoint=screenDragPoint=[mouseX,mouseY],dragStartPitch=camPitch,dragStartYaw=camYaw,isDragging=!0,touchStartTime=Date.now(),t(),camSnapMode=!1,settingsManager.disableUI||(rotateTheEarth=!1),uiManager.updateURL())}),canvasDOM.on("mouseup",function(e){settingsManager.disableNormalEvents&&e.preventDefault(),dragHasMoved||(settingsManager.isMobileModeEnabled&&(mouseSat=getSatIdFromCoord(mouseX,mouseY)),clickedSat=mouseSat,0===e.button&&(cameraType.current===cameraType.satellite&&(-1===clickedSat||satSet.getSatExtraOnly(clickedSat).static)||selectSat(clickedSat)),2===e.button&&(cameraManager.isCtrlPressed||cameraManager.isShiftPressed||a())),settingsManager.themes.retheme(),settingsManager.themes.redThemeSearch(),dragHasMoved=!1,isDragging=!1,settingsManager.disableUI||(rotateTheEarth=!1)})),canvasDOM.on("touchend",function(e){Date.now()-touchStartTime>150&&!isPinching&&Math.abs(mobile.startMouseX-mouseX)<50&&Math.abs(mobile.startMouseY-mouseY)<50&&(a(),mouseSat=-1),isPinching&&(isPinching=!1),mouseY=0,mouseX=0,dragHasMoved=!1,isDragging=!1,settingsManager.disableUI||(rotateTheEarth=!1)}),$("#nav-wrapper *").on("click",function(e){t()}),$("#nav-wrapper").on("click",function(e){t()}),$("#nav-footer *").on("click",function(e){t()}),$("#nav-footer").on("click",function(e){t()}),$("#ui-wrapper *").on("click",function(e){t()}),settingsManager.startWithFocus&&(canvasDOM.attr("tabIndex",0),canvasDOM.trigger("focus")),settingsManager.disableUI||(bodyDOM.on("keypress",e=>{uiManager.keyHandler(e)}),bodyDOM.on("keydown",e=>{uiManager.keyDownHandler(e)}),bodyDOM.on("keyup",e=>{uiManager.keyUpHandler(e)}),rightBtnSaveMenuDOM.on("click",function(e){g(e)}),rightBtnViewMenuDOM.on("click",function(e){g(e)}),rightBtnEditMenuDOM.on("click",function(e){g(e)}),rightBtnCreateMenuDOM.on("click",function(e){g(e)}),rightBtnDrawMenuDOM.on("click",function(e){g(e)}),rightBtnColorsMenuDOM.on("click",function(e){g(e)}),rightBtnEarthMenuDOM.on("click",function(e){g(e)}),$("#reset-camera-rmb").on("click",function(e){g(e)}),$("#clear-screen-rmb").on("click",function(e){g(e)}),$("#clear-lines-rmb").on("click",function(e){g(e)}),rightBtnSaveDOM.hover(()=>{r()}),rightBtnSaveDOM.click(()=>{r()}),rightBtnSaveMenuDOM.hover(null,function(){rightBtnSaveMenuDOM.hide()}),rightBtnViewDOM.hover(()=>{n()}),rightBtnViewDOM.click(()=>{n()}),rightBtnViewMenuDOM.hover(null,function(){rightBtnViewMenuDOM.hide()}),rightBtnEditDOM.hover(()=>{s()}),rightBtnEditDOM.click(()=>{s()}),rightBtnEditMenuDOM.hover(null,function(){rightBtnEditMenuDOM.hide()}),rightBtnCreateDOM.hover(()=>{i()}),rightBtnCreateDOM.click(()=>{i()}),rightBtnCreateMenuDOM.hover(null,function(){rightBtnCreateMenuDOM.hide()}),rightBtnDrawDOM.hover(()=>{o()}),rightBtnDrawDOM.click(()=>{o()}),rightBtnDrawMenuDOM.hover(null,function(){rightBtnDrawMenuDOM.hide()}),rightBtnColorsDOM.hover(()=>{c()}),rightBtnColorsDOM.click(()=>{c()}),rightBtnEarthMenuDOM.hover(null,function(){rightBtnEarthMenuDOM.hide()}),rightBtnEarthDOM.hover(()=>{l()}),rightBtnEarthDOM.click(()=>{l()}),rightBtnEarthMenuDOM.hover(null,function(){rightBtnEarthMenuDOM.hide()}))}()});