var satSensorMarkerArray=[],emptyMat4=mat4.create();!function(){var e,a,t,r,n,i,o,l,g,d,c,u,S,M=360/(2*Math.PI),h={},p=settingsManager.limitSats,f={};try{$("#loader-text").text("Locating ELSETs..."),h=new Worker(settingsManager.installDirectory+"js/satCruncher.js")}catch(e){console.log(e),browserUnsupported()}var m,v,b,L,D,C,T=0,x=0,A=!1;h.onmessage=(e=>{if(!A){for(S=JSON.parse(e.data.extraData),L=0;L<f.numSats;L++)u[L].inclination=S[L].inclination,u[L].eccentricity=S[L].eccentricity,u[L].raan=S[L].raan,u[L].argPe=S[L].argPe,u[L].meanMotion=S[L].meanMotion,u[L].semiMajorAxis=S[L].semiMajorAxis,u[L].semiMinorAxis=S[L].semiMinorAxis,u[L].apogee=S[L].apogee,u[L].perigee=S[L].perigee,u[L].period=S[L].period;return A=!0,void(S=null)}if(e.data.extraUpdate)return S=JSON.parse(e.data.extraData),L=e.data.satId,u[L].inclination=S[0].inclination,u[L].eccentricity=S[0].eccentricity,u[L].raan=S[0].raan,u[L].argPe=S[0].argPe,u[L].meanMotion=S[0].meanMotion,u[L].semiMajorAxis=S[0].semiMajorAxis,u[L].semiMinorAxis=S[0].semiMinorAxis,u[L].apogee=S[0].apogee,u[L].perigee=S[0].perigee,u[L].period=S[0].period,u[L].TLE1=S[0].TLE1,u[L].TLE2=S[0].TLE2,void(S=null);if(l=new Float32Array(e.data.satPos),g=new Float32Array(e.data.satVel),void 0!==e.data.satInView&&(d=new Int8Array(e.data.satInView)),void 0!==e.data.satInSun&&(c=new Int8Array(e.data.satInSun)),void 0!==e.data.sensorMarkerArray&&(satSensorMarkerArray=e.data.sensorMarkerArray),(settingsManager.isMapMenuOpen||settingsManager.isMapUpdateOverride)&&((x=Date.now())>settingsManager.lastMapUpdateTime+3e4?(uiManager.updateMap(),settingsManager.lastMapUpdateTime=x,settingsManager.isMapUpdateOverride=!1):settingsManager.isMapUpdateOverride&&(uiManager.updateMap(),settingsManager.lastMapUpdateTime=x,settingsManager.isMapUpdateOverride=!1)),settingsManager.socratesOnSatCruncher&&(selectSat(settingsManager.socratesOnSatCruncher),settingsManager.socratesOnSatCruncher=null),(objectManager.isSensorManagerLoaded&&sensorManager.checkSensorSelected()||settingsManager.isForceColorScheme)&&(isDragging||f.setColorScheme(settingsManager.currentColorScheme,!0)),!settingsManager.cruncherReady){""!==p&&$("#menu-satellite-collision").hide(),f.onCruncherReady(),settingsManager.disableUI||(function(){let e;try{e=JSON.parse(localStorage.getItem("currentSensor"))}catch(a){e=null}if(null!==e)try{void 0===e[0]||null==e[0]?(sensorManager.setSensor(null,e[1]),uiManager.legendMenuChange("default")):void 0===e[0].shortName?(sensorManager.setSensor(e[0],e[1]),uiManager.legendMenuChange("default")):(sensorManager.setSensor(sensorManager.sensorList[e[0].shortName],e[1]),uiManager.legendMenuChange("default"))}catch(e){localStorage.setItem("currentSensor",null),console.warn("Saved Sensor Information Invalid")}}(),function(){let e;try{e=localStorage.getItem("watchlistList")}catch(a){e=null}if(null!==e){let a=JSON.parse(e);watchlistInViewList=[];for(let e=0;e<a.length;e++){let t=f.getSatExtraOnly(f.getIdFromObjNum(a[e]));if(null===t)return void console.error("Watchlist File Format Incorret");a[e]=t.id,watchlistInViewList.push(!1)}uiManager.updateWatchlist(a,watchlistInViewList)}}());try{nextLaunchManager.init()}catch(e){}!function(){let e=f.queryStr.split("&");for(let a=0;a<e.length;a++){let t=e[a].split("=")[0],r=e[a].split("=")[1];"search"==t&&(settingsManager.disableUI||searchBox.doSearch(r))}for(let t=0;t<e.length;t++){let r,s=e[t].split("=")[0],n=e[t].split("=")[1];switch(s){case"intldes":null!==(r=f.getIdFromIntlDes(n.toUpperCase()))&&selectSat(r);break;case"sat":null!==(r=f.getIdFromObjNum(n.toUpperCase()))&&selectSat(r);break;case"misl":var a=n.split(",");$("#ms-type").val(a[0].toString()),$("#ms-attacker").val(a[1].toString()),$("#ms-target").val(a[2].toString()),$("#missile").trigger("submit");break;case"date":timeManager.propOffset=Number(n)-Date.now(),$("#datetime-input-tb").datepicker("setDate",new Date(timeManager.propRealTime+timeManager.propOffset)),h.postMessage({typ:"offset",dat:timeManager.propOffset.toString()+" "+timeManager.propRate.toString()});break;case"rate":n=Math.min(n,1e3),n=Math.max(n,0),timeManager.propRate=Number(n),h.postMessage({typ:"offset",dat:timeManager.propOffset.toString()+" "+timeManager.propRate.toString()})}}}(),settingsManager.startWithOrbitsDisplayed&&setTimeout(function(){groups.debris=new groups.SatGroup("all",""),groups.selectGroup(groups.debris),f.setColorScheme(settingsManager.currentColorScheme,!0),groups.debris.updateOrbits(),settingsManager.isOrbitOverlayVisible=!0},0),setTimeout(function(){$("img").each(function(){$(this).attr("src",$(this).attr("delayedsrc"))})},0),settingsManager.cruncherReady=!0}}),f.changeShaders=(a=>{switch(gl.detachShader(e,D),gl.detachShader(e,C),a){case"var":gl.shaderSource(D,shaderLoader.getShaderCode("dot-vertex-var.glsl"));break;case 12:gl.shaderSource(D,shaderLoader.getShaderCode("dot-vertex-12.glsl"));break;case 6:gl.shaderSource(D,shaderLoader.getShaderCode("dot-vertex-6.glsl"));break;case 2:gl.shaderSource(D,shaderLoader.getShaderCode("dot-vertex-2.glsl"))}gl.compileShader(D),gl.shaderSource(C,shaderLoader.getShaderCode("dot-fragment.glsl")),gl.compileShader(C),gl.attachShader(e,D),gl.attachShader(e,C),gl.linkProgram(e),e.aPos=gl.getAttribLocation(e,"aPos"),e.aColor=gl.getAttribLocation(e,"aColor"),e.aStar=gl.getAttribLocation(e,"aStar"),e.minSize=gl.getUniformLocation(e,"minSize"),e.maxSize=gl.getUniformLocation(e,"maxSize"),e.uMvMatrix=gl.getUniformLocation(e,"uMvMatrix"),e.uCamMatrix=gl.getUniformLocation(e,"uCamMatrix"),e.uPMatrix=gl.getUniformLocation(e,"uPMatrix")}),f.init=(a=>{f.satsReadyCallback=a,db.log("satSet.init"),function(){for(var e=window.location.search.substring(1).split("&"),a=0;a<e.length;a++){"vertShadersSize"===e[a].split("=")[0]&&(settingsManager.vertShadersSize=6,document.getElementById("settings-shaders").checked=!0)}}(),e=gl.createProgram(),D=gl.createShader(gl.VERTEX_SHADER),gl.shaderSource(D,shaderLoader.getShaderCode("dot-vertex-var.glsl")),gl.compileShader(D),C=gl.createShader(gl.FRAGMENT_SHADER),gl.shaderSource(C,shaderLoader.getShaderCode("dot-fragment.glsl")),gl.compileShader(C),gl.attachShader(e,D),gl.attachShader(e,C),gl.linkProgram(e),e.aPos=gl.getAttribLocation(e,"aPos"),e.aColor=gl.getAttribLocation(e,"aColor"),e.aStar=gl.getAttribLocation(e,"aStar"),e.minSize=gl.getUniformLocation(e,"minSize"),e.maxSize=gl.getUniformLocation(e,"maxSize"),e.uMvMatrix=gl.getUniformLocation(e,"uMvMatrix"),e.uCamMatrix=gl.getUniformLocation(e,"uCamMatrix"),e.uPMatrix=gl.getUniformLocation(e,"uPMatrix"),f.startCatalogLoad=(()=>{if(settingsManager.isCatalogPreloaded=!0,void 0===settingsManager.tleSource&&(settingsManager.tleSource="tle/TLE.json"),settingsManager.offline)f.loadTLEs(jsTLEfile),jsTLEfile=null;else try{var e=settingsManager.tleSource;$.get({url:""+e,cache:!1}).done(function(e){f.loadTLEs(e)}).fail(function(){$.get({url:""+e,cache:!0}).done(function(e){f.loadTLEs(e)}).fail(function(){$.getScript("offline/tle.js",function(){f.loadTLEs(jsTLEfile)},!0)})}),jsTLEfile=null}catch(e){f.loadTLEs(jsTLEfile),jsTLEfile=null}}),f.startCatalogLoad()}),f.loadTLEs=(e=>{var t,n,o,g,d,c,S,M,m,v=[];if("undefined"!=typeof trusatList||!settingsManager.trusatMode||settingsManager.trusatOnly){!function(){for(var e=window.location.search.substring(1).split("&"),a=0;a<e.length;a++){var r=e[a].split("=")[0],s=e[a].split("=")[1];switch(r){case"limitSats":p=s,$("#limitSats").val(s),$("#limitSats-Label").addClass("active"),v=s.split(",");break;case"lat":s>=-90&&s<=90&&(t=s);break;case"long":s>=-180&&s<=360&&(n=s);break;case"hei":s>=-20&&s<=20&&(o=s);break;case"minaz":s>=0&&s<=360&&(g=s);break;case"maxaz":s>=0&&s<=360&&(d=s);break;case"minel":s>=-10&&s<=180&&(c=s);break;case"maxel":s>=-10&&s<=180&&(S=s);break;case"minrange":s>=0&&(M=s);break;case"maxrange":s<=1e7&&(m=s)}}}(),u=function(a){var t,r,n=[];f.sccIndex={},f.cosparIndex={},null==a[0]&&(p="");for(var i=0;i<e.length;i++)if(e[i].SCC_NUM=R(e[i].TLE1.substr(2,5).trim(),5),""!==p)for(var o=0;o<a.length;o++)e[i].SCC_NUM===a[o]&&(""===(t=e[i].TLE1.substr(9,8).trim().substring(0,2))?e[i].intlDes="none":(t=(t>50?"19":"20")+t,r=e[i].TLE1.substr(9,8).trim().substring(2),e[i].intlDes=t+"-"+r),e[i].id=i,f.sccIndex[`${e[i].SCC_NUM}`]=e[i].id,f.cosparIndex[`${e[i].intlDes}`]=e[i].id,e[i].active=!0,n.push(e[i]));else""===(t=e[i].TLE1.substr(9,8).trim().substring(0,2))?e[i].intlDes="none":(t=(t>50?"19":"20")+t,r=e[i].TLE1.substr(9,8).trim().substring(2),e[i].intlDes=t+"-"+r),e[i].id=i,f.sccIndex[`${e[i].SCC_NUM}`]=e[i].id,f.cosparIndex[`${e[i].intlDes}`]=e[i].id,e[i].active=!0,n.push(e[i]);var l=!1;if("undefined"!=typeof satelliteList&&settingsManager.offline){for(s=0;s<satelliteList.length;s++)if(l=!1,void 0!=satelliteList[s].SCC&&void 0!=satelliteList[s].TLE1&&void 0!=satelliteList[s].TLE2){if(void 0!==f.sccIndex[`${satelliteList[s].SCC}`]){n[i=f.sccIndex[`${satelliteList[s].SCC}`]].ON=satelliteList[s].ON,n[i].OT=void 0!==satelliteList[s].OT?satelliteList[s].OT:null,n[i].TLE1=satelliteList[s].TLE1,n[i].TLE2=satelliteList[s].TLE2,l=!0;break}if(!l){if(void 0==satelliteList[s].TLE1)continue;if(void 0==satelliteList[s].TLE2)continue;settingsManager.isExtraSatellitesAdded=!0,void 0===satelliteList[s].ON&&(satelliteList[s].ON="Unknown"),void 0===satelliteList[s].OT&&(satelliteList[s].OT=null),t=((t=satelliteList[s].TLE1.substr(9,8).trim().substring(0,2))>50?"19":"20")+t,r=satelliteList[s].TLE1.substr(9,8).trim().substring(2),extrasSatInfo={static:!1,missile:!1,active:!0,ON:satelliteList[s].ON,OT:satelliteList[s].OT,C:"Unknown",LV:"Unknown",LS:"Unknown",SCC_NUM:satelliteList[s].SCC.toString(),TLE1:satelliteList[s].TLE1,TLE2:satelliteList[s].TLE2,intlDes:t+"-"+r,type:"sat",id:n.length,vmag:satelliteList[s].vmag},f.sccIndex[`${satelliteList[s].SCC.toString()}`]=n.length,f.cosparIndex[`${t}-${r}`]=n.length,n.push(extrasSatInfo)}}satelliteList=null}if("undefined"!=typeof satInfoList&&settingsManager.offline){for(s=0;s<satInfoList.length;s++)for(settingsManager.isExtraSatellitesAdded=!0,l=!1,i=s;i<n.length;i++)if(satInfoList[s].SCC===n[i].SCC_NUM){n[i].ON=satInfoList[s].ON,n[i].C=satInfoList[s].C,n[i].LV=satInfoList[s].LV,n[i].LS=satInfoList[s].LS,n[i].URL=satInfoList[s].URL,l=!0;break}satInfoList=null}if("undefined"!=typeof trusatList&&settingsManager.trusatMode){for(s=0;s<trusatList.length;s++)void 0!=trusatList[s].TLE1&&void 0!=trusatList[s].TLE2&&(void 0===trusatList[s].ON&&(trusatList[s].ON="Unknown"),void 0===trusatList[s].OT&&(trusatList[s].OT=null),t=((t=trusatList[s].TLE1.substr(9,8).trim().substring(0,2))>50?"19":"20")+t,r=trusatList[s].TLE1.substr(9,8).trim().substring(2),scc=R(parseInt(trusatList[s].TLE1.substr(2,5).trim()).toString(),5),extrasSatInfo={static:!1,missile:!1,active:!0,trusat:!0,ON:trusatList[s].ON,OT:4,C:"Unknown",LV:"Unknown",LS:"Unknown",SCC_NUM:`T${scc.toString()}`,TLE1:trusatList[s].TLE1,TLE2:trusatList[s].TLE2,intlDes:t+"-"+r,type:"sat",id:n.length},n.push(extrasSatInfo));trusatList=null}for(settingsManager.isExtraSatellitesAdded&&($(".legend-pink-box").show(),$(".legend-trusat-box")[1].parentElement.style.display="",$(".legend-trusat-box")[2].parentElement.style.display="",$(".legend-trusat-box")[3].parentElement.style.display="",$(".legend-trusat-box")[1].parentElement.innerHTML=`<div class="Square-Box legend-trusat-box"></div>${settingsManager.nameOfSpecialSats}`,$(".legend-trusat-box")[2].parentElement.innerHTML=`<div class="Square-Box legend-trusat-box"></div>${settingsManager.nameOfSpecialSats}`,$(".legend-trusat-box")[3].parentElement.innerHTML=`<div class="Square-Box legend-trusat-box"></div>${settingsManager.nameOfSpecialSats}`),f.orbitalSats=n.length,objectManager.starIndex1+=f.orbitalSats,objectManager.starIndex2+=f.orbitalSats,settingsManager.isEnableGsCatalog&&f.initGsData(),loggerStop=Date.now(),i=0;i<objectManager.staticSet.length;i++)n.push(objectManager.staticSet[i]);for(i=0;i<objectManager.analSatSet.length;i++)objectManager.analSatSet[i].id=n.length,n.push(objectManager.analSatSet[i]);radarDataManager.satDataStartIndex=n.length+1;for(let e=0;e<objectManager.radarDataSet.length;e++)n.push(objectManager.radarDataSet[e]);for(i=0;i<objectManager.missileSet.length;i++)n.push(objectManager.missileSet[i]);for(f.missileSats=n.length,i=0;i<objectManager.fieldOfViewSet.length;i++)objectManager.fieldOfViewSet[i].id=n.length,n.push(objectManager.fieldOfViewSet[i]);return n}(v),e=null,f.satDataString=JSON.stringify(u),timeManager.propRealTime=Date.now(),void 0!==t&&void 0!==n&&void 0!==o&&void 0!==g&&void 0!==d&&void 0!==c&&void 0!==S&&void 0!==M&&void 0!==m&&(satellite.setobs({lat:t,long:n,obshei:o,obsminaz:g,obsmaxaz:d,obsminel:c,obsmaxel:S,obsminrange:M,obsmaxrange:m}),h.postMessage({typ:"offset",dat:timeManager.propOffset.toString()+" "+timeManager.propRate.toString(),setlatlong:!0,lat:t,long:n,obshei:o,obsminaz:g,obsmaxaz:d,obsminel:c,obsmaxel:S,obsminrange:M,obsmaxrange:m})),h.postMessage({typ:"satdata",dat:f.satDataString,fieldOfViewSetLength:objectManager.fieldOfViewSet.length,isLowPerf:settingsManager.lowPerf}),a=gl.createBuffer(),l=new Float32Array(3*u.length);var b=[];i=gl.createBuffer();for(var L=0;L<u.length;L++){var D=L+1&255,C=(L+1&65280)>>8,T=(L+1&16711680)>>16;b.push(D/255),b.push(C/255),b.push(T/255)}if(gl.bindBuffer(gl.ARRAY_BUFFER,i),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(b),gl.STATIC_DRAW),r=gl.createBuffer(),f.setupStarBuffer(),f.numSats=u.length,f.setColorScheme(ColorScheme.default,!0),settingsManager.shadersReady=!0,f.satsReadyCallback&&(f.satsReadyCallback(u),!settingsManager.trusatOnly))try{void 0===f.getSat(f.getIdFromObjNum(44235)).vmag&&satVmagManager.init()}catch(e){console.debug("satVmagManager Not Loaded")}}else $.getScript("/tle/trusat.js",function(e){f.loadTLEs(e)})}),f.getSatData=(()=>(db.log("satSet.getSatData"),u)),f.getSatInView=(()=>(db.log("satSet.getSatInView"),void 0!==d&&d)),f.getSatInSun=(()=>(db.log("satSet.getSatInSun"),void 0!==c&&c)),f.getSatVel=(()=>(db.log("satSet.getSatVel"),void 0!==g&&g)),f.setColorScheme=((e,a)=>{db.log("satSet.setColorScheme"),settingsManager.currentColorScheme=e;try{n=e.calculateColorBuffers(a),t=n.colorBuf,o=n.pickableBuf}catch(e){console.log("satSet.setColorScheme not ready yet!")}}),f.convertIdArrayToSatnumArray=(e=>{let a=[];for(let t=0;t<e.length;t++)a.push(parseInt(f.getSat(e[t]).SCC_NUM));return a}),f.convertSatnumArrayToIdArray=(e=>{let a=[];for(let t=0;t<e.length;t++)try{a.push(f.getSatFromObjNum(e[t]).id)}catch(e){}return a}),f.initGsData=(()=>{$.getScript("satData/gs.json",function(e){$("#loader-text").html("Integrating Satellite Intel..."),$("#loading-screen").fadeIn(1e3,function(){f.gsInfo=JSON.parse(e);for(let e=0;e<f.gsInfo.length;e++){let a=f.gsInfo[e],t=0;for(let e=0;e<a[1].length;e++){let r=a[1][e];t=Math.max(t-200,0),void 0!==f.cosparIndex[`${r.cospar}`]&&(satSetI=f.cosparIndex[`${r.cospar}`],void 0!==r.name&&(void 0!==u[satSetI].ON&&"TBA"!=u[satSetI].ON&&"Unknown"!=u[satSetI].ON&&"PAYLOAD"!=u[satSetI].ON.slice(0,7)&&"OBJECT"!=u[satSetI].ON.slice(0,6)||(u[satSetI].ON=r.name)),void 0!==r.lv&&(void 0!==u[satSetI].LV&&"U"!=u[satSetI].LV||(u[satSetI].LV=r.lv)),void 0!==r.ls&&(void 0!==u[satSetI].LS&&"U"!=u[satSetI].LS||(u[satSetI].LS=r.ls)),void 0!==a[0].gsurl&&(u[satSetI].URL=a[0].gsurl),void 0!==a[0].sdpow&&(u[satSetI].Pw=a[0].sdpow),void 0!==a[0].sdtyp&&(u[satSetI].P=a[0].sdtyp),void 0!==a[0].sdcon&&(u[satSetI].Con=a[0].sdcon),void 0!==a[0].sdmas&&(u[satSetI].DM=a[0].sdmas),void 0!==a[0].sdope&&(u[satSetI].U=a[0].sdope),void 0!==a[0].sdlif&&(u[satSetI].Li=a[0].sdlif))}}$("#loading-screen").fadeOut("slow"),setTimeout(function(){$("#loader-text").html("Attempting to Math...")},800)})})}),f.searchCelestrak=((e,a)=>{if(void 0===a){for(var t=15e3;t<u.length;t++)if(u[t].SCC_NUM>=8e4&&!u[t].active){a=t;break}}else a=f.getIdFromObjNum(a);let r=new XMLHttpRequest;r.open("GET",`php/get_data.php?type=c&sat=${e}`,!0),r.onload=function(){if(this.status>=200&&this.status<400){let e=JSON.parse(this.response).split("\n"),t=e[1],r=e[2];f.insertNewAnalystSatellite(t,r,a)}else console.warn("Celestrack request returned an error!")},r.onerror=function(){console.warn("Celestrack request failed!")},r.send()}),f.searchN2yo=((e,a)=>{if(void 0===a){for(var t=15e3;t<u.length;t++)if(u[t].SCC_NUM>=8e4&&!u[t].active){a=t;break}}else a=f.getIdFromObjNum(a);let r=new XMLHttpRequest;r.open("GET",`php/get_data.php?type=n&sat=${e}`,!0),r.onload=function(){if(this.status>=200&&this.status<400){let e=this.response.split('<div id="tle">')[1].split("<pre>")[1].split("\n"),t=e[0],r=e[1];f.insertNewAnalystSatellite(t,r,a)}else console.warn("N2YO request returned an error!")},r.onerror=function(){console.warn("N2YO request failed!")},r.send()}),f.insertNewAnalystSatellite=((e,a,t)=>{if(satellite.altitudeCheck(e,a,timeManager.propOffset)>1){h.postMessage({typ:"satEdit",id:t,active:!0,TLE1:e,TLE2:a}),orbitManager.updateOrbitBuffer(t,!0,e,a);let r=f.getSat(t);r.active=!0,r.OT=1,searchBox.doSearch(r.SCC_NUM.toString())}else alert("Failed Altitude Check")}),f.setupStarBuffer=(()=>{let e=f.setupStarData(u);gl.bindBuffer(gl.ARRAY_BUFFER,r),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(e),gl.STATIC_DRAW)}),f.setupStarData=(e=>{let a=[];for(var t=0;t<e.length;t++)t>=objectManager.starIndex1&&t<=objectManager.starIndex2?a.push(1):a.push(0);for(let e=0;e<settingsManager.lastSearchResults.length;e++)a[settingsManager.lastSearchResults[e]]=1;return a}),f.updateRadarData=(()=>{for(let e=0;e<radarDataManager.radarData.length;e++)try{u[radarDataManager.satDataStartIndex+e].mId=radarDataManager.radarData[e].m,u[radarDataManager.satDataStartIndex+e].t=radarDataManager.radarData[e].t,u[radarDataManager.satDataStartIndex+e].rcs=radarDataManager.radarData[e].rc,u[radarDataManager.satDataStartIndex+e].trackId=radarDataManager.radarData[e].ti,u[radarDataManager.satDataStartIndex+e].objectId=radarDataManager.radarData[e].oi,u[radarDataManager.satDataStartIndex+e].satId=radarDataManager.radarData[e].si,u[radarDataManager.satDataStartIndex+e].missileComplex=radarDataManager.radarData[e].mc,u[radarDataManager.satDataStartIndex+e].missileObject=radarDataManager.radarData[e].mo,u[radarDataManager.satDataStartIndex+e].azError=radarDataManager.radarData[e].ae,u[radarDataManager.satDataStartIndex+e].elError=radarDataManager.radarData[e].ee,u[radarDataManager.satDataStartIndex+e].dataType=radarDataManager.radarData[e].dataType}catch(e){}});let y,I;var E;function R(e,a){return e.length<a?R("0"+e,a):e}f.draw=((s,n,d)=>{if(settingsManager.shadersReady&&settingsManager.cruncherReady){if(y=1*timeManager.propTime(),radarDataManager.radarData.length>0)for(0==radarDataManager.drawT1&&radarDataManager.findFirstDataTime(),I=!1,b=radarDataManager.drawT1;b<radarDataManager.radarData.length;b++){if(radarDataManager.radarData[b].t>=y-3e3&&radarDataManager.radarData[b].t<=y+3e3){if(I||(radarDataManager.drawT1=b,I=!0),0!==l[3*(radarDataManager.satDataStartIndex+b)])continue;l[3*(radarDataManager.satDataStartIndex+b)]=radarDataManager.radarData[b].x,l[3*(radarDataManager.satDataStartIndex+b)+1]=radarDataManager.radarData[b].y,l[3*(radarDataManager.satDataStartIndex+b)+2]=radarDataManager.radarData[b].z}else l[3*(radarDataManager.satDataStartIndex+b)]=0,l[3*(radarDataManager.satDataStartIndex+b)+1]=0,l[3*(radarDataManager.satDataStartIndex+b)+2]=0;if(radarDataManager.radarData[b].t>y+3e3)break}if(m=Math.max(timeManager.propRate,.001),v=Math.min((d-T)/1e3,1/m),v*=timeManager.propRate,f.satDataLenInDraw=u.length,!settingsManager.lowPerf&&v>settingsManager.minimumDrawDt){if(settingsManager.isSatOverflyModeOn||settingsManager.isFOVBubbleModeOn)for(f.satDataLenInDraw3=3*f.satDataLenInDraw,b=0;b<f.satDataLenInDraw3;b++)l[b]+=g[b]*v;else for(f.satDataLenInDraw-=settingsManager.maxFieldOfViewMarkers+settingsManager.maxRadarData,f.satDataLenInDraw3=3*f.satDataLenInDraw,b=0;b<f.satDataLenInDraw3;b++)l[b]+=g[b]*v;T=d}gl.useProgram(e),gl.bindFramebuffer(gl.FRAMEBUFFER,null),gl.uniformMatrix4fv(e.uMvMatrix,!1,emptyMat4),gl.uniformMatrix4fv(e.uCamMatrix,!1,n),gl.uniformMatrix4fv(e.uPMatrix,!1,s),gl.uniform1f(e.minSize,settingsManager.satShader.minSize),gl.uniform1f(e.maxSize,settingsManager.satShader.maxSize),gl.bindBuffer(gl.ARRAY_BUFFER,r),gl.enableVertexAttribArray(e.aStar),gl.vertexAttribPointer(e.aStar,1,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,a),gl.bufferData(gl.ARRAY_BUFFER,l,gl.STREAM_DRAW),gl.vertexAttribPointer(e.aPos,3,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,t),gl.enableVertexAttribArray(e.aColor),gl.vertexAttribPointer(e.aColor,4,gl.FLOAT,!1,0,0),gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA),gl.enable(gl.BLEND),gl.depthMask(!1),gl.drawArrays(gl.POINTS,0,u.length),gl.depthMask(!0),gl.disable(gl.BLEND);try{gl.useProgram(gl.pickShaderProgram),gl.bindFramebuffer(gl.FRAMEBUFFER,gl.pickFb),gl.uniformMatrix4fv(gl.pickShaderProgram.uMvMatrix,!1,emptyMat4),gl.uniformMatrix4fv(gl.pickShaderProgram.uCamMatrix,!1,n),gl.uniformMatrix4fv(gl.pickShaderProgram.uPMatrix,!1,s),gl.enableVertexAttribArray(gl.pickShaderProgram.aColor),gl.bindBuffer(gl.ARRAY_BUFFER,i),gl.vertexAttribPointer(gl.pickShaderProgram.aColor,3,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,o),gl.enableVertexAttribArray(gl.pickShaderProgram.aPickable),gl.vertexAttribPointer(gl.pickShaderProgram.aPickable,1,gl.FLOAT,!1,0,0),gl.drawArrays(gl.POINTS,0,u.length)}catch(e){db.log(`satData.length: ${u.length}`),db.log(e)}return!0}}),f.setSat=((e,a)=>{if(!u)return null;u[e]=a}),f.mergeSat=(e=>{if(!u)return null;var a=f.getIdFromObjNum(e.SCC);u[a].ON=e.ON,u[a].C=e.C,u[a].LV=e.LV,u[a].LS=e.LS,u[a].R=e.R,u[a].URL=e.URL,u[a].NOTES=e.NOTES,u[a].TTP=e.TTP,u[a].FMISSED=e.FMISSED,u[a].ORPO=e.ORPO,u[a].constellation=e.constellation,u[a].associates=e.associates,u[a].maneuver=e.maneuver}),f.vmagUpdate=(e=>{if(!u)return null;var a=f.getIdFromObjNum(e.satid);try{u[a].vmag=e.vmag}catch(e){}}),f.getSat=(e=>(db.log("satSet.getSat",!0),u&&u[e]?(A&&(u[e].inViewChange=!1,void 0!==d&&void 0!==d[e]?(u[e].inview!==d[e]&&(u[e].inViewChange=!0),u[e].inview=d[e]):(u[e].inview=!1,u[e].inViewChange=!1),void 0!==c&&void 0!==c[e]&&(u[e].inSun!==c[e]&&(u[e].inSunChange=!0),u[e].inSun=c[e]),u[e].velocity=Math.sqrt(g[3*e]*g[3*e]+g[3*e+1]*g[3*e+1]+g[3*e+2]*g[3*e+2]),u[e].velocityX=g[3*e],u[e].velocityY=g[3*e+1],u[e].velocityZ=g[3*e+2],u[e].position={x:l[3*e],y:l[3*e+1],z:l[3*e+2]}),void 0===u[e].isInSun&&(u[e].isInSun=(()=>{let a=sun.getXYZ(),t=Math.asin(RADIUS_OF_EARTH/Math.sqrt(Math.pow(-u[e].position.x,2)+Math.pow(-u[e].position.y,2)+Math.pow(-u[e].position.z,2)))*M,r=Math.asin(RADIUS_OF_SUN/Math.sqrt(Math.pow(-u[e].position.x+a.x,2)+Math.pow(-u[e].position.y+a.y,2)+Math.pow(-u[e].position.z+a.z,2)))*M,s=Math.acos(numeric.dot([-u[e].position.x,-u[e].position.y,-u[e].position.z],[-u[e].position.x+a.x,-u[e].position.y+a.y,-u[e].position.z+a.z])/(Math.sqrt(Math.pow(-u[e].position.x,2)+Math.pow(-u[e].position.y,2)+Math.pow(-u[e].position.z,2))*Math.sqrt(Math.pow(-u[e].position.x+a.x,2)+Math.pow(-u[e].position.y+a.y,2)+Math.pow(-u[e].position.z+a.z,2))))*M;return t>r&&s<t-r?0:Math.abs(t-r)<s&&s<t+r?1:r>t?1:s<r-t?1:2})),void 0===u[e].setRAE&&(u[e].setRAE=(a=>{u[e].rae=a})),void 0===u[e].getAltitude&&(u[e].getAltitude=(()=>satellite.altitudeCheck(u[e].TLE1,u[e].TLE2,timeManager.getPropOffset()))),objectManager.isSensorManagerLoaded&&void 0===u[e].getTEARR&&(u[e].getTEARR=((a,t)=>{let r={};if(void 0===t&&(t=sensorManager.currentSensor),void 0===t.observerGd){try{t.observerGd={height:t.obshei,latitude:t.lat,longitude:t.long}}catch(e){throw"observerGd is not set and could not be guessed."}if(void 0===t.observerGd.longitude)try{t.observerGd={height:t.alt,latitude:t.lat*DEG2RAD,longitude:t.lon*DEG2RAD}}catch(e){throw"observerGd is not set and could not be guessed."}}let s,n=satellite.twoline2satrec(u[e].TLE1,u[e].TLE2);s=void 0!==a?a:timeManager.propTime();let i=timeManager.jday(s.getUTCFullYear(),s.getUTCMonth()+1,s.getUTCDate(),s.getUTCHours(),s.getUTCMinutes(),s.getUTCSeconds());i+=s.getUTCMilliseconds()*MILLISECONDS_PER_DAY;let o=satellite.gstime(i),l=(i-n.jdsatepoch)*MINUTES_PER_DAY,g=satellite.sgp4(n,l);try{let e=satellite.eciToGeodetic(g.position,o);r.alt=e.height,r.lon=e.longitude,r.lat=e.latitude;let a=satellite.eciToEcf(g.position,o),s=satellite.ecfToLookAngles(t.observerGd,a);r.azimuth=s.azimuth*M,r.elevation=s.elevation*M,r.range=s.rangeSat}catch(e){r.alt=0,r.lon=0,r.lat=0,r.azimuth=0,r.elevation=0,r.range=0}return r.inview=satellite.checkIsInFOV(t,{az:r.azimuth,el:r.elevation,range:r.range}),uiManager.currentTEARR=r,r})),void 0===u[e].getDirection&&(u[e].getDirection=(()=>{let a=u[e].getTEARR().lat*M,t=timeManager.propTimeCheck(5e3,timeManager.propTime()),r=u[e].getTEARR(t).lat*M;if(a<r)return"N";if(a>r)return"S";if(a===r){if(t=timeManager.propTimeCheck(2e4,timeManager.propTime()),futureTEARR=u[e].getTEARR(t),a<r)return"N";if(a>r)return"S"}return console.warn("Sat Direction Calculation Error - By Pole?"),"Error"})),u[e]):null)),f.getSatInViewOnly=(e=>u&&u[e]?(u[e].inview=d[e],u[e]):null),f.getSatPosOnly=(e=>{if(!u)return null;if(!u[e])return null;return A&&(u[e].position={x:l[3*e],y:l[3*e+1],z:l[3*e+2]}),u[e]}),f.getSatExtraOnly=(e=>u&&u[e]?u[e]:null),f.getSatFromObjNum=(e=>{let a=f.getIdFromObjNum(e);return f.getSat(a)}),f.getIdFromObjNum=(e=>void 0!==typeof f.sccIndex[`${e}`]?f.sccIndex[`${e}`]:null),f.getIdFromIntlDes=(e=>void 0!==typeof f.cosparIndex[`${e}`]?f.cosparIndex[`${e}`]:null),f.getIdFromStarName=(e=>{for(var a=0;a<u.length;a++)if("Star"===u[a].type&&u[a].name===e)return a;return null}),f.getIdFromSensorName=(e=>{if(void 0!==e)for(var a=0;a<u.length;a++)if(!0===u[a].static&&!0!==u[a].missile&&"Star"!==u[a].type&&u[a].name===e)return a;try{var t=timeManager.propTime(),r=timeManager.jday(t.getUTCFullYear(),t.getUTCMonth()+1,t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds());r+=1.15741e-8*t.getUTCMilliseconds();var s=satellite.gstime(r);cosLat=Math.cos(sensorManager.currentSensor.lat*DEG2RAD),sinLat=Math.sin(sensorManager.currentSensor.lat*DEG2RAD),cosLon=Math.cos(sensorManager.currentSensor.long*DEG2RAD+s),sinLon=Math.sin(sensorManager.currentSensor.long*DEG2RAD+s);var n={position:{},name:"Custom Sensor"};return n.position.x=(6371.25+sensorManager.currentSensor.obshei)*cosLat*cosLon,n.position.y=(6371.25+sensorManager.currentSensor.obshei)*cosLat*sinLon,n.position.z=(6371.25+sensorManager.currentSensor.obshei)*sinLat,n}catch(e){return console.log(e),null}}),f.getScreenCoords=((e,a,t,r)=>{satScreenPositionArray.error=!1,r||(r=f.getSatPosOnly(e).position),E=vec4.fromValues(r.x,r.y,r.z,1),vec4.transformMat4(E,E,t),vec4.transformMat4(E,E,a),satScreenPositionArray.x=E[0]/E[3],satScreenPositionArray.y=E[1]/E[3],satScreenPositionArray.z=E[2]/E[3],satScreenPositionArray.x=.5*(satScreenPositionArray.x+1)*window.innerWidth,satScreenPositionArray.y=.5*(1-satScreenPositionArray.y)*window.innerHeight,satScreenPositionArray.x>=0&&satScreenPositionArray.y>=0&&satScreenPositionArray.z>=0&&satScreenPositionArray.z<=1||(satScreenPositionArray.error=!0)}),f.searchYear=(e=>{for(var a=[],t=0;t<u.length;t++)void 0!==u[t].TLE1&&u[t].TLE1.substring(9,11)==e&&a.push(t);return a}),f.searchYearOrLess=(e=>{for(var a=[],t=0;t<u.length;t++)void 0!==u[t].TLE1&&(e>=59&&e<100?u[t].TLE1.substring(9,11)<=e&&u[t].TLE1.substring(9,11)>=59&&a.push(t):(u[t].TLE1.substring(9,11)<=e||u[t].TLE1.substring(9,11)>=59)&&a.push(t));return a}),f.searchNameRegex=(e=>{for(var a=[],t=0;t<u.length;t++)e.test(u[t].ON)&&a.push(t);return a}),f.searchCountryRegex=(e=>{for(var a=[],t=0;t<u.length;t++)e.test(u[t].C)&&a.push(t);return a}),f.searchAzElRange=((e,a,t,r,s,n,i,o,l,g,d,c,S)=>{var h=!isNaN(parseFloat(e))&&isFinite(e),p=!isNaN(parseFloat(a))&&isFinite(a),f=!isNaN(parseFloat(t))&&isFinite(t),m=!isNaN(parseFloat(r))&&isFinite(r),v=!isNaN(parseFloat(l))&&isFinite(l),b=!isNaN(parseFloat(d))&&isFinite(d),L=!isNaN(parseFloat(s))&&isFinite(s),D=!isNaN(parseFloat(n))&&isFinite(n),C=!isNaN(parseFloat(i))&&isFinite(i),T=!isNaN(parseFloat(o))&&isFinite(o),x=!isNaN(parseFloat(g))&&isFinite(g),A=!isNaN(parseFloat(c))&&isFinite(c);if(S*=1,p||f||h||m||v||b){L||(s=5),D||(n=5),C||(i=200),T||(o=1),x||(g=.5),A||(c=d/10);for(var y=[],I=0,E=0;E<u.length;E++)u[E].static||u[E].missile||!u[E].active||(y.push(u[E]),satellite.getTEARR(y[I]),y[I].azimuth=uiManager.currentTEARR.azimuth,y[I].elevation=uiManager.currentTEARR.elevation,y[I].range=uiManager.currentTEARR.range,y[I].inview=uiManager.currentTEARR.inview,I++);if(m||v||(y=function(e){for(var a=[],t=0;t<e.length;t++)e[t].inview&&a.push(e[t]);return a}(y)),0!==S&&(y=function(e){for(var a=[],t=0;t<e.length;t++)e[t].OT===S&&a.push(e[t]);return a}(y)),h)y=function(e,a,t){for(var r=[],s=0;s<e.length;s++)e[s].azimuth<t&&e[s].azimuth>a&&r.push(e[s]);return r}(y,(e*=1)-(s*=1),e+s);if(p)y=function(e,a,t){for(var r=[],s=0;s<e.length;s++)e[s].elevation<t&&e[s].elevation>a&&r.push(e[s]);return r}(y,(a*=1)-(n*=1),a+n);if(f)y=function(e,a,t){for(var r=[],s=0;s<e.length;s++)e[s].range<t&&e[s].range>a&&r.push(e[s]);return r}(y,(t*=1)-(i*=1),t+i);if(m)y=function(e,a,t){for(var r=[],s=0;s<e.length;s++)(e[s].inclination*M).toFixed(2)<t&&(e[s].inclination*M).toFixed(2)>a&&r.push(e[s]);return r}(y,(r*=1)-(o*=1),r+o);if(v)y=function(e,a,t){for(var r=[],s=0;s<e.length;s++)e[s].period<t&&e[s].period>a&&r.length<=200&&r.push(e[s]);r.length>=200&&$("#findByLooks-results").text("Limited to 200 Results!");return r}(y,(l*=1)-(g*=1),l+g);if(b)y=function(e,a,t){console.log(a),console.log(t);for(var r=[],s=0;s<e.length;s++)parseFloat(e[s].R)<t&&parseFloat(e[s].R)>a&&r.length<=200&&(console.log(e[s]),r.push(e[s]));r.length>=200&&$("#findByLooks-results").text("Limited to 200 Results!");return r}(y,(d*=1)-(c*=1),d+c);var R=[];for(E=0;E<y.length;E++)E<y.length-1?$("#search").val($("#search").val()+y[E].SCC_NUM+","):$("#search").val($("#search").val()+y[E].SCC_NUM),R.push(y[E].SCC_NUM);return searchBox.doSearch($("#search").val()),y}}),f.exportTle2Csv=(()=>{let e=[],a=f.getSatData();a.sort((e,a)=>parseInt(e.SCC_NUM)-parseInt(a.SCC_NUM));for(let t=0;t<a.length;t++){let r=a[t];void 0!==r.TLE1&&void 0!==r.TLE2&&("ANALSAT"!=r.C&&e.push({satId:r.SCC_NUM,TLE1:r.TLE1,TLE2:r.TLE2,inclination:r.inclination*M,eccentricity:r.eccentricity,period:r.period,raan:r.raan*M,apogee:r.apogee,perigee:r.perigee,site:r.LS,country:r.C,name:r.ON,mission:r.M,purpose:r.P,user:r.U,rocket:r.LV,contractor:r.Con,dryMass:r.DM,liftMass:r.LM,lifeExpected:r.Li,power:r.Pw,visualMagnitude:r.vmag,source1:r.S1,source2:r.S2,source3:r.S3,source4:r.S4,source5:r.S5,source6:r.S6,source7:r.S7,source8:r.URL}))}saveCsv(e,"catalogInfo")}),f.exportTle2Txt=(()=>{let e=[],a=f.getSatData();a.sort((e,a)=>parseInt(e.SCC_NUM)-parseInt(a.SCC_NUM));for(let t=0;t<a.length;t++){let r=a[t];void 0!==r.TLE1&&void 0!==r.TLE2&&("ANALSAT"!=r.C&&(e.push(r.TLE1),e.push(r.TLE2)))}e=e.join("\n");var t=new Blob([e],{type:"text/plain;charset=utf-8"});saveAs(t,"TLE.txt")}),f.setHover=(e=>{if(e!==objectManager.hoveringSat){if(gl.bindBuffer(gl.ARRAY_BUFFER,t),-1!==objectManager.hoveringSat&&objectManager.hoveringSat!==objectManager.selectedSat)try{gl.bufferSubData(gl.ARRAY_BUFFER,4*objectManager.hoveringSat*4,new Float32Array(settingsManager.currentColorScheme.colorizer(f.getSat(objectManager.hoveringSat)).color))}catch(e){console.log(objectManager.hoveringSat),console.log(f.getSat(objectManager.hoveringSat)),console.log(settingsManager.currentColorScheme.colorizer(f.getSat(objectManager.hoveringSat)))}-1!==e&&e!==objectManager.selectedSat&&gl.bufferSubData(gl.ARRAY_BUFFER,4*e*4,new Float32Array(settingsManager.hoverColor)),objectManager.hoveringSat=e}}),f.selectSat=(e=>{e!==objectManager.selectedSat&&(isAnalysisMenuOpen&&-1!=e&&$("#anal-sat").val(f.getSat(e).SCC_NUM),adviceList.satelliteSelected(),h.postMessage({satelliteSelected:[e]}),settingsManager.isMobileModeEnabled&&mobile.searchToggle(!1),"undefined"!=typeof meshManager&&(gl.bindBuffer(gl.ARRAY_BUFFER,t),-1!==objectManager.selectedSat&&gl.bufferSubData(gl.ARRAY_BUFFER,4*objectManager.selectedSat*4,new Float32Array(settingsManager.currentColorScheme.colorizer(f.getSat(objectManager.selectedSat)).color)),-1!==e&&(isSatView=!0,gl.bufferSubData(gl.ARRAY_BUFFER,4*e*4,new Float32Array(settingsManager.selectedColor)))),objectManager.selectedSat=e,objectManager.isSensorManagerLoaded&&sensorManager.checkSensorSelected()&&$("#menu-lookangles").removeClass("bmenu-item-disabled"),$("#menu-lookanglesmultisite").removeClass("bmenu-item-disabled"),$("#menu-satview").removeClass("bmenu-item-disabled"),$("#menu-map").removeClass("bmenu-item-disabled"),$("#menu-editSat").removeClass("bmenu-item-disabled"),$("#menu-sat-fov").removeClass("bmenu-item-disabled"),$("#menu-newLaunch").removeClass("bmenu-item-disabled"),$("#menu-breakup").removeClass("bmenu-item-disabled"))}),f.onCruncherReady=(()=>{db.log("satSet.onCruncherReady",!0),f.queryStr=window.location.search.substring(1),f.satDataString=null}),window.satSet=f,window.satCruncher=h,window.satPos=l}();