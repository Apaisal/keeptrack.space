var satSensorMarkerArray=[],emptyMat4=mat4.create();!function(){var e,t,a,r,i,n,o,l,g,u,c,d,S,h=360/(2*Math.PI),f={},p=settingsManager.limitSats,m={};try{$("#loader-text").text("Locating ELSETs..."),f=new Worker(settingsManager.installDirectory+"js/sat-cruncher.js")}catch(e){console.log(e),browserUnsupported()}settingsManager.isCatalogPreloaded=!0,void 0===settingsManager.tleSource&&(settingsManager.tleSource="tle/TLE.json");try{var M=settingsManager.tleSource;$.get({url:""+M,cache:!1}).done(function(e){m.loadTLEs(e)}).fail(function(){$.get({url:""+M,cache:!0}).done(function(e){m.loadTLEs(e)}).fail(function(){$.getScript("offline/tle.js",function(){m.loadTLEs(jsTLEfile)},!0)})}),jsTLEfile=null}catch(e){console.warn(5),m.loadTLEs(jsTLEfile),jsTLEfile=null}var v,b,L,C,T,A,y=0,E=0,R=!1;f.onmessage=(e=>{if(!R){for(S=JSON.parse(e.data.extraData),C=0;C<m.numSats;C++)d[C].inclination=S[C].inclination,d[C].eccentricity=S[C].eccentricity,d[C].raan=S[C].raan,d[C].argPe=S[C].argPe,d[C].meanMotion=S[C].meanMotion,d[C].semiMajorAxis=S[C].semiMajorAxis,d[C].semiMinorAxis=S[C].semiMinorAxis,d[C].apogee=S[C].apogee,d[C].perigee=S[C].perigee,d[C].period=S[C].period;return R=!0,void(S=null)}if(e.data.extraUpdate)return S=JSON.parse(e.data.extraData),C=e.data.satId,d[C].inclination=S[0].inclination,d[C].eccentricity=S[0].eccentricity,d[C].raan=S[0].raan,d[C].argPe=S[0].argPe,d[C].meanMotion=S[0].meanMotion,d[C].semiMajorAxis=S[0].semiMajorAxis,d[C].semiMinorAxis=S[0].semiMinorAxis,d[C].apogee=S[0].apogee,d[C].perigee=S[0].perigee,d[C].period=S[0].period,d[C].TLE1=S[0].TLE1,d[C].TLE2=S[0].TLE2,void(S=null);if(l=new Float32Array(e.data.satPos),g=new Float32Array(e.data.satVel),void 0!==e.data.satInView&&(u=new Int8Array(e.data.satInView)),void 0!==e.data.satInSun&&(c=new Int8Array(e.data.satInSun)),void 0!==e.data.sensorMarkerArray&&(satSensorMarkerArray=e.data.sensorMarkerArray),(settingsManager.isMapMenuOpen||settingsManager.isMapUpdateOverride)&&((E=Date.now())>settingsManager.lastMapUpdateTime+3e4?(uiManager.updateMap(),settingsManager.lastMapUpdateTime=E,settingsManager.isMapUpdateOverride=!1):settingsManager.isMapUpdateOverride&&(uiManager.updateMap(),settingsManager.lastMapUpdateTime=E,settingsManager.isMapUpdateOverride=!1)),settingsManager.socratesOnSatCruncher&&(selectSat(settingsManager.socratesOnSatCruncher),settingsManager.socratesOnSatCruncher=null),(objectManager.isSensorManagerLoaded&&sensorManager.checkSensorSelected()||settingsManager.isForceColorScheme)&&(isDragging||m.setColorScheme(settingsManager.currentColorScheme,!0)),!settingsManager.cruncherReady){""!==p&&$("#menu-satellite-collision").hide(),m.onCruncherReady(),settingsManager.disableUI||(function(){let e=settingsManager.offline?null:JSON.parse(localStorage.getItem("currentSensor"));if(null!==e)try{void 0===e[0]||null==e[0]?sensorManager.setSensor(null,e[1]):void 0===e[0].shortName?sensorManager.setSensor(e[0],e[1]):sensorManager.setSensor(sensorManager.sensorList[e[0].shortName],e[1])}catch(e){localStorage.setItem("currentSensor",null),console.warn("Saved Sensor Information Invalid")}}(),function(){let e=settingsManager.offline?null:localStorage.getItem("watchlistList");if(null!==e){let t=JSON.parse(e);watchlistInViewList=[];for(let e=0;e<t.length;e++){let a=m.getSatExtraOnly(m.getIdFromObjNum(t[e]));if(null===a)return void console.error("Watchlist File Format Incorret");t[e]=a.id,watchlistInViewList.push(!1)}uiManager.updateWatchlist(t,watchlistInViewList)}}());try{nextLaunchManager.init()}catch(e){}!function(){let e=m.queryStr.split("&");for(let t=0;t<e.length;t++){let a=e[t].split("=")[0],r=e[t].split("=")[1];"search"==a&&(settingsManager.disableUI||searchBox.doSearch(r))}for(let a=0;a<e.length;a++){let r,s=e[a].split("=")[0],i=e[a].split("=")[1];switch(s){case"intldes":null!==(r=m.getIdFromIntlDes(i.toUpperCase()))&&selectSat(r);break;case"sat":null!==(r=m.getIdFromObjNum(i.toUpperCase()))&&selectSat(r);break;case"misl":var t=i.split(",");$("#ms-type").val(t[0].toString()),$("#ms-attacker").val(t[1].toString()),$("#ms-target").val(t[2].toString()),$("#missile").trigger("submit");break;case"date":timeManager.propOffset=Number(i)-Date.now(),$("#datetime-input-tb").datepicker("setDate",new Date(timeManager.propRealTime+timeManager.propOffset)),f.postMessage({typ:"offset",dat:timeManager.propOffset.toString()+" "+timeManager.propRate.toString()});break;case"rate":i=Math.min(i,1e3),i=Math.max(i,0),timeManager.propRate=Number(i),f.postMessage({typ:"offset",dat:timeManager.propOffset.toString()+" "+timeManager.propRate.toString()})}}}(),settingsManager.startWithOrbitsDisplayed&&setTimeout(function(){groups.debris=new groups.SatGroup("all",""),groups.selectGroup(groups.debris),m.setColorScheme(settingsManager.currentColorScheme,!0),groups.debris.updateOrbits(),settingsManager.isOrbitOverlayVisible=!0},0),setTimeout(function(){$("img").each(function(){$(this).attr("src",$(this).attr("delayedsrc"))})},0),settingsManager.cruncherReady=!0}}),m.changeShaders=(t=>{switch(gl.detachShader(e,T),gl.detachShader(e,A),t){case"var":gl.shaderSource(T,shaderLoader.getShaderCode("dot-vertex-var.glsl"));break;case 12:gl.shaderSource(T,shaderLoader.getShaderCode("dot-vertex-12.glsl"));break;case 6:gl.shaderSource(T,shaderLoader.getShaderCode("dot-vertex-6.glsl"));break;case 2:gl.shaderSource(T,shaderLoader.getShaderCode("dot-vertex-2.glsl"))}gl.compileShader(T),gl.shaderSource(A,shaderLoader.getShaderCode("dot-fragment.glsl")),gl.compileShader(A),gl.attachShader(e,T),gl.attachShader(e,A),gl.linkProgram(e),e.aPos=gl.getAttribLocation(e,"aPos"),e.aColor=gl.getAttribLocation(e,"aColor"),e.aStar=gl.getAttribLocation(e,"aStar"),e.minSize=gl.getUniformLocation(e,"minSize"),e.maxSize=gl.getUniformLocation(e,"maxSize"),e.uMvMatrix=gl.getUniformLocation(e,"uMvMatrix"),e.uCamMatrix=gl.getUniformLocation(e,"uCamMatrix"),e.uPMatrix=gl.getUniformLocation(e,"uPMatrix")}),m.init=(a=>{db.log("satSet.init"),function(){for(var e=window.location.search.substring(1).split("&"),t=0;t<e.length;t++){"vertShadersSize"===e[t].split("=")[0]&&(settingsManager.vertShadersSize=6,document.getElementById("settings-shaders").checked=!0)}}(),e=gl.createProgram(),T=gl.createShader(gl.VERTEX_SHADER),gl.shaderSource(T,shaderLoader.getShaderCode("dot-vertex-var.glsl")),gl.compileShader(T),A=gl.createShader(gl.FRAGMENT_SHADER),gl.shaderSource(A,shaderLoader.getShaderCode("dot-fragment.glsl")),gl.compileShader(A),gl.attachShader(e,T),gl.attachShader(e,A),gl.linkProgram(e),e.aPos=gl.getAttribLocation(e,"aPos"),e.aColor=gl.getAttribLocation(e,"aColor"),e.aStar=gl.getAttribLocation(e,"aStar"),e.minSize=gl.getUniformLocation(e,"minSize"),e.maxSize=gl.getUniformLocation(e,"maxSize"),e.uMvMatrix=gl.getUniformLocation(e,"uMvMatrix"),e.uCamMatrix=gl.getUniformLocation(e,"uCamMatrix"),e.uPMatrix=gl.getUniformLocation(e,"uPMatrix"),m.loadTLEs=(e=>{var i,o,g,u,c,S,h,M,v,b=[];if("undefined"!=typeof trusatList||!settingsManager.trusatMode||settingsManager.trusatOnly){!function(){for(var e=window.location.search.substring(1).split("&"),t=0;t<e.length;t++){var a=e[t].split("=")[0],r=e[t].split("=")[1];switch(a){case"limitSats":p=r,$("#limitSats").val(r),$("#limitSats-Label").addClass("active"),b=r.split(",");break;case"lat":r>=-90&&r<=90&&(i=r);break;case"long":r>=-180&&r<=360&&(o=r);break;case"hei":r>=-20&&r<=20&&(g=r);break;case"minaz":r>=0&&r<=360&&(u=r);break;case"maxaz":r>=0&&r<=360&&(c=r);break;case"minel":r>=-10&&r<=180&&(S=r);break;case"maxel":r>=-10&&r<=180&&(h=r);break;case"minrange":r>=0&&(M=r);break;case"maxrange":r<=1e7&&(v=r)}}}(),d=function(t){var a,r,i=[];null==t[0]&&(p=""),settingsManager.offline&&(e=JSON.parse(e));for(var n=0;n<e.length;n++)if(e[n].SCC_NUM=F(e[n].TLE1.substr(2,5).trim(),5),""!==p)for(var o=0;o<t.length;o++)e[n].SCC_NUM===t[o]&&(""===(a=e[n].TLE1.substr(9,8).trim().substring(0,2))?e[n].intlDes="none":(a=(a>50?"19":"20")+a,r=e[n].TLE1.substr(9,8).trim().substring(2),e[n].intlDes=a+"-"+r),e[n].id=n,e[n].active=!0,i.push(e[n]));else""===(a=e[n].TLE1.substr(9,8).trim().substring(0,2))?e[n].intlDes="none":(a=(a>50?"19":"20")+a,r=e[n].TLE1.substr(9,8).trim().substring(2),e[n].intlDes=a+"-"+r),e[n].id=n,e[n].active=!0,i.push(e[n]);var l=!1;if("undefined"!=typeof satelliteList&&settingsManager.offline){for(s=0;s<satelliteList.length;s++){for(l=!1,n=0;n<i.length;n++)if(void 0!=satelliteList[s].SCC&&void 0!=satelliteList[s].TLE1&&void 0!=satelliteList[s].TLE2&&i[n].SCC_NUM===satelliteList[s].SCC){i[n].ON=satelliteList[s].ON,i[n].OT=void 0!==satelliteList[s].OT?satelliteList[s].OT:null,i[n].TLE1=satelliteList[s].TLE1,i[n].TLE2=satelliteList[s].TLE2,l=!0;break}if(!l){if(void 0==satelliteList[s].TLE1)continue;if(void 0==satelliteList[s].TLE2)continue;void 0===satelliteList[s].ON&&(satelliteList[s].ON="Unknown"),void 0===satelliteList[s].OT&&(satelliteList[s].OT=null),a=((a=satelliteList[s].TLE1.substr(9,8).trim().substring(0,2))>50?"19":"20")+a,r=satelliteList[s].TLE1.substr(9,8).trim().substring(2),extrasSatInfo={static:!1,missile:!1,active:!1,ON:satelliteList[s].ON,OT:satelliteList[s].OT,C:"Unknown",LV:"Unknown",LS:"Unknown",SCC_NUM:satelliteList[s].SCC.toString(),TLE1:satelliteList[s].TLE1,TLE2:satelliteList[s].TLE2,intlDes:a+"-"+r,type:"sat",id:i.length,vmag:satelliteList[s].vmag},i.push(extrasSatInfo)}}satelliteList=null}if("undefined"!=typeof satInfoList&&settingsManager.offline){for(s=0;s<satInfoList.length;s++)for(l=!1,n=s;n<i.length;n++)if(satInfoList[s].SCC===i[n].SCC_NUM){i[n].ON=satInfoList[s].ON,i[n].C=satInfoList[s].C,i[n].LV=satInfoList[s].LV,i[n].LS=satInfoList[s].LS,i[n].URL=satInfoList[s].URL,l=!0;break}satInfoList=null}if("undefined"!=typeof trusatList&&settingsManager.trusatMode){for(s=0;s<trusatList.length;s++)void 0!=trusatList[s].TLE1&&void 0!=trusatList[s].TLE2&&(void 0===trusatList[s].ON&&(trusatList[s].ON="Unknown"),void 0===trusatList[s].OT&&(trusatList[s].OT=null),a=((a=trusatList[s].TLE1.substr(9,8).trim().substring(0,2))>50?"19":"20")+a,r=trusatList[s].TLE1.substr(9,8).trim().substring(2),scc=F(parseInt(trusatList[s].TLE1.substr(2,5).trim()).toString(),5),extrasSatInfo={static:!1,missile:!1,active:!0,trusat:!0,ON:trusatList[s].ON,OT:4,C:"Unknown",LV:"Unknown",LS:"Unknown",SCC_NUM:`T${scc.toString()}`,TLE1:trusatList[s].TLE1,TLE2:trusatList[s].TLE2,intlDes:a+"-"+r,type:"sat",id:i.length},i.push(extrasSatInfo));trusatList=null}for(m.orbitalSats=i.length,objectManager.starIndex1+=m.orbitalSats,objectManager.starIndex2+=m.orbitalSats,loggerStop=Date.now(),n=0;n<objectManager.staticSet.length;n++)i.push(objectManager.staticSet[n]);for(n=0;n<objectManager.analSatSet.length;n++)objectManager.analSatSet[n].id=i.length,i.push(objectManager.analSatSet[n]);for(n=0;n<objectManager.missileSet.length;n++)i.push(objectManager.missileSet[n]);for(m.missileSats=i.length,n=0;n<objectManager.fieldOfViewSet.length;n++)objectManager.fieldOfViewSet[n].id=i.length,i.push(objectManager.fieldOfViewSet[n]);return i}(b),e=null,m.satDataString=JSON.stringify(d),timeManager.propRealTime=Date.now(),void 0!==i&&void 0!==o&&void 0!==g&&void 0!==u&&void 0!==c&&void 0!==S&&void 0!==h&&void 0!==M&&void 0!==v&&(satellite.setobs({lat:i,long:o,obshei:g,obsminaz:u,obsmaxaz:c,obsminel:S,obsmaxel:h,obsminrange:M,obsmaxrange:v}),f.postMessage({typ:"offset",dat:timeManager.propOffset.toString()+" "+timeManager.propRate.toString(),setlatlong:!0,lat:i,long:o,obshei:g,obsminaz:u,obsmaxaz:c,obsminel:S,obsmaxel:h,obsminrange:M,obsmaxrange:v})),f.postMessage({typ:"satdata",dat:m.satDataString,fieldOfViewSetLength:objectManager.fieldOfViewSet.length,isLowPerf:settingsManager.lowPerf}),t=gl.createBuffer(),l=new Float32Array(3*d.length);var L=[];n=gl.createBuffer();for(var C=0;C<d.length;C++){var T=C+1&255,A=(C+1&65280)>>8,y=(C+1&16711680)>>16;L.push(T/255),L.push(A/255),L.push(y/255)}if(gl.bindBuffer(gl.ARRAY_BUFFER,n),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(L),gl.STATIC_DRAW),r=gl.createBuffer(),m.setupStarBuffer(),m.numSats=d.length,m.setColorScheme(ColorScheme.default,!0),settingsManager.shadersReady=!0,a&&(a(d),!settingsManager.trusatOnly))try{void 0===m.getSat(m.getIdFromObjNum(44235)).vmag&&satVmagManager.init()}catch(e){console.debug("satVmagManager Not Loaded")}}else $.getScript("/tle/trusat.js",function(){m.loadTLEs(e)})})}),m.getSatData=(()=>(db.log("satSet.getSatData"),d)),m.getSatInView=(()=>(db.log("satSet.getSatInView"),void 0!==u&&u)),m.getSatInSun=(()=>(db.log("satSet.getSatInSun"),void 0!==c&&c)),m.getSatVel=(()=>(db.log("satSet.getSatVel"),void 0!==g&&g)),m.setColorScheme=((e,t)=>{db.log("satSet.setColorScheme"),settingsManager.currentColorScheme=e;try{i=e.calculateColorBuffers(t),a=i.colorBuf,o=i.pickableBuf}catch(e){console.log("satSet.setColorScheme not ready yet!")}}),m.convertIdArrayToSatnumArray=(e=>{let t=[];for(let a=0;a<e.length;a++)t.push(parseInt(m.getSat(e[a]).SCC_NUM));return t}),m.convertSatnumArrayToIdArray=(e=>{let t=[];for(let a=0;a<e.length;a++)t.push(m.getSatFromObjNum(e[a]).id);return t}),m.searchCelestrak=((e,t)=>{if(void 0===t){for(var a=15e3;a<d.length;a++)if(d[a].SCC_NUM>=8e4&&!d[a].active){t=a;break}}else t=m.getIdFromObjNum(t);let r=new XMLHttpRequest;r.open("GET",`php/get_data.php?type=c&sat=${e}`,!0),r.onload=function(){if(this.status>=200&&this.status<400){let e=JSON.parse(this.response).split("\n"),a=e[1],r=e[2];m.insertNewAnalystSatellite(a,r,t)}else console.warn("Celestrack request returned an error!")},r.onerror=function(){console.warn("Celestrack request failed!")},r.send()}),m.searchN2yo=((e,t)=>{if(void 0===t){for(var a=15e3;a<d.length;a++)if(d[a].SCC_NUM>=8e4&&!d[a].active){t=a;break}}else t=m.getIdFromObjNum(t);let r=new XMLHttpRequest;r.open("GET",`php/get_data.php?type=n&sat=${e}`,!0),r.onload=function(){if(this.status>=200&&this.status<400){let e=this.response.split('<div id="tle">')[1].split("<pre>")[1].split("\n"),a=e[0],r=e[1];m.insertNewAnalystSatellite(a,r,t)}else console.warn("N2YO request returned an error!")},r.onerror=function(){console.warn("N2YO request failed!")},r.send()}),m.insertNewAnalystSatellite=((e,t,a)=>{if(satellite.altitudeCheck(e,t,timeManager.propOffset)>1){f.postMessage({typ:"satEdit",id:a,active:!0,TLE1:e,TLE2:t}),orbitManager.updateOrbitBuffer(a,!0,e,t);let r=m.getSat(a);r.active=!0,r.OT=1,searchBox.doSearch(r.SCC_NUM.toString())}else alert("Failed Altitude Check")}),m.setupStarBuffer=(()=>{let e=m.setupStarData(d);gl.bindBuffer(gl.ARRAY_BUFFER,r),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(e),gl.STATIC_DRAW)}),m.setupStarData=(e=>{let t=[];for(var a=0;a<e.length;a++)a>=objectManager.starIndex1?t.push(1):t.push(0);for(let e=0;e<settingsManager.lastSearchResults.length;e++)t[settingsManager.lastSearchResults[e]]=1;return t});var w;function F(e,t){return e.length<t?F("0"+e,t):e}m.draw=((s,i,u)=>{if(settingsManager.shadersReady&&settingsManager.cruncherReady){if(v=Math.max(timeManager.propRate,.001),b=Math.min((u-y)/1e3,1/v),b*=timeManager.propRate,m.satDataLenInDraw=d.length,!settingsManager.lowPerf&&b>settingsManager.minimumDrawDt){if(settingsManager.isSatOverflyModeOn||settingsManager.isFOVBubbleModeOn)for(m.satDataLenInDraw*=3,L=0;L<m.satDataLenInDraw;L++)0!=g[L]&&(l[L]+=g[L]*b);else for(m.satDataLenInDraw-=settingsManager.maxFieldOfViewMarkers,L=0;L<3*m.satDataLenInDraw;L++)0!=g[L]&&(l[L]+=g[L]*b);y=u}gl.useProgram(e),gl.bindFramebuffer(gl.FRAMEBUFFER,null),gl.uniformMatrix4fv(e.uMvMatrix,!1,emptyMat4),gl.uniformMatrix4fv(e.uCamMatrix,!1,i),gl.uniformMatrix4fv(e.uPMatrix,!1,s),gl.uniform1f(e.minSize,settingsManager.satShader.minSize),gl.uniform1f(e.maxSize,settingsManager.satShader.maxSize),gl.bindBuffer(gl.ARRAY_BUFFER,r),gl.enableVertexAttribArray(e.aStar),gl.vertexAttribPointer(e.aStar,1,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,t),gl.bufferData(gl.ARRAY_BUFFER,l,gl.STREAM_DRAW),gl.vertexAttribPointer(e.aPos,3,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,a),gl.enableVertexAttribArray(e.aColor),gl.vertexAttribPointer(e.aColor,4,gl.FLOAT,!1,0,0),gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA),gl.enable(gl.BLEND),gl.depthMask(!1),gl.drawArrays(gl.POINTS,0,d.length),gl.depthMask(!0),gl.disable(gl.BLEND);try{gl.useProgram(gl.pickShaderProgram),gl.bindFramebuffer(gl.FRAMEBUFFER,gl.pickFb),gl.uniformMatrix4fv(gl.pickShaderProgram.uMvMatrix,!1,emptyMat4),gl.uniformMatrix4fv(gl.pickShaderProgram.uCamMatrix,!1,i),gl.uniformMatrix4fv(gl.pickShaderProgram.uPMatrix,!1,s),gl.enableVertexAttribArray(gl.pickShaderProgram.aColor),gl.bindBuffer(gl.ARRAY_BUFFER,n),gl.vertexAttribPointer(gl.pickShaderProgram.aColor,3,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,o),gl.enableVertexAttribArray(gl.pickShaderProgram.aPickable),gl.vertexAttribPointer(gl.pickShaderProgram.aPickable,1,gl.FLOAT,!1,0,0),gl.drawArrays(gl.POINTS,0,d.length)}catch(e){db.log(`satData.length: ${d.length}`),db.log(e)}return!0}}),m.setSat=((e,t)=>{if(!d)return null;d[e]=t}),m.mergeSat=(e=>{if(!d)return null;var t=m.getIdFromObjNum(e.SCC);d[t].ON=e.ON,d[t].C=e.C,d[t].LV=e.LV,d[t].LS=e.LS,d[t].R=e.R,d[t].URL=e.URL,d[t].NOTES=e.NOTES,d[t].TTP=e.TTP,d[t].FMISSED=e.FMISSED,d[t].ORPO=e.ORPO,d[t].constellation=e.constellation,d[t].associates=e.associates,d[t].maneuver=e.maneuver}),m.vmagUpdate=(e=>{if(!d)return null;var t=m.getIdFromObjNum(e.satid);try{d[t].vmag=e.vmag}catch(e){}}),m.getSat=(e=>(db.log("satSet.getSat",!0),d&&d[e]?(R&&(d[e].inViewChange=!1,void 0!==u&&void 0!==u[e]?(d[e].inview!==u[e]&&(d[e].inViewChange=!0),d[e].inview=u[e]):(d[e].inview=!1,d[e].inViewChange=!1),void 0!==c&&void 0!==c[e]&&(d[e].inSun!==c[e]&&(d[e].inSunChange=!0),d[e].inSun=c[e]),d[e].velocity=Math.sqrt(g[3*e]*g[3*e]+g[3*e+1]*g[3*e+1]+g[3*e+2]*g[3*e+2]),d[e].velocityX=g[3*e],d[e].velocityY=g[3*e+1],d[e].velocityZ=g[3*e+2],d[e].position={x:l[3*e],y:l[3*e+1],z:l[3*e+2]}),void 0===d[e].isInSun&&(d[e].isInSun=(()=>{let t=sun.getXYZ(),a=Math.asin(RADIUS_OF_EARTH/Math.sqrt(Math.pow(-d[e].position.x,2)+Math.pow(-d[e].position.y,2)+Math.pow(-d[e].position.z,2)))*h,r=Math.asin(RADIUS_OF_SUN/Math.sqrt(Math.pow(-d[e].position.x+t.x,2)+Math.pow(-d[e].position.y+t.y,2)+Math.pow(-d[e].position.z+t.z,2)))*h,s=Math.acos(numeric.dot([-d[e].position.x,-d[e].position.y,-d[e].position.z],[-d[e].position.x+t.x,-d[e].position.y+t.y,-d[e].position.z+t.z])/(Math.sqrt(Math.pow(-d[e].position.x,2)+Math.pow(-d[e].position.y,2)+Math.pow(-d[e].position.z,2))*Math.sqrt(Math.pow(-d[e].position.x+t.x,2)+Math.pow(-d[e].position.y+t.y,2)+Math.pow(-d[e].position.z+t.z,2))))*h;return a>r&&s<a-r?0:Math.abs(a-r)<s&&s<a+r?1:r>a?1:s<r-a?1:2})),void 0===d[e].getAltitude&&(d[e].getAltitude=(()=>satellite.altitudeCheck(d[e].TLE1,d[e].TLE2,timeManager.getPropOffset()))),objectManager.isSensorManagerLoaded&&void 0===d[e].getTEARR&&(d[e].getTEARR=((t,a)=>{let r={};if(void 0===a&&(a=sensorManager.currentSensor),void 0===a.observerGd){try{a.observerGd={height:a.obshei,latitude:a.lat,longitude:a.long}}catch(e){throw"observerGd is not set and could not be guessed."}if(void 0===a.observerGd.longitude)try{a.observerGd={height:a.alt,latitude:a.lat*DEG2RAD,longitude:a.lon*DEG2RAD}}catch(e){throw"observerGd is not set and could not be guessed."}}let s,i=satellite.twoline2satrec(d[e].TLE1,d[e].TLE2);s=void 0!==t?t:timeManager.propTime();let n=timeManager.jday(s.getUTCFullYear(),s.getUTCMonth()+1,s.getUTCDate(),s.getUTCHours(),s.getUTCMinutes(),s.getUTCSeconds());n+=s.getUTCMilliseconds()*MILLISECONDS_PER_DAY;let o=satellite.gstime(n),l=(n-i.jdsatepoch)*MINUTES_PER_DAY,g=satellite.sgp4(i,l);try{let e=satellite.eciToGeodetic(g.position,o);r.alt=e.height,r.lon=e.longitude,r.lat=e.latitude;let t=satellite.eciToEcf(g.position,o),s=satellite.ecfToLookAngles(a.observerGd,t);r.azimuth=s.azimuth*h,r.elevation=s.elevation*h,r.range=s.rangeSat}catch(e){r.alt=0,r.lon=0,r.lat=0,r.azimuth=0,r.elevation=0,r.range=0}return r.inview=satellite.checkIsInFOV(a,{az:r.azimuth,el:r.elevation,range:r.range}),uiManager.currentTEARR=r,r})),void 0===d[e].getDirection&&(d[e].getDirection=(()=>{let t=d[e].getTEARR().lat*h,a=timeManager.propTimeCheck(5e3,timeManager.propTime()),r=d[e].getTEARR(a).lat*h;if(t<r)return"N";if(t>r)return"S";if(t===r){if(a=timeManager.propTimeCheck(2e4,timeManager.propTime()),futureTEARR=d[e].getTEARR(a),t<r)return"N";if(t>r)return"S"}return console.warn("Sat Direction Calculation Error - By Pole?"),"Error"})),d[e]):null)),m.getSatInViewOnly=(e=>d&&d[e]?(d[e].inview=u[e],d[e]):null),m.getSatPosOnly=(e=>{if(!d)return null;if(!d[e])return null;return R&&(d[e].position={x:l[3*e],y:l[3*e+1],z:l[3*e+2]}),d[e]}),m.getSatExtraOnly=(e=>d&&d[e]?d[e]:null),m.getSatFromObjNum=(e=>{let t=m.getIdFromObjNum(e);return m.getSat(t)}),m.getIdFromObjNum=(e=>{for(var t,a=0;a<d.length;a++)if(!d[a].static&&!d[a].missile&&(t=parseInt(d[a].SCC_NUM),parseInt(e)===t))return a;return null}),m.getIdFromIntlDes=(e=>{for(var t=0;t<d.length;t++)if(d[t].intlDes===e)return t;return null}),m.getIdFromStarName=(e=>{for(var t=0;t<d.length;t++)if("Star"===d[t].type&&d[t].name===e)return t;return null}),m.getIdFromSensorName=(e=>{if(void 0!==e)for(var t=0;t<d.length;t++)if(!0===d[t].static&&!0!==d[t].missile&&"Star"!==d[t].type&&d[t].name===e)return t;try{var a=timeManager.propTime(),r=timeManager.jday(a.getUTCFullYear(),a.getUTCMonth()+1,a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds());r+=1.15741e-8*a.getUTCMilliseconds();var s=satellite.gstime(r);cosLat=Math.cos(sensorManager.currentSensor.lat*DEG2RAD),sinLat=Math.sin(sensorManager.currentSensor.lat*DEG2RAD),cosLon=Math.cos(sensorManager.currentSensor.long*DEG2RAD+s),sinLon=Math.sin(sensorManager.currentSensor.long*DEG2RAD+s);var i={position:{},name:"Custom Sensor"};return i.position.x=(6371.25+sensorManager.currentSensor.obshei)*cosLat*cosLon,i.position.y=(6371.25+sensorManager.currentSensor.obshei)*cosLat*sinLon,i.position.z=(6371.25+sensorManager.currentSensor.obshei)*sinLat,i}catch(e){return console.log(e),null}}),m.getScreenCoords=((e,t,a,r)=>{satScreenPositionArray.error=!1,r||(r=m.getSatPosOnly(e).position),w=vec4.fromValues(r.x,r.y,r.z,1),vec4.transformMat4(w,w,a),vec4.transformMat4(w,w,t),satScreenPositionArray.x=w[0]/w[3],satScreenPositionArray.y=w[1]/w[3],satScreenPositionArray.z=w[2]/w[3],satScreenPositionArray.x=.5*(satScreenPositionArray.x+1)*window.innerWidth,satScreenPositionArray.y=.5*(1-satScreenPositionArray.y)*window.innerHeight,satScreenPositionArray.x>=0&&satScreenPositionArray.y>=0&&satScreenPositionArray.z>=0&&satScreenPositionArray.z<=1||(satScreenPositionArray.error=!0)}),m.searchYear=(e=>{for(var t=[],a=0;a<d.length;a++)void 0!==d[a].TLE1&&d[a].TLE1.substring(9,11)==e&&t.push(a);return t}),m.searchYearOrLess=(e=>{for(var t=[],a=0;a<d.length;a++)void 0!==d[a].TLE1&&(e>=59&&e<100?d[a].TLE1.substring(9,11)<=e&&d[a].TLE1.substring(9,11)>=59&&t.push(a):(d[a].TLE1.substring(9,11)<=e||d[a].TLE1.substring(9,11)>=59)&&t.push(a));return t}),m.searchNameRegex=(e=>{for(var t=[],a=0;a<d.length;a++)e.test(d[a].ON)&&t.push(a);return t}),m.searchCountryRegex=(e=>{for(var t=[],a=0;a<d.length;a++)e.test(d[a].C)&&t.push(a);return t}),m.searchAzElRange=((e,t,a,r,s,i,n,o,l,g,u,c,S)=>{var f=!isNaN(parseFloat(e))&&isFinite(e),p=!isNaN(parseFloat(t))&&isFinite(t),m=!isNaN(parseFloat(a))&&isFinite(a),M=!isNaN(parseFloat(r))&&isFinite(r),v=!isNaN(parseFloat(l))&&isFinite(l),b=!isNaN(parseFloat(u))&&isFinite(u),L=!isNaN(parseFloat(s))&&isFinite(s),C=!isNaN(parseFloat(i))&&isFinite(i),T=!isNaN(parseFloat(n))&&isFinite(n),A=!isNaN(parseFloat(o))&&isFinite(o),y=!isNaN(parseFloat(g))&&isFinite(g),E=!isNaN(parseFloat(c))&&isFinite(c);if(S*=1,p||m||f||M||v||b){L||(s=5),C||(i=5),T||(n=200),A||(o=1),y||(g=.5),E||(c=u/10);for(var R=[],w=0,F=0;F<d.length;F++)d[F].static||d[F].missile||!d[F].active||(R.push(d[F]),satellite.getTEARR(R[w]),R[w].azimuth=uiManager.currentTEARR.azimuth,R[w].elevation=uiManager.currentTEARR.elevation,R[w].range=uiManager.currentTEARR.range,R[w].inview=uiManager.currentTEARR.inview,w++);if(M||v||(R=function(e){for(var t=[],a=0;a<e.length;a++)e[a].inview&&t.push(e[a]);return t}(R)),0!==S&&(R=function(e){for(var t=[],a=0;a<e.length;a++)e[a].OT===S&&t.push(e[a]);return t}(R)),f)R=function(e,t,a){for(var r=[],s=0;s<e.length;s++)e[s].azimuth<a&&e[s].azimuth>t&&r.push(e[s]);return r}(R,(e*=1)-(s*=1),e+s);if(p)R=function(e,t,a){for(var r=[],s=0;s<e.length;s++)e[s].elevation<a&&e[s].elevation>t&&r.push(e[s]);return r}(R,(t*=1)-(i*=1),t+i);if(m)R=function(e,t,a){for(var r=[],s=0;s<e.length;s++)e[s].range<a&&e[s].range>t&&r.push(e[s]);return r}(R,(a*=1)-(n*=1),a+n);if(M)R=function(e,t,a){for(var r=[],s=0;s<e.length;s++)(e[s].inclination*h).toFixed(2)<a&&(e[s].inclination*h).toFixed(2)>t&&r.push(e[s]);return r}(R,(r*=1)-(o*=1),r+o);if(v)R=function(e,t,a){for(var r=[],s=0;s<e.length;s++)e[s].period<a&&e[s].period>t&&r.length<=200&&r.push(e[s]);r.length>=200&&$("#findByLooks-results").text("Limited to 200 Results!");return r}(R,(l*=1)-(g*=1),l+g);if(b)R=function(e,t,a){console.log(t),console.log(a);for(var r=[],s=0;s<e.length;s++)parseFloat(e[s].R)<a&&parseFloat(e[s].R)>t&&r.length<=200&&(console.log(e[s]),r.push(e[s]));r.length>=200&&$("#findByLooks-results").text("Limited to 200 Results!");return r}(R,(u*=1)-(c*=1),u+c);var x=[];for(F=0;F<R.length;F++)F<R.length-1?$("#search").val($("#search").val()+R[F].SCC_NUM+","):$("#search").val($("#search").val()+R[F].SCC_NUM),x.push(R[F].SCC_NUM);return searchBox.doSearch($("#search").val()),R}}),m.exportTle2Csv=(()=>{let e=[],t=m.getSatData();t.sort((e,t)=>parseInt(e.SCC_NUM)-parseInt(t.SCC_NUM));for(let a=0;a<t.length;a++){let r=t[a];void 0!==r.TLE1&&void 0!==r.TLE2&&("ANALSAT"!=r.C&&e.push({satId:r.SCC_NUM,TLE1:r.TLE1,TLE2:r.TLE2,inclination:r.inclination*h,eccentricity:r.eccentricity,period:r.period,raan:r.raan*h,apogee:r.apogee,perigee:r.perigee,site:r.LS,country:r.C,name:r.ON,mission:r.M,purpose:r.P,user:r.U,rocket:r.LV,contractor:r.Con,dryMass:r.DM,liftMass:r.LM,lifeExpected:r.Li,power:r.Pw,visualMagnitude:r.vmag,source1:r.S1,source2:r.S2,source3:r.S3,source4:r.S4,source5:r.S5,source6:r.S6,source7:r.S7,source8:r.URL}))}saveCsv(e,"catalogInfo")}),m.exportTle2Txt=(()=>{let e=[],t=m.getSatData();t.sort((e,t)=>parseInt(e.SCC_NUM)-parseInt(t.SCC_NUM));for(let a=0;a<t.length;a++){let r=t[a];void 0!==r.TLE1&&void 0!==r.TLE2&&("ANALSAT"!=r.C&&(e.push(r.TLE1),e.push(r.TLE2)))}e=e.join("\n");var a=new Blob([e],{type:"text/plain;charset=utf-8"});saveAs(a,"TLE.txt")}),m.setHover=(e=>{if(e!==objectManager.hoveringSat){if(gl.bindBuffer(gl.ARRAY_BUFFER,a),-1!==objectManager.hoveringSat&&objectManager.hoveringSat!==objectManager.selectedSat)try{gl.bufferSubData(gl.ARRAY_BUFFER,4*objectManager.hoveringSat*4,new Float32Array(settingsManager.currentColorScheme.colorizer(m.getSat(objectManager.hoveringSat)).color))}catch(e){console.log(objectManager.hoveringSat),console.log(m.getSat(objectManager.hoveringSat)),console.log(settingsManager.currentColorScheme.colorizer(m.getSat(objectManager.hoveringSat)))}-1!==e&&e!==objectManager.selectedSat&&gl.bufferSubData(gl.ARRAY_BUFFER,4*e*4,new Float32Array(settingsManager.hoverColor)),objectManager.hoveringSat=e}}),m.selectSat=(e=>{e!==objectManager.selectedSat&&(isAnalysisMenuOpen&&-1!=e&&$("#anal-sat").val(m.getSat(e).SCC_NUM),adviceList.satelliteSelected(),f.postMessage({satelliteSelected:[e]}),settingsManager.isMobileModeEnabled&&mobile.searchToggle(!1),"undefined"!=typeof meshManager&&(gl.bindBuffer(gl.ARRAY_BUFFER,a),-1!==objectManager.selectedSat&&gl.bufferSubData(gl.ARRAY_BUFFER,4*objectManager.selectedSat*4,new Float32Array(settingsManager.currentColorScheme.colorizer(m.getSat(objectManager.selectedSat)).color)),-1!==e&&(isSatView=!0,gl.bufferSubData(gl.ARRAY_BUFFER,4*e*4,new Float32Array(settingsManager.selectedColor)))),objectManager.selectedSat=e,objectManager.isSensorManagerLoaded&&sensorManager.checkSensorSelected()&&$("#menu-lookangles").removeClass("bmenu-item-disabled"),$("#menu-lookanglesmultisite").removeClass("bmenu-item-disabled"),$("#menu-satview").removeClass("bmenu-item-disabled"),$("#menu-map").removeClass("bmenu-item-disabled"),$("#menu-editSat").removeClass("bmenu-item-disabled"),$("#menu-sat-fov").removeClass("bmenu-item-disabled"),$("#menu-newLaunch").removeClass("bmenu-item-disabled"),$("#menu-breakup").removeClass("bmenu-item-disabled"))}),m.onCruncherReady=(()=>{db.log("satSet.onCruncherReady",!0),m.queryStr=window.location.search.substring(1),m.satDataString=null}),window.satSet=m,window.satCruncher=f,window.satPos=l}();