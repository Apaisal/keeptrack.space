var satSensorMarkerArray=[];!function(){var e,t,a,i,r,n,o,l,g,h,c,d,u=360/(2*Math.PI),m={},S=settingsManager.limitSats,p={},M=mat4.create(),f=-1;try{$("#loader-text").text("Locating ELSETs..."),m=new Worker("js/sat-cruncher.js")}catch(e){browserUnsupported()}var v,L,b,C,w,A,T=0,y=0,E=!1;m.onmessage=(e=>{if(!E){for(d=JSON.parse(e.data.extraData),C=0;C<p.numSats;C++)c[C].inclination=d[C].inclination,c[C].eccentricity=d[C].eccentricity,c[C].raan=d[C].raan,c[C].argPe=d[C].argPe,c[C].meanMotion=d[C].meanMotion,c[C].semiMajorAxis=d[C].semiMajorAxis,c[C].semiMinorAxis=d[C].semiMinorAxis,c[C].apogee=d[C].apogee,c[C].perigee=d[C].perigee,c[C].period=d[C].period;return E=!0,void(d=null)}if(e.data.extraUpdate)return d=JSON.parse(e.data.extraData),C=e.data.satId,c[C].inclination=d[0].inclination,c[C].eccentricity=d[0].eccentricity,c[C].raan=d[0].raan,c[C].argPe=d[0].argPe,c[C].meanMotion=d[0].meanMotion,c[C].semiMajorAxis=d[0].semiMajorAxis,c[C].semiMinorAxis=d[0].semiMinorAxis,c[C].apogee=d[0].apogee,c[C].perigee=d[0].perigee,c[C].period=d[0].period,c[C].TLE1=d[0].TLE1,c[C].TLE2=d[0].TLE2,void(d=null);o=new Float32Array(e.data.satPos),l=new Float32Array(e.data.satVel),void 0!==e.data.satInView&&(g=new Int8Array(e.data.satInView)),void 0!==e.data.satInSun&&(h=new Int8Array(e.data.satInSun)),void 0!==e.data.sensorMarkerArray&&(satSensorMarkerArray=e.data.sensorMarkerArray),(settingsManager.isMapMenuOpen||settingsManager.isMapUpdateOverride)&&((y=Date.now())>settingsManager.lastMapUpdateTime+3e4?(uiManager.updateMap(),settingsManager.lastMapUpdateTime=y,settingsManager.isMapUpdateOverride=!1):settingsManager.isMapUpdateOverride&&(uiManager.updateMap(),settingsManager.lastMapUpdateTime=y,settingsManager.isMapUpdateOverride=!1)),settingsManager.socratesOnSatCruncher&&(selectSat(settingsManager.socratesOnSatCruncher),settingsManager.socratesOnSatCruncher=null),(sensorManager.checkSensorSelected()||settingsManager.isForceColorScheme)&&(isDragging||p.setColorScheme(settingsManager.currentColorScheme,!0)),settingsManager.cruncherReady||($("#version-info").html(settingsManager.versionNumber),$("#version-info").tooltip({delay:50,html:settingsManager.versionDate,position:"top"}),""!==S&&$("#menu-satellite-collision").hide(),$("body").attr("style","background:black"),$("#canvas-holder").attr("style","display:block"),mobile.checkMobileMode(),settingsManager.isMobileModeEnabled?($("#mobile-start-button").show(),$("#spinner").hide(),$("#loader-text").html("")):settingsManager.trusatMode?setTimeout(function(){$("#loading-screen").removeClass("full-loader"),$("#loading-screen").addClass("mini-loader-container"),$("#logo-inner-container").addClass("mini-loader"),$("#logo-text").html(""),$("#logo-trusat").hide(),$("#loader-text").html("Attempting to Math..."),$("#loading-screen").fadeOut()},5e3):($("#loading-screen").removeClass("full-loader"),$("#loading-screen").addClass("mini-loader-container"),$("#logo-inner-container").addClass("mini-loader"),$("#logo-text").html(""),$("#logo-trusat").hide(),$("#loader-text").html("Attempting to Math..."),$("#loading-screen").fadeOut()),p.setColorScheme(settingsManager.currentColorScheme),settingsManager.cruncherReady=!0,p.onCruncherReady(),function(){let e=settingsManager.offline?null:JSON.parse(localStorage.getItem("currentSensor"));if(null!==e)try{void 0===e[0]||null==e[0]?sensorManager.setSensor(null,e[1]):void 0===e[0].shortName?sensorManager.setSensor(e[0],e[1]):sensorManager.setSensor(sensorManager.sensorList[e[0].shortName],e[1])}catch(e){console.warn("Saved Sensor Information Invalid")}}(),function(){var e=settingsManager.offline?null:localStorage.getItem("watchlistList");if(null!==e){var t=JSON.parse(e);watchlistInViewList=[];for(var a=0;a<t.length;a++){var i=p.getSatExtraOnly(p.getIdFromObjNum(t[a]));if(null===i)return void console.error("Watchlist File Format Incorret");t[a]=i.id,watchlistInViewList.push(!1)}uiManager.updateWatchlist(t,watchlistInViewList)}}(),$(window).width()>$(window).height()?(settingsManager.mapHeight=$(window).width(),$("#map-image").width(settingsManager.mapHeight),settingsManager.mapHeight=3*settingsManager.mapHeight/4,$("#map-image").height(settingsManager.mapHeight),$("#map-menu").width($(window).width())):(settingsManager.mapHeight=$(window).height()-100,$("#map-image").height(settingsManager.mapHeight),settingsManager.mapHeight=4*settingsManager.mapHeight/3,$("#map-image").width(settingsManager.mapHeight),$("#map-menu").width($(window).width())))}),p.changeShaders=(t=>{switch(gl.detachShader(e,w),gl.detachShader(e,A),t){case"var":gl.shaderSource(w,shaderLoader.getShaderCode("dot-vertex-var.glsl"));break;case 12:gl.shaderSource(w,shaderLoader.getShaderCode("dot-vertex-12.glsl"));break;case 6:gl.shaderSource(w,shaderLoader.getShaderCode("dot-vertex-6.glsl"));break;case 2:gl.shaderSource(w,shaderLoader.getShaderCode("dot-vertex-2.glsl"))}gl.compileShader(w),gl.shaderSource(A,shaderLoader.getShaderCode("dot-fragment.glsl")),gl.compileShader(A),gl.attachShader(e,w),gl.attachShader(e,A),gl.linkProgram(e),e.aPos=gl.getAttribLocation(e,"aPos"),e.aColor=gl.getAttribLocation(e,"aColor"),e.uMvMatrix=gl.getUniformLocation(e,"uMvMatrix"),e.uCamMatrix=gl.getUniformLocation(e,"uCamMatrix"),e.uPMatrix=gl.getUniformLocation(e,"uPMatrix")}),p.init=(a=>{if(db.log("satSet.init"),function(){for(var e=window.location.search.substring(1).split("&"),t=0;t<e.length;t++){"vertShadersSize"===e[t].split("=")[0]&&(settingsManager.vertShadersSize=6,document.getElementById("settings-shaders").checked=!0)}}(),e=gl.createProgram(),w=gl.createShader(gl.VERTEX_SHADER),gl.shaderSource(w,shaderLoader.getShaderCode("dot-vertex-var.glsl")),gl.compileShader(w),A=gl.createShader(gl.FRAGMENT_SHADER),gl.shaderSource(A,shaderLoader.getShaderCode("dot-fragment.glsl")),gl.compileShader(A),gl.attachShader(e,w),gl.attachShader(e,A),gl.linkProgram(e),e.aPos=gl.getAttribLocation(e,"aPos"),e.aColor=gl.getAttribLocation(e,"aColor"),e.uMvMatrix=gl.getUniformLocation(e,"uMvMatrix"),e.uCamMatrix=gl.getUniformLocation(e,"uCamMatrix"),e.uPMatrix=gl.getUniformLocation(e,"uPMatrix"),settingsManager.offline)n(jsTLEfile),jsTLEfile=null;else{var i=settingsManager.tleSource;$.get(i+"?v="+settingsManager.versionNumber).done(function(e){n(e)}).fail(function(){$.getScript("/offline/tle.js",function(){n(jsTLEfile)})}),jsTLEfile=null}function n(e){var i,l,g,h,d,u,M,f,v,L=[];if("undefined"!=typeof trusatList||!settingsManager.trusatMode||settingsManager.trusatOnly){!function(){for(var e=window.location.search.substring(1).split("&"),t=0;t<e.length;t++){var a=e[t].split("=")[0],s=e[t].split("=")[1];switch(a){case"limitSats":S=s,$("#limitSats").val(s),$("#limitSats-Label").addClass("active"),L=s.split(",");break;case"lat":s>=-90&&s<=90&&(i=s);break;case"long":s>=-180&&s<=360&&(l=s);break;case"hei":s>=-20&&s<=20&&(g=s);break;case"minaz":s>=0&&s<=360&&(h=s);break;case"maxaz":s>=0&&s<=360&&(d=s);break;case"minel":s>=-10&&s<=180&&(u=s);break;case"maxel":s>=-10&&s<=180&&(M=s);break;case"minrange":s>=0&&(f=s);break;case"maxrange":s<=1e7&&(v=s)}}}(),c=function(t){var a,i,r=[];null==t[0]&&(S="");for(var n=0;n<e.length;n++)if(e[n].SCC_NUM=F(e[n].TLE1.substr(2,5).trim(),5),""!==S)for(var o=0;o<t.length;o++)e[n].SCC_NUM===t[o]&&(""===(a=e[n].TLE1.substr(9,8).trim().substring(0,2))?e[n].intlDes="none":(a=(a>50?"19":"20")+a,i=e[n].TLE1.substr(9,8).trim().substring(2),e[n].intlDes=a+"-"+i),e[n].id=n,e[n].active=!0,r.push(e[n]));else""===(a=e[n].TLE1.substr(9,8).trim().substring(0,2))?e[n].intlDes="none":(a=(a>50?"19":"20")+a,i=e[n].TLE1.substr(9,8).trim().substring(2),e[n].intlDes=a+"-"+i),e[n].id=n,e[n].active=!0,r.push(e[n]);var l=!1;if("undefined"!=typeof satelliteList&&settingsManager.offline){for(s=0;s<satelliteList.length;s++){for(l=!1,n=0;n<r.length;n++)if(void 0!=satelliteList[s].SCC&&void 0!=satelliteList[s].TLE1&&void 0!=satelliteList[s].TLE2&&r[n].SCC_NUM===satelliteList[s].SCC){r[n].ON=satelliteList[s].ON,r[n].OT=void 0!==satelliteList[s].OT?satelliteList[s].OT:null,r[n].TLE1=satelliteList[s].TLE1,r[n].TLE2=satelliteList[s].TLE2,l=!0;break}if(!l){if(void 0==satelliteList[s].TLE1)continue;if(void 0==satelliteList[s].TLE2)continue;void 0===satelliteList[s].ON&&(satelliteList[s].ON="Unknown"),void 0===satelliteList[s].OT&&(satelliteList[s].OT=null),a=((a=satelliteList[s].TLE1.substr(9,8).trim().substring(0,2))>50?"19":"20")+a,i=satelliteList[s].TLE1.substr(9,8).trim().substring(2),extrasSatInfo={static:!1,missile:!1,active:!1,ON:satelliteList[s].ON,OT:satelliteList[s].OT,C:"Unknown",LV:"Unknown",LS:"Unknown",SCC_NUM:satelliteList[s].SCC.toString(),TLE1:satelliteList[s].TLE1,TLE2:satelliteList[s].TLE2,intlDes:a+"-"+i,type:"sat",id:r.length},r.push(extrasSatInfo)}}satelliteList=null}if("undefined"!=typeof satInfoList&&settingsManager.offline){for(s=0;s<satInfoList.length;s++)for(l=!1,n=s;n<r.length;n++)if(satInfoList[s].SCC===r[n].SCC_NUM){r[n].ON=satInfoList[s].ON,r[n].C=satInfoList[s].C,r[n].LV=satInfoList[s].LV,r[n].LS=satInfoList[s].LS,r[n].URL=satInfoList[s].URL,l=!0;break}satInfoList=null}if("undefined"!=typeof trusatList&&settingsManager.trusatMode){for(s=0;s<trusatList.length;s++)void 0!=trusatList[s].TLE1&&void 0!=trusatList[s].TLE2&&(void 0===trusatList[s].ON&&(trusatList[s].ON="Unknown"),void 0===trusatList[s].OT&&(trusatList[s].OT=null),a=((a=trusatList[s].TLE1.substr(9,8).trim().substring(0,2))>50?"19":"20")+a,i=trusatList[s].TLE1.substr(9,8).trim().substring(2),scc=F(parseInt(trusatList[s].TLE1.substr(2,5).trim()).toString(),5),extrasSatInfo={static:!1,missile:!1,active:!0,trusat:!0,ON:trusatList[s].ON,OT:4,C:"Unknown",LV:"Unknown",LS:"Unknown",SCC_NUM:`T${scc.toString()}`,TLE1:trusatList[s].TLE1,TLE2:trusatList[s].TLE2,intlDes:a+"-"+i,type:"sat",id:r.length},r.push(extrasSatInfo));trusatList=null}for(p.orbitalSats=r.length,loggerStop=Date.now(),n=0;n<objectManager.staticSet.length;n++)r.push(objectManager.staticSet[n]);for(n=0;n<objectManager.analSatSet.length;n++)objectManager.analSatSet[n].id=r.length,r.push(objectManager.analSatSet[n]);for(n=0;n<objectManager.missileSet.length;n++)r.push(objectManager.missileSet[n]);for(p.missileSats=r.length,n=0;n<objectManager.fieldOfViewSet.length;n++)objectManager.fieldOfViewSet[n].id=r.length,r.push(objectManager.fieldOfViewSet[n]);return r}(L),e=null,p.satDataString=JSON.stringify(c),timeManager.propRealTime=Date.now(),void 0!==i&&void 0!==l&&void 0!==g&&void 0!==h&&void 0!==d&&void 0!==u&&void 0!==M&&void 0!==f&&void 0!==v&&(satellite.setobs({lat:i,long:l,obshei:g,obsminaz:h,obsmaxaz:d,obsminel:u,obsmaxel:M,obsminrange:f,obsmaxrange:v}),m.postMessage({typ:"offset",dat:timeManager.propOffset.toString()+" "+timeManager.propRate.toString(),setlatlong:!0,lat:i,long:l,obshei:g,obsminaz:h,obsmaxaz:d,obsminel:u,obsmaxel:M,obsminrange:f,obsmaxrange:v})),m.postMessage({typ:"satdata",dat:p.satDataString,fieldOfViewSetLength:objectManager.fieldOfViewSet.length,isLowPerf:settingsManager.lowPerf}),t=gl.createBuffer(),o=new Float32Array(3*c.length);var b=[];r=gl.createBuffer();for(var C=0;C<c.length;C++){var w=C+1&255,A=(C+1&65280)>>8,T=(C+1&16711680)>>16;b.push(w/255),b.push(A/255),b.push(T/255)}if(gl.bindBuffer(gl.ARRAY_BUFFER,r),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(b),gl.STATIC_DRAW),p.numSats=c.length,p.setColorScheme(ColorScheme.default,!0),settingsManager.shadersReady=!0,a&&(a(c),!settingsManager.trusatOnly))try{void 0===p.getSat(p.getIdFromObjNum(694)).vmag&&satVmagManager.init()}catch(e){console.debug("satVmagManager Not Loaded")}}else $.getScript("/tle/trusat.js",function(){n(e)})}}),p.getSatData=(()=>(db.log("satSet.getSatData"),c)),p.getSatInView=(()=>(db.log("satSet.getSatInView"),void 0!==g&&g)),p.getSatInSun=(()=>(db.log("satSet.getSatInSun"),void 0!==h&&h)),p.getSatVel=(()=>(db.log("satSet.getSatVel"),void 0!==l&&l)),p.setColorScheme=((e,t)=>{db.log("satSet.setColorScheme"),settingsManager.currentColorScheme=e,i=e.calculateColorBuffers(t),a=i.colorBuf,n=i.pickableBuf});var R;p.draw=((i,s,g)=>{if(settingsManager.shadersReady&&settingsManager.cruncherReady){if(v=Math.max(timeManager.propRate,.001),L=Math.min((g-T)/1e3,1/v),L*=timeManager.propRate,p.satDataLenInDraw=c.length,!settingsManager.lowPerf&&L>settingsManager.minimumDrawDt){if(settingsManager.isSatOverflyModeOn||settingsManager.isFOVBubbleModeOn)for(p.satDataLenInDraw*=3,b=0;b<p.satDataLenInDraw;b++)0!=l[b]&&(o[b]+=l[b]*L);else for(p.satDataLenInDraw-=settingsManager.maxFieldOfViewMarkers,b=0;b<3*p.satDataLenInDraw;b++)0!=l[b]&&(o[b]+=l[b]*L);T=g}gl.useProgram(e),gl.bindFramebuffer(gl.FRAMEBUFFER,null),gl.uniformMatrix4fv(e.uMvMatrix,!1,M),gl.uniformMatrix4fv(e.uCamMatrix,!1,s),gl.uniformMatrix4fv(e.uPMatrix,!1,i),gl.bindBuffer(gl.ARRAY_BUFFER,t),gl.bufferData(gl.ARRAY_BUFFER,o,gl.STREAM_DRAW),gl.vertexAttribPointer(e.aPos,3,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,a),gl.enableVertexAttribArray(e.aColor),gl.vertexAttribPointer(e.aColor,4,gl.FLOAT,!1,0,0),gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA),gl.enable(gl.BLEND),gl.depthMask(!1),gl.drawArrays(gl.POINTS,0,c.length),gl.depthMask(!0),gl.disable(gl.BLEND);try{gl.useProgram(gl.pickShaderProgram),gl.bindFramebuffer(gl.FRAMEBUFFER,gl.pickFb),gl.uniformMatrix4fv(gl.pickShaderProgram.uMvMatrix,!1,M),gl.uniformMatrix4fv(gl.pickShaderProgram.uCamMatrix,!1,s),gl.uniformMatrix4fv(gl.pickShaderProgram.uPMatrix,!1,i),gl.enableVertexAttribArray(gl.pickShaderProgram.aColor),gl.bindBuffer(gl.ARRAY_BUFFER,r),gl.vertexAttribPointer(gl.pickShaderProgram.aColor,3,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,n),gl.enableVertexAttribArray(gl.pickShaderProgram.aPickable),gl.vertexAttribPointer(gl.pickShaderProgram.aPickable,1,gl.FLOAT,!1,0,0),gl.drawArrays(gl.POINTS,0,c.length)}catch(e){db.log(`satData.length: ${c.length}`),db.log(e)}return!0}}),p.setSat=((e,t)=>{if(!c)return null;c[e]=t}),p.mergeSat=(e=>{if(!c)return null;var t=p.getIdFromObjNum(e.SCC);c[t].ON=e.ON,c[t].C=e.C,c[t].LV=e.LV,c[t].LS=e.LS,c[t].R=e.R,c[t].URL=e.URL,c[t].NOTES=e.NOTES,c[t].TTP=e.TTP,c[t].FMISSED=e.FMISSED,c[t].ORPO=e.ORPO,c[t].constellation=e.constellation,c[t].associates=e.associates,c[t].maneuver=e.maneuver}),p.vmagUpdate=(e=>{if(!c)return null;var t=p.getIdFromObjNum(e.satid);try{c[t].vmag=e.vmag}catch(e){}}),p.getSat=(e=>(db.log("satSet.getSat",!0),c&&c[e]?(E&&(c[e].inViewChange=!1,void 0!==g&&void 0!==g[e]?(c[e].inview!==g[e]&&(c[e].inViewChange=!0),c[e].inview=g[e]):(c[e].inview=!1,c[e].inViewChange=!1),void 0!==h&&void 0!==h[e]&&(c[e].inSun!==h[e]&&(c[e].inSunChange=!0),c[e].inSun=h[e]),c[e].velocity=Math.sqrt(l[3*e]*l[3*e]+l[3*e+1]*l[3*e+1]+l[3*e+2]*l[3*e+2]),c[e].velocityX=l[3*e],c[e].velocityY=l[3*e+1],c[e].velocityZ=l[3*e+2],c[e].position={x:o[3*e],y:o[3*e+1],z:o[3*e+2]}),new x(c[e])):null)),p.getSatInViewOnly=(e=>c&&c[e]?(c[e].inview=g[e],new x(c[e])):null),p.getSatPosOnly=(e=>{if(!c)return null;if(!c[e])return null;return E&&(c[e].position={x:o[3*e],y:o[3*e+1],z:o[3*e+2]}),new x(c[e])}),p.getSatExtraOnly=(e=>c&&c[e]?new x(c[e]):null),p.getSatFromObjNum=(e=>{let t=p.getIdFromObjNum(e);return p.getSat(t)});class x{constructor(e){this.inSun=e.inSun,this.inSunChange=e.inSunChange,this.inview=e.inview,this.inView=e.inView,this.inViewChange=e.inViewChange,this.position=e.position,this.velocity=e.velocity,this.velocityX=e.velocityX,this.velocityY=e.velocityY,this.velocityZ=e.velocityZ,this.C=e.C,this.LS=e.LS,this.LV=e.LV,this.ON=e.ON,this.OT=e.OT,this.R=e.R,this.SCC_NUM=e.SCC_NUM,this.TLE1=e.TLE1,this.TLE2=e.TLE2,this.active=e.active,this.apogee=e.apogee,this.argPe=e.argPe,this.eccentricity=e.eccentricity,this.id=e.id,this.inclination=e.inclination,this.intlDes=e.intlDes,this.meanMotion=e.meanMotion,this.perigee=e.perigee,this.period=e.period,this.raan=e.raan,this.semiMajorAxis=e.semiMajorAxis,this.semiMinorAxis=e.semiMinorAxis,this.alt=e.alt,this.lat=e.lat,this.lon=e.lon,this.linkAEHF=e.linkAEHF,this.linkBeidou=e.linkBeidou,this.linkGPS=e.linkGPS,this.linkGalileo=e.linkGalileo,this.linkGlonass=e.linkGlonass,this.linkWGS=e.linkWGS,this.name=e.name,this.static=e.static,this.staticNum=e.staticNum,this.type=e.type,this.typeExt=e.typeExt,this.ra=e.ra,this.dec=e.dec}get isInSun(){let e=sun.getXYZ(),t=Math.asin(RADIUS_OF_EARTH/Math.sqrt(Math.pow(-this.position.x,2)+Math.pow(-this.position.y,2)+Math.pow(-this.position.z,2)))*u,a=Math.asin(RADIUS_OF_SUN/Math.sqrt(Math.pow(-this.position.x+e.x,2)+Math.pow(-this.position.y+e.y,2)+Math.pow(-this.position.z+e.z,2)))*u,i=Math.acos(numeric.dot([-this.position.x,-this.position.y,-this.position.z],[-this.position.x+e.x,-this.position.y+e.y,-this.position.z+e.z])/(Math.sqrt(Math.pow(-this.position.x,2)+Math.pow(-this.position.y,2)+Math.pow(-this.position.z,2))*Math.sqrt(Math.pow(-this.position.x+e.x,2)+Math.pow(-this.position.y+e.y,2)+Math.pow(-this.position.z+e.z,2))))*u;return t>a&&i<t-a?0:Math.abs(t-a)<i&&i<t+a?1:a>t?1:i<a-t?1:2}getTEARR(e,t){let a={};if(void 0===t&&(t=sensorManager.currentSensor),void 0===t.observerGd){try{t.observerGd={height:t.obshei,latitude:t.lat,longitude:t.long}}catch(e){throw"observerGd is not set and could not be guessed."}if(void 0===t.observerGd.longitude)try{t.observerGd={height:t.alt,latitude:t.lat*DEG2RAD,longitude:t.lon*DEG2RAD}}catch(e){throw"observerGd is not set and could not be guessed."}}let i,s=satellite.twoline2satrec(this.TLE1,this.TLE2);i=void 0!==e?e:timeManager.propTime();let r=timeManager.jday(i.getUTCFullYear(),i.getUTCMonth()+1,i.getUTCDate(),i.getUTCHours(),i.getUTCMinutes(),i.getUTCSeconds());r+=i.getUTCMilliseconds()*MILLISECONDS_PER_DAY;let n=satellite.gstime(r),o=(r-s.jdsatepoch)*MINUTES_PER_DAY,l=satellite.sgp4(s,o);try{let e=satellite.eciToGeodetic(l.position,n);a.alt=e.height,a.lon=e.longitude,a.lat=e.latitude;let i=satellite.eciToEcf(l.position,n),s=satellite.ecfToLookAngles(t.observerGd,i);a.azimuth=s.azimuth*u,a.elevation=s.elevation*u,a.range=s.rangeSat}catch(e){a.alt=0,a.lon=0,a.lat=0,a.azimuth=0,a.elevation=0,a.range=0}return a.inview=satellite.checkIsInFOV(t,{az:a.azimuth,el:a.elevation,range:a.range}),uiManager.currentTEARR=a,a}getDirection(){let e=this.getTEARR().lat*u,t=timeManager.propTimeCheck(5e3,timeManager.propTime()),a=this.getTEARR(t).lat*u;if(e<a)return"N";if(e>a)return"S";if(e===a){if(t=timeManager.propTimeCheck(2e4,timeManager.propTime()),futureTEARR=this.getTEARR(t),e<a)return"N";if(e>a)return"S"}return console.warn("Sat Direction Calculation Error - By Pole?"),"Error"}}function F(e,t){return e.length<t?F("0"+e,t):e}p.getIdFromObjNum=(e=>{for(var t,a=0;a<c.length;a++)if(!c[a].static&&!c[a].missile&&(t=parseInt(c[a].SCC_NUM),parseInt(e)===t))return a;return null}),p.getIdFromIntlDes=(e=>{for(var t=0;t<c.length;t++)if(c[t].intlDes===e)return t;return null}),p.getIdFromStarName=(e=>{for(var t=0;t<c.length;t++)if("Star"===c[t].type&&c[t].name===e)return t;return null}),p.getIdFromSensorName=(e=>{if(void 0!==e)for(var t=0;t<c.length;t++)if(!0===c[t].static&&!0!==c[t].missile&&"Star"!==c[t].type&&c[t].name===e)return t;try{var a=timeManager.propTime(),i=timeManager.jday(a.getUTCFullYear(),a.getUTCMonth()+1,a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds());i+=1.15741e-8*a.getUTCMilliseconds();var s=satellite.gstime(i);cosLat=Math.cos(sensorManager.currentSensor.lat*DEG2RAD),sinLat=Math.sin(sensorManager.currentSensor.lat*DEG2RAD),cosLon=Math.cos(sensorManager.currentSensor.long*DEG2RAD+s),sinLon=Math.sin(sensorManager.currentSensor.long*DEG2RAD+s);var r={position:{},name:"Custom Sensor"};return r.position.x=(6371.25+sensorManager.currentSensor.obshei)*cosLat*cosLon,r.position.y=(6371.25+sensorManager.currentSensor.obshei)*cosLat*sinLon,r.position.z=(6371.25+sensorManager.currentSensor.obshei)*sinLat,r}catch(e){return console.log(e),null}}),p.getScreenCoords=((e,t,a,i)=>{satScreenPositionArray.error=!1,i||(i=p.getSatPosOnly(e).position),R=vec4.fromValues(i.x,i.y,i.z,1),vec4.transformMat4(R,R,a),vec4.transformMat4(R,R,t),satScreenPositionArray.x=R[0]/R[3],satScreenPositionArray.y=R[1]/R[3],satScreenPositionArray.z=R[2]/R[3],satScreenPositionArray.x=.5*(satScreenPositionArray.x+1)*window.innerWidth,satScreenPositionArray.y=.5*(1-satScreenPositionArray.y)*window.innerHeight,satScreenPositionArray.x>=0&&satScreenPositionArray.y>=0&&satScreenPositionArray.z>=0&&satScreenPositionArray.z<=1||(satScreenPositionArray.error=!0)}),p.searchNameRegex=(e=>{for(var t=[],a=0;a<c.length;a++)e.test(c[a].ON)&&t.push(a);return t}),p.searchCountryRegex=(e=>{for(var t=[],a=0;a<c.length;a++)e.test(c[a].C)&&t.push(a);return t}),p.searchAzElRange=((e,t,a,i,s,r,n,o,l,g,h)=>{var d=!isNaN(parseFloat(e))&&isFinite(e),m=!isNaN(parseFloat(t))&&isFinite(t),S=!isNaN(parseFloat(a))&&isFinite(a),p=!isNaN(parseFloat(i))&&isFinite(i),M=!isNaN(parseFloat(l))&&isFinite(l),f=!isNaN(parseFloat(s))&&isFinite(s),v=!isNaN(parseFloat(r))&&isFinite(r),L=!isNaN(parseFloat(n))&&isFinite(n),b=!isNaN(parseFloat(o))&&isFinite(o),C=!isNaN(parseFloat(g))&&isFinite(g);if(h*=1,m||S||d||p||M){f||(s=5),v||(r=5),L||(n=200),b||(o=1),C||(g=.5);for(var w=[],A=0,T=0;T<c.length;T++)c[T].static||c[T].missile||!c[T].active||(w.push(c[T]),satellite.getTEARR(w[A]),w[A].azimuth=uiManager.currentTEARR.azimuth,w[A].elevation=uiManager.currentTEARR.elevation,w[A].range=uiManager.currentTEARR.range,w[A].inview=uiManager.currentTEARR.inview,A++);if(p||M||(w=function(e){for(var t=[],a=0;a<e.length;a++)e[a].inview&&t.push(e[a]);return t}(w)),0!==h&&(w=function(e){for(var t=[],a=0;a<e.length;a++)e[a].OT===h&&t.push(e[a]);return t}(w)),d)w=function(e,t,a){for(var i=[],s=0;s<e.length;s++)e[s].azimuth<a&&e[s].azimuth>t&&i.push(e[s]);return i}(w,(e*=1)-(s*=1),e+s);if(m)w=function(e,t,a){for(var i=[],s=0;s<e.length;s++)e[s].elevation<a&&e[s].elevation>t&&i.push(e[s]);return i}(w,(t*=1)-(r*=1),t+r);if(S)w=function(e,t,a){for(var i=[],s=0;s<e.length;s++)e[s].range<a&&e[s].range>t&&i.push(e[s]);return i}(w,(a*=1)-(n*=1),a+n);if(p)w=function(e,t,a){for(var i=[],s=0;s<e.length;s++)(e[s].inclination*u).toFixed(2)<a&&(e[s].inclination*u).toFixed(2)>t&&i.push(e[s]);return i}(w,(i*=1)-(o*=1),i+o);if(M)w=function(e,t,a){for(var i=[],s=0;s<e.length;s++)e[s].period<a&&e[s].period>t&&i.length<=200&&i.push(e[s]);i.length>=200&&$("#findByLooks-results").text("Limited to 200 Results!");return i}(w,(l*=1)-(g*=1),l+g);var y=[];for(T=0;T<w.length;T++)T<w.length-1?$("#search").val($("#search").val()+w[T].SCC_NUM+","):$("#search").val($("#search").val()+w[T].SCC_NUM),y.push(w[T].SCC_NUM);return searchBox.doSearch($("#search").val()),w}}),p.exportTle2Csv=(()=>{let e=[],t=p.getSatData();t.sort((e,t)=>parseInt(e.SCC_NUM)-parseInt(t.SCC_NUM));for(let a=0;a<t.length;a++){let i=t[a];void 0!==i.TLE1&&void 0!==i.TLE2&&("ANALSAT"!=i.C&&e.push({satId:i.SCC_NUM,TLE1:i.TLE1,TLE2:i.TLE2,inclination:i.inclination,eccentricity:i.eccentricity,period:i.period,raan:i.raan,apogee:i.apogee,perigee:i.perigee,site:i.LS,country:i.C,name:i.ON,rocket:i.LV}))}saveCsv(e,"catalogTLE2")}),p.exportTle2Txt=(()=>{let e=[],t=p.getSatData();t.sort((e,t)=>parseInt(e.SCC_NUM)-parseInt(t.SCC_NUM));for(let a=0;a<t.length;a++){let i=t[a];void 0!==i.TLE1&&void 0!==i.TLE2&&("ANALSAT"!=i.C&&(e.push(i.TLE1),e.push(i.TLE2)))}e=e.join("\n");var a=new Blob([e],{type:"text/plain;charset=utf-8"});saveAs(a,"TLE.txt")}),p.setHover=(e=>{e!==f&&(gl.bindBuffer(gl.ARRAY_BUFFER,a),-1!==f&&gl.bufferSubData(gl.ARRAY_BUFFER,4*f*4,new Float32Array(settingsManager.currentColorScheme.colorizer(p.getSat(f)).color)),-1!==e&&gl.bufferSubData(gl.ARRAY_BUFFER,4*e*4,new Float32Array(settingsManager.hoverColor)),f=e)}),p.selectSat=(e=>{e!==selectedSat&&(isAnalysisMenuOpen&&-1!=e&&$("#anal-sat").val(p.getSat(e).SCC_NUM),adviceList.satelliteSelected(),m.postMessage({satelliteSelected:[e]}),settingsManager.isMobileModeEnabled&&mobile.searchToggle(!1),gl.bindBuffer(gl.ARRAY_BUFFER,a),-1!==selectedSat&&gl.bufferSubData(gl.ARRAY_BUFFER,4*selectedSat*4,new Float32Array(settingsManager.currentColorScheme.colorizer(p.getSat(selectedSat)).color)),-1!==e&&(isSatView=!0,gl.bufferSubData(gl.ARRAY_BUFFER,4*e*4,new Float32Array(settingsManager.selectedColor))),selectedSat=e,sensorManager.checkSensorSelected()&&$("#menu-lookangles").removeClass("bmenu-item-disabled"),$("#menu-lookanglesmultisite").removeClass("bmenu-item-disabled"),$("#menu-satview").removeClass("bmenu-item-disabled"),$("#menu-map").removeClass("bmenu-item-disabled"),$("#menu-editSat").removeClass("bmenu-item-disabled"),$("#menu-sat-fov").removeClass("bmenu-item-disabled"),$("#menu-newLaunch").removeClass("bmenu-item-disabled"),$("#menu-breakup").removeClass("bmenu-item-disabled"))}),p.onCruncherReady=(()=>{db.log("satSet.onCruncherReady",!0);for(var e=window.location.search.substring(1).split("&"),t=0;t<e.length;t++){var a=e[t].split("=")[0],i=e[t].split("=")[1];switch(a){case"intldes":var s=p.getIdFromIntlDes(i.toUpperCase());null!==s&&selectSat(s);break;case"search":searchBox.doSearch(i),$("#search").val(i);break;case"rate":i=Math.min(i,1e3),i=Math.max(i,0),timeManager.propRate=Number(i),m.postMessage({typ:"offset",dat:timeManager.propOffset.toString()+" "+timeManager.propRate.toString()});break;case"hrs":timeManager.propOffset=3600*Number(i)*1e3,m.postMessage({typ:"offset",dat:timeManager.propOffset.toString()+" "+timeManager.propRate.toString()})}}searchBox.init(c),p.satDataString=null}),window.satSet=p,window.satCruncher=m,window.satPos=o}();