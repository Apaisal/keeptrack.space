!function(){const e=2*Math.PI,t=e/360,a=360/e,s=1440,r=1.15741e-8;var i,o,n,l,u,g,d;satellite.lookanglesInterval=5,satellite.lookanglesLength=2,satellite.isRiseSetLookangles=!1,satellite.currentSensor={},satellite.tempSensor={},satellite.currentTEARR={},satellite.defaultSensor={},satellite.defaultSensor.observerGd={lat:null,longitude:0,latitude:0,height:0},satellite.currentSensor=satellite.defaultSensor,satellite.sensorListUS=[window.sensorManager.sensorList.COD,window.sensorManager.sensorList.BLE,window.sensorManager.sensorList.CAV,window.sensorManager.sensorList.CLR,window.sensorManager.sensorList.EGL,window.sensorManager.sensorList.FYL,window.sensorManager.sensorList.THL,window.sensorManager.sensorList.MIL,window.sensorManager.sensorList.ALT,window.sensorManager.sensorList.ASC,window.sensorManager.sensorList.CDN],satellite.checkSensorSelected=(()=>null!=satellite.currentSensor.lat),satellite.currentEpoch=(e=>{let t=(e=new Date(e)).getUTCFullYear();t=parseInt(t.toString().substr(2,2));let a=s(timeManager.getDayOfYear(e),3);function s(e,t){return e.length<t?s("0"+e,t):e}return[t,a=s(a=(a+(60*e.getUTCHours()+e.getUTCMinutes())/1440).toFixed(8),12)]}),satellite.distance=((e,t)=>{if(null==t||null==e)return"";if("Star"===t.type||"Star"===e.type)return"";let a=Math.pow(e.position.x-t.position.x,2),s=Math.pow(e.position.y-t.position.y,2),r=Math.pow(e.position.z-t.position.z,2);return"<br />"+Math.sqrt(a+s+r).toFixed(0)+" km"}),satellite.getsensorinfo=(()=>{$("#sensor-latitude").html(satellite.currentSensor.lat),$("#sensor-longitude").html(satellite.currentSensor.long),$("#sensor-minazimuth").html(satellite.currentSensor.obsminaz),$("#sensor-maxazimuth").html(satellite.currentSensor.obsmaxaz),$("#sensor-minelevation").html(satellite.currentSensor.obsminel),$("#sensor-maxelevation").html(satellite.currentSensor.obsmaxel),$("#sensor-minrange").html(satellite.currentSensor.obsminrange),$("#sensor-maxrange").html(satellite.currentSensor.obsmaxrange)}),satellite.setobs=((e,a)=>{if(a)return satellite.currentSensor=satellite.defaultSensor,void $(".sensor-reset-menu").hide();$("#menu-sensor-info").removeClass("bmenu-item-disabled"),$("#menu-fov-bubble").removeClass("bmenu-item-disabled"),$("#menu-surveillance").removeClass("bmenu-item-disabled"),$("#menu-planetarium").removeClass("bmenu-item-disabled"),$("#menu-astronomy").removeClass("bmenu-item-disabled"),$(".sensor-reset-menu").show(),satellite.currentSensor=e,satellite.currentSensor.observerGd={latitude:e.lat*t,longitude:e.long*t,height:parseFloat(e.obshei)}}),satellite.altitudeCheck=((e,t,a)=>{let i;void 0!==e.TLE1?(a=t,i=satellite.twoline2satrec(e.TLE1,e.TLE2)):i=satellite.twoline2satrec(e,t);let o=timeManager.propTimeCheck(a,timeManager.propRealTime),n=timeManager.jday(o.getUTCFullYear(),o.getUTCMonth()+1,o.getUTCDate(),o.getUTCHours(),o.getUTCMinutes(),o.getUTCSeconds());n+=o.getUTCMilliseconds()*r;let l,u=satellite.gstime(n),g=(n-i.jdsatepoch)*s,d=satellite.sgp4(i,g);try{l=satellite.eciToGeodetic(d.position,u)}catch(e){return 0}return l.height}),satellite.getDirection=(e=>{let t=satellite.getTEARR(e).lat*a,s=timeManager.propTimeCheck(5e3,timeManager.propTime()),r=satellite.getTEARR(e,void 0,s).lat*a;if(t<r)return"N";if(t>r)return"S";if(t===r){if(s=timeManager.propTimeCheck(2e4,timeManager.propTime()),futureTEARR=satellite.getTEARR(e,void 0,s),t<r)return"N";if(t>r)return"S"}return console.warn("Sat Direction Calculation Error - By Pole?"),"Error"}),satellite.getTEARR=((e,i,o)=>{let n={};if(void 0===i){if(void 0===satellite.currentSensor)throw"getTEARR requires a sensor or for a sensor to be currently selected.";i=satellite.currentSensor}if(void 0===i.observerGd){try{i.observerGd={height:i.obshei,latitude:i.lat,longitude:i.long}}catch(e){throw"observerGd is not set and could not be guessed."}if(void 0===i.observerGd.longitude)try{i.observerGd={height:i.alt,latitude:i.lat*t,longitude:i.lon*t}}catch(e){throw"observerGd is not set and could not be guessed."}}let l,u=satellite.twoline2satrec(e.TLE1,e.TLE2);l=void 0!==o?o:timeManager.propTime();let g=timeManager.jday(l.getUTCFullYear(),l.getUTCMonth()+1,l.getUTCDate(),l.getUTCHours(),l.getUTCMinutes(),l.getUTCSeconds());g+=l.getUTCMilliseconds()*r;let d=satellite.gstime(g),c=(g-u.jdsatepoch)*s,m=satellite.sgp4(u,c);try{let e=satellite.eciToGeodetic(m.position,d);n.alt=e.height,n.lon=e.longitude,n.lat=e.latitude;let t=satellite.eciToEcf(m.position,d),s=satellite.ecfToLookAngles(i.observerGd,t);n.azimuth=s.azimuth*a,n.elevation=s.elevation*a,n.range=s.rangeSat}catch(e){n.alt=0,n.lon=0,n.lat=0,n.azimuth=0,n.elevation=0,n.range=0}return i.obsminaz>i.obsmaxaz?(n.azimuth>=i.obsminaz||n.azimuth<=i.obsmaxaz)&&n.elevation>=i.obsminel&&n.elevation<=i.obsmaxel&&n.range<=i.obsmaxrange&&n.range>=i.obsminrange||(n.azimuth>=i.obsminaz2||n.azimuth<=i.obsmaxaz2)&&n.elevation>=i.obsminel2&&n.elevation<=i.obsmaxel2&&n.range<=i.obsmaxrange2&&n.range>=i.obsminrange2?n.inview=!0:n.inview=!1:n.azimuth>=i.obsminaz&&n.azimuth<=i.obsmaxaz&&n.elevation>=i.obsminel&&n.elevation<=i.obsmaxel&&n.range<=i.obsmaxrange&&n.range>=i.obsminrange||n.azimuth>=i.obsminaz2&&n.azimuth<=i.obsmaxaz2&&n.elevation>=i.obsminel2&&n.elevation<=i.obsmaxel2&&n.range<=i.obsmaxrange2&&n.range>=i.obsminrange2?n.inview=!0:n.inview=!1,satellite.currentTEARR=n,n}),satellite.exportTle2Csv=(()=>{let e=[],t=satSet.getSatData();t.sort((e,t)=>parseInt(e.SCC_NUM)-parseInt(t.SCC_NUM));for(let a=0;a<t.length;a++){let s=t[a];void 0!==s.TLE1&&void 0!==s.TLE2&&("ANALSAT"!=s.C&&e.push({satId:s.SCC_NUM,TLE1:s.TLE1,TLE2:s.TLE2,inclination:s.inclination,eccentricity:s.eccentricity,period:s.period,raan:s.raan,apogee:s.apogee,perigee:s.perigee,site:s.LS,country:s.C,name:s.ON,rocket:s.LV}))}saveCsv(e,"catalogTLE2")}),satellite.exportTle2Txt=(()=>{let e=[],t=satSet.getSatData();t.sort((e,t)=>parseInt(e.SCC_NUM)-parseInt(t.SCC_NUM));for(let a=0;a<t.length;a++){let s=t[a];void 0!==s.TLE1&&void 0!==s.TLE2&&("ANALSAT"!=s.C&&(e.push(s.TLE1),e.push(s.TLE2)))}e=e.join("\n");var a=new Blob([e],{type:"text/plain;charset=utf-8"});saveAs(a,"TLE.txt")}),satellite.calculateSatrec=(()=>{let e,t=[];for(let a=0;a<satSet.getSatData().length;a++)sat=satSet.getSat(a),sat.static||sat.missile||!sat.active||(e=satellite.twoline2satrec(sat.TLE1,sat.TLE2),t.push({SCC_NUM:sat.SCC_NUM,satrec:e}));window.satrecCache=t}),satellite.nextpassList=(e=>{let t=[];for(let a=0;a<e.length;a++){let s=satellite.nextNpasses(e[a],void 0,864e5,satellite.lookanglesInterval,settingsManager.nextNPassesCount);for(let r=0;r<s.length;r++)t.push({SCC_NUM:e[a].SCC_NUM,time:s[r]})}return t}),satellite.nextpass=((e,t,a,s)=>{if(void 0===t){if(void 0===satellite.currentSensor)throw"getTEARR requires a sensor or for a sensor to be currently selected.";t=satellite.currentSensor}if(void 0===t.observerGd)try{t.observerGd={height:t.obshei,latitude:t.lat,longitude:t.long}}catch(e){throw"observerGd is not set and could not be guessed."}void 0===a&&(a=satellite.lookanglesLength),void 0===s&&(s=satellite.lookanglesInterval);let r=timeManager.getPropOffset(),i=0,o=satellite.twoline2satrec(e.TLE1,e.TLE2);for(let e=0;e<24*a*60*60;e+=s){i=1e3*e+r;let a=timeManager.propTimeCheck(i,timeManager.propRealTime),s=satellite.getRae(a,o,t);if(satellite.checkIsInFOV(t,s))return timeManager.dateFormat(a,"isoDateTime",!0)}return"No Passes in "+satellite.lookanglesLength+" Days"}),satellite.nextNpasses=((t,a,r,i,o)=>{if(void 0===a){if(void 0===satellite.currentSensor)throw"getTEARR requires a sensor or for a sensor to be currently selected.";a=satellite.currentSensor}if(void 0===a.observerGd)try{a.observerGd={height:a.obshei,latitude:a.lat,longitude:a.long}}catch(e){throw"observerGd is not set and could not be guessed."}void 0===r&&(r=satellite.lookanglesLength),void 0===i&&(i=satellite.lookanglesInterval);let n=[],l=timeManager.getPropOffset(),u=satellite.twoline2satrec(t.TLE1,t.TLE2);const g=s/(u.no*s/e);for(let e=0;e<24*r*60*60;e+=i){if(n.length>=o)return n;let t=e+l,s=timeManager.propTimeCheck(1e3*t,timeManager.propRealTime),r=satellite.getRae(s,u,a);satellite.checkIsInFOV(a,r)&&(n.push(s),e+=60*g*.75)}return n}),satellite.lastlooksArray=[],satellite.getlookangles=(e=>{if(!satellite.checkSensorSelected())return void console.warn("satellite.getlookangles requires a sensor to be set!");let t=timeManager.getPropOffset(),a=satellite.twoline2satrec(e.TLE1,e.TLE2);a.no;let s=satellite.isRiseSetLookangles?1:satellite.lookanglesInterval,r=[];for(let e=0;e<24*satellite.lookanglesLength*60*60;e+=s){let s=i(e+t,a);if(void 0!==s&&r.push(s),r.length>=1500)break}function i(e,t){let a=satellite.currentSensor;var s=Date.now(),r=timeManager.propTimeCheck(1e3*e,s);let i=satellite.getRae(r,t,a);if(satellite.checkIsInFOV(a,i)){if(satellite.isRiseSetLookangles){let e=new Date;if(e.setTime(Number(r)-1e3*satellite.lookanglesInterval),aer1=satellite.getRae(e,t,a),!satellite.checkIsInFOV(a,aer1))return{time:timeManager.dateFormat(r,"isoDateTime",!0),rng:range,az:azimuth,el:elevation};if(e.setTime(Number(r)+1e3*satellite.lookanglesInterval),aer1=satellite.getRae(e,t,a),!satellite.checkIsInFOV(a,aer1))return{time:timeManager.dateFormat(r,"isoDateTime",!0),rng:range,az:azimuth,el:elevation};return}return{time:timeManager.dateFormat(r,"isoDateTime",!0),rng:range,az:azimuth,el:elevation}}}r.sort(function(e,t){return new Date(e.time)-new Date(t.time)}),satellite.lastlooksArray=r,function(){var e=document.getElementById("looks");e.innerHTML="";var t=e.insertRow(),a=t.insertCell();a.appendChild(document.createTextNode("Time")),a.setAttribute("style","text-decoration: underline");var s=t.insertCell();s.appendChild(document.createTextNode("El")),s.setAttribute("style","text-decoration: underline");var i=t.insertCell();i.appendChild(document.createTextNode("Az")),i.setAttribute("style","text-decoration: underline");var o=t.insertCell();o.appendChild(document.createTextNode("Rng")),o.setAttribute("style","text-decoration: underline");for(let t=0;t<r.length;t++){let a;if(e.rows.length>0)for(let s=0;s<e.rows.length;s++){var n=e.rows[s].cells[0].textContent,l=parseInt(n.substr(0,4)),u=parseInt(n.substr(5,2))-1,g=parseInt(n.substr(8,2)),d=parseInt(n.substr(11,2)),c=parseInt(n.substr(14,2)),m=parseInt(n.substr(17,2)),p=new Date(l,u,g,d,c,m);if(p.setUTCDate(g),p.setUTCHours(d),r[t].time<p){a=e.insertRow(t);break}}null==a&&(a=e.insertRow()),a.insertCell().appendChild(document.createTextNode(timeManager.dateFormat(r[t].time,"isoDateTime",!0))),a.insertCell().appendChild(document.createTextNode(r[t].el.toFixed(1))),a.insertCell().appendChild(document.createTextNode(r[t].az.toFixed(0))),a.insertCell().appendChild(document.createTextNode(r[t].rng.toFixed(0)))}}()}),satellite.lastMultiSiteArray=[],satellite.getlookanglesMultiSite=(t=>{let a=!1;satellite.checkSensorSelected()||(a=!0),satellite.tempSensor=satellite.currentSensor;let r=timeManager.getPropOffset(),i=satellite.twoline2satrec(t.TLE1,t.TLE2);const o=s/(i.no*s/e);let n=[];for(let e=0;e<satellite.sensorListUS.length;e++){satellite.setobs(satellite.sensorListUS[e]);for(let t=0;t<24*satellite.lookanglesLength*60*60;t+=satellite.lookanglesInterval){let a=l(t+r,i,satellite.sensorListUS[e]);void 0!==a&&(n.push(a),t+=60*o*.75)}}function l(e,t,a){var s=Date.now(),r=timeManager.propTimeCheck(1e3*e,s);let i=satellite.getRae(r,t,a);if(satellite.checkIsInFOV(a,i))return{time:r,el:elevation,az:azimuth,rng:range,name:a.shortName}}n.sort(function(e,t){return new Date(e.time)-new Date(t.time)}),satellite.lastMultiSiteArray=n,function(){console.log(n);var e=document.getElementById("looksmultisite");e.innerHTML="";var t=e.insertRow(),a=t.insertCell();a.appendChild(document.createTextNode("Time")),a.setAttribute("style","text-decoration: underline");var s=t.insertCell();s.appendChild(document.createTextNode("El")),s.setAttribute("style","text-decoration: underline");var r=t.insertCell();r.appendChild(document.createTextNode("Az")),r.setAttribute("style","text-decoration: underline");var i=t.insertCell();i.appendChild(document.createTextNode("Rng")),i.setAttribute("style","text-decoration: underline");var o=t.insertCell();o.appendChild(document.createTextNode("Sensor")),o.setAttribute("style","text-decoration: underline");for(let t=0;t<n.length;t++){let a;if(e.rows.length>0)for(let s=0;s<e.rows.length;s++){var l=e.rows[s].cells[0].textContent,u=parseInt(l.substr(0,4)),g=parseInt(l.substr(5,2))-1,d=parseInt(l.substr(8,2)),c=parseInt(l.substr(11,2)),m=parseInt(l.substr(14,2)),p=parseInt(l.substr(17,2)),h=new Date(u,g,d,c,m,p);if(h.setUTCDate(d),h.setUTCHours(c),n[t].time<h){a=e.insertRow(t);break}}null==a&&(a=e.insertRow()),a.insertCell().appendChild(document.createTextNode(timeManager.dateFormat(n[t].time,"isoDateTime",!0))),a.insertCell().appendChild(document.createTextNode(n[t].el.toFixed(1))),a.insertCell().appendChild(document.createTextNode(n[t].az.toFixed(0))),a.insertCell().appendChild(document.createTextNode(n[t].rng.toFixed(0))),a.insertCell().appendChild(document.createTextNode(n[t].name))}}(),satellite.currentSensor=a?satellite.defaultSensor:satellite.tempSensor}),satellite.getOrbitByLatLon=((e,t,i,o,n,l,u)=>{var g,d,c,m,p,h,T,b,v,M;for(void 0===u&&(u=0),M=0;M<5200;M+=1){if(1===(T=L(M))){if(v===o){M;break}M+=20}5===T&&(M+=100)}if(2===T)return console.warn("meanACalcResults failed after trying all combinations!"),["Error",""];if(void 0!==l&&0!==l)for(T=0,M=0;M<3600;M+=1){if(1===(h=x(M))){if(1===T&&v===o)break}else console.log("Failed Arg of Per Calc");if(5===h&&(M+=50),2===h)return["Error",""];for(var C=0;C<5200;C+=1){if(1===(T=L(C))){if(v===o)break;C+=20}if(5===T&&(C+=100),2===T)return["Error",""]}}for(M=0;M<52e4;M+=1){var f=w(M,u);if(1===f)break;5===f&&(M+=1e3)}return[g,d];function S(e,t){return e.length<t?S("0"+e,t):e}function x(t){var s,r,i=satellite.twoline2satrec(e.TLE1,e.TLE2);(s=(s=void 0===c?(i.mo*a).toPrecision(10):c).split("."))[0]=s[0].substr(-3,3),s[1]=s[1].substr(0,4),s=S(s=(s[0]+"."+s[1]).toString(),8),(r=(r=void 0===m?(e.raan*a).toPrecision(7):m).split("."))[0]=r[0].substr(-3,3),r[1]=r[1].substr(0,4),r=S(r=(r[0]+"."+r[1]).toString(),8),m=r;var o=e.SCC_NUM,l=e.TLE1.substr(9,8),u=(e.inclination*a).toPrecision(7);(u=u.split("."))[0]=u[0].substr(-3,3),u[1]=u[1].substr(0,4),u=S(u=(u[0]+"."+u[1]).toString(),8);var h=e.TLE1.substr(18,2),T=e.TLE1.substr(20,12),b=e.TLE2.substr(52,11),v=e.eccentricity.toPrecision(7).substr(2,7);t/=10,t=S(t=parseFloat(t).toPrecision(7),8);var M=e.TLE1.substr(32,39);g="1 "+o+"U "+l+" "+h+T+M,d="2 "+o+" "+u+" "+r+" "+v+" "+t+" "+s+" "+b+"    10",i=satellite.twoline2satrec(g,d);var C=z(n,i,3);return e.TLE1=g,e.TLE2=d,p=t,C}function L(t){var s=satellite.twoline2satrec(e.TLE1,e.TLE2);t/=10,t=S(t=parseFloat(t).toPrecision(7),8);var r=(e.raan*a).toPrecision(7);m=r,(r=r.toString().split("."))[0]=r[0].substr(-3,3),r[1]=r[1].substr(0,4),r=S(r=(r[0]+"."+r[1]).toString(),8);var i=e.SCC_NUM,o=e.TLE1.substr(9,8),l=(e.inclination*a).toPrecision(7);(l=l.split("."))[0]=l[0].substr(-3,3),l[1]=l[1].substr(0,4),l=S(l=(l[0]+"."+l[1]).toString(),8);var u,h=e.TLE1.substr(18,2),T=e.TLE1.substr(20,12),b=e.TLE2.substr(52,11),v=e.eccentricity.toPrecision(7).substr(2,7);(u=(u=void 0===p?(e.argPe*a).toPrecision(7):p).split("."))[0]=u[0].substr(-3,3),u[1]=u[1].substr(0,4),u=S(u=(u[0]+"."+u[1]).toString(),8);var M="1 "+i+"U "+o+" "+h+T+e.TLE1.substr(32,39),C="2 "+i+" "+l+" "+r+" "+v+" "+u+" "+t+" "+b+"    10";s=satellite.twoline2satrec(M,C);var f=z(n,s,1);return 1===f&&(g=M,d=C,e.TLE1=M,e.TLE2=C,c=t),f}function w(t,s){var r=satellite.twoline2satrec(e.TLE1,e.TLE2),i=c;rascNum=t,(t/=100)>360&&(t-=360),(t=(t=t.toPrecision(7)).split("."))[0]=t[0].substr(-3,3),t[1]=t[1].substr(0,4),t=S(t=(t[0]+"."+t[1]).toString(),8),m=t;var o=e.SCC_NUM,l=e.TLE1.substr(9,8),u=(e.inclination*a).toPrecision(7);(u=u.split("."))[0]=u[0].substr(-3,3),u[1]=u[1].substr(0,4),u=S(u=(u[0]+"."+u[1]).toString(),8);var h,T=e.TLE1.substr(18,2),b=e.TLE1.substr(20,12),v=e.TLE2.substr(52,11),M=e.eccentricity.toPrecision(7).substr(2,7);(h=(h=void 0===p?(e.argPe*a).toPrecision(7):p).split("."))[0]=h[0].substr(-3,3),h[1]=h[1].substr(0,4),h=S(h=(h[0]+"."+h[1]).toString(),8);var C=e.TLE1.substr(32,39);g="1 "+o+"U "+l+" "+T+b+C,d="2 "+o+" "+u+" "+t+" "+M+" "+h+" "+i+" "+v+"    10",r=satellite.twoline2satrec(g,d);var f=z(n,r,2);return 1===f&&(e.TLE1=g,(t=rascNum/100+s)>360&&(t-=360),t<0&&(t+=360),(t=(t=t.toPrecision(7)).split("."))[0]=t[0].substr(-3,3),t[1]=t[1].substr(0,4),t=S(t=(t[0]+"."+t[1]).toString(),8),m=t,d="2 "+o+" "+u+" "+t+" "+M+" "+h+" "+i+" "+v+"    10",e.TLE2=d),f}function z(e,a,o){timeManager.propRealTime=Date.now();var n=timeManager.propTimeCheck(e,timeManager.propRealTime),u=timeManager.jday(n.getUTCFullYear(),n.getUTCMonth()+1,n.getUTCDate(),n.getUTCHours(),n.getUTCMinutes(),n.getUTCSeconds());u+=n.getUTCMilliseconds()*r;var g,d,c,m,p=satellite.gstime(u),h=(u-a.jdsatepoch)*s,T=satellite.sgp4(a,h);void 0===T&&console.log(a);try{g=satellite.eciToGeodetic(T.position,p)}catch(e){return console.warn(e),2}if(d=1*satellite.degreesLat(g.latitude),c=1*satellite.degreesLong(g.longitude),m=g.height,null==b&&(b=d),1===o){if(d===b)return 0;d>b&&(v="N"),d<b&&(v="S"),b=d}return d>t-.15&&d<t+.15&&1===o?1:c>i-.15&&c<i+.15&&2===o?1:m>l-30&&m<l+30&&3===o?1:(d>t-11&&d<t+11||1!==o)&&(c>i-11&&c<i+11||2!==o)?(m<l-100||m>l+100)&&3===o?5:0:5}}),satellite.calculateLookAngles=((e,a,s)=>{!function(){if(void 0===a){if(!satellite.checkSensorSelected())return void console.error("getlookangles2 requires a sensor!");a=satellite.currentSensor}else{if(void 0===a.obsminaz)return void console.error("sensor format incorrect");a.observerGd={latitude:a.lat*t,longitude:a.long*t,height:parseFloat(a.obshei)}}void 0===e?console.error("sat parameter required!"):void 0!==e.TLE1&&void 0!==e.TLE2||console.error("sat parameter invalid format!"),void 0===s&&(s=0),void 0===satellite.isRiseSetLookangles&&(satellite.isRiseSetLookangles=!1)}(),void 0===s&&(s=0);var r,i=0,o=satellite.twoline2satrec(e.TLE1,e.TLE2),n=[];satellite.isRiseSetLookangles&&(r=satellite.lookanglesInterval,satellite.lookanglesInterval=1);for(var l=0;l<24*satellite.lookanglesLength*60*60;l+=satellite.lookanglesInterval)i=1e3*l+s,n.length<=5e3&&(lookanglesRow=u(i,o),"undefined"!=typeof lookanglesRow&&n.push(lookanglesRow));function u(e,t){let s=new Date;s.setTime(Number(Date.now())+e);let r=satellite.getRae(s,t,a);if(satellite.checkIsInFOV(a,r)){if(satellite.isRiseSetLookangles){var i=new Date;return i.setTime(Number(Date.now())+e-1e3*satellite.lookanglesInterval),aer1=satellite.getRae(i,t,a),isInFOV1=satellite.checkIsInFOV(a,aer1),isInFOV1?(i.setTime(Number(Date.now())+e-1e3*satellite.lookanglesInterval),aer1=satellite.getRae(i,t,a),isInFOV1=satellite.checkIsInFOV(a,aer1),isInFOV1?void 0:{time:timeManager.dateFormat(s,"isoDateTime",!0),rng:range,az:azimuth,el:elevation}):{time:timeManager.dateFormat(s,"isoDateTime",!0),rng:range,az:azimuth,el:elevation}}return{time:timeManager.dateFormat(s,"isoDateTime",!0),rng:range,az:azimuth,el:elevation}}}return satellite.isRiseSetLookangles&&(satellite.lookanglesInterval=r),n}),satellite.findBestPasses=((e,t)=>{for(var a=e.split(","),s=[],r=0;r<a.length;r++)try{for(var i=satSet.getSat(satSet.getIdFromObjNum(a[r])),o=satellite.findBestPass(i,t,0),n=0;n<o.length;n++)s.push(o[n])}catch(e){console.warn(e)}let l=s.sort((e,t)=>t.sortTime-e.sortTime);l.reverse(),l.forEach(function(e){delete e.sortTime});for(r=0;r<l.length;r++)l[r].startDate=l[r].startDate.toISOString().split("T")[0],l[r].startTime=l[r].startTime.toISOString().split("T")[1].split(".")[0],l[r].stopDate=l[r].stopDate.toISOString().split("T")[0],l[r].stopTime=l[r].stopTime.toISOString().split("T")[1].split(".")[0];saveCsv(l,"bestSatTimes")}),satellite.findBestPass=((a,r,i)=>{!function(){if(void 0===r){if(!satellite.checkSensorSelected())return void console.error("getlookangles2 requires a sensor!");r=satellite.currentSensor}else{if(void 0===r.obsminaz)return void console.error("sensor format incorrect");r.observerGd={latitude:r.lat*t,longitude:r.long*t,height:parseFloat(r.obshei)}}void 0===a?console.error("sat parameter required!"):void 0!==a.TLE1&&void 0!==a.TLE2||console.error("sat parameter invalid format!")}(),void 0===i&&(i=0);var o=0,n=satellite.twoline2satrec(a.TLE1,a.TLE2),l=[];looksInterval=5,looksLength=7;for(var u=0,g=null,d=null,c=null,m=null,p=r.obsmaxrange,h=0,T=!1,b=!1,v=s/(n.no*s/e),M=0;M<24*looksLength*60*60;M+=looksInterval)o=1e3*M+i,l.length<=5e3&&(lookanglesRow=C(o,n),"undefined"!=typeof lookanglesRow&&(l.push(lookanglesRow),u=0,g=null,d=null,c=null,m=null,p=r.obsmaxrange,h=0,T=!1,b=!1,M+=60*v*.75));return l;function C(e,t){let a=new Date;a.setTime(Number(Date.now())+e);let s=satellite.getRae(a,t,r);if(satellite.checkIsInFOV(r,s)){let s=new Date;s.setTime(Number(Date.now())+e-1e3*looksInterval),aer1=satellite.getRae(s,t,r);let i=satellite.checkIsInFOV(r,aer1);if(i){if(s.setTime(Number(Date.now())+e+1e3*looksInterval),aer1=satellite.getRae(s,t,r),!(i=satellite.checkIsInFOV(r,aer1))){b=elevation<=3.5,u=Math.min((a-m)/1e3/60*10/8,10);let e=Math.min(h/40*10,10);e-=Math.max((h-50)/5,0),u+=e*=T&&b?2:1,u+=Math.min(9e3/p,10),u-=Math.max((900-p)/10,0);let s=0;try{s=(a-m)/1e3}catch(e){s=0}return{sortTime:m,scc:t.satnum,score:u,startDate:m,startTime:m,startAz:g,startEl:d,startRange:c,stopDate:a,stopTime:a,stopAz:azimuth.toFixed(0),stopEl:elevation.toFixed(1),stopRange:range.toFixed(0),tic:s,minRange:p.toFixed(0),passMaxEl:h.toFixed(1)}}}else elevation<=3.5&&(T=!0),m=a,g=azimuth.toFixed(0),d=elevation.toFixed(1),c=range.toFixed(0);h<elevation&&(h=elevation),p>range&&(p=range)}}}),satellite.getRae=((e,t,d)=>{let c=(i=e.getUTCFullYear(),o=e.getUTCMonth()+1,n=e.getUTCDate(),l=e.getUTCHours(),u=e.getUTCMinutes(),g=e.getUTCSeconds(),i?367*i-Math.floor(7*(i+Math.floor((o+9)/12))*.25)+Math.floor(275*o/9)+n+1721013.5+((g/60+u)/60+l)/24:(e=Date.now(),jDayStart=new Date(e.getFullYear(),0,0),jDayDiff=e-jDayStart,Math.floor(jDayDiff/r)));c+=e.getUTCMilliseconds()*r;let m=satellite.gstime(c),p=(c-t.jdsatepoch)*s,h=satellite.sgp4(t,p),T=satellite.eciToEcf(h.position,m),b=satellite.ecfToLookAngles(d.observerGd,T);return azimuth=b.azimuth*a,elevation=b.elevation*a,range=b.rangeSat,{az:azimuth,el:elevation,range:range}}),satellite.checkIsInFOV=((e,t)=>{let a=t.az,s=t.el,r=t.range;return(!(e.obsminaz<e.obsmaxaz)||a>=e.obsminaz&&a<=e.obsmaxaz&&s>=e.obsminel&&s<=e.obsmaxel&&r<=e.obsmaxrange&&r>=e.obsminrange&&!(a>=e.obsminaz2&&a<=e.obsmaxaz2&&s>=e.obsminel2&&s<=e.obsmaxel2&&r<=e.obsmaxrange2&&r>=e.obsminrange2))&&((a>=e.obsminaz||a<=e.obsmaxaz)&&s>=e.obsminel&&s<=e.obsmaxel&&r<=e.obsmaxrange&&r>=e.obsminrange||(a>=e.obsminaz2||a<=e.obsmaxaz2)&&s>=e.obsminel2&&s<=e.obsmaxel2&&r<=e.obsmaxrange2&&r>=e.obsminrange2)}),satellite.getDOPsTable=((e,t,a)=>{let s,r=document.getElementById("dops");r.innerHTML="";let i=timeManager.getPropOffset(),o=0,n=r.insertRow(),l=n.insertCell();l.appendChild(document.createTextNode("Time"));let u=n.insertCell();u.appendChild(document.createTextNode("HDOP"));let g=n.insertCell();g.appendChild(document.createTextNode("PDOP"));let d=n.insertCell();d.appendChild(document.createTextNode("GDOP"));for(let c=0;c<1440;c++)o=1e3*c*60+i,s=timeManager.propTimeCheck(o,timeManager.propRealTime),dops=satellite.getDOPs(e,t,a,!1,s),(l=(n=r.insertRow()).insertCell()).appendChild(document.createTextNode(timeManager.dateFormat(s,"isoDateTime",!0))),(u=n.insertCell()).appendChild(document.createTextNode(dops.HDOP)),(g=n.insertCell()).appendChild(document.createTextNode(dops.PDOP)),(d=n.insertCell()).appendChild(document.createTextNode(dops.GDOP))}),satellite.getDOPs=((e,s,r,i,o)=>{if(void 0!==e){if(void 0!==s){var n,l;r=void 0!==r?r:0,i=void 0!==i&&i,e*=t,s*=t;var u=[];void 0===groups.GPSGroup&&(groups.GPSGroup=new groups.SatGroup("nameRegex",/NAVSTAR/)),void 0===o&&(o=timeManager.propTime());var g=timeManager.jday(o.getUTCFullYear(),o.getUTCMonth()+1,o.getUTCDate(),o.getUTCHours(),o.getUTCMinutes(),o.getUTCSeconds());g+=1.15741e-8*o.getUTCMilliseconds();var d=satellite.gstime(g),c={},m=Math.cos(e),p=Math.sin(e),h=Math.cos(s+d),T=Math.sin(s+d);c.x=6371.25*m*h,c.y=6371.25*m*T,c.z=6371.25*p;for(var b=0;b<groups.GPSGroup.sats.length;b++)n=satSet.getSat(groups.GPSGroup.sats[b].satId),l=satellite.ecfToLookAngles({longitude:s,latitude:e,height:r},satellite.eciToEcf(n.position,d)),n.az=l.azimuth*a,n.el=l.elevation*a,n.el>settingsManager.gpsElevationMask&&u.push(n);return satellite.calculateDOPs(u,c,i)}console.error("Longitude Required")}else console.error("Latitude Required")}),satellite.calculateDOPs=((e,t,a)=>{var s={};if(nsat=e.length,nsat<4)return s.PDOP=50,s.HDOP=50,s.GDOP=50,s.VDOP=50,s.TDOP=50,s;var r=numeric.rep([nsat,4],0),i=[],o=[];a&&(drawLineList=[]);for(var n=1;n<=nsat;n++){var l=e[n-1];a&&(drawLineList[n-1]={},drawLineList[n-1].line=new Line,drawLineList[n-1].sat=l,drawLineList[n-1].ref=[t.x,t.y,t.z]);var u=l.az,g=l.el;i.push(u),o.push(g);var d=[Math.cos(g*Math.PI/180)*Math.sin(u*Math.PI/180),Math.cos(g*Math.PI/180)*Math.cos(u*Math.PI/180),Math.sin(g*Math.PI/180),1];numeric.setBlock(r,[n-1,0],[n-1,3],[d])}var c=numeric.dot(numeric.transpose(r),r),m=numeric.inv(c),p=Math.sqrt(m[0][0]+m[1][1]+m[2][2]),h=Math.sqrt(m[0][0]+m[1][1]),T=Math.sqrt(m[0][0]+m[1][1]+m[2][2]+m[3][3]),b=Math.sqrt(m[2][2]),v=Math.sqrt(m[3][3]);return s.PDOP=parseFloat(Math.round(100*p)/100).toFixed(2),s.HDOP=parseFloat(Math.round(100*h)/100).toFixed(2),s.GDOP=parseFloat(Math.round(100*T)/100).toFixed(2),s.VDOP=parseFloat(Math.round(100*b)/100).toFixed(2),s.TDOP=parseFloat(Math.round(100*v)/100).toFixed(2),s}),satellite.getSunTimes=((e,t,i,o)=>{if(void 0===t){if(void 0===satellite.currentSensor)throw"getTEARR requires a sensor or for a sensor to be currently selected.";t=satellite.currentSensor}if(void 0===t.observerGd)try{t.observerGd={height:t.obshei,latitude:t.lat,longitude:t.long}}catch(e){throw"observerGd is not set and could not be guessed."}void 0===i&&(i=satellite.lookanglesLength),void 0===o&&(o=satellite.lookanglesInterval);for(var n=timeManager.getPropOffset(),l=0,u=satellite.twoline2satrec(e.TLE1,e.TLE2),g=1e11,d=0;d<24*i*60*60;d+=o){l=1e3*d+n;var c=timeManager.propTimeCheck(l,timeManager.propRealTime),m=timeManager.jday(c.getUTCFullYear(),c.getUTCMonth()+1,c.getUTCDate(),c.getUTCHours(),c.getUTCMinutes(),c.getUTCSeconds());m+=c.getUTCMilliseconds()*r;var p,h,T,b,v,M=satellite.gstime(m),C=sun.getDirection2(m),f=1e6*C[0],S=1e6*C[1],x=1e6*C[2],L=(m-u.jdsatepoch)*s,w=satellite.sgp4(u,L),z=Math.pow(f-w.position.x,2),E=Math.pow(S-w.position.y,2),k=Math.pow(x-w.position.z,2),D=Math.sqrt(z+E+k);p=satellite.eciToEcf(w.position,M),h=satellite.ecfToLookAngles(t.observerGd,p),gpos=satellite.eciToGeodetic(w.position,M),alt=1e3*gpos.height,lon=gpos.longitude,lat=gpos.latitude,T=h.azimuth*a,b=h.elevation*a,v=h.rangeSat,t.obsminaz>t.obsmaxaz?((T>=t.obsminaz||T<=t.obsmaxaz)&&b>=t.obsminel&&b<=t.obsmaxel&&v<=t.obsmaxrange&&v>=t.obsminrange||(T>=t.obsminaz2||T<=t.obsmaxaz2)&&b>=t.obsminel2&&b<=t.obsmaxel2&&v<=t.obsmaxrange2&&v>=t.obsminrange2)&&D<g&&(g=D,c):(T>=t.obsminaz&&T<=t.obsmaxaz&&b>=t.obsminel&&b<=t.obsmaxel&&v<=t.obsmaxrange&&v>=t.obsminrange||T>=t.obsminaz2&&T<=t.obsmaxaz2&&b>=t.obsminel2&&b<=t.obsmaxel2&&v<=t.obsmaxrange2&&v>=t.obsminrange2)&&D<g&&(g=D,c)}}),satellite.lookAnglesToEcf=((e,a,s,r,i,o)=>{var n={};n.latitude=r,n.longitude=i,n.height=o;var l,u,g,d=satellite.geodeticToEcf(n);l=d.x,u=d.y,g=d.z;var c=Math.sin(r),m=Math.sin(i),p=Math.cos(r),h=Math.cos(i),T=t*e,b=t*a,v=-s*Math.cos(b)*Math.cos(T),M=s*Math.cos(b)*Math.sin(T),C=s*Math.sin(b);return{x:c*h*v+-m*M+p*h*C+l,y:c*m*v+h*M+p*m*C+u,z:-p*v+c*C+g}}),satellite.xyz2latlon=((e,t,s)=>{var r=timeManager.propTime(),i=timeManager.jday(r.getUTCFullYear(),r.getUTCMonth()+1,r.getUTCDate(),r.getUTCHours(),r.getUTCMinutes(),r.getUTCSeconds());i+=1.15741e-8*r.getUTCMilliseconds();var o=satellite.gstime(i),n=satellite.eciToGeodetic({x:e,y:t,z:s},o);return n.latitude=n.latitude*a,n.longitude=n.longitude*a,n.longitude=n.longitude>180?n.longitude-360:n.longitude,n.longitude=n.longitude<-180?n.longitude+360:n.longitude,n}),satellite.isInSun=(e=>{var t=sun.getXYZ(),s=Math.asin(RADIUS_OF_EARTH/Math.sqrt(Math.pow(-e.position.x,2)+Math.pow(-e.position.y,2)+Math.pow(-e.position.z,2)))*a,r=Math.asin(RADIUS_OF_SUN/Math.sqrt(Math.pow(-e.position.x+t.x,2)+Math.pow(-e.position.y+t.y,2)+Math.pow(-e.position.z+t.z,2)))*a,i=Math.acos(numeric.dot([-e.position.x,-e.position.y,-e.position.z],[-e.position.x+t.x,-e.position.y+t.y,-e.position.z+t.z])/(Math.sqrt(Math.pow(-e.position.x,2)+Math.pow(-e.position.y,2)+Math.pow(-e.position.z,2))*Math.sqrt(Math.pow(-e.position.x+t.x,2)+Math.pow(-e.position.y+t.y,2)+Math.pow(-e.position.z+t.z,2))))*a;return s>r&&i<s-r?0:Math.abs(s-r)<i&&i<s+r?1:r>s?1:i<r-s?1:2}),satellite.map=((e,t)=>{var i=timeManager.getPropOffset(),o=satellite.twoline2satrec(e.TLE1,e.TLE2);return function(e,t){var i=timeManager.propTimeCheck(e,timeManager.propRealTime),o=timeManager.jday(i.getUTCFullYear(),i.getUTCMonth()+1,i.getUTCDate(),i.getUTCHours(),i.getUTCMinutes(),i.getUTCSeconds());o+=i.getUTCMilliseconds()*r;var n,l,u,g=satellite.gstime(o),d=(o-t.jdsatepoch)*s,c=satellite.sgp4(t,d);n=satellite.eciToGeodetic(c.position,g),l=satellite.degreesLat(n.latitude),u=satellite.degreesLong(n.longitude);var m,p,h,T,b,v=timeManager.dateFormat(i,"isoDateTime",!0);m=satellite.eciToEcf(c.position,g),p=satellite.ecfToLookAngles(satellite.currentSensor.observerGd,m),h=p.azimuth*a,T=p.elevation*a,b=p.rangeSat;var M=0;satellite.currentSensor.obsminaz<satellite.currentSensor.obsmaxaz?(h>=satellite.currentSensor.obsminaz&&h<=satellite.currentSensor.obsmaxaz&&T>=satellite.currentSensor.obsminel&&T<=satellite.currentSensor.obsmaxel&&b<=satellite.currentSensor.obsmaxrange&&b>=satellite.currentSensor.obsminrange||h>=satellite.currentSensor.obsminaz2&&h<=satellite.currentSensor.obsmaxaz2&&T>=satellite.currentSensor.obsminel2&&T<=satellite.currentSensor.obsmaxel2&&b<=satellite.currentSensor.obsmaxrange2&&b>=satellite.currentSensor.obsminrange2)&&(M=1):((h>=satellite.currentSensor.obsminaz||h<=satellite.currentSensor.obsmaxaz)&&T>=satellite.currentSensor.obsminel&&T<=satellite.currentSensor.obsmaxel&&b<=satellite.currentSensor.obsmaxrange&&b>=satellite.currentSensor.obsminrange||(h>=satellite.currentSensor.obsminaz2||h<=satellite.currentSensor.obsmaxaz2)&&T>=satellite.currentSensor.obsminel2&&T<=satellite.currentSensor.obsmaxel2&&b<=satellite.currentSensor.obsmaxrange2&&b>=satellite.currentSensor.obsminrange2)&&(M=1);return{lat:l,lon:u,time:v,inview:M}}(t*e.period/50*60*1e3+i,o)})}();