!function(){const e=2*Math.PI,t=e/360,a=360/e,s=1440,r=1.15741e-8;var o,n;function i(e,t,a,s,o,n){return e?367*e-Math.floor(7*(e+Math.floor((t+9)/12))*.25)+Math.floor(275*t/9)+a+1721013.5+((n/60+o)/60+s)/24:(i=Date.now(),jDayStart=new Date(i.getFullYear(),0,0),jDayDiff=i-jDayStart,Math.floor(jDayDiff/r));var i}satellite.lookanglesInterval=5,satellite.lookanglesLength=2,satellite.isRiseSetLookangles=!1,satellite.currentEpoch=(e=>{let t=(e=new Date(e)).getUTCFullYear();t=parseInt(t.toString().substr(2,2));let a=s(timeManager.getDayOfYear(e),3);function s(e,t){return e.length<t?s("0"+e,t):e}return[t,a=s(a=(a+(60*e.getUTCHours()+e.getUTCMinutes())/1440).toFixed(8),12)]}),satellite.distance=((e,t)=>{if(null==t||null==e)return"";if("Star"===t.type||"Star"===e.type)return"";let a=Math.pow(e.position.x-t.position.x,2),s=Math.pow(e.position.y-t.position.y,2),r=Math.pow(e.position.z-t.position.z,2);return"<br />Range: "+Math.sqrt(a+s+r).toFixed(0)+" km"}),satellite.setobs=(e=>{if(void 0===e)return sensorManager.currentSensor=sensorManager.defaultSensor,void $(".sensor-reset-menu").hide();$("#menu-sensor-info").removeClass("bmenu-item-disabled"),$("#menu-fov-bubble").removeClass("bmenu-item-disabled"),$("#menu-surveillance").removeClass("bmenu-item-disabled"),$("#menu-planetarium").removeClass("bmenu-item-disabled"),$("#menu-astronomy").removeClass("bmenu-item-disabled"),$(".sensor-reset-menu").show(),sensorManager.currentSensor=e,sensorManager.currentSensor.observerGd={latitude:e.lat*t,longitude:e.long*t,height:parseFloat(e.obshei)}}),satellite.altitudeCheck=((e,t,a)=>{let o=satellite.twoline2satrec(e,t),n=timeManager.propTimeCheck(a,timeManager.propRealTime),i=timeManager.jday(n.getUTCFullYear(),n.getUTCMonth()+1,n.getUTCDate(),n.getUTCHours(),n.getUTCMinutes(),n.getUTCSeconds());i+=n.getUTCMilliseconds()*r;let l,g=satellite.gstime(i),u=(i-o.jdsatepoch)*s,d=satellite.sgp4(o,u);try{l=satellite.eciToGeodetic(d.position,g)}catch(e){return 0}return l.height}),satellite.getTEARR=((e,o,n)=>{if(!objectManager.isSensorManagerLoaded)throw"satellite.getTEARR requires sensorManager";let i={};if(void 0===o){if(void 0===sensorManager.currentSensor)throw"getTEARR requires a sensor or for a sensor to be currently selected.";o=sensorManager.currentSensor}if(void 0===o.observerGd){try{o.observerGd={height:o.obshei,latitude:o.lat,longitude:o.long}}catch(e){throw"observerGd is not set and could not be guessed."}if(void 0===o.observerGd.longitude)try{o.observerGd={height:o.alt,latitude:o.lat*t,longitude:o.lon*t}}catch(e){throw"observerGd is not set and could not be guessed."}}let l,g=satellite.twoline2satrec(e.TLE1,e.TLE2);l=void 0!==n?n:timeManager.propTime();let u=timeManager.jday(l.getUTCFullYear(),l.getUTCMonth()+1,l.getUTCDate(),l.getUTCHours(),l.getUTCMinutes(),l.getUTCSeconds());u+=l.getUTCMilliseconds()*r;let d=satellite.gstime(u),c=(u-g.jdsatepoch)*s,m=satellite.sgp4(g,c);try{let e=satellite.eciToGeodetic(m.position,d);i.alt=e.height,i.lon=e.longitude,i.lat=e.latitude;let t=satellite.eciToEcf(m.position,d),s=satellite.ecfToLookAngles(o.observerGd,t);i.azimuth=s.azimuth*a,i.elevation=s.elevation*a,i.range=s.rangeSat}catch(e){i.alt=0,i.lon=0,i.lat=0,i.azimuth=0,i.elevation=0,i.range=0}return i.inview=satellite.checkIsInFOV(o,{az:i.azimuth,el:i.elevation,range:i.range}),uiManager.currentTEARR=i,i}),satellite.nextpassList=(e=>{let t=[];for(let a=0;a<e.length;a++){let s=satellite.nextNpasses(e[a],void 0,864e5,satellite.lookanglesInterval,settingsManager.nextNPassesCount);for(let r=0;r<s.length;r++)t.push({SCC_NUM:e[a].SCC_NUM,time:s[r]})}return t}),satellite.nextpass=((e,t,a,s)=>{if(void 0===t){if(void 0===sensorManager.currentSensor)throw"getTEARR requires a sensor or for a sensor to be currently selected.";t=sensorManager.currentSensor}if(void 0===t.observerGd)try{t.observerGd={height:t.obshei,latitude:t.lat,longitude:t.long}}catch(e){throw"observerGd is not set and could not be guessed."}void 0===a&&(a=satellite.lookanglesLength),void 0===s&&(s=satellite.lookanglesInterval);let r=timeManager.getPropOffset(),o=0,n=satellite.twoline2satrec(e.TLE1,e.TLE2);for(let e=0;e<24*a*60*60;e+=s){o=1e3*e+r;let a=timeManager.propTimeCheck(o,timeManager.propRealTime),s=satellite.getRae(a,n,t);if(satellite.checkIsInFOV(t,s))return timeManager.dateFormat(a,"isoDateTime",!0)}return"No Passes in "+satellite.lookanglesLength+" Days"}),satellite.nextNpasses=((t,a,r,o,n)=>{if(void 0===a){if(void 0===sensorManager.currentSensor)throw"getTEARR requires a sensor or for a sensor to be currently selected.";a=sensorManager.currentSensor}if(void 0===a.observerGd)try{a.observerGd={height:a.obshei,latitude:a.lat,longitude:a.long}}catch(e){throw"observerGd is not set and could not be guessed."}void 0===r&&(r=satellite.lookanglesLength),void 0===o&&(o=satellite.lookanglesInterval);let i=[],l=timeManager.getPropOffset(),g=satellite.twoline2satrec(t.TLE1,t.TLE2);const u=s/(g.no*s/e);for(let e=0;e<24*r*60*60;e+=o){if(i.length>=n)return i;let t=e+l,s=timeManager.propTimeCheck(1e3*t,timeManager.propRealTime),r=satellite.getRae(s,g,a);satellite.checkIsInFOV(a,r)&&(i.push(s),e+=60*u*.75)}return i}),satellite.lastlooksArray=[],satellite.getlookangles=(e=>{if(!sensorManager.checkSensorSelected())return void console.warn("satellite.getlookangles requires a sensor to be set!");let t=timeManager.getPropOffset(),a=satellite.twoline2satrec(e.TLE1,e.TLE2);a.no;let s=satellite.isRiseSetLookangles?1:satellite.lookanglesInterval,r=[];for(let e=0;e<24*satellite.lookanglesLength*60*60;e+=s){let s=o(1e3*e+t,a);if(void 0!==s&&r.push(s),r.length>=1500)break}function o(e,t){let a=sensorManager.currentSensor;var r=Date.now(),o=timeManager.propTimeCheck(e,r);let n=satellite.getRae(o,t,a);if(satellite.checkIsInFOV(a,n)){if(satellite.isRiseSetLookangles){let e=new Date;if(e.setTime(Number(o)-1e3*s),aer1=satellite.getRae(e,t,a),!satellite.checkIsInFOV(a,aer1))return{time:timeManager.dateFormat(o,"isoDateTime",!0),rng:range,az:azimuth,el:elevation};if(e.setTime(Number(o)+1e3*s),aer1=satellite.getRae(e,t,a),!satellite.checkIsInFOV(a,aer1))return{time:timeManager.dateFormat(o,"isoDateTime",!0),rng:range,az:azimuth,el:elevation};return}return{time:timeManager.dateFormat(o,"isoDateTime",!0),rng:range,az:azimuth,el:elevation}}}r.sort(function(e,t){return new Date(e.time)-new Date(t.time)}),satellite.lastlooksArray=r,function(){var e=document.getElementById("looks");e.innerHTML="";var t=e.insertRow(),a=t.insertCell();a.appendChild(document.createTextNode("Time")),a.setAttribute("style","text-decoration: underline");var s=t.insertCell();s.appendChild(document.createTextNode("El")),s.setAttribute("style","text-decoration: underline");var o=t.insertCell();o.appendChild(document.createTextNode("Az")),o.setAttribute("style","text-decoration: underline");var n=t.insertCell();n.appendChild(document.createTextNode("Rng")),n.setAttribute("style","text-decoration: underline");for(let t=0;t<r.length;t++){let a;if(e.rows.length>0)for(let s=0;s<e.rows.length;s++){var i=e.rows[s].cells[0].textContent,l=parseInt(i.substr(0,4)),g=parseInt(i.substr(5,2))-1,u=parseInt(i.substr(8,2)),d=parseInt(i.substr(11,2)),c=parseInt(i.substr(14,2)),m=parseInt(i.substr(17,2)),p=new Date(l,g,u,d,c,m);if(p.setUTCDate(u),p.setUTCHours(d),r[t].time<p){a=e.insertRow(t);break}}null==a&&(a=e.insertRow()),a.insertCell().appendChild(document.createTextNode(timeManager.dateFormat(r[t].time,"isoDateTime",!1))),a.insertCell().appendChild(document.createTextNode(r[t].el.toFixed(1))),a.insertCell().appendChild(document.createTextNode(r[t].az.toFixed(0))),a.insertCell().appendChild(document.createTextNode(r[t].rng.toFixed(0)))}}()}),satellite.lastMultiSiteArray=[],satellite.getlookanglesMultiSite=(t=>{let a=!1;sensorManager.checkSensorSelected()||(a=!0),sensorManager.tempSensor=sensorManager.currentSensor;let r=timeManager.getPropOffset(),o=satellite.twoline2satrec(t.TLE1,t.TLE2);const n=s/(o.no*s/e);let i=[];for(let e=0;e<sensorManager.sensorListUS.length;e++){satellite.setobs(sensorManager.sensorListUS[e]);for(let t=0;t<24*satellite.lookanglesLength*60*60;t+=satellite.lookanglesInterval){let a=l(1e3*t+r,o,sensorManager.sensorListUS[e]);void 0!==a&&(i.push(a),t+=60*n*.75)}}function l(e,t,a){var s=Date.now(),r=timeManager.propTimeCheck(e,s);let o=satellite.getRae(r,t,a);if(satellite.checkIsInFOV(a,o))return{time:r.toISOString(),el:elevation,az:azimuth,rng:range,name:a.shortName}}i.sort(function(e,t){return new Date(e.time)-new Date(t.time)}),satellite.lastMultiSiteArray=i,function(){var e=document.getElementById("looksmultisite");e.innerHTML="";var t=e.insertRow(),a=t.insertCell();a.appendChild(document.createTextNode("Time")),a.setAttribute("style","text-decoration: underline");var s=t.insertCell();s.appendChild(document.createTextNode("El")),s.setAttribute("style","text-decoration: underline");var r=t.insertCell();r.appendChild(document.createTextNode("Az")),r.setAttribute("style","text-decoration: underline");var o=t.insertCell();o.appendChild(document.createTextNode("Rng")),o.setAttribute("style","text-decoration: underline");var n=t.insertCell();n.appendChild(document.createTextNode("Sensor")),n.setAttribute("style","text-decoration: underline");for(let t=0;t<i.length;t++){let a;if(e.rows.length>0)for(let s=0;s<e.rows.length;s++){var l=e.rows[s].cells[0].textContent,g=parseInt(l.substr(0,4)),u=parseInt(l.substr(5,2))-1,d=parseInt(l.substr(8,2)),c=parseInt(l.substr(11,2)),m=parseInt(l.substr(14,2)),p=parseInt(l.substr(17,2)),T=new Date(g,u,d,c,m,p);if(T.setUTCDate(d),T.setUTCHours(c),i[t].time<T){a=e.insertRow(t);break}}null==a&&(a=e.insertRow()),a.insertCell().appendChild(document.createTextNode(timeManager.dateFormat(i[t].time,"isoDateTime",!0))),a.insertCell().appendChild(document.createTextNode(i[t].el.toFixed(1))),a.insertCell().appendChild(document.createTextNode(i[t].az.toFixed(0))),a.insertCell().appendChild(document.createTextNode(i[t].rng.toFixed(0))),a.insertCell().appendChild(document.createTextNode(i[t].name))}}(),sensorManager.currentSensor=a?sensorManager.defaultSensor:sensorManager.tempSensor}),satellite.satSensorFOV=((e,t)=>{let a=timeManager.getPropOffset(),o=Date.now(),n=timeManager.propTimeCheck(a,o),l=u(n,satellite.twoline2satrec(e.TLE1,e.TLE2)),g=u(n,satellite.twoline2satrec(t.TLE1,t.TLE2));return console.log(l),void console.log(g);function u(e,t){let a=i(e.getUTCFullYear(),e.getUTCMonth()+1,e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds());a+=e.getUTCMilliseconds()*r;let o=satellite.gstime(a),n=(a-t.jdsatepoch)*s,l=satellite.sgp4(t,n);return satellite.eciToEcf(l.position,o)}}),satellite.findCloseObjects=(()=>{let e=[],t=[];for(let e=0;e<satSet.numSats;e++){let a=satSet.getSat(e);if(void 0===a.TLE1)continue;if(a.apogee>5556)continue;a.satrec=satellite.twoline2satrec(a.TLE1,a.TLE2);let s=n(0,a.satrec);a.position=s.position,void 0!==a.position&&t.push(a)}for(let a=0;a<t.length;a++){let s=t[a],r=s.position,o=r.x-20,n=r.x+20,i=r.y-20,l=r.y+20,g=r.z-20,u=r.z+20;for(let a=0;a<t.length;a++){let r=t[a];if(s==r)continue;let d=r.position;d.x<n&&d.x>o&&d.y<l&&d.y>i&&d.z<u&&d.z>g&&e.push({sat1:s,sat2:r})}}let a=Array.from(new Set(e));e=[],t=[];for(let e=0;e<a.length;e++){let t=a[e].sat1,s=n(18e5,t.satrec);a[e].sat1.position=s.position,s=n(18e5,(t=a[e].sat2).satrec),t.position=s.position,a[e].sat2.position=s.position}t=Array.from(new Set(t));for(let t=0;t<a.length;t++){let s=a[t].sat1,r=s.position;if(void 0===r)continue;let o=r.x-20,n=r.x+20,i=r.y-20,l=r.y+20,g=r.z-20,u=r.z+20,d=a[t].sat2,c=d.position;void 0!==c&&(c.x<n&&c.x>o&&c.y<l&&c.y>i&&c.z<u&&c.z>g&&(e.push(s.SCC_NUM),e.push(d.SCC_NUM)))}a=Array.from(new Set(e));let o="";for(let e=0;e<a.length;e++)e==a.length-1?o+=a[e]:o+=a[e]+",";return void searchBox.doSearch(o);function n(e,t){let a=new Date;a.setTime(Number(Date.now())+e);let o=i(a.getUTCFullYear(),a.getUTCMonth()+1,a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds());o+=a.getUTCMilliseconds()*r;satellite.gstime(o);let n=(o-t.jdsatepoch)*s;return satellite.sgp4(t,n)}}),satellite.getOrbitByLatLon=((e,t,o,n,i,l,g)=>{var u,d,c,m,p,T,h,b,v,M;for(void 0===g&&(g=0),M=0;M<5200;M+=1){if(1===(h=L(M))){if(v===n){M;break}M+=20}5===h&&(M+=100)}if(2===h)return console.warn("meanACalcResults failed after trying all combinations!"),["Error",""];if(void 0!==l&&0!==l)for(h=0,M=0;M<3600&&(1!==(T=x(M))||1!==h||v!==n);M+=1){if(5===T&&(M+=50),2===T)return["Error",""];for(var f=0;f<5200;f+=1){if(1===(h=L(f))){if(v===n)break;f+=20}if(5===h&&(f+=100),2===h)return["Error",""]}}for(M=0;M<52e4;M+=1){var C=U(M,g);if(1===C)break;5===C&&(M+=1e3)}return[u,d];function S(e,t){return e.length<t?S("0"+e,t):e}function x(t){var s,r,o=satellite.twoline2satrec(e.TLE1,e.TLE2);(s=(s=void 0===c?(o.mo*a).toPrecision(10):c).split("."))[0]=s[0].substr(-3,3),s[1]=s[1].substr(0,4),s=S(s=(s[0]+"."+s[1]).toString(),8),(r=(r=void 0===m?(e.raan*a).toPrecision(7):m).split("."))[0]=r[0].substr(-3,3),r[1]=r[1].substr(0,4),r=S(r=(r[0]+"."+r[1]).toString(),8),m=r;var n=e.SCC_NUM,l=e.TLE1.substr(9,8),g=(e.inclination*a).toPrecision(7);(g=g.split("."))[0]=g[0].substr(-3,3),g[1]=g[1].substr(0,4),g=S(g=(g[0]+"."+g[1]).toString(),8);var T=e.TLE1.substr(18,2),h=e.TLE1.substr(20,12),b=e.TLE2.substr(52,11),v=e.eccentricity.toPrecision(7).substr(2,7);t/=10,t=S(t=parseFloat(t).toPrecision(7),8);var M=e.TLE1.substr(32,39);u="1 "+n+"U "+l+" "+T+h+M,d="2 "+n+" "+g+" "+r+" "+v+" "+t+" "+s+" "+b+"    10",o=satellite.twoline2satrec(u,d);var f=k(i,o,3);return e.TLE1=u,e.TLE2=d,p=t,f}function L(t){var s=satellite.twoline2satrec(e.TLE1,e.TLE2);t/=10,t=S(t=parseFloat(t).toPrecision(7),8);var r=(e.raan*a).toPrecision(7);m=r,(r=r.toString().split("."))[0]=r[0].substr(-3,3),r[1]=r[1].substr(0,4),r=S(r=(r[0]+"."+r[1]).toString(),8);var o=e.SCC_NUM,n=e.TLE1.substr(9,8),l=(e.inclination*a).toPrecision(7);(l=l.split("."))[0]=l[0].substr(-3,3),l[1]=l[1].substr(0,4),l=S(l=(l[0]+"."+l[1]).toString(),8);var g,T=e.TLE1.substr(18,2),h=e.TLE1.substr(20,12),b=e.TLE2.substr(52,11),v=e.eccentricity.toPrecision(7).substr(2,7);(g=(g=void 0===p?(e.argPe*a).toPrecision(7):p).split("."))[0]=g[0].substr(-3,3),g[1]=g[1].substr(0,4),g=S(g=(g[0]+"."+g[1]).toString(),8);var M="1 "+o+"U "+n+" "+T+h+e.TLE1.substr(32,39),f="2 "+o+" "+l+" "+r+" "+v+" "+g+" "+t+" "+b+"    10";s=satellite.twoline2satrec(M,f);var C=k(i,s,1);return 1===C&&(u=M,d=f,e.TLE1=M,e.TLE2=f,c=t),C}function U(t,s){var r=satellite.twoline2satrec(e.TLE1,e.TLE2),o=c;rascNum=t,(t/=100)>360&&(t-=360),(t=(t=t.toPrecision(7)).split("."))[0]=t[0].substr(-3,3),t[1]=t[1].substr(0,4),t=S(t=(t[0]+"."+t[1]).toString(),8),m=t;var n=e.SCC_NUM,l=e.TLE1.substr(9,8),g=(e.inclination*a).toPrecision(7);(g=g.split("."))[0]=g[0].substr(-3,3),g[1]=g[1].substr(0,4),g=S(g=(g[0]+"."+g[1]).toString(),8);var T,h=e.TLE1.substr(18,2),b=e.TLE1.substr(20,12),v=e.TLE2.substr(52,11),M=e.eccentricity.toPrecision(7).substr(2,7);(T=(T=void 0===p?(e.argPe*a).toPrecision(7):p).split("."))[0]=T[0].substr(-3,3),T[1]=T[1].substr(0,4),T=S(T=(T[0]+"."+T[1]).toString(),8);var f=e.TLE1.substr(32,39);u="1 "+n+"U "+l+" "+h+b+f,d="2 "+n+" "+g+" "+t+" "+M+" "+T+" "+o+" "+v+"    10",r=satellite.twoline2satrec(u,d);var C=k(i,r,2);return 1===C&&(e.TLE1=u,(t=rascNum/100+s)>360&&(t-=360),t<0&&(t+=360),(t=(t=t.toPrecision(7)).split("."))[0]=t[0].substr(-3,3),t[1]=t[1].substr(0,4),t=S(t=(t[0]+"."+t[1]).toString(),8),m=t,d="2 "+n+" "+g+" "+t+" "+M+" "+T+" "+o+" "+v+"    10",e.TLE2=d),C}function k(e,a,n){timeManager.propRealTime=Date.now();var i=timeManager.propTimeCheck(e,timeManager.propRealTime),g=timeManager.jday(i.getUTCFullYear(),i.getUTCMonth()+1,i.getUTCDate(),i.getUTCHours(),i.getUTCMinutes(),i.getUTCSeconds());g+=i.getUTCMilliseconds()*r;var u,d,c,m,p=satellite.gstime(g),T=(g-a.jdsatepoch)*s,h=satellite.sgp4(a,T);void 0===h&&console.log(a);try{u=satellite.eciToGeodetic(h.position,p)}catch(e){return console.warn(e),2}if(d=1*satellite.degreesLat(u.latitude),c=1*satellite.degreesLong(u.longitude),m=u.height,null==b&&(b=d),1===n){if(d===b)return 0;d>b&&(v="N"),d<b&&(v="S"),b=d}return d>t-.15&&d<t+.15&&1===n?1:c>o-.15&&c<o+.15&&2===n?1:m>l-30&&m<l+30&&3===n?1:(d>t-11&&d<t+11||1!==n)&&(c>o-11&&c<o+11||2!==n)?(m<l-100||m>l+100)&&3===n?5:0:5}}),satellite.calculateLookAngles=((e,a,s)=>{!function(){if(void 0===a){if(!sensorManager.checkSensorSelected())return void console.error("getlookangles2 requires a sensor!");a=sensorManager.currentSensor}else{if(void 0===a.obsminaz)return void console.error("sensor format incorrect");a.observerGd={latitude:a.lat*t,longitude:a.long*t,height:parseFloat(a.obshei)}}void 0===e?console.error("sat parameter required!"):void 0!==e.TLE1&&void 0!==e.TLE2||console.error("sat parameter invalid format!"),void 0===s&&(s=0),void 0===satellite.isRiseSetLookangles&&(satellite.isRiseSetLookangles=!1)}(),void 0===s&&(s=0);var r,o=0,n=satellite.twoline2satrec(e.TLE1,e.TLE2),i=[];satellite.isRiseSetLookangles&&(r=satellite.lookanglesInterval,satellite.lookanglesInterval=1);for(var l=0;l<24*satellite.lookanglesLength*60*60;l+=satellite.lookanglesInterval)o=1e3*l+s,i.length<=5e3&&(lookanglesRow=g(o,n),"undefined"!=typeof lookanglesRow&&i.push(lookanglesRow));function g(e,t){let s=new Date;s.setTime(Number(Date.now())+e);let r=satellite.getRae(s,t,a);if(satellite.checkIsInFOV(a,r)){if(satellite.isRiseSetLookangles){var o=new Date;return o.setTime(Number(Date.now())+e-1e3*satellite.lookanglesInterval),aer1=satellite.getRae(o,t,a),isInFOV1=satellite.checkIsInFOV(a,aer1),isInFOV1?(o.setTime(Number(Date.now())+e-1e3*satellite.lookanglesInterval),aer1=satellite.getRae(o,t,a),isInFOV1=satellite.checkIsInFOV(a,aer1),isInFOV1?void 0:{time:timeManager.dateFormat(s,"isoDateTime",!0),rng:range,az:azimuth,el:elevation}):{time:timeManager.dateFormat(s,"isoDateTime",!0),rng:range,az:azimuth,el:elevation}}return{time:timeManager.dateFormat(s,"isoDateTime",!0),rng:range,az:azimuth,el:elevation}}}return satellite.isRiseSetLookangles&&(satellite.lookanglesInterval=r),i}),satellite.findBestPasses=((e,t)=>{for(var a=e.split(","),s=[],r=0;r<a.length;r++)try{for(var o=satSet.getSat(satSet.getIdFromObjNum(a[r])),n=satellite.findBestPass(o,t,0),i=0;i<n.length;i++)s.push(n[i])}catch(e){console.warn(e)}let l=s.sort((e,t)=>t.sortTime-e.sortTime);l.reverse(),l.forEach(function(e){delete e.sortTime});for(let e=0;e<l.length;e++)l[e].startDate=l[e].startDate.toISOString().split("T")[0],l[e].startTime=l[e].startTime.toISOString().split("T")[1].split(".")[0],l[e].stopDate=l[e].stopDate.toISOString().split("T")[0],l[e].stopTime=l[e].stopTime.toISOString().split("T")[1].split(".")[0];saveCsv(l,"bestSatTimes")}),satellite.findBestPass=((a,r,o)=>{!function(){if(void 0===r){if(!sensorManager.checkSensorSelected())return void console.error("getlookangles2 requires a sensor!");r=sensorManager.currentSensor}else{if(void 0===r.obsminaz)return void console.error("sensor format incorrect");r.observerGd={latitude:r.lat*t,longitude:r.long*t,height:parseFloat(r.obshei)}}void 0===a?console.error("sat parameter required!"):void 0!==a.TLE1&&void 0!==a.TLE2||console.error("sat parameter invalid format!")}(),void 0===o&&(o=0);var n=0,i=satellite.twoline2satrec(a.TLE1,a.TLE2),l=[];looksInterval=5,looksLength=7;for(var g=0,u=null,d=null,c=null,m=null,p=r.obsmaxrange,T=0,h=!1,b=!1,v=s/(i.no*s/e),M=0;M<24*looksLength*60*60;M+=looksInterval)n=1e3*M+o,l.length<=5e3&&(lookanglesRow=f(n,i),"undefined"!=typeof lookanglesRow&&(l.push(lookanglesRow),g=0,u=null,d=null,c=null,m=null,p=r.obsmaxrange,T=0,h=!1,b=!1,M+=60*v*.75));return l;function f(e,t){let a=new Date;a.setTime(Number(Date.now())+e);let s=satellite.getRae(a,t,r);if(satellite.checkIsInFOV(r,s)){let s=new Date;s.setTime(Number(Date.now())+e-1e3*looksInterval),aer1=satellite.getRae(s,t,r);let o=satellite.checkIsInFOV(r,aer1);if(o){if(s.setTime(Number(Date.now())+e+1e3*looksInterval),aer1=satellite.getRae(s,t,r),!(o=satellite.checkIsInFOV(r,aer1))){b=elevation<=3.5,g=Math.min((a-m)/1e3/60*10/8,10);let e=Math.min(T/40*10,10);e-=Math.max((T-50)/5,0),g+=e*=h&&b?2:1,g+=Math.min(9e3/p,10),g-=Math.max((900-p)/10,0);let s=0;try{s=(a-m)/1e3}catch(e){s=0}return{sortTime:m,scc:t.satnum,score:g,startDate:m,startTime:m,startAz:u,startEl:d,startRange:c,stopDate:a,stopTime:a,stopAz:azimuth.toFixed(0),stopEl:elevation.toFixed(1),stopRange:range.toFixed(0),tic:s,minRange:p.toFixed(0),passMaxEl:T.toFixed(1)}}}else elevation<=3.5&&(h=!0),m=a,u=azimuth.toFixed(0),d=elevation.toFixed(1),c=range.toFixed(0);T<elevation&&(T=elevation),p>range&&(p=range)}}}),satellite.getRae=((e,t,o)=>{let n=i(e.getUTCFullYear(),e.getUTCMonth()+1,e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds());n+=e.getUTCMilliseconds()*r;let l=satellite.gstime(n),g=(n-t.jdsatepoch)*s,u=satellite.sgp4(t,g),d=satellite.eciToEcf(u.position,l),c=satellite.ecfToLookAngles(o.observerGd,d);return azimuth=c.azimuth*a,elevation=c.elevation*a,range=c.rangeSat,{az:azimuth,el:elevation,range:range}}),satellite.eci2Rae=((e,t,s)=>{let o=i((e=new Date(e)).getUTCFullYear(),e.getUTCMonth()+1,e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds());o+=e.getUTCMilliseconds()*r;let n=satellite.gstime(o),l=satellite.eciToEcf(t.position,n),g=satellite.ecfToLookAngles(s.observerGd,l);return azimuth=g.azimuth*a,elevation=g.elevation*a,range=g.rangeSat,{az:azimuth,el:elevation,range:range}}),satellite.getEci=((e,t)=>{let a=i(t.getUTCFullYear(),t.getUTCMonth()+1,t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds());a+=t.getUTCMilliseconds()*r;let o=satellite.twoline2satrec(e.TLE1,e.TLE2),n=(a-o.jdsatepoch)*s;return satellite.sgp4(o,n)}),satellite.findNearbyObjectsByOrbit=(e=>{let t=satSet.getSatData(),a=[],s=1.05*e.period,r=.95*e.period,o=1.025*e.inclination,n=.975*e.inclination,i=1.025*e.raan,l=.975*e.raan;for(ss=0;ss<t.length;ss++){let e=t[ss];if(e.static)break;e.period>s||e.period<r||(e.inclination>o||e.inclination<n||e.raan>i||e.raan<l||a.push(e.id))}return a}),satellite.findClosestApproachTime=((e,t,a,s)=>{distArray={},void 0===s&&(s=86400);let r=1e6;for(let o=0;o<s;o++){let s=a+1e3*o,n=timeManager.propTimeCheck(s,timeManager.propRealTime),i=satellite.getEci(e,n),l=satellite.getEci(t,n),g=Math.sqrt((i.position.x-l.position.x)**2+(i.position.y-l.position.y)**2+(i.position.z-l.position.z)**2);g<r&&(r=g,distArray={time:n,propOffset:a+1e3*o,dist:g,velX:i.velocity.x-l.velocity.x,velY:i.velocity.y-l.velocity.y,velZ:i.velocity.z-l.velocity.z})}return distArray}),satellite.createManeuverAnalyst=((e,t,a,s)=>{var r,i,l,g=satSet.getSat(e),u=g,d=g.getTEARR();r=satellite.degreesLat(d.lat),i=satellite.degreesLong(d.lon),l=d.alt;var c,m=g.getDirection(),p=satellite.currentEpoch(timeManager.propTime());g.TLE1=g.TLE1.substr(0,18)+p[0]+p[1]+g.TLE1.substr(32),camSnapMode=!1;var T=(c=g.apogee-g.perigee<300?satellite.getOrbitByLatLon(g,r,i,m,timeManager.propOffset):satellite.getOrbitByLatLon(g,r,i,m,timeManager.propOffset,l))[0],h=c[1];e=satSet.getIdFromObjNum(8e4);var b=satSet.getSat(e);b=u;var v,M=T.substr(7);M=(v=b.apogee-b.perigee<300?satellite.getOrbitByLatLon(b,r,i,m,timeManager.propOffset,0,s):satellite.getOrbitByLatLon(b,r,i,m,timeManager.propOffset,l,s))[0],S=v[1];var f=h.substr(8,8);(f=(f=(parseFloat(f)+t).toPrecision(7)).split("."))[0]=f[0].substr(-3,3),f[1]?f[1]=f[1].substr(0,4):f[1]="0000",f=(f[0]+"."+f[1]).toString(),o=8,f=(n="   "+f).substr(n.length-o);var C=S.substr(52,10);(C=(C=parseFloat(C*a).toPrecision(10)).split("."))[0]=C[0].substr(-2,2),C[1]?C[1]=C[1].substr(0,8):C[1]="00000000",C=(C[0]+"."+C[1]).toString();var S="2 80000 "+f+" "+S.substr(17,35)+C+S.substr(63);return(b=satSet.getSat(e)).TLE1=M,b.TLE2=S,b.active=!0,satellite.altitudeCheck(M,S,timeManager.propOffset)>1?(satCruncher.postMessage({typ:"satEdit",id:e,TLE1:M,TLE2:S}),orbitManager.updateOrbitBuffer(e,!0,M,S),!0):(console.warn("Breakup Generator Failed"),!1)}),satellite.findChangeOrbitToDock=((e,t,a,s)=>{let r={dist:1e6};for(let o=-1;o<=1;o++)for(let n=-1;n<=1;n++)for(let i=.95;i<=1.05;i+=.05)if(satellite.createManeuverAnalyst(e.id,o,i,n)){let e=satellite.findClosestApproachTime(satSet.getSatFromObjNum(8e4),t,a,s);if(e.dist<r.dist){r=e;console.log(`Distance: ${r.dist}`),console.log(`Time: ${r.time}`),console.log(satSet.getSatFromObjNum(8e4))}}console.log(`${e.inclination+0}`),console.log(`${e.raan+0}`),console.log(`${1*e.meanMotion}`),satellite.createManeuverAnalyst(e.id,0,1,0)}),satellite.checkIsInFOV=((e,t)=>{let a=t.az,s=t.el,r=t.range;return e.obsminaz>e.obsmaxaz?(a>=e.obsminaz||a<=e.obsmaxaz)&&s>=e.obsminel&&s<=e.obsmaxel&&r<=e.obsmaxrange&&r>=e.obsminrange||(a>=e.obsminaz2||a<=e.obsmaxaz2)&&s>=e.obsminel2&&s<=e.obsmaxel2&&r<=e.obsmaxrange2&&r>=e.obsminrange2:a>=e.obsminaz&&a<=e.obsmaxaz&&s>=e.obsminel&&s<=e.obsmaxel&&r<=e.obsmaxrange&&r>=e.obsminrange||a>=e.obsminaz2&&a<=e.obsmaxaz2&&s>=e.obsminel2&&s<=e.obsmaxel2&&r<=e.obsmaxrange2&&r>=e.obsminrange2}),satellite.getDOPsTable=((e,t,a)=>{let s,r=document.getElementById("dops");r.innerHTML="";let o=timeManager.getPropOffset(),n=0,i=r.insertRow(),l=i.insertCell();l.appendChild(document.createTextNode("Time"));let g=i.insertCell();g.appendChild(document.createTextNode("HDOP"));let u=i.insertCell();u.appendChild(document.createTextNode("PDOP"));let d=i.insertCell();d.appendChild(document.createTextNode("GDOP"));for(let c=0;c<1440;c++)n=1e3*c*60+o,s=timeManager.propTimeCheck(n,timeManager.propRealTime),dops=satellite.getDOPs(e,t,a,!1,s),(l=(i=r.insertRow()).insertCell()).appendChild(document.createTextNode(timeManager.dateFormat(s,"isoDateTime",!0))),(g=i.insertCell()).appendChild(document.createTextNode(dops.HDOP)),(u=i.insertCell()).appendChild(document.createTextNode(dops.PDOP)),(d=i.insertCell()).appendChild(document.createTextNode(dops.GDOP))}),satellite.getDOPs=((e,s,r,o,n)=>{if(void 0!==e){if(void 0!==s){var i,l;r=void 0!==r?r:0,o=void 0!==o&&o,e*=t,s*=t;var g=[];void 0===groups.GPSGroup&&(groups.GPSGroup=new groups.SatGroup("nameRegex",/NAVSTAR/)),void 0===n&&(n=timeManager.propTime());var u=timeManager.jday(n.getUTCFullYear(),n.getUTCMonth()+1,n.getUTCDate(),n.getUTCHours(),n.getUTCMinutes(),n.getUTCSeconds());u+=1.15741e-8*n.getUTCMilliseconds();var d=satellite.gstime(u),c={},m=Math.cos(e),p=Math.sin(e),T=Math.cos(s+d),h=Math.sin(s+d);c.x=6371.25*m*T,c.y=6371.25*m*h,c.z=6371.25*p;for(var b=0;b<groups.GPSGroup.sats.length;b++)i=satSet.getSat(groups.GPSGroup.sats[b].satId),l=satellite.ecfToLookAngles({longitude:s,latitude:e,height:r},satellite.eciToEcf(i.position,d)),i.az=l.azimuth*a,i.el=l.elevation*a,i.el>settingsManager.gpsElevationMask&&g.push(i);return satellite.calculateDOPs(g,c,o)}console.error("Longitude Required")}else console.error("Latitude Required")}),satellite.calculateDOPs=((e,t,a)=>{var s={};if(nsat=e.length,nsat<4)return s.PDOP=50,s.HDOP=50,s.GDOP=50,s.VDOP=50,s.TDOP=50,s;var r=numeric.rep([nsat,4],0),o=[],n=[];a&&(drawLineList=[]);for(var i=1;i<=nsat;i++){var l=e[i-1];a&&(drawLineList[i-1]={},drawLineList[i-1].line=new Line,drawLineList[i-1].sat=l,drawLineList[i-1].ref=[t.x,t.y,t.z]);var g=l.az,u=l.el;o.push(g),n.push(u);var d=[Math.cos(u*Math.PI/180)*Math.sin(g*Math.PI/180),Math.cos(u*Math.PI/180)*Math.cos(g*Math.PI/180),Math.sin(u*Math.PI/180),1];numeric.setBlock(r,[i-1,0],[i-1,3],[d])}var c=numeric.dot(numeric.transpose(r),r),m=numeric.inv(c),p=Math.sqrt(m[0][0]+m[1][1]+m[2][2]),T=Math.sqrt(m[0][0]+m[1][1]),h=Math.sqrt(m[0][0]+m[1][1]+m[2][2]+m[3][3]),b=Math.sqrt(m[2][2]),v=Math.sqrt(m[3][3]);return s.PDOP=parseFloat(Math.round(100*p)/100).toFixed(2),s.HDOP=parseFloat(Math.round(100*T)/100).toFixed(2),s.GDOP=parseFloat(Math.round(100*h)/100).toFixed(2),s.VDOP=parseFloat(Math.round(100*b)/100).toFixed(2),s.TDOP=parseFloat(Math.round(100*v)/100).toFixed(2),s}),satellite.getSunTimes=((e,t,o,n)=>{if(void 0===t){if(void 0===sensorManager.currentSensor)throw"getTEARR requires a sensor or for a sensor to be currently selected.";t=sensorManager.currentSensor}if(void 0===t.observerGd)try{t.observerGd={height:t.obshei,latitude:t.lat,longitude:t.long}}catch(e){throw"observerGd is not set and could not be guessed."}void 0===o&&(o=satellite.lookanglesLength),void 0===n&&(n=satellite.lookanglesInterval);for(var i=timeManager.getPropOffset(),l=0,g=satellite.twoline2satrec(e.TLE1,e.TLE2),u=1e11,d=0;d<24*o*60*60;d+=n){l=1e3*d+i;var c=timeManager.propTimeCheck(l,timeManager.propRealTime),m=timeManager.jday(c.getUTCFullYear(),c.getUTCMonth()+1,c.getUTCDate(),c.getUTCHours(),c.getUTCMinutes(),c.getUTCSeconds());m+=c.getUTCMilliseconds()*r;var p,T,h,b,v,M=satellite.gstime(m),f=sun.getDirection2(m),C=1e6*f[0],S=1e6*f[1],x=1e6*f[2],L=(m-g.jdsatepoch)*s,U=satellite.sgp4(g,L),k=Math.pow(C-U.position.x,2),w=Math.pow(S-U.position.y,2),E=Math.pow(x-U.position.z,2),y=Math.sqrt(k+w+E);p=satellite.eciToEcf(U.position,M),T=satellite.ecfToLookAngles(t.observerGd,p),gpos=satellite.eciToGeodetic(U.position,M),alt=1e3*gpos.height,lon=gpos.longitude,lat=gpos.latitude,h=T.azimuth*a,b=T.elevation*a,v=T.rangeSat,t.obsminaz>t.obsmaxaz?((h>=t.obsminaz||h<=t.obsmaxaz)&&b>=t.obsminel&&b<=t.obsmaxel&&v<=t.obsmaxrange&&v>=t.obsminrange||(h>=t.obsminaz2||h<=t.obsmaxaz2)&&b>=t.obsminel2&&b<=t.obsmaxel2&&v<=t.obsmaxrange2&&v>=t.obsminrange2)&&y<u&&(u=y,c):(h>=t.obsminaz&&h<=t.obsmaxaz&&b>=t.obsminel&&b<=t.obsmaxel&&v<=t.obsmaxrange&&v>=t.obsminrange||h>=t.obsminaz2&&h<=t.obsmaxaz2&&b>=t.obsminel2&&b<=t.obsmaxel2&&v<=t.obsmaxrange2&&v>=t.obsminrange2)&&y<u&&(u=y,c)}}),satellite.lookAnglesToEcf=((e,a,s,r,o,n)=>{var i={};i.latitude=r,i.longitude=o,i.height=n;var l,g,u,d=satellite.geodeticToEcf(i);l=d.x,g=d.y,u=d.z;var c=Math.sin(r),m=Math.sin(o),p=Math.cos(r),T=Math.cos(o),h=t*e,b=t*a,v=-s*Math.cos(b)*Math.cos(h),M=s*Math.cos(b)*Math.sin(h),f=s*Math.sin(b);return{x:c*T*v+-m*M+p*T*f+l,y:c*m*v+T*M+p*m*f+g,z:-p*v+c*f+u}}),satellite.eci2ll=((e,t,s)=>{var r=timeManager.propTime(),o=timeManager.jday(r.getUTCFullYear(),r.getUTCMonth()+1,r.getUTCDate(),r.getUTCHours(),r.getUTCMinutes(),r.getUTCSeconds());o+=1.15741e-8*r.getUTCMilliseconds();var n=satellite.gstime(o),i=satellite.eciToGeodetic({x:e,y:t,z:s},n);return i.latitude=i.latitude*a,i.longitude=i.longitude*a,i.longitude=i.longitude>180?i.longitude-360:i.longitude,i.longitude=i.longitude<-180?i.longitude+360:i.longitude,i}),satellite.map=((e,t)=>{var o=timeManager.getPropOffset(),n=satellite.twoline2satrec(e.TLE1,e.TLE2);return function(e,t){var o=timeManager.propTimeCheck(e,timeManager.propRealTime),n=timeManager.jday(o.getUTCFullYear(),o.getUTCMonth()+1,o.getUTCDate(),o.getUTCHours(),o.getUTCMinutes(),o.getUTCSeconds());n+=o.getUTCMilliseconds()*r;var i,l,g,u=satellite.gstime(n),d=(n-t.jdsatepoch)*s,c=satellite.sgp4(t,d);i=satellite.eciToGeodetic(c.position,u),l=satellite.degreesLat(i.latitude),g=satellite.degreesLong(i.longitude);var m,p,T,h,b,v=timeManager.dateFormat(o,"isoDateTime",!0);m=satellite.eciToEcf(c.position,u),p=satellite.ecfToLookAngles(sensorManager.currentSensor.observerGd,m),T=p.azimuth*a,h=p.elevation*a,b=p.rangeSat;var M=0;sensorManager.currentSensor.obsminaz<sensorManager.currentSensor.obsmaxaz?(T>=sensorManager.currentSensor.obsminaz&&T<=sensorManager.currentSensor.obsmaxaz&&h>=sensorManager.currentSensor.obsminel&&h<=sensorManager.currentSensor.obsmaxel&&b<=sensorManager.currentSensor.obsmaxrange&&b>=sensorManager.currentSensor.obsminrange||T>=sensorManager.currentSensor.obsminaz2&&T<=sensorManager.currentSensor.obsmaxaz2&&h>=sensorManager.currentSensor.obsminel2&&h<=sensorManager.currentSensor.obsmaxel2&&b<=sensorManager.currentSensor.obsmaxrange2&&b>=sensorManager.currentSensor.obsminrange2)&&(M=1):((T>=sensorManager.currentSensor.obsminaz||T<=sensorManager.currentSensor.obsmaxaz)&&h>=sensorManager.currentSensor.obsminel&&h<=sensorManager.currentSensor.obsmaxel&&b<=sensorManager.currentSensor.obsmaxrange&&b>=sensorManager.currentSensor.obsminrange||(T>=sensorManager.currentSensor.obsminaz2||T<=sensorManager.currentSensor.obsmaxaz2)&&h>=sensorManager.currentSensor.obsminel2&&h<=sensorManager.currentSensor.obsmaxel2&&b<=sensorManager.currentSensor.obsmaxrange2&&b>=sensorManager.currentSensor.obsminrange2)&&(M=1);return{lat:l,lon:g,time:v,inview:M}}(t*e.period/50*60*1e3+o,n)})}();