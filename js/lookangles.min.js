!function(){const e=2*Math.PI,t=e/360,s=360/e,a=1440,r=1.15741e-8;function o(e,t,s,a,o,n){return e?367*e-Math.floor(7*(e+Math.floor((t+9)/12))*.25)+Math.floor(275*t/9)+s+1721013.5+((n/60+o)/60+a)/24:(i=Date.now(),jDayStart=new Date(i.getFullYear(),0,0),jDayDiff=i-jDayStart,Math.floor(jDayDiff/r));var i}satellite.lookanglesInterval=5,satellite.lookanglesLength=2,satellite.isRiseSetLookangles=!1,satellite.currentEpoch=(e=>{let t=(e=new Date(e)).getUTCFullYear();t=parseInt(t.toString().substr(2,2));let s=a(timeManager.getDayOfYear(e),3);function a(e,t){return e.length<t?a("0"+e,t):e}return[t,s=a(s=(s+(60*e.getUTCHours()+e.getUTCMinutes())/1440).toFixed(8),12)]}),satellite.distance=((e,t)=>{if(null==t||null==e)return"";if("Star"===t.type||"Star"===e.type)return"";let s=Math.pow(e.position.x-t.position.x,2),a=Math.pow(e.position.y-t.position.y,2),r=Math.pow(e.position.z-t.position.z,2);return"<br />"+Math.sqrt(s+a+r).toFixed(0)+" km"}),satellite.setobs=(e=>{if(void 0===e)return sensorManager.currentSensor=sensorManager.defaultSensor,void $(".sensor-reset-menu").hide();$("#menu-sensor-info").removeClass("bmenu-item-disabled"),$("#menu-fov-bubble").removeClass("bmenu-item-disabled"),$("#menu-surveillance").removeClass("bmenu-item-disabled"),$("#menu-planetarium").removeClass("bmenu-item-disabled"),$("#menu-astronomy").removeClass("bmenu-item-disabled"),$(".sensor-reset-menu").show(),sensorManager.currentSensor=e,sensorManager.currentSensor.observerGd={latitude:e.lat*t,longitude:e.long*t,height:parseFloat(e.obshei)}}),satellite.altitudeCheck=((e,t,s)=>{let o=satellite.twoline2satrec(e,t),n=timeManager.propTimeCheck(s,timeManager.propRealTime),i=timeManager.jday(n.getUTCFullYear(),n.getUTCMonth()+1,n.getUTCDate(),n.getUTCHours(),n.getUTCMinutes(),n.getUTCSeconds());i+=n.getUTCMilliseconds()*r;let l,g=satellite.gstime(i),u=(i-o.jdsatepoch)*a,d=satellite.sgp4(o,u);try{l=satellite.eciToGeodetic(d.position,g)}catch(e){return 0}return l.height}),satellite.getTEARR=((e,o,n)=>{let i={};if(void 0===o){if(void 0===sensorManager.currentSensor)throw"getTEARR requires a sensor or for a sensor to be currently selected.";o=sensorManager.currentSensor}if(void 0===o.observerGd){try{o.observerGd={height:o.obshei,latitude:o.lat,longitude:o.long}}catch(e){throw"observerGd is not set and could not be guessed."}if(void 0===o.observerGd.longitude)try{o.observerGd={height:o.alt,latitude:o.lat*t,longitude:o.lon*t}}catch(e){throw"observerGd is not set and could not be guessed."}}let l,g=satellite.twoline2satrec(e.TLE1,e.TLE2);l=void 0!==n?n:timeManager.propTime();let u=timeManager.jday(l.getUTCFullYear(),l.getUTCMonth()+1,l.getUTCDate(),l.getUTCHours(),l.getUTCMinutes(),l.getUTCSeconds());u+=l.getUTCMilliseconds()*r;let d=satellite.gstime(u),c=(u-g.jdsatepoch)*a,m=satellite.sgp4(g,c);try{let e=satellite.eciToGeodetic(m.position,d);i.alt=e.height,i.lon=e.longitude,i.lat=e.latitude;let t=satellite.eciToEcf(m.position,d),a=satellite.ecfToLookAngles(o.observerGd,t);i.azimuth=a.azimuth*s,i.elevation=a.elevation*s,i.range=a.rangeSat}catch(e){i.alt=0,i.lon=0,i.lat=0,i.azimuth=0,i.elevation=0,i.range=0}return i.inview=satellite.checkIsInFOV(o,{az:i.azimuth,el:i.elevation,range:i.range}),uiManager.currentTEARR=i,i}),satellite.nextpassList=(e=>{let t=[];for(let s=0;s<e.length;s++){let a=satellite.nextNpasses(e[s],void 0,864e5,satellite.lookanglesInterval,settingsManager.nextNPassesCount);for(let r=0;r<a.length;r++)t.push({SCC_NUM:e[s].SCC_NUM,time:a[r]})}return t}),satellite.nextpass=((e,t,s,a)=>{if(void 0===t){if(void 0===sensorManager.currentSensor)throw"getTEARR requires a sensor or for a sensor to be currently selected.";t=sensorManager.currentSensor}if(void 0===t.observerGd)try{t.observerGd={height:t.obshei,latitude:t.lat,longitude:t.long}}catch(e){throw"observerGd is not set and could not be guessed."}void 0===s&&(s=satellite.lookanglesLength),void 0===a&&(a=satellite.lookanglesInterval);let r=timeManager.getPropOffset(),o=0,n=satellite.twoline2satrec(e.TLE1,e.TLE2);for(let e=0;e<24*s*60*60;e+=a){o=1e3*e+r;let s=timeManager.propTimeCheck(o,timeManager.propRealTime),a=satellite.getRae(s,n,t);if(satellite.checkIsInFOV(t,a))return timeManager.dateFormat(s,"isoDateTime",!0)}return"No Passes in "+satellite.lookanglesLength+" Days"}),satellite.nextNpasses=((t,s,r,o,n)=>{if(void 0===s){if(void 0===sensorManager.currentSensor)throw"getTEARR requires a sensor or for a sensor to be currently selected.";s=sensorManager.currentSensor}if(void 0===s.observerGd)try{s.observerGd={height:s.obshei,latitude:s.lat,longitude:s.long}}catch(e){throw"observerGd is not set and could not be guessed."}void 0===r&&(r=satellite.lookanglesLength),void 0===o&&(o=satellite.lookanglesInterval);let i=[],l=timeManager.getPropOffset(),g=satellite.twoline2satrec(t.TLE1,t.TLE2);const u=a/(g.no*a/e);for(let e=0;e<24*r*60*60;e+=o){if(i.length>=n)return i;let t=e+l,a=timeManager.propTimeCheck(1e3*t,timeManager.propRealTime),r=satellite.getRae(a,g,s);satellite.checkIsInFOV(s,r)&&(i.push(a),e+=60*u*.75)}return i}),satellite.lastlooksArray=[],satellite.getlookangles=(e=>{if(!sensorManager.checkSensorSelected())return void console.warn("satellite.getlookangles requires a sensor to be set!");let t=timeManager.getPropOffset(),s=satellite.twoline2satrec(e.TLE1,e.TLE2);s.no;let a=satellite.isRiseSetLookangles?1:satellite.lookanglesInterval,r=[];for(let e=0;e<24*satellite.lookanglesLength*60*60;e+=a){let a=o(1e3*e+t,s);if(void 0!==a&&r.push(a),r.length>=1500)break}function o(e,t){let s=sensorManager.currentSensor;var r=Date.now(),o=timeManager.propTimeCheck(e,r);let n=satellite.getRae(o,t,s);if(satellite.checkIsInFOV(s,n)){if(satellite.isRiseSetLookangles){let e=new Date;if(e.setTime(Number(o)-1e3*a),aer1=satellite.getRae(e,t,s),!satellite.checkIsInFOV(s,aer1))return{time:timeManager.dateFormat(o,"isoDateTime",!0),rng:range,az:azimuth,el:elevation};if(e.setTime(Number(o)+1e3*a),aer1=satellite.getRae(e,t,s),!satellite.checkIsInFOV(s,aer1))return{time:timeManager.dateFormat(o,"isoDateTime",!0),rng:range,az:azimuth,el:elevation};return}return{time:timeManager.dateFormat(o,"isoDateTime",!0),rng:range,az:azimuth,el:elevation}}}r.sort(function(e,t){return new Date(e.time)-new Date(t.time)}),satellite.lastlooksArray=r,function(){var e=document.getElementById("looks");e.innerHTML="";var t=e.insertRow(),s=t.insertCell();s.appendChild(document.createTextNode("Time")),s.setAttribute("style","text-decoration: underline");var a=t.insertCell();a.appendChild(document.createTextNode("El")),a.setAttribute("style","text-decoration: underline");var o=t.insertCell();o.appendChild(document.createTextNode("Az")),o.setAttribute("style","text-decoration: underline");var n=t.insertCell();n.appendChild(document.createTextNode("Rng")),n.setAttribute("style","text-decoration: underline");for(let t=0;t<r.length;t++){let s;if(e.rows.length>0)for(let a=0;a<e.rows.length;a++){var i=e.rows[a].cells[0].textContent,l=parseInt(i.substr(0,4)),g=parseInt(i.substr(5,2))-1,u=parseInt(i.substr(8,2)),d=parseInt(i.substr(11,2)),c=parseInt(i.substr(14,2)),m=parseInt(i.substr(17,2)),p=new Date(l,g,u,d,c,m);if(p.setUTCDate(u),p.setUTCHours(d),r[t].time<p){s=e.insertRow(t);break}}null==s&&(s=e.insertRow()),s.insertCell().appendChild(document.createTextNode(timeManager.dateFormat(r[t].time,"isoDateTime",!1))),s.insertCell().appendChild(document.createTextNode(r[t].el.toFixed(1))),s.insertCell().appendChild(document.createTextNode(r[t].az.toFixed(0))),s.insertCell().appendChild(document.createTextNode(r[t].rng.toFixed(0)))}}()}),satellite.lastMultiSiteArray=[],satellite.getlookanglesMultiSite=(t=>{let s=!1;sensorManager.checkSensorSelected()||(s=!0),sensorManager.tempSensor=sensorManager.currentSensor;let r=timeManager.getPropOffset(),o=satellite.twoline2satrec(t.TLE1,t.TLE2);const n=a/(o.no*a/e);let i=[];for(let e=0;e<sensorManager.sensorListUS.length;e++){satellite.setobs(sensorManager.sensorListUS[e]);for(let t=0;t<24*satellite.lookanglesLength*60*60;t+=satellite.lookanglesInterval){let s=l(1e3*t+r,o,sensorManager.sensorListUS[e]);void 0!==s&&(i.push(s),t+=60*n*.75)}}function l(e,t,s){var a=Date.now(),r=timeManager.propTimeCheck(e,a);let o=satellite.getRae(r,t,s);if(satellite.checkIsInFOV(s,o))return{time:r,el:elevation,az:azimuth,rng:range,name:s.shortName}}i.sort(function(e,t){return new Date(e.time)-new Date(t.time)}),satellite.lastMultiSiteArray=i,function(){var e=document.getElementById("looksmultisite");e.innerHTML="";var t=e.insertRow(),s=t.insertCell();s.appendChild(document.createTextNode("Time")),s.setAttribute("style","text-decoration: underline");var a=t.insertCell();a.appendChild(document.createTextNode("El")),a.setAttribute("style","text-decoration: underline");var r=t.insertCell();r.appendChild(document.createTextNode("Az")),r.setAttribute("style","text-decoration: underline");var o=t.insertCell();o.appendChild(document.createTextNode("Rng")),o.setAttribute("style","text-decoration: underline");var n=t.insertCell();n.appendChild(document.createTextNode("Sensor")),n.setAttribute("style","text-decoration: underline");for(let t=0;t<i.length;t++){let s;if(e.rows.length>0)for(let a=0;a<e.rows.length;a++){var l=e.rows[a].cells[0].textContent,g=parseInt(l.substr(0,4)),u=parseInt(l.substr(5,2))-1,d=parseInt(l.substr(8,2)),c=parseInt(l.substr(11,2)),m=parseInt(l.substr(14,2)),p=parseInt(l.substr(17,2)),h=new Date(g,u,d,c,m,p);if(h.setUTCDate(d),h.setUTCHours(c),i[t].time<h){s=e.insertRow(t);break}}null==s&&(s=e.insertRow()),s.insertCell().appendChild(document.createTextNode(timeManager.dateFormat(i[t].time,"isoDateTime",!1))),s.insertCell().appendChild(document.createTextNode(i[t].el.toFixed(1))),s.insertCell().appendChild(document.createTextNode(i[t].az.toFixed(0))),s.insertCell().appendChild(document.createTextNode(i[t].rng.toFixed(0))),s.insertCell().appendChild(document.createTextNode(i[t].name))}}(),sensorManager.currentSensor=s?sensorManager.defaultSensor:sensorManager.tempSensor}),satellite.satSensorFOV=((e,t)=>{let s=timeManager.getPropOffset(),n=Date.now(),i=timeManager.propTimeCheck(s,n),l=u(i,satellite.twoline2satrec(e.TLE1,e.TLE2)),g=u(i,satellite.twoline2satrec(t.TLE1,t.TLE2));return console.log(l),void console.log(g);function u(e,t){let s=o(e.getUTCFullYear(),e.getUTCMonth()+1,e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds());s+=e.getUTCMilliseconds()*r;let n=satellite.gstime(s),i=(s-t.jdsatepoch)*a,l=satellite.sgp4(t,i);return satellite.eciToEcf(l.position,n)}}),satellite.findCloseObjects=(()=>{let e=[],t=[];for(let e=0;e<satSet.numSats;e++){let s=satSet.getSat(e);if(void 0===s.TLE1)continue;if(s.apogee>5556)continue;s.satrec=satellite.twoline2satrec(s.TLE1,s.TLE2);let a=i(0,s.satrec);s.position=a.position,void 0!==s.position&&t.push(s)}for(let s=0;s<t.length;s++){let a=t[s],r=a.position,o=r.x-20,n=r.x+20,i=r.y-20,l=r.y+20,g=r.z-20,u=r.z+20;for(let s=0;s<t.length;s++){let r=t[s];if(a==r)continue;let d=r.position;d.x<n&&d.x>o&&d.y<l&&d.y>i&&d.z<u&&d.z>g&&e.push({sat1:a,sat2:r})}}let s=Array.from(new Set(e));e=[],t=[];for(let e=0;e<s.length;e++){let t=s[e].sat1,a=i(18e5,t.satrec);s[e].sat1.position=a.position,a=i(18e5,(t=s[e].sat2).satrec),t.position=a.position,s[e].sat2.position=a.position}t=Array.from(new Set(t));for(let t=0;t<s.length;t++){let a=s[t].sat1,r=a.position;if(void 0===r)continue;let o=r.x-20,n=r.x+20,i=r.y-20,l=r.y+20,g=r.z-20,u=r.z+20,d=s[t].sat2,c=d.position;void 0!==c&&(c.x<n&&c.x>o&&c.y<l&&c.y>i&&c.z<u&&c.z>g&&(e.push(a.SCC_NUM),e.push(d.SCC_NUM)))}s=Array.from(new Set(e));let n="";for(let e=0;e<s.length;e++)e==s.length-1?n+=s[e]:n+=s[e]+",";return void searchBox.doSearch(n);function i(e,t){let s=new Date;s.setTime(Number(Date.now())+e);let n=o(s.getUTCFullYear(),s.getUTCMonth()+1,s.getUTCDate(),s.getUTCHours(),s.getUTCMinutes(),s.getUTCSeconds());n+=s.getUTCMilliseconds()*r;satellite.gstime(n);let i=(n-t.jdsatepoch)*a;return satellite.sgp4(t,i)}}),satellite.getOrbitByLatLon=((e,t,o,n,i,l,g)=>{var u,d,c,m,p,h,T,b,v,M;for(void 0===g&&(g=0),M=0;M<5200;M+=1){if(1===(T=L(M))){if(v===n){M;break}M+=20}5===T&&(M+=100)}if(2===T)return console.warn("meanACalcResults failed after trying all combinations!"),["Error",""];if(void 0!==l&&0!==l)for(T=0,M=0;M<3600;M+=1){if(1===(h=x(M))){if(1===T&&v===n)break}else console.log("Failed Arg of Per Calc");if(5===h&&(M+=50),2===h)return["Error",""];for(var f=0;f<5200;f+=1){if(1===(T=L(f))){if(v===n)break;f+=20}if(5===T&&(f+=100),2===T)return["Error",""]}}for(M=0;M<52e4;M+=1){var C=w(M,g);if(1===C)break;5===C&&(M+=1e3)}return[u,d];function S(e,t){return e.length<t?S("0"+e,t):e}function x(t){var a,r,o=satellite.twoline2satrec(e.TLE1,e.TLE2);(a=(a=void 0===c?(o.mo*s).toPrecision(10):c).split("."))[0]=a[0].substr(-3,3),a[1]=a[1].substr(0,4),a=S(a=(a[0]+"."+a[1]).toString(),8),(r=(r=void 0===m?(e.raan*s).toPrecision(7):m).split("."))[0]=r[0].substr(-3,3),r[1]=r[1].substr(0,4),r=S(r=(r[0]+"."+r[1]).toString(),8),m=r;var n=e.SCC_NUM,l=e.TLE1.substr(9,8),g=(e.inclination*s).toPrecision(7);(g=g.split("."))[0]=g[0].substr(-3,3),g[1]=g[1].substr(0,4),g=S(g=(g[0]+"."+g[1]).toString(),8);var h=e.TLE1.substr(18,2),T=e.TLE1.substr(20,12),b=e.TLE2.substr(52,11),v=e.eccentricity.toPrecision(7).substr(2,7);t/=10,t=S(t=parseFloat(t).toPrecision(7),8);var M=e.TLE1.substr(32,39);u="1 "+n+"U "+l+" "+h+T+M,d="2 "+n+" "+g+" "+r+" "+v+" "+t+" "+a+" "+b+"    10",o=satellite.twoline2satrec(u,d);var f=k(i,o,3);return e.TLE1=u,e.TLE2=d,p=t,f}function L(t){var a=satellite.twoline2satrec(e.TLE1,e.TLE2);t/=10,t=S(t=parseFloat(t).toPrecision(7),8);var r=(e.raan*s).toPrecision(7);m=r,(r=r.toString().split("."))[0]=r[0].substr(-3,3),r[1]=r[1].substr(0,4),r=S(r=(r[0]+"."+r[1]).toString(),8);var o=e.SCC_NUM,n=e.TLE1.substr(9,8),l=(e.inclination*s).toPrecision(7);(l=l.split("."))[0]=l[0].substr(-3,3),l[1]=l[1].substr(0,4),l=S(l=(l[0]+"."+l[1]).toString(),8);var g,h=e.TLE1.substr(18,2),T=e.TLE1.substr(20,12),b=e.TLE2.substr(52,11),v=e.eccentricity.toPrecision(7).substr(2,7);(g=(g=void 0===p?(e.argPe*s).toPrecision(7):p).split("."))[0]=g[0].substr(-3,3),g[1]=g[1].substr(0,4),g=S(g=(g[0]+"."+g[1]).toString(),8);var M="1 "+o+"U "+n+" "+h+T+e.TLE1.substr(32,39),f="2 "+o+" "+l+" "+r+" "+v+" "+g+" "+t+" "+b+"    10";a=satellite.twoline2satrec(M,f);var C=k(i,a,1);return 1===C&&(u=M,d=f,e.TLE1=M,e.TLE2=f,c=t),C}function w(t,a){var r=satellite.twoline2satrec(e.TLE1,e.TLE2),o=c;rascNum=t,(t/=100)>360&&(t-=360),(t=(t=t.toPrecision(7)).split("."))[0]=t[0].substr(-3,3),t[1]=t[1].substr(0,4),t=S(t=(t[0]+"."+t[1]).toString(),8),m=t;var n=e.SCC_NUM,l=e.TLE1.substr(9,8),g=(e.inclination*s).toPrecision(7);(g=g.split("."))[0]=g[0].substr(-3,3),g[1]=g[1].substr(0,4),g=S(g=(g[0]+"."+g[1]).toString(),8);var h,T=e.TLE1.substr(18,2),b=e.TLE1.substr(20,12),v=e.TLE2.substr(52,11),M=e.eccentricity.toPrecision(7).substr(2,7);(h=(h=void 0===p?(e.argPe*s).toPrecision(7):p).split("."))[0]=h[0].substr(-3,3),h[1]=h[1].substr(0,4),h=S(h=(h[0]+"."+h[1]).toString(),8);var f=e.TLE1.substr(32,39);u="1 "+n+"U "+l+" "+T+b+f,d="2 "+n+" "+g+" "+t+" "+M+" "+h+" "+o+" "+v+"    10",r=satellite.twoline2satrec(u,d);var C=k(i,r,2);return 1===C&&(e.TLE1=u,(t=rascNum/100+a)>360&&(t-=360),t<0&&(t+=360),(t=(t=t.toPrecision(7)).split("."))[0]=t[0].substr(-3,3),t[1]=t[1].substr(0,4),t=S(t=(t[0]+"."+t[1]).toString(),8),m=t,d="2 "+n+" "+g+" "+t+" "+M+" "+h+" "+o+" "+v+"    10",e.TLE2=d),C}function k(e,s,n){timeManager.propRealTime=Date.now();var i=timeManager.propTimeCheck(e,timeManager.propRealTime),g=timeManager.jday(i.getUTCFullYear(),i.getUTCMonth()+1,i.getUTCDate(),i.getUTCHours(),i.getUTCMinutes(),i.getUTCSeconds());g+=i.getUTCMilliseconds()*r;var u,d,c,m,p=satellite.gstime(g),h=(g-s.jdsatepoch)*a,T=satellite.sgp4(s,h);void 0===T&&console.log(s);try{u=satellite.eciToGeodetic(T.position,p)}catch(e){return console.warn(e),2}if(d=1*satellite.degreesLat(u.latitude),c=1*satellite.degreesLong(u.longitude),m=u.height,null==b&&(b=d),1===n){if(d===b)return 0;d>b&&(v="N"),d<b&&(v="S"),b=d}return d>t-.15&&d<t+.15&&1===n?1:c>o-.15&&c<o+.15&&2===n?1:m>l-30&&m<l+30&&3===n?1:(d>t-11&&d<t+11||1!==n)&&(c>o-11&&c<o+11||2!==n)?(m<l-100||m>l+100)&&3===n?5:0:5}}),satellite.calculateLookAngles=((e,s,a)=>{!function(){if(void 0===s){if(!sensorManager.checkSensorSelected())return void console.error("getlookangles2 requires a sensor!");s=sensorManager.currentSensor}else{if(void 0===s.obsminaz)return void console.error("sensor format incorrect");s.observerGd={latitude:s.lat*t,longitude:s.long*t,height:parseFloat(s.obshei)}}void 0===e?console.error("sat parameter required!"):void 0!==e.TLE1&&void 0!==e.TLE2||console.error("sat parameter invalid format!"),void 0===a&&(a=0),void 0===satellite.isRiseSetLookangles&&(satellite.isRiseSetLookangles=!1)}(),void 0===a&&(a=0);var r,o=0,n=satellite.twoline2satrec(e.TLE1,e.TLE2),i=[];satellite.isRiseSetLookangles&&(r=satellite.lookanglesInterval,satellite.lookanglesInterval=1);for(var l=0;l<24*satellite.lookanglesLength*60*60;l+=satellite.lookanglesInterval)o=1e3*l+a,i.length<=5e3&&(lookanglesRow=g(o,n),"undefined"!=typeof lookanglesRow&&i.push(lookanglesRow));function g(e,t){let a=new Date;a.setTime(Number(Date.now())+e);let r=satellite.getRae(a,t,s);if(satellite.checkIsInFOV(s,r)){if(satellite.isRiseSetLookangles){var o=new Date;return o.setTime(Number(Date.now())+e-1e3*satellite.lookanglesInterval),aer1=satellite.getRae(o,t,s),isInFOV1=satellite.checkIsInFOV(s,aer1),isInFOV1?(o.setTime(Number(Date.now())+e-1e3*satellite.lookanglesInterval),aer1=satellite.getRae(o,t,s),isInFOV1=satellite.checkIsInFOV(s,aer1),isInFOV1?void 0:{time:timeManager.dateFormat(a,"isoDateTime",!0),rng:range,az:azimuth,el:elevation}):{time:timeManager.dateFormat(a,"isoDateTime",!0),rng:range,az:azimuth,el:elevation}}return{time:timeManager.dateFormat(a,"isoDateTime",!0),rng:range,az:azimuth,el:elevation}}}return satellite.isRiseSetLookangles&&(satellite.lookanglesInterval=r),i}),satellite.findBestPasses=((e,t)=>{for(var s=e.split(","),a=[],r=0;r<s.length;r++)try{for(var o=satSet.getSat(satSet.getIdFromObjNum(s[r])),n=satellite.findBestPass(o,t,0),i=0;i<n.length;i++)a.push(n[i])}catch(e){console.warn(e)}let l=a.sort((e,t)=>t.sortTime-e.sortTime);l.reverse(),l.forEach(function(e){delete e.sortTime});for(let e=0;e<l.length;e++)l[e].startDate=l[e].startDate.toISOString().split("T")[0],l[e].startTime=l[e].startTime.toISOString().split("T")[1].split(".")[0],l[e].stopDate=l[e].stopDate.toISOString().split("T")[0],l[e].stopTime=l[e].stopTime.toISOString().split("T")[1].split(".")[0];saveCsv(l,"bestSatTimes")}),satellite.findBestPass=((s,r,o)=>{!function(){if(void 0===r){if(!sensorManager.checkSensorSelected())return void console.error("getlookangles2 requires a sensor!");r=sensorManager.currentSensor}else{if(void 0===r.obsminaz)return void console.error("sensor format incorrect");r.observerGd={latitude:r.lat*t,longitude:r.long*t,height:parseFloat(r.obshei)}}void 0===s?console.error("sat parameter required!"):void 0!==s.TLE1&&void 0!==s.TLE2||console.error("sat parameter invalid format!")}(),void 0===o&&(o=0);var n=0,i=satellite.twoline2satrec(s.TLE1,s.TLE2),l=[];looksInterval=5,looksLength=7;for(var g=0,u=null,d=null,c=null,m=null,p=r.obsmaxrange,h=0,T=!1,b=!1,v=a/(i.no*a/e),M=0;M<24*looksLength*60*60;M+=looksInterval)n=1e3*M+o,l.length<=5e3&&(lookanglesRow=f(n,i),"undefined"!=typeof lookanglesRow&&(l.push(lookanglesRow),g=0,u=null,d=null,c=null,m=null,p=r.obsmaxrange,h=0,T=!1,b=!1,M+=60*v*.75));return l;function f(e,t){let s=new Date;s.setTime(Number(Date.now())+e);let a=satellite.getRae(s,t,r);if(satellite.checkIsInFOV(r,a)){let a=new Date;a.setTime(Number(Date.now())+e-1e3*looksInterval),aer1=satellite.getRae(a,t,r);let o=satellite.checkIsInFOV(r,aer1);if(o){if(a.setTime(Number(Date.now())+e+1e3*looksInterval),aer1=satellite.getRae(a,t,r),!(o=satellite.checkIsInFOV(r,aer1))){b=elevation<=3.5,g=Math.min((s-m)/1e3/60*10/8,10);let e=Math.min(h/40*10,10);e-=Math.max((h-50)/5,0),g+=e*=T&&b?2:1,g+=Math.min(9e3/p,10),g-=Math.max((900-p)/10,0);let a=0;try{a=(s-m)/1e3}catch(e){a=0}return{sortTime:m,scc:t.satnum,score:g,startDate:m,startTime:m,startAz:u,startEl:d,startRange:c,stopDate:s,stopTime:s,stopAz:azimuth.toFixed(0),stopEl:elevation.toFixed(1),stopRange:range.toFixed(0),tic:a,minRange:p.toFixed(0),passMaxEl:h.toFixed(1)}}}else elevation<=3.5&&(T=!0),m=s,u=azimuth.toFixed(0),d=elevation.toFixed(1),c=range.toFixed(0);h<elevation&&(h=elevation),p>range&&(p=range)}}}),satellite.getRae=((e,t,n)=>{let i=o(e.getUTCFullYear(),e.getUTCMonth()+1,e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds());i+=e.getUTCMilliseconds()*r;let l=satellite.gstime(i),g=(i-t.jdsatepoch)*a,u=satellite.sgp4(t,g),d=satellite.eciToEcf(u.position,l),c=satellite.ecfToLookAngles(n.observerGd,d);return azimuth=c.azimuth*s,elevation=c.elevation*s,range=c.rangeSat,{az:azimuth,el:elevation,range:range}}),satellite.checkIsInFOV=((e,t)=>{let s=t.az,a=t.el,r=t.range;return e.obsminaz>e.obsmaxaz?(s>=e.obsminaz||s<=e.obsmaxaz)&&a>=e.obsminel&&a<=e.obsmaxel&&r<=e.obsmaxrange&&r>=e.obsminrange||(s>=e.obsminaz2||s<=e.obsmaxaz2)&&a>=e.obsminel2&&a<=e.obsmaxel2&&r<=e.obsmaxrange2&&r>=e.obsminrange2:s>=e.obsminaz&&s<=e.obsmaxaz&&a>=e.obsminel&&a<=e.obsmaxel&&r<=e.obsmaxrange&&r>=e.obsminrange||s>=e.obsminaz2&&s<=e.obsmaxaz2&&a>=e.obsminel2&&a<=e.obsmaxel2&&r<=e.obsmaxrange2&&r>=e.obsminrange2}),satellite.getDOPsTable=((e,t,s)=>{let a,r=document.getElementById("dops");r.innerHTML="";let o=timeManager.getPropOffset(),n=0,i=r.insertRow(),l=i.insertCell();l.appendChild(document.createTextNode("Time"));let g=i.insertCell();g.appendChild(document.createTextNode("HDOP"));let u=i.insertCell();u.appendChild(document.createTextNode("PDOP"));let d=i.insertCell();d.appendChild(document.createTextNode("GDOP"));for(let c=0;c<1440;c++)n=1e3*c*60+o,a=timeManager.propTimeCheck(n,timeManager.propRealTime),dops=satellite.getDOPs(e,t,s,!1,a),(l=(i=r.insertRow()).insertCell()).appendChild(document.createTextNode(timeManager.dateFormat(a,"isoDateTime",!0))),(g=i.insertCell()).appendChild(document.createTextNode(dops.HDOP)),(u=i.insertCell()).appendChild(document.createTextNode(dops.PDOP)),(d=i.insertCell()).appendChild(document.createTextNode(dops.GDOP))}),satellite.getDOPs=((e,a,r,o,n)=>{if(void 0!==e){if(void 0!==a){var i,l;r=void 0!==r?r:0,o=void 0!==o&&o,e*=t,a*=t;var g=[];void 0===groups.GPSGroup&&(groups.GPSGroup=new groups.SatGroup("nameRegex",/NAVSTAR/)),void 0===n&&(n=timeManager.propTime());var u=timeManager.jday(n.getUTCFullYear(),n.getUTCMonth()+1,n.getUTCDate(),n.getUTCHours(),n.getUTCMinutes(),n.getUTCSeconds());u+=1.15741e-8*n.getUTCMilliseconds();var d=satellite.gstime(u),c={},m=Math.cos(e),p=Math.sin(e),h=Math.cos(a+d),T=Math.sin(a+d);c.x=6371.25*m*h,c.y=6371.25*m*T,c.z=6371.25*p;for(var b=0;b<groups.GPSGroup.sats.length;b++)i=satSet.getSat(groups.GPSGroup.sats[b].satId),l=satellite.ecfToLookAngles({longitude:a,latitude:e,height:r},satellite.eciToEcf(i.position,d)),i.az=l.azimuth*s,i.el=l.elevation*s,i.el>settingsManager.gpsElevationMask&&g.push(i);return satellite.calculateDOPs(g,c,o)}console.error("Longitude Required")}else console.error("Latitude Required")}),satellite.calculateDOPs=((e,t,s)=>{var a={};if(nsat=e.length,nsat<4)return a.PDOP=50,a.HDOP=50,a.GDOP=50,a.VDOP=50,a.TDOP=50,a;var r=numeric.rep([nsat,4],0),o=[],n=[];s&&(drawLineList=[]);for(var i=1;i<=nsat;i++){var l=e[i-1];s&&(drawLineList[i-1]={},drawLineList[i-1].line=new Line,drawLineList[i-1].sat=l,drawLineList[i-1].ref=[t.x,t.y,t.z]);var g=l.az,u=l.el;o.push(g),n.push(u);var d=[Math.cos(u*Math.PI/180)*Math.sin(g*Math.PI/180),Math.cos(u*Math.PI/180)*Math.cos(g*Math.PI/180),Math.sin(u*Math.PI/180),1];numeric.setBlock(r,[i-1,0],[i-1,3],[d])}var c=numeric.dot(numeric.transpose(r),r),m=numeric.inv(c),p=Math.sqrt(m[0][0]+m[1][1]+m[2][2]),h=Math.sqrt(m[0][0]+m[1][1]),T=Math.sqrt(m[0][0]+m[1][1]+m[2][2]+m[3][3]),b=Math.sqrt(m[2][2]),v=Math.sqrt(m[3][3]);return a.PDOP=parseFloat(Math.round(100*p)/100).toFixed(2),a.HDOP=parseFloat(Math.round(100*h)/100).toFixed(2),a.GDOP=parseFloat(Math.round(100*T)/100).toFixed(2),a.VDOP=parseFloat(Math.round(100*b)/100).toFixed(2),a.TDOP=parseFloat(Math.round(100*v)/100).toFixed(2),a}),satellite.getSunTimes=((e,t,o,n)=>{if(void 0===t){if(void 0===sensorManager.currentSensor)throw"getTEARR requires a sensor or for a sensor to be currently selected.";t=sensorManager.currentSensor}if(void 0===t.observerGd)try{t.observerGd={height:t.obshei,latitude:t.lat,longitude:t.long}}catch(e){throw"observerGd is not set and could not be guessed."}void 0===o&&(o=satellite.lookanglesLength),void 0===n&&(n=satellite.lookanglesInterval);for(var i=timeManager.getPropOffset(),l=0,g=satellite.twoline2satrec(e.TLE1,e.TLE2),u=1e11,d=0;d<24*o*60*60;d+=n){l=1e3*d+i;var c=timeManager.propTimeCheck(l,timeManager.propRealTime),m=timeManager.jday(c.getUTCFullYear(),c.getUTCMonth()+1,c.getUTCDate(),c.getUTCHours(),c.getUTCMinutes(),c.getUTCSeconds());m+=c.getUTCMilliseconds()*r;var p,h,T,b,v,M=satellite.gstime(m),f=sun.getDirection2(m),C=1e6*f[0],S=1e6*f[1],x=1e6*f[2],L=(m-g.jdsatepoch)*a,w=satellite.sgp4(g,L),k=Math.pow(C-w.position.x,2),U=Math.pow(S-w.position.y,2),z=Math.pow(x-w.position.z,2),D=Math.sqrt(k+U+z);p=satellite.eciToEcf(w.position,M),h=satellite.ecfToLookAngles(t.observerGd,p),gpos=satellite.eciToGeodetic(w.position,M),alt=1e3*gpos.height,lon=gpos.longitude,lat=gpos.latitude,T=h.azimuth*s,b=h.elevation*s,v=h.rangeSat,t.obsminaz>t.obsmaxaz?((T>=t.obsminaz||T<=t.obsmaxaz)&&b>=t.obsminel&&b<=t.obsmaxel&&v<=t.obsmaxrange&&v>=t.obsminrange||(T>=t.obsminaz2||T<=t.obsmaxaz2)&&b>=t.obsminel2&&b<=t.obsmaxel2&&v<=t.obsmaxrange2&&v>=t.obsminrange2)&&D<u&&(u=D,c):(T>=t.obsminaz&&T<=t.obsmaxaz&&b>=t.obsminel&&b<=t.obsmaxel&&v<=t.obsmaxrange&&v>=t.obsminrange||T>=t.obsminaz2&&T<=t.obsmaxaz2&&b>=t.obsminel2&&b<=t.obsmaxel2&&v<=t.obsmaxrange2&&v>=t.obsminrange2)&&D<u&&(u=D,c)}}),satellite.lookAnglesToEcf=((e,s,a,r,o,n)=>{var i={};i.latitude=r,i.longitude=o,i.height=n;var l,g,u,d=satellite.geodeticToEcf(i);l=d.x,g=d.y,u=d.z;var c=Math.sin(r),m=Math.sin(o),p=Math.cos(r),h=Math.cos(o),T=t*e,b=t*s,v=-a*Math.cos(b)*Math.cos(T),M=a*Math.cos(b)*Math.sin(T),f=a*Math.sin(b);return{x:c*h*v+-m*M+p*h*f+l,y:c*m*v+h*M+p*m*f+g,z:-p*v+c*f+u}}),satellite.eci2ll=((e,t,a)=>{var r=timeManager.propTime(),o=timeManager.jday(r.getUTCFullYear(),r.getUTCMonth()+1,r.getUTCDate(),r.getUTCHours(),r.getUTCMinutes(),r.getUTCSeconds());o+=1.15741e-8*r.getUTCMilliseconds();var n=satellite.gstime(o),i=satellite.eciToGeodetic({x:e,y:t,z:a},n);return i.latitude=i.latitude*s,i.longitude=i.longitude*s,i.longitude=i.longitude>180?i.longitude-360:i.longitude,i.longitude=i.longitude<-180?i.longitude+360:i.longitude,i}),satellite.map=((e,t)=>{var o=timeManager.getPropOffset(),n=satellite.twoline2satrec(e.TLE1,e.TLE2);return function(e,t){var o=timeManager.propTimeCheck(e,timeManager.propRealTime),n=timeManager.jday(o.getUTCFullYear(),o.getUTCMonth()+1,o.getUTCDate(),o.getUTCHours(),o.getUTCMinutes(),o.getUTCSeconds());n+=o.getUTCMilliseconds()*r;var i,l,g,u=satellite.gstime(n),d=(n-t.jdsatepoch)*a,c=satellite.sgp4(t,d);i=satellite.eciToGeodetic(c.position,u),l=satellite.degreesLat(i.latitude),g=satellite.degreesLong(i.longitude);var m,p,h,T,b,v=timeManager.dateFormat(o,"isoDateTime",!0);m=satellite.eciToEcf(c.position,u),p=satellite.ecfToLookAngles(sensorManager.currentSensor.observerGd,m),h=p.azimuth*s,T=p.elevation*s,b=p.rangeSat;var M=0;sensorManager.currentSensor.obsminaz<sensorManager.currentSensor.obsmaxaz?(h>=sensorManager.currentSensor.obsminaz&&h<=sensorManager.currentSensor.obsmaxaz&&T>=sensorManager.currentSensor.obsminel&&T<=sensorManager.currentSensor.obsmaxel&&b<=sensorManager.currentSensor.obsmaxrange&&b>=sensorManager.currentSensor.obsminrange||h>=sensorManager.currentSensor.obsminaz2&&h<=sensorManager.currentSensor.obsmaxaz2&&T>=sensorManager.currentSensor.obsminel2&&T<=sensorManager.currentSensor.obsmaxel2&&b<=sensorManager.currentSensor.obsmaxrange2&&b>=sensorManager.currentSensor.obsminrange2)&&(M=1):((h>=sensorManager.currentSensor.obsminaz||h<=sensorManager.currentSensor.obsmaxaz)&&T>=sensorManager.currentSensor.obsminel&&T<=sensorManager.currentSensor.obsmaxel&&b<=sensorManager.currentSensor.obsmaxrange&&b>=sensorManager.currentSensor.obsminrange||(h>=sensorManager.currentSensor.obsminaz2||h<=sensorManager.currentSensor.obsmaxaz2)&&T>=sensorManager.currentSensor.obsminel2&&T<=sensorManager.currentSensor.obsmaxel2&&b<=sensorManager.currentSensor.obsmaxrange2&&b>=sensorManager.currentSensor.obsminrange2)&&(M=1);return{lat:l,lon:g,time:v,inview:M}}(t*e.period/50*60*1e3+o,n)})}();