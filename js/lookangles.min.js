!function(){const e=2*Math.PI,t=e/360,a=360/e,r=1440,s=1.15741e-8;var n,o,i,l,g,u,d;satellite.lookanglesInterval=5,satellite.lookanglesLength=2,satellite.isRiseSetLookangles=!1,satellite.currentEpoch=(e=>{let t=(e=new Date(e)).getUTCFullYear();t=parseInt(t.toString().substr(2,2));let a=r(timeManager.getDayOfYear(e),3);function r(e,t){return e.length<t?r("0"+e,t):e}return[t,a=r(a=(a+(60*e.getUTCHours()+e.getUTCMinutes())/1440).toFixed(8),12)]}),satellite.distance=((e,t)=>{if(null==t||null==e)return"";if("Star"===t.type||"Star"===e.type)return"";let a=Math.pow(e.position.x-t.position.x,2),r=Math.pow(e.position.y-t.position.y,2),s=Math.pow(e.position.z-t.position.z,2);return"<br />"+Math.sqrt(a+r+s).toFixed(0)+" km"}),satellite.setobs=(e=>{if(void 0===e)return sensorManager.currentSensor=sensorManager.defaultSensor,void $(".sensor-reset-menu").hide();$("#menu-sensor-info").removeClass("bmenu-item-disabled"),$("#menu-fov-bubble").removeClass("bmenu-item-disabled"),$("#menu-surveillance").removeClass("bmenu-item-disabled"),$("#menu-planetarium").removeClass("bmenu-item-disabled"),$("#menu-astronomy").removeClass("bmenu-item-disabled"),$(".sensor-reset-menu").show(),sensorManager.currentSensor=e,sensorManager.currentSensor.observerGd={latitude:e.lat*t,longitude:e.long*t,height:parseFloat(e.obshei)}}),satellite.altitudeCheck=((e,t,a)=>{let n=satellite.twoline2satrec(e,t),o=timeManager.propTimeCheck(a,timeManager.propRealTime),i=timeManager.jday(o.getUTCFullYear(),o.getUTCMonth()+1,o.getUTCDate(),o.getUTCHours(),o.getUTCMinutes(),o.getUTCSeconds());i+=o.getUTCMilliseconds()*s;let l,g=satellite.gstime(i),u=(i-n.jdsatepoch)*r,d=satellite.sgp4(n,u);try{l=satellite.eciToGeodetic(d.position,g)}catch(e){return 0}return l.height}),satellite.getTEARR=((e,n,o)=>{let i={};if(void 0===n){if(void 0===sensorManager.currentSensor)throw"getTEARR requires a sensor or for a sensor to be currently selected.";n=sensorManager.currentSensor}if(void 0===n.observerGd){try{n.observerGd={height:n.obshei,latitude:n.lat,longitude:n.long}}catch(e){throw"observerGd is not set and could not be guessed."}if(void 0===n.observerGd.longitude)try{n.observerGd={height:n.alt,latitude:n.lat*t,longitude:n.lon*t}}catch(e){throw"observerGd is not set and could not be guessed."}}let l,g=satellite.twoline2satrec(e.TLE1,e.TLE2);l=void 0!==o?o:timeManager.propTime();let u=timeManager.jday(l.getUTCFullYear(),l.getUTCMonth()+1,l.getUTCDate(),l.getUTCHours(),l.getUTCMinutes(),l.getUTCSeconds());u+=l.getUTCMilliseconds()*s;let d=satellite.gstime(u),c=(u-g.jdsatepoch)*r,m=satellite.sgp4(g,c);try{let e=satellite.eciToGeodetic(m.position,d);i.alt=e.height,i.lon=e.longitude,i.lat=e.latitude;let t=satellite.eciToEcf(m.position,d),r=satellite.ecfToLookAngles(n.observerGd,t);i.azimuth=r.azimuth*a,i.elevation=r.elevation*a,i.range=r.rangeSat}catch(e){i.alt=0,i.lon=0,i.lat=0,i.azimuth=0,i.elevation=0,i.range=0}return i.inview=satellite.checkIsInFOV(n,{az:i.azimuth,el:i.elevation,range:i.range}),uiManager.currentTEARR=i,i}),satellite.nextpassList=(e=>{let t=[];for(let a=0;a<e.length;a++){let r=satellite.nextNpasses(e[a],void 0,864e5,satellite.lookanglesInterval,settingsManager.nextNPassesCount);for(let s=0;s<r.length;s++)t.push({SCC_NUM:e[a].SCC_NUM,time:r[s]})}return t}),satellite.nextpass=((e,t,a,r)=>{if(void 0===t){if(void 0===sensorManager.currentSensor)throw"getTEARR requires a sensor or for a sensor to be currently selected.";t=sensorManager.currentSensor}if(void 0===t.observerGd)try{t.observerGd={height:t.obshei,latitude:t.lat,longitude:t.long}}catch(e){throw"observerGd is not set and could not be guessed."}void 0===a&&(a=satellite.lookanglesLength),void 0===r&&(r=satellite.lookanglesInterval);let s=timeManager.getPropOffset(),n=0,o=satellite.twoline2satrec(e.TLE1,e.TLE2);for(let e=0;e<24*a*60*60;e+=r){n=1e3*e+s;let a=timeManager.propTimeCheck(n,timeManager.propRealTime),r=satellite.getRae(a,o,t);if(satellite.checkIsInFOV(t,r))return timeManager.dateFormat(a,"isoDateTime",!0)}return"No Passes in "+satellite.lookanglesLength+" Days"}),satellite.nextNpasses=((t,a,s,n,o)=>{if(void 0===a){if(void 0===sensorManager.currentSensor)throw"getTEARR requires a sensor or for a sensor to be currently selected.";a=sensorManager.currentSensor}if(void 0===a.observerGd)try{a.observerGd={height:a.obshei,latitude:a.lat,longitude:a.long}}catch(e){throw"observerGd is not set and could not be guessed."}void 0===s&&(s=satellite.lookanglesLength),void 0===n&&(n=satellite.lookanglesInterval);let i=[],l=timeManager.getPropOffset(),g=satellite.twoline2satrec(t.TLE1,t.TLE2);const u=r/(g.no*r/e);for(let e=0;e<24*s*60*60;e+=n){if(i.length>=o)return i;let t=e+l,r=timeManager.propTimeCheck(1e3*t,timeManager.propRealTime),s=satellite.getRae(r,g,a);satellite.checkIsInFOV(a,s)&&(i.push(r),e+=60*u*.75)}return i}),satellite.lastlooksArray=[],satellite.getlookangles=(e=>{if(!sensorManager.checkSensorSelected())return void console.warn("satellite.getlookangles requires a sensor to be set!");let t=timeManager.getPropOffset(),a=satellite.twoline2satrec(e.TLE1,e.TLE2);a.no;let r=satellite.isRiseSetLookangles?1:satellite.lookanglesInterval,s=[];for(let e=0;e<24*satellite.lookanglesLength*60*60;e+=r){let r=n(e+t,a);if(void 0!==r&&s.push(r),s.length>=1500)break}function n(e,t){let a=sensorManager.currentSensor;var r=Date.now(),s=timeManager.propTimeCheck(1e3*e,r);let n=satellite.getRae(s,t,a);if(satellite.checkIsInFOV(a,n)){if(satellite.isRiseSetLookangles){let e=new Date;if(e.setTime(Number(s)-1e3*satellite.lookanglesInterval),aer1=satellite.getRae(e,t,a),!satellite.checkIsInFOV(a,aer1))return{time:timeManager.dateFormat(s,"isoDateTime",!0),rng:range,az:azimuth,el:elevation};if(e.setTime(Number(s)+1e3*satellite.lookanglesInterval),aer1=satellite.getRae(e,t,a),!satellite.checkIsInFOV(a,aer1))return{time:timeManager.dateFormat(s,"isoDateTime",!0),rng:range,az:azimuth,el:elevation};return}return{time:timeManager.dateFormat(s,"isoDateTime",!0),rng:range,az:azimuth,el:elevation}}}s.sort(function(e,t){return new Date(e.time)-new Date(t.time)}),satellite.lastlooksArray=s,function(){var e=document.getElementById("looks");e.innerHTML="";var t=e.insertRow(),a=t.insertCell();a.appendChild(document.createTextNode("Time")),a.setAttribute("style","text-decoration: underline");var r=t.insertCell();r.appendChild(document.createTextNode("El")),r.setAttribute("style","text-decoration: underline");var n=t.insertCell();n.appendChild(document.createTextNode("Az")),n.setAttribute("style","text-decoration: underline");var o=t.insertCell();o.appendChild(document.createTextNode("Rng")),o.setAttribute("style","text-decoration: underline");for(let t=0;t<s.length;t++){let a;if(e.rows.length>0)for(let r=0;r<e.rows.length;r++){var i=e.rows[r].cells[0].textContent,l=parseInt(i.substr(0,4)),g=parseInt(i.substr(5,2))-1,u=parseInt(i.substr(8,2)),d=parseInt(i.substr(11,2)),c=parseInt(i.substr(14,2)),m=parseInt(i.substr(17,2)),h=new Date(l,g,u,d,c,m);if(h.setUTCDate(u),h.setUTCHours(d),s[t].time<h){a=e.insertRow(t);break}}null==a&&(a=e.insertRow()),a.insertCell().appendChild(document.createTextNode(timeManager.dateFormat(s[t].time,"isoDateTime",!0))),a.insertCell().appendChild(document.createTextNode(s[t].el.toFixed(1))),a.insertCell().appendChild(document.createTextNode(s[t].az.toFixed(0))),a.insertCell().appendChild(document.createTextNode(s[t].rng.toFixed(0)))}}()}),satellite.lastMultiSiteArray=[],satellite.getlookanglesMultiSite=(t=>{let a=!1;sensorManager.checkSensorSelected()||(a=!0),sensorManager.tempSensor=sensorManager.currentSensor;let s=timeManager.getPropOffset(),n=satellite.twoline2satrec(t.TLE1,t.TLE2);const o=r/(n.no*r/e);let i=[];for(let e=0;e<sensorManager.sensorListUS.length;e++){satellite.setobs(sensorManager.sensorListUS[e]);for(let t=0;t<24*satellite.lookanglesLength*60*60;t+=satellite.lookanglesInterval){let a=l(t+s,n,sensorManager.sensorListUS[e]);void 0!==a&&(i.push(a),t+=60*o*.75)}}function l(e,t,a){var r=Date.now(),s=timeManager.propTimeCheck(1e3*e,r);let n=satellite.getRae(s,t,a);if(satellite.checkIsInFOV(a,n))return{time:s,el:elevation,az:azimuth,rng:range,name:a.shortName}}i.sort(function(e,t){return new Date(e.time)-new Date(t.time)}),satellite.lastMultiSiteArray=i,function(){console.log(i);var e=document.getElementById("looksmultisite");e.innerHTML="";var t=e.insertRow(),a=t.insertCell();a.appendChild(document.createTextNode("Time")),a.setAttribute("style","text-decoration: underline");var r=t.insertCell();r.appendChild(document.createTextNode("El")),r.setAttribute("style","text-decoration: underline");var s=t.insertCell();s.appendChild(document.createTextNode("Az")),s.setAttribute("style","text-decoration: underline");var n=t.insertCell();n.appendChild(document.createTextNode("Rng")),n.setAttribute("style","text-decoration: underline");var o=t.insertCell();o.appendChild(document.createTextNode("Sensor")),o.setAttribute("style","text-decoration: underline");for(let t=0;t<i.length;t++){let a;if(e.rows.length>0)for(let r=0;r<e.rows.length;r++){var l=e.rows[r].cells[0].textContent,g=parseInt(l.substr(0,4)),u=parseInt(l.substr(5,2))-1,d=parseInt(l.substr(8,2)),c=parseInt(l.substr(11,2)),m=parseInt(l.substr(14,2)),h=parseInt(l.substr(17,2)),p=new Date(g,u,d,c,m,h);if(p.setUTCDate(d),p.setUTCHours(c),i[t].time<p){a=e.insertRow(t);break}}null==a&&(a=e.insertRow()),a.insertCell().appendChild(document.createTextNode(timeManager.dateFormat(i[t].time,"isoDateTime",!0))),a.insertCell().appendChild(document.createTextNode(i[t].el.toFixed(1))),a.insertCell().appendChild(document.createTextNode(i[t].az.toFixed(0))),a.insertCell().appendChild(document.createTextNode(i[t].rng.toFixed(0))),a.insertCell().appendChild(document.createTextNode(i[t].name))}}(),sensorManager.currentSensor=a?sensorManager.defaultSensor:sensorManager.tempSensor}),satellite.getOrbitByLatLon=((e,t,n,o,i,l,g)=>{var u,d,c,m,h,p,T,b,v,M;for(void 0===g&&(g=0),M=0;M<5200;M+=1){if(1===(T=L(M))){if(v===o){M;break}M+=20}5===T&&(M+=100)}if(2===T)return console.warn("meanACalcResults failed after trying all combinations!"),["Error",""];if(void 0!==l&&0!==l)for(T=0,M=0;M<3600;M+=1){if(1===(p=x(M))){if(1===T&&v===o)break}else console.log("Failed Arg of Per Calc");if(5===p&&(M+=50),2===p)return["Error",""];for(var f=0;f<5200;f+=1){if(1===(T=L(f))){if(v===o)break;f+=20}if(5===T&&(f+=100),2===T)return["Error",""]}}for(M=0;M<52e4;M+=1){var C=k(M,g);if(1===C)break;5===C&&(M+=1e3)}return[u,d];function S(e,t){return e.length<t?S("0"+e,t):e}function x(t){var r,s,n=satellite.twoline2satrec(e.TLE1,e.TLE2);(r=(r=void 0===c?(n.mo*a).toPrecision(10):c).split("."))[0]=r[0].substr(-3,3),r[1]=r[1].substr(0,4),r=S(r=(r[0]+"."+r[1]).toString(),8),(s=(s=void 0===m?(e.raan*a).toPrecision(7):m).split("."))[0]=s[0].substr(-3,3),s[1]=s[1].substr(0,4),s=S(s=(s[0]+"."+s[1]).toString(),8),m=s;var o=e.SCC_NUM,l=e.TLE1.substr(9,8),g=(e.inclination*a).toPrecision(7);(g=g.split("."))[0]=g[0].substr(-3,3),g[1]=g[1].substr(0,4),g=S(g=(g[0]+"."+g[1]).toString(),8);var p=e.TLE1.substr(18,2),T=e.TLE1.substr(20,12),b=e.TLE2.substr(52,11),v=e.eccentricity.toPrecision(7).substr(2,7);t/=10,t=S(t=parseFloat(t).toPrecision(7),8);var M=e.TLE1.substr(32,39);u="1 "+o+"U "+l+" "+p+T+M,d="2 "+o+" "+g+" "+s+" "+v+" "+t+" "+r+" "+b+"    10",n=satellite.twoline2satrec(u,d);var f=w(i,n,3);return e.TLE1=u,e.TLE2=d,h=t,f}function L(t){var r=satellite.twoline2satrec(e.TLE1,e.TLE2);t/=10,t=S(t=parseFloat(t).toPrecision(7),8);var s=(e.raan*a).toPrecision(7);m=s,(s=s.toString().split("."))[0]=s[0].substr(-3,3),s[1]=s[1].substr(0,4),s=S(s=(s[0]+"."+s[1]).toString(),8);var n=e.SCC_NUM,o=e.TLE1.substr(9,8),l=(e.inclination*a).toPrecision(7);(l=l.split("."))[0]=l[0].substr(-3,3),l[1]=l[1].substr(0,4),l=S(l=(l[0]+"."+l[1]).toString(),8);var g,p=e.TLE1.substr(18,2),T=e.TLE1.substr(20,12),b=e.TLE2.substr(52,11),v=e.eccentricity.toPrecision(7).substr(2,7);(g=(g=void 0===h?(e.argPe*a).toPrecision(7):h).split("."))[0]=g[0].substr(-3,3),g[1]=g[1].substr(0,4),g=S(g=(g[0]+"."+g[1]).toString(),8);var M="1 "+n+"U "+o+" "+p+T+e.TLE1.substr(32,39),f="2 "+n+" "+l+" "+s+" "+v+" "+g+" "+t+" "+b+"    10";r=satellite.twoline2satrec(M,f);var C=w(i,r,1);return 1===C&&(u=M,d=f,e.TLE1=M,e.TLE2=f,c=t),C}function k(t,r){var s=satellite.twoline2satrec(e.TLE1,e.TLE2),n=c;rascNum=t,(t/=100)>360&&(t-=360),(t=(t=t.toPrecision(7)).split("."))[0]=t[0].substr(-3,3),t[1]=t[1].substr(0,4),t=S(t=(t[0]+"."+t[1]).toString(),8),m=t;var o=e.SCC_NUM,l=e.TLE1.substr(9,8),g=(e.inclination*a).toPrecision(7);(g=g.split("."))[0]=g[0].substr(-3,3),g[1]=g[1].substr(0,4),g=S(g=(g[0]+"."+g[1]).toString(),8);var p,T=e.TLE1.substr(18,2),b=e.TLE1.substr(20,12),v=e.TLE2.substr(52,11),M=e.eccentricity.toPrecision(7).substr(2,7);(p=(p=void 0===h?(e.argPe*a).toPrecision(7):h).split("."))[0]=p[0].substr(-3,3),p[1]=p[1].substr(0,4),p=S(p=(p[0]+"."+p[1]).toString(),8);var f=e.TLE1.substr(32,39);u="1 "+o+"U "+l+" "+T+b+f,d="2 "+o+" "+g+" "+t+" "+M+" "+p+" "+n+" "+v+"    10",s=satellite.twoline2satrec(u,d);var C=w(i,s,2);return 1===C&&(e.TLE1=u,(t=rascNum/100+r)>360&&(t-=360),t<0&&(t+=360),(t=(t=t.toPrecision(7)).split("."))[0]=t[0].substr(-3,3),t[1]=t[1].substr(0,4),t=S(t=(t[0]+"."+t[1]).toString(),8),m=t,d="2 "+o+" "+g+" "+t+" "+M+" "+p+" "+n+" "+v+"    10",e.TLE2=d),C}function w(e,a,o){timeManager.propRealTime=Date.now();var i=timeManager.propTimeCheck(e,timeManager.propRealTime),g=timeManager.jday(i.getUTCFullYear(),i.getUTCMonth()+1,i.getUTCDate(),i.getUTCHours(),i.getUTCMinutes(),i.getUTCSeconds());g+=i.getUTCMilliseconds()*s;var u,d,c,m,h=satellite.gstime(g),p=(g-a.jdsatepoch)*r,T=satellite.sgp4(a,p);void 0===T&&console.log(a);try{u=satellite.eciToGeodetic(T.position,h)}catch(e){return console.warn(e),2}if(d=1*satellite.degreesLat(u.latitude),c=1*satellite.degreesLong(u.longitude),m=u.height,null==b&&(b=d),1===o){if(d===b)return 0;d>b&&(v="N"),d<b&&(v="S"),b=d}return d>t-.15&&d<t+.15&&1===o?1:c>n-.15&&c<n+.15&&2===o?1:m>l-30&&m<l+30&&3===o?1:(d>t-11&&d<t+11||1!==o)&&(c>n-11&&c<n+11||2!==o)?(m<l-100||m>l+100)&&3===o?5:0:5}}),satellite.calculateLookAngles=((e,a,r)=>{!function(){if(void 0===a){if(!sensorManager.checkSensorSelected())return void console.error("getlookangles2 requires a sensor!");a=sensorManager.currentSensor}else{if(void 0===a.obsminaz)return void console.error("sensor format incorrect");a.observerGd={latitude:a.lat*t,longitude:a.long*t,height:parseFloat(a.obshei)}}void 0===e?console.error("sat parameter required!"):void 0!==e.TLE1&&void 0!==e.TLE2||console.error("sat parameter invalid format!"),void 0===r&&(r=0),void 0===satellite.isRiseSetLookangles&&(satellite.isRiseSetLookangles=!1)}(),void 0===r&&(r=0);var s,n=0,o=satellite.twoline2satrec(e.TLE1,e.TLE2),i=[];satellite.isRiseSetLookangles&&(s=satellite.lookanglesInterval,satellite.lookanglesInterval=1);for(var l=0;l<24*satellite.lookanglesLength*60*60;l+=satellite.lookanglesInterval)n=1e3*l+r,i.length<=5e3&&(lookanglesRow=g(n,o),"undefined"!=typeof lookanglesRow&&i.push(lookanglesRow));function g(e,t){let r=new Date;r.setTime(Number(Date.now())+e);let s=satellite.getRae(r,t,a);if(satellite.checkIsInFOV(a,s)){if(satellite.isRiseSetLookangles){var n=new Date;return n.setTime(Number(Date.now())+e-1e3*satellite.lookanglesInterval),aer1=satellite.getRae(n,t,a),isInFOV1=satellite.checkIsInFOV(a,aer1),isInFOV1?(n.setTime(Number(Date.now())+e-1e3*satellite.lookanglesInterval),aer1=satellite.getRae(n,t,a),isInFOV1=satellite.checkIsInFOV(a,aer1),isInFOV1?void 0:{time:timeManager.dateFormat(r,"isoDateTime",!0),rng:range,az:azimuth,el:elevation}):{time:timeManager.dateFormat(r,"isoDateTime",!0),rng:range,az:azimuth,el:elevation}}return{time:timeManager.dateFormat(r,"isoDateTime",!0),rng:range,az:azimuth,el:elevation}}}return satellite.isRiseSetLookangles&&(satellite.lookanglesInterval=s),i}),satellite.findBestPasses=((e,t)=>{for(var a=e.split(","),r=[],s=0;s<a.length;s++)try{for(var n=satSet.getSat(satSet.getIdFromObjNum(a[s])),o=satellite.findBestPass(n,t,0),i=0;i<o.length;i++)r.push(o[i])}catch(e){console.warn(e)}let l=r.sort((e,t)=>t.sortTime-e.sortTime);l.reverse(),l.forEach(function(e){delete e.sortTime});for(let e=0;e<l.length;e++)l[e].startDate=l[e].startDate.toISOString().split("T")[0],l[e].startTime=l[e].startTime.toISOString().split("T")[1].split(".")[0],l[e].stopDate=l[e].stopDate.toISOString().split("T")[0],l[e].stopTime=l[e].stopTime.toISOString().split("T")[1].split(".")[0];saveCsv(l,"bestSatTimes")}),satellite.findBestPass=((a,s,n)=>{!function(){if(void 0===s){if(!sensorManager.checkSensorSelected())return void console.error("getlookangles2 requires a sensor!");s=sensorManager.currentSensor}else{if(void 0===s.obsminaz)return void console.error("sensor format incorrect");s.observerGd={latitude:s.lat*t,longitude:s.long*t,height:parseFloat(s.obshei)}}void 0===a?console.error("sat parameter required!"):void 0!==a.TLE1&&void 0!==a.TLE2||console.error("sat parameter invalid format!")}(),void 0===n&&(n=0);var o=0,i=satellite.twoline2satrec(a.TLE1,a.TLE2),l=[];looksInterval=5,looksLength=7;for(var g=0,u=null,d=null,c=null,m=null,h=s.obsmaxrange,p=0,T=!1,b=!1,v=r/(i.no*r/e),M=0;M<24*looksLength*60*60;M+=looksInterval)o=1e3*M+n,l.length<=5e3&&(lookanglesRow=f(o,i),"undefined"!=typeof lookanglesRow&&(l.push(lookanglesRow),g=0,u=null,d=null,c=null,m=null,h=s.obsmaxrange,p=0,T=!1,b=!1,M+=60*v*.75));return l;function f(e,t){let a=new Date;a.setTime(Number(Date.now())+e);let r=satellite.getRae(a,t,s);if(satellite.checkIsInFOV(s,r)){let r=new Date;r.setTime(Number(Date.now())+e-1e3*looksInterval),aer1=satellite.getRae(r,t,s);let n=satellite.checkIsInFOV(s,aer1);if(n){if(r.setTime(Number(Date.now())+e+1e3*looksInterval),aer1=satellite.getRae(r,t,s),!(n=satellite.checkIsInFOV(s,aer1))){b=elevation<=3.5,g=Math.min((a-m)/1e3/60*10/8,10);let e=Math.min(p/40*10,10);e-=Math.max((p-50)/5,0),g+=e*=T&&b?2:1,g+=Math.min(9e3/h,10),g-=Math.max((900-h)/10,0);let r=0;try{r=(a-m)/1e3}catch(e){r=0}return{sortTime:m,scc:t.satnum,score:g,startDate:m,startTime:m,startAz:u,startEl:d,startRange:c,stopDate:a,stopTime:a,stopAz:azimuth.toFixed(0),stopEl:elevation.toFixed(1),stopRange:range.toFixed(0),tic:r,minRange:h.toFixed(0),passMaxEl:p.toFixed(1)}}}else elevation<=3.5&&(T=!0),m=a,u=azimuth.toFixed(0),d=elevation.toFixed(1),c=range.toFixed(0);p<elevation&&(p=elevation),h>range&&(h=range)}}}),satellite.getRae=((e,t,d)=>{let c=(n=e.getUTCFullYear(),o=e.getUTCMonth()+1,i=e.getUTCDate(),l=e.getUTCHours(),g=e.getUTCMinutes(),u=e.getUTCSeconds(),n?367*n-Math.floor(7*(n+Math.floor((o+9)/12))*.25)+Math.floor(275*o/9)+i+1721013.5+((u/60+g)/60+l)/24:(e=Date.now(),jDayStart=new Date(e.getFullYear(),0,0),jDayDiff=e-jDayStart,Math.floor(jDayDiff/s)));c+=e.getUTCMilliseconds()*s;let m=satellite.gstime(c),h=(c-t.jdsatepoch)*r,p=satellite.sgp4(t,h),T=satellite.eciToEcf(p.position,m),b=satellite.ecfToLookAngles(d.observerGd,T);return azimuth=b.azimuth*a,elevation=b.elevation*a,range=b.rangeSat,{az:azimuth,el:elevation,range:range}}),satellite.checkIsInFOV=((e,t)=>{let a=t.az,r=t.el,s=t.range;return e.obsminaz>e.obsmaxaz?(a>=e.obsminaz||a<=e.obsmaxaz)&&r>=e.obsminel&&r<=e.obsmaxel&&s<=e.obsmaxrange&&s>=e.obsminrange||(a>=e.obsminaz2||a<=e.obsmaxaz2)&&r>=e.obsminel2&&r<=e.obsmaxel2&&s<=e.obsmaxrange2&&s>=e.obsminrange2:a>=e.obsminaz&&a<=e.obsmaxaz&&r>=e.obsminel&&r<=e.obsmaxel&&s<=e.obsmaxrange&&s>=e.obsminrange||a>=e.obsminaz2&&a<=e.obsmaxaz2&&r>=e.obsminel2&&r<=e.obsmaxel2&&s<=e.obsmaxrange2&&s>=e.obsminrange2}),satellite.getDOPsTable=((e,t,a)=>{let r,s=document.getElementById("dops");s.innerHTML="";let n=timeManager.getPropOffset(),o=0,i=s.insertRow(),l=i.insertCell();l.appendChild(document.createTextNode("Time"));let g=i.insertCell();g.appendChild(document.createTextNode("HDOP"));let u=i.insertCell();u.appendChild(document.createTextNode("PDOP"));let d=i.insertCell();d.appendChild(document.createTextNode("GDOP"));for(let c=0;c<1440;c++)o=1e3*c*60+n,r=timeManager.propTimeCheck(o,timeManager.propRealTime),dops=satellite.getDOPs(e,t,a,!1,r),(l=(i=s.insertRow()).insertCell()).appendChild(document.createTextNode(timeManager.dateFormat(r,"isoDateTime",!0))),(g=i.insertCell()).appendChild(document.createTextNode(dops.HDOP)),(u=i.insertCell()).appendChild(document.createTextNode(dops.PDOP)),(d=i.insertCell()).appendChild(document.createTextNode(dops.GDOP))}),satellite.getDOPs=((e,r,s,n,o)=>{if(void 0!==e){if(void 0!==r){var i,l;s=void 0!==s?s:0,n=void 0!==n&&n,e*=t,r*=t;var g=[];void 0===groups.GPSGroup&&(groups.GPSGroup=new groups.SatGroup("nameRegex",/NAVSTAR/)),void 0===o&&(o=timeManager.propTime());var u=timeManager.jday(o.getUTCFullYear(),o.getUTCMonth()+1,o.getUTCDate(),o.getUTCHours(),o.getUTCMinutes(),o.getUTCSeconds());u+=1.15741e-8*o.getUTCMilliseconds();var d=satellite.gstime(u),c={},m=Math.cos(e),h=Math.sin(e),p=Math.cos(r+d),T=Math.sin(r+d);c.x=6371.25*m*p,c.y=6371.25*m*T,c.z=6371.25*h;for(var b=0;b<groups.GPSGroup.sats.length;b++)i=satSet.getSat(groups.GPSGroup.sats[b].satId),l=satellite.ecfToLookAngles({longitude:r,latitude:e,height:s},satellite.eciToEcf(i.position,d)),i.az=l.azimuth*a,i.el=l.elevation*a,i.el>settingsManager.gpsElevationMask&&g.push(i);return satellite.calculateDOPs(g,c,n)}console.error("Longitude Required")}else console.error("Latitude Required")}),satellite.calculateDOPs=((e,t,a)=>{var r={};if(nsat=e.length,nsat<4)return r.PDOP=50,r.HDOP=50,r.GDOP=50,r.VDOP=50,r.TDOP=50,r;var s=numeric.rep([nsat,4],0),n=[],o=[];a&&(drawLineList=[]);for(var i=1;i<=nsat;i++){var l=e[i-1];a&&(drawLineList[i-1]={},drawLineList[i-1].line=new Line,drawLineList[i-1].sat=l,drawLineList[i-1].ref=[t.x,t.y,t.z]);var g=l.az,u=l.el;n.push(g),o.push(u);var d=[Math.cos(u*Math.PI/180)*Math.sin(g*Math.PI/180),Math.cos(u*Math.PI/180)*Math.cos(g*Math.PI/180),Math.sin(u*Math.PI/180),1];numeric.setBlock(s,[i-1,0],[i-1,3],[d])}var c=numeric.dot(numeric.transpose(s),s),m=numeric.inv(c),h=Math.sqrt(m[0][0]+m[1][1]+m[2][2]),p=Math.sqrt(m[0][0]+m[1][1]),T=Math.sqrt(m[0][0]+m[1][1]+m[2][2]+m[3][3]),b=Math.sqrt(m[2][2]),v=Math.sqrt(m[3][3]);return r.PDOP=parseFloat(Math.round(100*h)/100).toFixed(2),r.HDOP=parseFloat(Math.round(100*p)/100).toFixed(2),r.GDOP=parseFloat(Math.round(100*T)/100).toFixed(2),r.VDOP=parseFloat(Math.round(100*b)/100).toFixed(2),r.TDOP=parseFloat(Math.round(100*v)/100).toFixed(2),r}),satellite.getSunTimes=((e,t,n,o)=>{if(void 0===t){if(void 0===sensorManager.currentSensor)throw"getTEARR requires a sensor or for a sensor to be currently selected.";t=sensorManager.currentSensor}if(void 0===t.observerGd)try{t.observerGd={height:t.obshei,latitude:t.lat,longitude:t.long}}catch(e){throw"observerGd is not set and could not be guessed."}void 0===n&&(n=satellite.lookanglesLength),void 0===o&&(o=satellite.lookanglesInterval);for(var i=timeManager.getPropOffset(),l=0,g=satellite.twoline2satrec(e.TLE1,e.TLE2),u=1e11,d=0;d<24*n*60*60;d+=o){l=1e3*d+i;var c=timeManager.propTimeCheck(l,timeManager.propRealTime),m=timeManager.jday(c.getUTCFullYear(),c.getUTCMonth()+1,c.getUTCDate(),c.getUTCHours(),c.getUTCMinutes(),c.getUTCSeconds());m+=c.getUTCMilliseconds()*s;var h,p,T,b,v,M=satellite.gstime(m),f=sun.getDirection2(m),C=1e6*f[0],S=1e6*f[1],x=1e6*f[2],L=(m-g.jdsatepoch)*r,k=satellite.sgp4(g,L),w=Math.pow(C-k.position.x,2),D=Math.pow(S-k.position.y,2),I=Math.pow(x-k.position.z,2),z=Math.sqrt(w+D+I);h=satellite.eciToEcf(k.position,M),p=satellite.ecfToLookAngles(t.observerGd,h),gpos=satellite.eciToGeodetic(k.position,M),alt=1e3*gpos.height,lon=gpos.longitude,lat=gpos.latitude,T=p.azimuth*a,b=p.elevation*a,v=p.rangeSat,t.obsminaz>t.obsmaxaz?((T>=t.obsminaz||T<=t.obsmaxaz)&&b>=t.obsminel&&b<=t.obsmaxel&&v<=t.obsmaxrange&&v>=t.obsminrange||(T>=t.obsminaz2||T<=t.obsmaxaz2)&&b>=t.obsminel2&&b<=t.obsmaxel2&&v<=t.obsmaxrange2&&v>=t.obsminrange2)&&z<u&&(u=z,c):(T>=t.obsminaz&&T<=t.obsmaxaz&&b>=t.obsminel&&b<=t.obsmaxel&&v<=t.obsmaxrange&&v>=t.obsminrange||T>=t.obsminaz2&&T<=t.obsmaxaz2&&b>=t.obsminel2&&b<=t.obsmaxel2&&v<=t.obsmaxrange2&&v>=t.obsminrange2)&&z<u&&(u=z,c)}}),satellite.lookAnglesToEcf=((e,a,r,s,n,o)=>{var i={};i.latitude=s,i.longitude=n,i.height=o;var l,g,u,d=satellite.geodeticToEcf(i);l=d.x,g=d.y,u=d.z;var c=Math.sin(s),m=Math.sin(n),h=Math.cos(s),p=Math.cos(n),T=t*e,b=t*a,v=-r*Math.cos(b)*Math.cos(T),M=r*Math.cos(b)*Math.sin(T),f=r*Math.sin(b);return{x:c*p*v+-m*M+h*p*f+l,y:c*m*v+p*M+h*m*f+g,z:-h*v+c*f+u}}),satellite.eci2ll=((e,t,r)=>{var s=timeManager.propTime(),n=timeManager.jday(s.getUTCFullYear(),s.getUTCMonth()+1,s.getUTCDate(),s.getUTCHours(),s.getUTCMinutes(),s.getUTCSeconds());n+=1.15741e-8*s.getUTCMilliseconds();var o=satellite.gstime(n),i=satellite.eciToGeodetic({x:e,y:t,z:r},o);return i.latitude=i.latitude*a,i.longitude=i.longitude*a,i.longitude=i.longitude>180?i.longitude-360:i.longitude,i.longitude=i.longitude<-180?i.longitude+360:i.longitude,i}),satellite.map=((e,t)=>{var n=timeManager.getPropOffset(),o=satellite.twoline2satrec(e.TLE1,e.TLE2);return function(e,t){var n=timeManager.propTimeCheck(e,timeManager.propRealTime),o=timeManager.jday(n.getUTCFullYear(),n.getUTCMonth()+1,n.getUTCDate(),n.getUTCHours(),n.getUTCMinutes(),n.getUTCSeconds());o+=n.getUTCMilliseconds()*s;var i,l,g,u=satellite.gstime(o),d=(o-t.jdsatepoch)*r,c=satellite.sgp4(t,d);i=satellite.eciToGeodetic(c.position,u),l=satellite.degreesLat(i.latitude),g=satellite.degreesLong(i.longitude);var m,h,p,T,b,v=timeManager.dateFormat(n,"isoDateTime",!0);m=satellite.eciToEcf(c.position,u),h=satellite.ecfToLookAngles(sensorManager.currentSensor.observerGd,m),p=h.azimuth*a,T=h.elevation*a,b=h.rangeSat;var M=0;sensorManager.currentSensor.obsminaz<sensorManager.currentSensor.obsmaxaz?(p>=sensorManager.currentSensor.obsminaz&&p<=sensorManager.currentSensor.obsmaxaz&&T>=sensorManager.currentSensor.obsminel&&T<=sensorManager.currentSensor.obsmaxel&&b<=sensorManager.currentSensor.obsmaxrange&&b>=sensorManager.currentSensor.obsminrange||p>=sensorManager.currentSensor.obsminaz2&&p<=sensorManager.currentSensor.obsmaxaz2&&T>=sensorManager.currentSensor.obsminel2&&T<=sensorManager.currentSensor.obsmaxel2&&b<=sensorManager.currentSensor.obsmaxrange2&&b>=sensorManager.currentSensor.obsminrange2)&&(M=1):((p>=sensorManager.currentSensor.obsminaz||p<=sensorManager.currentSensor.obsmaxaz)&&T>=sensorManager.currentSensor.obsminel&&T<=sensorManager.currentSensor.obsmaxel&&b<=sensorManager.currentSensor.obsmaxrange&&b>=sensorManager.currentSensor.obsminrange||(p>=sensorManager.currentSensor.obsminaz2||p<=sensorManager.currentSensor.obsmaxaz2)&&T>=sensorManager.currentSensor.obsminel2&&T<=sensorManager.currentSensor.obsmaxel2&&b<=sensorManager.currentSensor.obsmaxrange2&&b>=sensorManager.currentSensor.obsminrange2)&&(M=1);return{lat:l,lon:g,time:v,inview:M}}(t*e.period/50*60*1e3+n,o)})}();