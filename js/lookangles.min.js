!function(){const e=2*Math.PI,t=e/360,a=360/e,s=1440,o=1.15741e-8;satellite.lookanglesInterval=5,satellite.lookanglesLength=2,satellite.isRiseSetLookangles=!1,satellite.currentSensor={},satellite.tempSensor={},satellite.currentTEARR={},satellite.defaultSensor={},satellite.defaultSensor.observerGd={lat:null,longitude:0,latitude:0,height:0},satellite.currentSensor=satellite.defaultSensor,satellite.sensorListUS=[window.sensorManager.sensorList.COD,window.sensorManager.sensorList.BLE,window.sensorManager.sensorList.CAV,window.sensorManager.sensorList.CLR,window.sensorManager.sensorList.EGL,window.sensorManager.sensorList.FYL,window.sensorManager.sensorList.THL,window.sensorManager.sensorList.MIL,window.sensorManager.sensorList.ALT,window.sensorManager.sensorList.ASC,window.sensorManager.sensorList.CDN],satellite.checkSensorSelected=function(){return null!=satellite.currentSensor.lat},satellite.currentEpoch=function(e){var t=(e=new Date(e)).getUTCFullYear();t=parseInt(t.toString().substr(2,2));var a=s(timeManager.getDayOfYear(e),3);function s(e,t){return e.length<t?s("0"+e,t):e}return[t,a=s(a=(a+(60*e.getUTCHours()+e.getUTCMinutes())/1440).toFixed(8),12)]},satellite.distance=function(e,t){if(null==t||null==e)return"";if("Star"===t.type||"Star"===e.type)return"";var a=Math.pow(e.position.x-t.position.x,2),s=Math.pow(e.position.y-t.position.y,2),o=Math.pow(e.position.z-t.position.z,2);return"<br />"+Math.sqrt(a+s+o).toFixed(0)+" km"},satellite.getsensorinfo=function(){$("#sensor-latitude").html(satellite.currentSensor.lat),$("#sensor-longitude").html(satellite.currentSensor.long),$("#sensor-minazimuth").html(satellite.currentSensor.obsminaz),$("#sensor-maxazimuth").html(satellite.currentSensor.obsmaxaz),$("#sensor-minelevation").html(satellite.currentSensor.obsminel),$("#sensor-maxelevation").html(satellite.currentSensor.obsmaxel),$("#sensor-minrange").html(satellite.currentSensor.obsminrange),$("#sensor-maxrange").html(satellite.currentSensor.obsmaxrange)},satellite.setobs=function(e,a){if(a)return satellite.currentSensor=satellite.defaultSensor,void $(".sensor-reset-menu").hide();$("#menu-sensor-info").removeClass("bmenu-item-disabled"),$("#menu-fov-bubble").removeClass("bmenu-item-disabled"),$("#menu-surveillance").removeClass("bmenu-item-disabled"),$("#menu-planetarium").removeClass("bmenu-item-disabled"),$("#menu-astronomy").removeClass("bmenu-item-disabled"),$(".sensor-reset-menu").show(),satellite.currentSensor=e,satellite.currentSensor.observerGd={latitude:e.lat*t,longitude:e.long*t,height:parseFloat(e.obshei)}},satellite.altitudeCheck=function(e,t,a){var n;void 0!==e.TLE1?(a=t,n=satellite.twoline2satrec(e.TLE1,e.TLE2)):n=satellite.twoline2satrec(e,t);var i=timeManager.propTimeCheck(a,timeManager.propRealTime),r=timeManager.jday(i.getUTCFullYear(),i.getUTCMonth()+1,i.getUTCDate(),i.getUTCHours(),i.getUTCMinutes(),i.getUTCSeconds());r+=i.getUTCMilliseconds()*o;var l,g=satellite.gstime(r),m=(r-n.jdsatepoch)*s,u=satellite.sgp4(n,m);try{l=satellite.eciToGeodetic(u.position,g)}catch(e){return 0}return l.height},satellite.getDirection=function(e){var t=satellite.getTEARR(e).lat,s=timeManager.propTimeCheck(5e3,timeManager.propTime()),o=satellite.getTEARR(e,void 0,s).lat;if((t*=a)<(o*=a))return"N";if(t>o)return"S";if(t===o){if(s=timeManager.propTimeCheck(2e4,timeManager.propTime()),futureTEARR=satellite.getTEARR(e,void 0,s),t<o)return"N";if(t>o)return"S"}return console.error("Sat Direction Calculation Error - By Pole?"),"Error"},satellite.getTEARR=function(e,n,i){var r={};if(void 0===n){if(void 0===satellite.currentSensor)throw"getTEARR requires a sensor or for a sensor to be currently selected.";n=satellite.currentSensor}if(void 0===n.observerGd){try{n.observerGd={height:n.obshei,latitude:n.lat,longitude:n.long}}catch(e){throw"observerGd is not set and could not be guessed."}if(void 0===n.observerGd.longitude)try{n.observerGd={height:n.alt,latitude:n.lat*t,longitude:n.lon*t}}catch(e){throw"observerGd is not set and could not be guessed."}}var l,g=satellite.twoline2satrec(e.TLE1,e.TLE2);l=void 0===i?timeManager.propTime():i;var m=timeManager.jday(l.getUTCFullYear(),l.getUTCMonth()+1,l.getUTCDate(),l.getUTCHours(),l.getUTCMinutes(),l.getUTCSeconds());m+=l.getUTCMilliseconds()*o;var u,c,d,b=satellite.gstime(m),T=(m-g.jdsatepoch)*s,p=satellite.sgp4(g,T);try{d=satellite.eciToGeodetic(p.position,b),r.alt=d.height,r.lon=d.longitude,r.lat=d.latitude,u=satellite.eciToEcf(p.position,b),c=satellite.ecfToLookAngles(n.observerGd,u),r.azimuth=c.azimuth*a,r.elevation=c.elevation*a,r.range=c.rangeSat}catch(e){r.alt=0,r.lon=0,r.lat=0,u=0,c=0,r.azimuth=0,r.elevation=0,r.range=0}return n.obsminaz>n.obsmaxaz?(r.azimuth>=n.obsminaz||r.azimuth<=n.obsmaxaz)&&r.elevation>=n.obsminel&&r.elevation<=n.obsmaxel&&r.range<=n.obsmaxrange&&r.range>=n.obsminrange||(r.azimuth>=n.obsminaz2||r.azimuth<=n.obsmaxaz2)&&r.elevation>=n.obsminel2&&r.elevation<=n.obsmaxel2&&r.range<=n.obsmaxrange2&&r.range>=n.obsminrange2?r.inview=!0:r.inview=!1:r.azimuth>=n.obsminaz&&r.azimuth<=n.obsmaxaz&&r.elevation>=n.obsminel&&r.elevation<=n.obsmaxel&&r.range<=n.obsmaxrange&&r.range>=n.obsminrange||r.azimuth>=n.obsminaz2&&r.azimuth<=n.obsmaxaz2&&r.elevation>=n.obsminel2&&r.elevation<=n.obsmaxel2&&r.range<=n.obsmaxrange2&&r.range>=n.obsminrange2?r.inview=!0:r.inview=!1,satellite.currentTEARR=r,r},satellite.exportTle2Csv=function(){let e=[],t=satSet.getSatData();t.sort((e,t)=>parseInt(e.SCC_NUM)-parseInt(t.SCC_NUM));for(let a=0;a<t.length;a++){let s=t[a];void 0!==s.TLE1&&void 0!==s.TLE2&&("ANALSAT"!=s.C&&e.push({satId:s.SCC_NUM,TLE1:s.TLE1,TLE2:s.TLE2,inclination:s.inclination,eccentricity:s.eccentricity,period:s.period,raan:s.raan,apogee:s.apogee,perigee:s.perigee,site:s.LS,country:s.C,name:s.ON,rocket:s.LV}))}saveCsv(e,"catalogTLE2")},satellite.exportTle2Txt=function(){let e=[],t=satSet.getSatData();t.sort((e,t)=>parseInt(e.SCC_NUM)-parseInt(t.SCC_NUM));for(let a=0;a<t.length;a++){let s=t[a];void 0!==s.TLE1&&void 0!==s.TLE2&&("ANALSAT"!=s.C&&(e.push(s.TLE1),e.push(s.TLE2)))}e=e.join("\n");var a=new Blob([e],{type:"text/plain;charset=utf-8"});saveAs(a,"TLE.txt")},satellite.calculateSatrec=function(){console.time("satrecCache");for(var e,t=[],a=0;a<satSet.getSatData().length;a++)sat=satSet.getSat(a),sat.static||sat.missile||!sat.active||(e=satellite.twoline2satrec(sat.TLE1,sat.TLE2),t.push({SCC_NUM:sat.SCC_NUM,satrec:e}));window.satrecCache=t,console.timeEnd("satrecCache")},satellite.nextpassList=function(e){for(var t=[],a=0;a<e.length;a++)for(var s=satellite.nextNpasses(e[a],void 0,864e5,satellite.lookanglesInterval,settingsManager.nextNPassesCount),o=0;o<s.length;o++)t.push({SCC_NUM:e[a].SCC_NUM,time:s[o]});return t},satellite.nextpass=function(e,t,n,i){if(void 0===t){if(void 0===satellite.currentSensor)throw"getTEARR requires a sensor or for a sensor to be currently selected.";t=satellite.currentSensor}if(void 0===t.observerGd)try{t.observerGd={height:t.obshei,latitude:t.lat,longitude:t.long}}catch(e){throw"observerGd is not set and could not be guessed."}void 0===n&&(n=satellite.lookanglesLength),void 0===i&&(i=satellite.lookanglesInterval);for(var r=timeManager.getPropOffset(),l=0,g=satellite.twoline2satrec(e.TLE1,e.TLE2),m=0;m<24*n*60*60;m+=i){l=1e3*m+r;var u=timeManager.propTimeCheck(l,timeManager.propRealTime),c=timeManager.jday(u.getUTCFullYear(),u.getUTCMonth()+1,u.getUTCDate(),u.getUTCHours(),u.getUTCMinutes(),u.getUTCSeconds());c+=u.getUTCMilliseconds()*o;var d,b,T,p,h,v=satellite.gstime(c),C=(c-g.jdsatepoch)*s,x=satellite.sgp4(g,C);if(d=satellite.eciToEcf(x.position,v),T=(b=satellite.ecfToLookAngles(t.observerGd,d)).azimuth*a,p=b.elevation*a,h=b.rangeSat,t.obsminaz>t.obsmaxaz){if((T>=t.obsminaz||T<=t.obsmaxaz)&&p>=t.obsminel&&p<=t.obsmaxel&&h<=t.obsmaxrange&&h>=t.obsminrange||(T>=t.obsminaz2||T<=t.obsmaxaz2)&&p>=t.obsminel2&&p<=t.obsmaxel2&&h<=t.obsmaxrange2&&h>=t.obsminrange2)return timeManager.dateFormat(u,"isoDateTime",!0)}else if(T>=t.obsminaz&&T<=t.obsmaxaz&&p>=t.obsminel&&p<=t.obsmaxel&&h<=t.obsmaxrange&&h>=t.obsminrange||T>=t.obsminaz2&&T<=t.obsmaxaz2&&p>=t.obsminel2&&p<=t.obsmaxel2&&h<=t.obsmaxrange2&&h>=t.obsminrange2)return timeManager.dateFormat(u,"isoDateTime",!0)}return"No Passes in "+satellite.lookanglesLength+" Days"},satellite.nextNpasses=function(t,n,i,r,l){if(void 0===n){if(void 0===satellite.currentSensor)throw"getTEARR requires a sensor or for a sensor to be currently selected.";n=satellite.currentSensor}if(void 0===n.observerGd)try{n.observerGd={height:n.obshei,latitude:n.lat,longitude:n.long}}catch(e){throw"observerGd is not set and could not be guessed."}void 0===i&&(i=satellite.lookanglesLength),void 0===r&&(r=satellite.lookanglesInterval);let g=[],m=timeManager.getPropOffset(),u=satellite.twoline2satrec(t.TLE1,t.TLE2);const c=s/(u.no*s/e);for(let e=0;e<24*i*60*60;e+=r){if(g.length>=l)return g;let t=e+m,i=timeManager.propTimeCheck(1e3*t,timeManager.propRealTime),r=timeManager.jday(i.getUTCFullYear(),i.getUTCMonth()+1,i.getUTCDate(),i.getUTCHours(),i.getUTCMinutes(),i.getUTCSeconds());r+=i.getUTCMilliseconds()*o;let d=satellite.gstime(r),b=(r-u.jdsatepoch)*s,T=satellite.sgp4(u,b),p=satellite.eciToEcf(T.position,d),h=satellite.ecfToLookAngles(n.observerGd,p),v=h.azimuth*a,C=h.elevation*a,x=h.rangeSat;n.obsminaz>n.obsmaxaz?((v>=n.obsminaz||v<=n.obsmaxaz)&&C>=n.obsminel&&C<=n.obsmaxel&&x<=n.obsmaxrange&&x>=n.obsminrange||(v>=n.obsminaz2||v<=n.obsmaxaz2)&&C>=n.obsminel2&&C<=n.obsmaxel2&&x<=n.obsmaxrange2&&x>=n.obsminrange2)&&(g.push(i),e+=60*c*.75):(v>=n.obsminaz&&v<=n.obsmaxaz&&C>=n.obsminel&&C<=n.obsmaxel&&x<=n.obsmaxrange&&x>=n.obsminrange||v>=n.obsminaz2&&v<=n.obsmaxaz2&&C>=n.obsminel2&&C<=n.obsmaxel2&&x<=n.obsmaxrange2&&x>=n.obsminrange2)&&(g.push(i),e+=60*c*.75)}return g},satellite.lastlooksArray=[],satellite.getlookangles=function(e){if(!satellite.checkSensorSelected())return void console.warn("satellite.getlookangles requires a sensor to be set!");let t=timeManager.getPropOffset(),n=satellite.twoline2satrec(e.TLE1,e.TLE2);n.no;let i=satellite.isRiseSetLookangles?1:satellite.lookanglesInterval,r=[];for(let e=0;e<24*satellite.lookanglesLength*60*60;e+=i){let a=l(e+t,n);if(void 0!==a&&r.push(a),r.length>=1500)break}function l(e,t){let n=satellite.currentSensor;var i=Date.now(),r=timeManager.propTimeCheck(1e3*e,i),l=timeManager.jday(r.getUTCFullYear(),r.getUTCMonth()+1,r.getUTCDate(),r.getUTCHours(),r.getUTCMinutes(),r.getUTCSeconds());l+=r.getUTCMilliseconds()*o;var g=satellite.gstime(l),m=(l-t.jdsatepoch)*s,u=satellite.sgp4(t,m);let c=satellite.eciToEcf(u.position,g),d=satellite.ecfToLookAngles(n.observerGd,c),b=d.azimuth*a,T=d.elevation*a,p=d.rangeSat;function h(e,t,a){return n.obsminaz<n.obsmaxaz?e>=n.obsminaz&&e<=n.obsmaxaz&&t>=n.obsminel&&t<=n.obsmaxel&&a<=n.obsmaxrange&&a>=n.obsminrange||e>=n.obsminaz2&&e<=n.obsmaxaz2&&t>=n.obsminel2&&t<=n.obsmaxel2&&a<=n.obsmaxrange2&&a>=n.obsminrange2:(e>=n.obsminaz||e<=n.obsmaxaz)&&t>=n.obsminel&&t<=n.obsmaxel&&a<=n.obsmaxrange&&a>=n.obsminrange||(e>=n.obsminaz2||e<=n.obsmaxaz2)&&t>=n.obsminel2&&t<=n.obsmaxel2&&a<=n.obsmaxrange2&&a>=n.obsminrange2}if(function(e,t,a){return n.obsminaz<n.obsmaxaz?e>=n.obsminaz&&e<=n.obsmaxaz&&t>=n.obsminel&&t<=n.obsmaxel&&a<=n.obsmaxrange&&a>=n.obsminrange||e>=n.obsminaz2&&e<=n.obsmaxaz2&&t>=n.obsminel2&&t<=n.obsmaxel2&&a<=n.obsmaxrange2&&a>=n.obsminrange2:(e>=n.obsminaz||e<=n.obsmaxaz)&&t>=n.obsminel&&t<=n.obsmaxel&&a<=n.obsmaxrange&&a>=n.obsminrange||(e>=n.obsminaz2||e<=n.obsmaxaz2)&&t>=n.obsminel2&&t<=n.obsmaxel2&&a<=n.obsmaxrange2&&a>=n.obsminrange2}(b,T,p)){if(satellite.isRiseSetLookangles){let e=new Date;e.setTime(Number(r)-1e3*satellite.lookanglesInterval);let i=timeManager.jday(e.getUTCFullYear(),e.getUTCMonth()+1,e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds());i+=e.getUTCMilliseconds()*o;var v=satellite.gstime(i);let l=(i-t.jdsatepoch)*s,g=satellite.sgp4(t,l),m=satellite.eciToEcf(g.position,v),u=satellite.ecfToLookAngles(n.observerGd,m),c=u.azimuth*a,d=u.elevation*a,C=u.rangeSat;if(!h(c,d,C))return{time:timeManager.dateFormat(r,"isoDateTime",!0),rng:p,az:b,el:T};if(e.setTime(Number(r)+1e3*satellite.lookanglesInterval),i=timeManager.jday(e.getUTCFullYear(),e.getUTCMonth()+1,e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds()),i+=e.getUTCMilliseconds()*o,v=satellite.gstime(i),l=(i-t.jdsatepoch)*s,g=satellite.sgp4(t,l),m=satellite.eciToEcf(g.position,v),!h(c=(u=satellite.ecfToLookAngles(n.observerGd,m)).azimuth*a,d=u.elevation*a,C=u.rangeSat))return{time:timeManager.dateFormat(r,"isoDateTime",!0),rng:p,az:b,el:T};return}return{time:timeManager.dateFormat(r,"isoDateTime",!0),rng:p,az:b,el:T}}}r.sort(function(e,t){return new Date(e.time)-new Date(t.time)}),satellite.lastlooksArray=r,function(){var e=document.getElementById("looks");e.innerHTML="";var t=e.insertRow(),a=t.insertCell();a.appendChild(document.createTextNode("Time")),a.setAttribute("style","text-decoration: underline");var s=t.insertCell();s.appendChild(document.createTextNode("El")),s.setAttribute("style","text-decoration: underline");var o=t.insertCell();o.appendChild(document.createTextNode("Az")),o.setAttribute("style","text-decoration: underline");var n=t.insertCell();n.appendChild(document.createTextNode("Rng")),n.setAttribute("style","text-decoration: underline");for(let t=0;t<r.length;t++){let a;if(e.rows.length>0)for(let s=0;s<e.rows.length;s++){var i=e.rows[s].cells[0].textContent,l=parseInt(i.substr(0,4)),g=parseInt(i.substr(5,2))-1,m=parseInt(i.substr(8,2)),u=parseInt(i.substr(11,2)),c=parseInt(i.substr(14,2)),d=parseInt(i.substr(17,2)),b=new Date(l,g,m,u,c,d);if(b.setUTCDate(m),b.setUTCHours(u),r[t].time<b){a=e.insertRow(t);break}}null==a&&(a=e.insertRow()),a.insertCell().appendChild(document.createTextNode(timeManager.dateFormat(r[t].time,"isoDateTime",!0))),a.insertCell().appendChild(document.createTextNode(r[t].el.toFixed(1))),a.insertCell().appendChild(document.createTextNode(r[t].az.toFixed(0))),a.insertCell().appendChild(document.createTextNode(r[t].rng.toFixed(0)))}}()},satellite.lastMultiSiteArray=[],satellite.getlookanglesMultiSite=function(t){let n=!1;satellite.checkSensorSelected()||(n=!0),satellite.tempSensor=satellite.currentSensor;let i=timeManager.getPropOffset(),r=satellite.twoline2satrec(t.TLE1,t.TLE2);const l=s/(r.no*s/e);let g=[];for(let e=0;e<satellite.sensorListUS.length;e++){satellite.setobs(satellite.sensorListUS[e]);for(let t=0;t<24*satellite.lookanglesLength*60*60;t+=satellite.lookanglesInterval){let a=m(t+i,r,satellite.sensorListUS[e]);void 0!==a&&(g.push(a),t+=60*l*.75)}}function m(e,t,n){var i=Date.now(),r=timeManager.propTimeCheck(1e3*e,i),l=timeManager.jday(r.getUTCFullYear(),r.getUTCMonth()+1,r.getUTCDate(),r.getUTCHours(),r.getUTCMinutes(),r.getUTCSeconds());l+=r.getUTCMilliseconds()*o;var g=satellite.gstime(l),m=(l-t.jdsatepoch)*s,u=satellite.sgp4(t,m);let c=satellite.eciToEcf(u.position,g),d=satellite.ecfToLookAngles(n.observerGd,c),b=d.azimuth*a,T=d.elevation*a,p=d.rangeSat;if(!(n.obsminaz<n.obsmaxaz)||b>=n.obsminaz&&b<=n.obsmaxaz&&T>=n.obsminel&&T<=n.obsmaxel&&p<=n.obsmaxrange&&p>=n.obsminrange&&!(b>=n.obsminaz2&&b<=n.obsmaxaz2&&T>=n.obsminel2&&T<=n.obsmaxel2&&p<=n.obsmaxrange2&&p>=n.obsminrange2))return(b>=n.obsminaz||b<=n.obsmaxaz)&&T>=n.obsminel&&T<=n.obsmaxel&&p<=n.obsmaxrange&&p>=n.obsminrange||(b>=n.obsminaz2||b<=n.obsmaxaz2)&&T>=n.obsminel2&&T<=n.obsmaxel2&&p<=n.obsmaxrange2&&p>=n.obsminrange2?{time:r,el:T,az:b,rng:p,name:n.shortName}:void 0}g.sort(function(e,t){return new Date(e.time)-new Date(t.time)}),satellite.lastMultiSiteArray=g,function(){console.log(g);var e=document.getElementById("looksmultisite");e.innerHTML="";var t=e.insertRow(),a=t.insertCell();a.appendChild(document.createTextNode("Time")),a.setAttribute("style","text-decoration: underline");var s=t.insertCell();s.appendChild(document.createTextNode("El")),s.setAttribute("style","text-decoration: underline");var o=t.insertCell();o.appendChild(document.createTextNode("Az")),o.setAttribute("style","text-decoration: underline");var n=t.insertCell();n.appendChild(document.createTextNode("Rng")),n.setAttribute("style","text-decoration: underline");var i=t.insertCell();i.appendChild(document.createTextNode("Sensor")),i.setAttribute("style","text-decoration: underline");for(let t=0;t<g.length;t++){let a;if(e.rows.length>0)for(let s=0;s<e.rows.length;s++){var r=e.rows[s].cells[0].textContent,l=parseInt(r.substr(0,4)),m=parseInt(r.substr(5,2))-1,u=parseInt(r.substr(8,2)),c=parseInt(r.substr(11,2)),d=parseInt(r.substr(14,2)),b=parseInt(r.substr(17,2)),T=new Date(l,m,u,c,d,b);if(T.setUTCDate(u),T.setUTCHours(c),g[t].time<T){a=e.insertRow(t);break}}null==a&&(a=e.insertRow()),a.insertCell().appendChild(document.createTextNode(timeManager.dateFormat(g[t].time,"isoDateTime",!0))),a.insertCell().appendChild(document.createTextNode(g[t].el.toFixed(1))),a.insertCell().appendChild(document.createTextNode(g[t].az.toFixed(0))),a.insertCell().appendChild(document.createTextNode(g[t].rng.toFixed(0))),a.insertCell().appendChild(document.createTextNode(g[t].name))}}(),satellite.currentSensor=n?satellite.defaultSensor:satellite.tempSensor},satellite.getOrbitByLatLon=function(e,t,n,i,r,l,g){var m,u,c,d,b,T,p,h,v,C;for(void 0===g&&(g=0),C=0;C<5200;C+=1){if(1===(p=z(C))){if(v===i){C;break}C+=20}5===p&&(C+=100)}if(2===p)return console.warn("meanACalcResults failed after trying all combinations!"),["Error",""];if(void 0!==l&&0!==l)for(p=0,C=0;C<3600;C+=1){if(1===(T=S(C))){if(1===p&&v===i)break}else console.log("Failed Arg of Per Calc");if(5===T&&(C+=50),2===T)return["Error",""];for(var x=0;x<5200;x+=1){if(1===(p=z(x))){if(v===i)break;x+=20}if(5===p&&(x+=100),2===p)return["Error",""]}}for(C=0;C<52e4;C+=1){var M=L(C,g);if(1===M)break;5===M&&(C+=1e3)}return[m,u];function f(e,t){return e.length<t?f("0"+e,t):e}function S(t){var s,o,n=satellite.twoline2satrec(e.TLE1,e.TLE2);(s=(s=void 0===c?(n.mo*a).toPrecision(10):c).split("."))[0]=s[0].substr(-3,3),s[1]=s[1].substr(0,4),s=f(s=(s[0]+"."+s[1]).toString(),8),(o=(o=void 0===d?(e.raan*a).toPrecision(7):d).split("."))[0]=o[0].substr(-3,3),o[1]=o[1].substr(0,4),o=f(o=(o[0]+"."+o[1]).toString(),8),d=o;var i=e.SCC_NUM,l=e.TLE1.substr(9,8),g=(e.inclination*a).toPrecision(7);(g=g.split("."))[0]=g[0].substr(-3,3),g[1]=g[1].substr(0,4),g=f(g=(g[0]+"."+g[1]).toString(),8);var T=e.TLE1.substr(18,2),p=e.TLE1.substr(20,12),h=e.TLE2.substr(52,11),v=e.eccentricity.toPrecision(7).substr(2,7);t/=10,t=f(t=parseFloat(t).toPrecision(7),8);var C=e.TLE1.substr(32,39);m="1 "+i+"U "+l+" "+T+p+C,u="2 "+i+" "+g+" "+o+" "+v+" "+t+" "+s+" "+h+"    10",n=satellite.twoline2satrec(m,u);var x=U(r,n,3);return e.TLE1=m,e.TLE2=u,b=t,x}function z(t){var s=satellite.twoline2satrec(e.TLE1,e.TLE2);t/=10,t=f(t=parseFloat(t).toPrecision(7),8);var o=(e.raan*a).toPrecision(7);d=o,(o=o.toString().split("."))[0]=o[0].substr(-3,3),o[1]=o[1].substr(0,4),o=f(o=(o[0]+"."+o[1]).toString(),8);var n=e.SCC_NUM,i=e.TLE1.substr(9,8),l=(e.inclination*a).toPrecision(7);(l=l.split("."))[0]=l[0].substr(-3,3),l[1]=l[1].substr(0,4),l=f(l=(l[0]+"."+l[1]).toString(),8);var g,T=e.TLE1.substr(18,2),p=e.TLE1.substr(20,12),h=e.TLE2.substr(52,11),v=e.eccentricity.toPrecision(7).substr(2,7);(g=(g=void 0===b?(e.argPe*a).toPrecision(7):b).split("."))[0]=g[0].substr(-3,3),g[1]=g[1].substr(0,4),g=f(g=(g[0]+"."+g[1]).toString(),8);var C="1 "+n+"U "+i+" "+T+p+e.TLE1.substr(32,39),x="2 "+n+" "+l+" "+o+" "+v+" "+g+" "+t+" "+h+"    10";s=satellite.twoline2satrec(C,x);var M=U(r,s,1);return 1===M&&(m=C,u=x,e.TLE1=C,e.TLE2=x,c=t),M}function L(t,s){var o=satellite.twoline2satrec(e.TLE1,e.TLE2),n=c;rascNum=t,(t/=100)>360&&(t-=360),(t=(t=t.toPrecision(7)).split("."))[0]=t[0].substr(-3,3),t[1]=t[1].substr(0,4),t=f(t=(t[0]+"."+t[1]).toString(),8),d=t;var i=e.SCC_NUM,l=e.TLE1.substr(9,8),g=(e.inclination*a).toPrecision(7);(g=g.split("."))[0]=g[0].substr(-3,3),g[1]=g[1].substr(0,4),g=f(g=(g[0]+"."+g[1]).toString(),8);var T,p=e.TLE1.substr(18,2),h=e.TLE1.substr(20,12),v=e.TLE2.substr(52,11),C=e.eccentricity.toPrecision(7).substr(2,7);(T=(T=void 0===b?(e.argPe*a).toPrecision(7):b).split("."))[0]=T[0].substr(-3,3),T[1]=T[1].substr(0,4),T=f(T=(T[0]+"."+T[1]).toString(),8);var x=e.TLE1.substr(32,39);m="1 "+i+"U "+l+" "+p+h+x,u="2 "+i+" "+g+" "+t+" "+C+" "+T+" "+n+" "+v+"    10",o=satellite.twoline2satrec(m,u);var M=U(r,o,2);return 1===M&&(e.TLE1=m,(t=rascNum/100+s)>360&&(t-=360),t<0&&(t+=360),(t=(t=t.toPrecision(7)).split("."))[0]=t[0].substr(-3,3),t[1]=t[1].substr(0,4),t=f(t=(t[0]+"."+t[1]).toString(),8),d=t,u="2 "+i+" "+g+" "+t+" "+C+" "+T+" "+n+" "+v+"    10",e.TLE2=u),M}function U(e,a,i){timeManager.propRealTime=Date.now();var r=timeManager.propTimeCheck(e,timeManager.propRealTime),g=timeManager.jday(r.getUTCFullYear(),r.getUTCMonth()+1,r.getUTCDate(),r.getUTCHours(),r.getUTCMinutes(),r.getUTCSeconds());g+=r.getUTCMilliseconds()*o;var m,u,c,d,b=satellite.gstime(g),T=(g-a.jdsatepoch)*s,p=satellite.sgp4(a,T);void 0===p&&console.log(a);try{m=satellite.eciToGeodetic(p.position,b)}catch(e){return console.warn(e),2}if(u=1*satellite.degreesLat(m.latitude),c=1*satellite.degreesLong(m.longitude),d=m.height,null==h&&(h=u),1===i){if(u===h)return 0;u>h&&(v="N"),u<h&&(v="S"),h=u}return u>t-.15&&u<t+.15&&1===i?1:c>n-.15&&c<n+.15&&2===i?1:d>l-30&&d<l+30&&3===i?1:(u>t-11&&u<t+11||1!==i)&&(c>n-11&&c<n+11||2!==i)?(d<l-100||d>l+100)&&3===i?5:0:5}},satellite.calculateLookAngles=function(e,n,i){var r;!function(){if(void 0===n){if(!satellite.checkSensorSelected())return void console.error("getlookangles2 requires a sensor!");n=satellite.currentSensor}else{if(void 0===n.obsminaz)return void console.error("sensor format incorrect");n.observerGd={latitude:n.lat*t,longitude:n.long*t,height:parseFloat(n.obshei)}}void 0===e?console.error("sat parameter required!"):void 0!==e.TLE1&&void 0!==e.TLE2||console.error("sat parameter invalid format!"),void 0===r&&(r=0),void 0===satellite.isRiseSetLookangles&&(satellite.isRiseSetLookangles=!1)}();var l,g=0,m=satellite.twoline2satrec(e.TLE1,e.TLE2),u=[];satellite.isRiseSetLookangles&&(l=satellite.lookanglesInterval,satellite.lookanglesInterval=1);for(var c=0;c<24*satellite.lookanglesLength*60*60;c+=satellite.lookanglesInterval)g=1e3*c+r,u.length<=5e3&&(lookanglesRow=d(g,m),"undefined"!=typeof lookanglesRow&&u.push(lookanglesRow));function d(e,t){var i=new Date;i.setTime(Number(Date.now())+e);var r=b(i.getUTCFullYear(),i.getUTCMonth()+1,i.getUTCDate(),i.getUTCHours(),i.getUTCMinutes(),i.getUTCSeconds());r+=i.getUTCMilliseconds()*o;var l,g,m,u,c,d=satellite.gstime(r),T=(r-t.jdsatepoch)*s,p=satellite.sgp4(t,T);if(l=satellite.eciToEcf(p.position,d),m=(g=satellite.ecfToLookAngles(n.observerGd,l)).azimuth*a,u=g.elevation*a,c=g.rangeSat,(!(n.obsminaz<n.obsmaxaz)||m>=n.obsminaz&&m<=n.obsmaxaz&&u>=n.obsminel&&u<=n.obsmaxel&&c<=n.obsmaxrange&&c>=n.obsminrange&&!(m>=n.obsminaz2&&m<=n.obsmaxaz2&&u>=n.obsminel2&&u<=n.obsmaxel2&&c<=n.obsmaxrange2&&c>=n.obsminrange2))&&((m>=n.obsminaz||m<=n.obsmaxaz)&&u>=n.obsminel&&u<=n.obsmaxel&&c<=n.obsmaxrange&&c>=n.obsminrange||(m>=n.obsminaz2||m<=n.obsmaxaz2)&&u>=n.obsminel2&&u<=n.obsmaxel2&&c<=n.obsmaxrange2&&c>=n.obsminrange2)){if(satellite.isRiseSetLookangles){var h=new Date;h.setTime(Number(Date.now())+e-1e3*satellite.lookanglesInterval);var v=timeManager.jday(h.getUTCFullYear(),h.getUTCMonth()+1,h.getUTCDate(),h.getUTCHours(),h.getUTCMinutes(),h.getUTCSeconds());v+=h.getUTCMilliseconds()*o;var C,x,M,f,S,z=satellite.gstime(v),L=(v-t.jdsatepoch)*s,U=satellite.sgp4(t,L);return C=satellite.eciToEcf(U.position,z),M=(x=satellite.ecfToLookAngles(n.observerGd,C)).azimuth*a,f=x.elevation*a,S=x.rangeSat,!((m>=n.obsminaz||m<=n.obsmaxaz)&&u>=n.obsminel&&u<=n.obsmaxel&&c<=n.obsmaxrange&&c>=n.obsminrange)||(m>=n.obsminaz2||m<=n.obsmaxaz2)&&u>=n.obsminel2&&u<=n.obsmaxel2&&c<=n.obsmaxrange2&&c>=n.obsminrange2?{time:timeManager.dateFormat(i,"isoDateTime",!0),rng:c,az:m,el:u}:(h.setTime(Number(Date.now())+e-1e3*satellite.lookanglesInterval),v=b(h.getUTCFullYear(),h.getUTCMonth()+1,h.getUTCDate(),h.getUTCHours(),h.getUTCMinutes(),h.getUTCSeconds()),v+=h.getUTCMilliseconds()*o,z=satellite.gstime(v),L=(v-t.jdsatepoch)*s,U=satellite.sgp4(t,L),C=satellite.eciToEcf(U.position,z),M=(x=satellite.ecfToLookAngles(n.observerGd,C)).azimuth*a,f=x.elevation*a,S=x.rangeSat,!((M>=n.obsminaz||M<=n.obsmaxaz)&&f>=n.obsminel&&f<=n.obsmaxel&&S<=n.obsmaxrange&&S>=n.obsminrange)||(M>=n.obsminaz2||M<=n.obsmaxaz2)&&f>=n.obsminel2&&f<=n.obsmaxel2&&S<=n.obsmaxrange2&&S>=n.obsminrange2?{time:timeManager.dateFormat(i,"isoDateTime",!0),rng:c,az:m,el:u}:void 0)}return{time:timeManager.dateFormat(i,"isoDateTime",!0),rng:c,az:m,el:u}}}function b(e,t,a,s,n,i){return e?367*e-Math.floor(7*(e+Math.floor((t+9)/12))*.25)+Math.floor(275*t/9)+a+1721013.5+((i/60+n)/60+s)/24:(r=Date.now(),jDayStart=new Date(r.getFullYear(),0,0),jDayDiff=r-jDayStart,Math.floor(jDayDiff/o));var r}return satellite.isRiseSetLookangles&&(satellite.lookanglesInterval=l),u},satellite.getDOPsTable=function(e,t,a){var s,o=document.getElementById("dops");o.innerHTML="";var n=timeManager.getPropOffset(),i=0,r=o.insertRow(),l=r.insertCell();l.appendChild(document.createTextNode("Time"));var g=r.insertCell();g.appendChild(document.createTextNode("HDOP"));var m=r.insertCell();m.appendChild(document.createTextNode("PDOP"));var u=r.insertCell();u.appendChild(document.createTextNode("GDOP"));for(var c=0;c<1440;c++)i=1e3*c*60+n,s=timeManager.propTimeCheck(i,timeManager.propRealTime),dops=satellite.getDOPs(e,t,a,!1,s),(l=(r=o.insertRow()).insertCell()).appendChild(document.createTextNode(timeManager.dateFormat(s,"isoDateTime",!0))),(g=r.insertCell()).appendChild(document.createTextNode(dops.HDOP)),(m=r.insertCell()).appendChild(document.createTextNode(dops.PDOP)),(u=r.insertCell()).appendChild(document.createTextNode(dops.GDOP))},satellite.getDOPs=function(e,s,o,n,i){if(void 0!==e){if(void 0!==s){var r,l;o=void 0!==o?o:0,n=void 0!==n&&n,e*=t,s*=t;var g=[];void 0===groups.GPSGroup&&(groups.GPSGroup=new groups.SatGroup("nameRegex",/NAVSTAR/)),void 0===i&&(i=timeManager.propTime());var m=timeManager.jday(i.getUTCFullYear(),i.getUTCMonth()+1,i.getUTCDate(),i.getUTCHours(),i.getUTCMinutes(),i.getUTCSeconds());m+=1.15741e-8*i.getUTCMilliseconds();var u=satellite.gstime(m),c={},d=Math.cos(e),b=Math.sin(e),T=Math.cos(s+u),p=Math.sin(s+u);c.x=6371.25*d*T,c.y=6371.25*d*p,c.z=6371.25*b;for(var h=0;h<groups.GPSGroup.sats.length;h++)r=satSet.getSat(groups.GPSGroup.sats[h].satId),l=satellite.ecfToLookAngles({longitude:s,latitude:e,height:o},satellite.eciToEcf(r.position,u)),r.az=l.azimuth*a,r.el=l.elevation*a,r.el>settingsManager.gpsElevationMask&&g.push(r);return satellite.calculateDOPs(g,c,n)}console.error("Longitude Required")}else console.error("Latitude Required")},satellite.calculateDOPs=function(e,t,a){var s={};if(nsat=e.length,nsat<4)return s.PDOP=50,s.HDOP=50,s.GDOP=50,s.VDOP=50,s.TDOP=50,s;var o=numeric.rep([nsat,4],0),n=[],i=[];a&&(drawLineList=[]);for(var r=1;r<=nsat;r++){var l=e[r-1];a&&(drawLineList[r-1]={},drawLineList[r-1].line=new Line,drawLineList[r-1].sat=l,drawLineList[r-1].ref=[t.x,t.y,t.z]);var g=l.az,m=l.el;n.push(g),i.push(m);var u=[Math.cos(m*Math.PI/180)*Math.sin(g*Math.PI/180),Math.cos(m*Math.PI/180)*Math.cos(g*Math.PI/180),Math.sin(m*Math.PI/180),1];numeric.setBlock(o,[r-1,0],[r-1,3],[u])}var c=numeric.dot(numeric.transpose(o),o),d=numeric.inv(c),b=Math.sqrt(d[0][0]+d[1][1]+d[2][2]),T=Math.sqrt(d[0][0]+d[1][1]),p=Math.sqrt(d[0][0]+d[1][1]+d[2][2]+d[3][3]),h=Math.sqrt(d[2][2]),v=Math.sqrt(d[3][3]);return s.PDOP=parseFloat(Math.round(100*b)/100).toFixed(2),s.HDOP=parseFloat(Math.round(100*T)/100).toFixed(2),s.GDOP=parseFloat(Math.round(100*p)/100).toFixed(2),s.VDOP=parseFloat(Math.round(100*h)/100).toFixed(2),s.TDOP=parseFloat(Math.round(100*v)/100).toFixed(2),s},satellite.getSunTimes=function(e,t,n,i){if(void 0===t){if(void 0===satellite.currentSensor)throw"getTEARR requires a sensor or for a sensor to be currently selected.";t=satellite.currentSensor}if(void 0===t.observerGd)try{t.observerGd={height:t.obshei,latitude:t.lat,longitude:t.long}}catch(e){throw"observerGd is not set and could not be guessed."}void 0===n&&(n=satellite.lookanglesLength),void 0===i&&(i=satellite.lookanglesInterval);for(var r=timeManager.getPropOffset(),l=0,g=satellite.twoline2satrec(e.TLE1,e.TLE2),m=1e11,u=0;u<24*n*60*60;u+=i){l=1e3*u+r;var c=timeManager.propTimeCheck(l,timeManager.propRealTime),d=timeManager.jday(c.getUTCFullYear(),c.getUTCMonth()+1,c.getUTCDate(),c.getUTCHours(),c.getUTCMinutes(),c.getUTCSeconds());d+=c.getUTCMilliseconds()*o;var b,T,p,h,v,C=satellite.gstime(d),x=sun.getDirection2(d),M=1e6*x[0],f=1e6*x[1],S=1e6*x[2],z=(d-g.jdsatepoch)*s,L=satellite.sgp4(g,z),U=Math.pow(M-L.position.x,2),w=Math.pow(f-L.position.y,2),E=Math.pow(S-L.position.z,2),D=Math.sqrt(U+w+E);b=satellite.eciToEcf(L.position,C),T=satellite.ecfToLookAngles(t.observerGd,b),gpos=satellite.eciToGeodetic(L.position,C),alt=1e3*gpos.height,lon=gpos.longitude,lat=gpos.latitude,p=T.azimuth*a,h=T.elevation*a,v=T.rangeSat,t.obsminaz>t.obsmaxaz?((p>=t.obsminaz||p<=t.obsmaxaz)&&h>=t.obsminel&&h<=t.obsmaxel&&v<=t.obsmaxrange&&v>=t.obsminrange||(p>=t.obsminaz2||p<=t.obsmaxaz2)&&h>=t.obsminel2&&h<=t.obsmaxel2&&v<=t.obsmaxrange2&&v>=t.obsminrange2)&&D<m&&(m=D,c):(p>=t.obsminaz&&p<=t.obsmaxaz&&h>=t.obsminel&&h<=t.obsmaxel&&v<=t.obsmaxrange&&v>=t.obsminrange||p>=t.obsminaz2&&p<=t.obsmaxaz2&&h>=t.obsminel2&&h<=t.obsmaxel2&&v<=t.obsmaxrange2&&v>=t.obsminrange2)&&D<m&&(m=D,c)}},satellite.lookAnglesToEcf=function(e,a,s,o,n,i){var r={};r.latitude=o,r.longitude=n,r.height=i;var l,g,m,u=satellite.geodeticToEcf(r);l=u.x,g=u.y,m=u.z;var c=Math.sin(o),d=Math.sin(n),b=Math.cos(o),T=Math.cos(n),p=t*e,h=t*a,v=-s*Math.cos(h)*Math.cos(p),C=s*Math.cos(h)*Math.sin(p),x=s*Math.sin(h);return{x:c*T*v+-d*C+b*T*x+l,y:c*d*v+T*C+b*d*x+g,z:-b*v+c*x+m}},satellite.xyz2latlon=function(e,t,s){var o=timeManager.propTime(),n=timeManager.jday(o.getUTCFullYear(),o.getUTCMonth()+1,o.getUTCDate(),o.getUTCHours(),o.getUTCMinutes(),o.getUTCSeconds());n+=1.15741e-8*o.getUTCMilliseconds();var i=satellite.gstime(n),r=satellite.eciToGeodetic({x:e,y:t,z:s},i);return r.latitude=r.latitude*a,r.longitude=r.longitude*a,r.longitude=r.longitude>180?r.longitude-360:r.longitude,r.longitude=r.longitude<-180?r.longitude+360:r.longitude,r},satellite.isInSun=function(e){var t=sun.getXYZ(),s=Math.asin(RADIUS_OF_EARTH/Math.sqrt(Math.pow(-e.position.x,2)+Math.pow(-e.position.y,2)+Math.pow(-e.position.z,2)))*a,o=Math.asin(RADIUS_OF_SUN/Math.sqrt(Math.pow(-e.position.x+t.x,2)+Math.pow(-e.position.y+t.y,2)+Math.pow(-e.position.z+t.z,2)))*a,n=Math.acos(numeric.dot([-e.position.x,-e.position.y,-e.position.z],[-e.position.x+t.x,-e.position.y+t.y,-e.position.z+t.z])/(Math.sqrt(Math.pow(-e.position.x,2)+Math.pow(-e.position.y,2)+Math.pow(-e.position.z,2))*Math.sqrt(Math.pow(-e.position.x+t.x,2)+Math.pow(-e.position.y+t.y,2)+Math.pow(-e.position.z+t.z,2))))*a;return s>o&&n<s-o?0:Math.abs(s-o)<n&&n<s+o?1:o>s?1:n<o-s?1:2},satellite.map=function(e,t){var n=timeManager.getPropOffset(),i=satellite.twoline2satrec(e.TLE1,e.TLE2);return function(e,t){var n=timeManager.propTimeCheck(e,timeManager.propRealTime),i=timeManager.jday(n.getUTCFullYear(),n.getUTCMonth()+1,n.getUTCDate(),n.getUTCHours(),n.getUTCMinutes(),n.getUTCSeconds());i+=n.getUTCMilliseconds()*o;var r,l,g,m=satellite.gstime(i),u=(i-t.jdsatepoch)*s,c=satellite.sgp4(t,u);r=satellite.eciToGeodetic(c.position,m),l=satellite.degreesLat(r.latitude),g=satellite.degreesLong(r.longitude);var d,b,T,p,h,v=timeManager.dateFormat(n,"isoDateTime",!0);d=satellite.eciToEcf(c.position,m),b=satellite.ecfToLookAngles(satellite.currentSensor.observerGd,d),T=b.azimuth*a,p=b.elevation*a,h=b.rangeSat;var C=0;satellite.currentSensor.obsminaz<satellite.currentSensor.obsmaxaz?(T>=satellite.currentSensor.obsminaz&&T<=satellite.currentSensor.obsmaxaz&&p>=satellite.currentSensor.obsminel&&p<=satellite.currentSensor.obsmaxel&&h<=satellite.currentSensor.obsmaxrange&&h>=satellite.currentSensor.obsminrange||T>=satellite.currentSensor.obsminaz2&&T<=satellite.currentSensor.obsmaxaz2&&p>=satellite.currentSensor.obsminel2&&p<=satellite.currentSensor.obsmaxel2&&h<=satellite.currentSensor.obsmaxrange2&&h>=satellite.currentSensor.obsminrange2)&&(C=1):((T>=satellite.currentSensor.obsminaz||T<=satellite.currentSensor.obsmaxaz)&&p>=satellite.currentSensor.obsminel&&p<=satellite.currentSensor.obsmaxel&&h<=satellite.currentSensor.obsmaxrange&&h>=satellite.currentSensor.obsminrange||(T>=satellite.currentSensor.obsminaz2||T<=satellite.currentSensor.obsmaxaz2)&&p>=satellite.currentSensor.obsminel2&&p<=satellite.currentSensor.obsmaxel2&&h<=satellite.currentSensor.obsmaxrange2&&h>=satellite.currentSensor.obsminrange2)&&(C=1);return{lat:l,lon:g,time:v,inview:C}}(t*e.period/50*60*1e3+n,i)}}();