!function(){var e,t,r,a=[],l=[],i={};i.emptyOrbitBuffer=new Float32Array(768);var n=-1,o=-1,g=[],s=mat4.create(),u=new Worker(settingsManager.installDirectory+"js/orbit-calculation-worker.js"),f=!1;function A(){var e=gl.createBuffer();return gl.bindBuffer(gl.ARRAY_BUFFER,e),gl.bufferData(gl.ARRAY_BUFFER,i.emptyOrbitBuffer,gl.STATIC_DRAW),e}i.init=function(){var l=gl.createShader(gl.VERTEX_SHADER);gl.shaderSource(l,shaderLoader.getShaderCode("path-vertex.glsl")),gl.compileShader(l);var n=gl.createShader(gl.FRAGMENT_SHADER);gl.shaderSource(n,shaderLoader.getShaderCode("path-fragment.glsl")),gl.compileShader(n),e=gl.createProgram(),gl.attachShader(e,l),gl.attachShader(e,n),gl.linkProgram(e),e.aPos=gl.getAttribLocation(e,"aPos"),e.uMvMatrix=gl.getUniformLocation(e,"uMvMatrix"),e.uCamMatrix=gl.getUniformLocation(e,"uCamMatrix"),e.uPMatrix=gl.getUniformLocation(e,"uPMatrix"),e.uColor=gl.getUniformLocation(e,"uColor"),t=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,t),gl.bufferData(gl.ARRAY_BUFFER,i.emptyOrbitBuffer,gl.STATIC_DRAW),r=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,r),gl.bufferData(gl.ARRAY_BUFFER,i.emptyOrbitBuffer,gl.STATIC_DRAW);for(var o=0;o<satSet.missileSats;o++)a.push(A());u.postMessage({isInit:!0,satData:satSet.satDataString,numSegs:255}),f=!0,satSet.satDataString=null,objectManager.fieldOfViewSet=null},i.updateOrbitBuffer=function(e,t,r,a,i,n,o,g){l[e]||satSet.getSat(e).static||(t?u.postMessage({isInit:!1,isUpdate:!0,satId:e,realTime:timeManager.propRealTime,offset:timeManager.propOffset,rate:timeManager.propRate,TLE1:r,TLE2:a}):i?u.postMessage({isInit:!1,isUpdate:!0,missile:!0,satId:e,latList:n,lonList:o,altList:g}):(u.postMessage({isInit:!1,satId:e,realTime:timeManager.propRealTime,offset:timeManager.propOffset,rate:timeManager.propRate}),l[e]=!0))},u.onmessage=function(e){var t=e.data.satId,r=new Float32Array(e.data.pointsOut);gl.bindBuffer(gl.ARRAY_BUFFER,a[t]),gl.bufferData(gl.ARRAY_BUFFER,r,gl.DYNAMIC_DRAW),l[t]=!1},i.setSelectOrbit=function(e){o=e,i.updateOrbitBuffer(e)},i.clearSelectOrbit=function(){o=-1,gl.bindBuffer(gl.ARRAY_BUFFER,t),gl.bufferData(gl.ARRAY_BUFFER,i.emptyOrbitBuffer,gl.DYNAMIC_DRAW)},i.addInViewOrbit=function(e){for(var t=0;t<g.length;t++)if(e===g[t])return;g.push(e),i.updateOrbitBuffer(e)},i.removeInViewOrbit=function(e){for(var t=null,r=0;r<g.length;r++)e===g[r]&&(t=r);null!==t&&(g.splice(t,1),i.updateOrbitBuffer(e))},i.clearInViewOrbit=function(e){g!==[]&&(g=[])},i.setHoverOrbit=function(e){e!==n&&(n=e,i.updateOrbitBuffer(e))},i.clearHoverOrbit=function(e){-1!==n&&(n=-1,gl.bindBuffer(gl.ARRAY_BUFFER,r),gl.bufferData(gl.ARRAY_BUFFER,i.emptyOrbitBuffer,gl.DYNAMIC_DRAW))},i.draw=function(t,r){if(f)return gl.bindFramebuffer(gl.FRAMEBUFFER,null),gl.useProgram(e),gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA),gl.enable(gl.BLEND),settingsManager.showOrbitThroughEarth?gl.disable(gl.DEPTH_TEST):gl.enable(gl.DEPTH_TEST),gl.uniformMatrix4fv(e.uMvMatrix,!1,s),gl.uniformMatrix4fv(e.uCamMatrix,!1,r),gl.uniformMatrix4fv(e.uPMatrix,!1,t),-1===o||satSet.getSatExtraOnly(o).static||(gl.uniform4fv(e.uColor,settingsManager.orbitSelectColor),gl.bindBuffer(gl.ARRAY_BUFFER,a[o]),gl.vertexAttribPointer(e.aPos,3,gl.FLOAT,!1,0,0),gl.enableVertexAttribArray(e.aPos),gl.drawArrays(gl.LINE_STRIP,0,256)),-1===n||n===o||satSet.getSatExtraOnly(n).static||(gl.uniform4fv(e.uColor,settingsManager.orbitHoverColor),gl.bindBuffer(gl.ARRAY_BUFFER,a[n]),gl.vertexAttribPointer(e.aPos,3,gl.FLOAT,!1,0,0),gl.enableVertexAttribArray(e.aPos),gl.drawArrays(gl.LINE_STRIP,0,256)),g.length>=1&&(gl.uniform4fv(e.uColor,settingsManager.orbitInViewColor),g.forEach(function(t){gl.bindBuffer(gl.ARRAY_BUFFER,a[t]),gl.vertexAttribPointer(e.aPos,3,gl.FLOAT,!1,0,0),gl.enableVertexAttribArray(e.aPos),gl.drawArrays(gl.LINE_STRIP,0,256)})),null===groups.selectedGroup||settingsManager.isGroupOverlayDisabled||(gl.uniform4fv(e.uColor,settingsManager.orbitGroupColor),groups.selectedGroup.forEach(function(t){gl.bindBuffer(gl.ARRAY_BUFFER,a[t]),gl.vertexAttribPointer(e.aPos,3,gl.FLOAT,!1,0,0),gl.enableVertexAttribArray(e.aPos),gl.drawArrays(gl.LINE_STRIP,0,256)})),gl.disableVertexAttribArray(e.aPos),gl.disableVertexAttribArray(e.aColor),gl.disable(gl.BLEND),gl.enable(gl.DEPTH_TEST),!0},i.getPathShader=function(){return e},i.historyOfSatellitesRunCount=0,i.historyOfSatellitesPlay=(()=>{i.historyOfSatellitesRunCount++,i.isTimeMachineRunning=!0,i.tempTransColor=settingsManager.colors.transparent,settingsManager.colors.transparent=[0,0,0,0];for(let e=0;e<=200;e++){let t=59+e;if(t>=100&&(t-=100),setTimeout(function(e){i.isTimeMachineVisible&&e===i.historyOfSatellitesRunCount&&(yearGroup=new groups.SatGroup("yearOrLess",t),groups.selectGroup(yearGroup),yearGroup.updateOrbits(),satSet.setColorScheme(ColorScheme.group,!0),t>=59&&t<100?M.toast({html:`Time Machine In Year 19${t}!`}):(yearStr=t<10?`0${t}`:`${t}`,M.toast({html:`Time Machine In Year 20${yearStr}!`})),20==t&&setTimeout(function(){e===i.historyOfSatellitesRunCount&&i.isTimeMachineVisible&&(settingsManager.colors.transparent=i.tempTransColor,i.isTimeMachineRunning=!1,groups.clearSelect(),satSet.setColorScheme(ColorScheme.default,!0))},1e4))},settingsManager.timeMachineDelay*e,i.historyOfSatellitesRunCount),20==t)break}}),window.orbitManager=i}();